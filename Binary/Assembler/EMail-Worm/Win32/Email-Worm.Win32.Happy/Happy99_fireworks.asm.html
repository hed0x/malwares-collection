<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Happy - Happy99_fireworks.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc7 {
	font-weight: bold;
	color: #0080C0;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;Graphic effect of Happy99, by Spanska</span><span class="sc0">
</span><span class="sc1">;A cute fireworks animation, done using a particle algorithm stolen from </span><span class="sc0">
</span><span class="sc1">;a beautiful 256 bytes demo by Picard/Hydrogen</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;if you want to understand comments, learn french or use Altavista ;)</span><span class="sc0">
</span><span class="sc1">;at the very end, you can post a message for me in alt.comp.virus</span><span class="sc0">

</span><span class="sc1">;--------------------------- (c) Spanska 1999 ---------------------------------</span><span class="sc0">

</span><span class="sc2">.386</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">GetModuleHandleA</span><span class="sc0">    </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">RegisterClassA</span><span class="sc0">      </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">CreateWindowExA</span><span class="sc0">     </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">ShowWindow</span><span class="sc0">      </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">UpdateWindow</span><span class="sc0">        </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">PeekMessageA</span><span class="sc0">        </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">SetPixelV</span><span class="sc0">       </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">TranslateMessage</span><span class="sc0">    </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">DispatchMessageA</span><span class="sc0">    </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">DefWindowProcA</span><span class="sc0">      </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">LocalAlloc</span><span class="sc0">      </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">LocalFree</span><span class="sc0">       </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">GetDC</span><span class="sc0">           </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">ReleaseDC</span><span class="sc0">       </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">PostQuitMessage</span><span class="sc0">     </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">       </span><span class="sc5">ExitProcess</span><span class="sc0">     </span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc5">nombre_explosion_maxi</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc9">.data</span><span class="sc0">

</span><span class="sc5">wndclass</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc5">clsStyle</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">4003h</span><span class="sc0">  </span><span class="sc1">; class style</span><span class="sc0">
        </span><span class="sc5">clsLpfnWndProc</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
        </span><span class="sc5">clsCbClsExtra</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">clsCbWndExtra</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">clsHInstance</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">      </span><span class="sc1">; instance handle</span><span class="sc0">
        </span><span class="sc5">clsHIcon</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; class icon handle</span><span class="sc0">
        </span><span class="sc5">clsHCursor</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; class cursor handle</span><span class="sc0">
        </span><span class="sc5">clsHbrBackground</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">      </span><span class="sc1">; class background brush</span><span class="sc0">
        </span><span class="sc5">clsLpszMenuName</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; menu name</span><span class="sc0">
        </span><span class="sc5">clsLpszClassName</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">      </span><span class="sc1">; far ptr to class name</span><span class="sc0">

</span><span class="sc5">msg</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">msHWND</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">msMESSAGE</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">msWPARAM</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">msLPARAM</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">msTIME</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">msPT</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">protege</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
    
</span><span class="sc5">nb_explosions</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">compteur</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">color</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">yy</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">xx</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">seed</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0FFAABB11h</span><span class="sc0">
</span><span class="sc5">theDC</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">writebuffer</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">nom_fenetre</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"Happy 2000 to 29A readers !!"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">handle</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">handle_wd</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">adresse_retour</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc9">.code</span><span class="sc0">

</span><span class="sc5">HOST</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;----- se réserver de la mémoire</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">32</span><span class="sc4">*</span><span class="sc2">257</span><span class="sc4">)*</span><span class="sc5">nombre_explosion_maxi</span><span class="sc0">     </span><span class="sc1">;number of bytes to allocate</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">LARGE</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">;allocation attributes (40h=LMEM_ZEROINIT)</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LocalAlloc</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">writebuffer</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">


</span><span class="sc1">;----- enregistrer la wndclass</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetModuleHandleA</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">handle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">clsHInstance</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">wndproc</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">clsLpfnWndProc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">clsLpszClassName</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nom_fenetre</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">wndclass</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">RegisterClassA</span><span class="sc0">

</span><span class="sc1">;----- creer la fenetre</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">handle</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">512</span><span class="sc0">            </span><span class="sc1">;hauteur</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">256</span><span class="sc0">            </span><span class="sc1">;largeur</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">100</span><span class="sc0">            </span><span class="sc1">;y</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">100</span><span class="sc0">            </span><span class="sc1">;x</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">00080000h</span><span class="sc4">+</span><span class="sc2">00040000h</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nom_fenetre</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nom_fenetre</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;extra style</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CreateWindowExA</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">handle_wd</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">handle_wd</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ShowWindow</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">handle_wd</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">UpdateWindow</span><span class="sc0">

</span><span class="sc1">;----- le message loop</span><span class="sc0">

</span><span class="sc5">msg_loop</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msg</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">PeekMessageA</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">process_messages</span><span class="sc0">

</span><span class="sc1">;-------- dessiner tous les points</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">compteur</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nombre_explosion_maxi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">compteur</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">ini_explosion</span><span class="sc0">

</span><span class="sc5">la_suite</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">handle_wd</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetDC</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">theDC</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">*</span><span class="sc2">256</span><span class="sc0">             </span><span class="sc1">;16 explosions of 256 pixels each</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">writebuffer</span><span class="sc0">

</span><span class="sc5">zozo2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;get Y coordinate</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;save it in a unused zone</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;get X coordinate</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;save it in unused zone</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">001000h</span><span class="sc0">            </span><span class="sc1">;gravity: add 0.1 pixel to Y speed</span><span class="sc0">
</span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">;load Y speed</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">;add Y speed to Y coordinate </span><span class="sc0">
</span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">;load X speed</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">;add X speed to X coordinate</span><span class="sc0">

</span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">;load Y coordinate</span><span class="sc0">
</span><span class="sc6">sar</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">                 </span><span class="sc1">;remove decimal part</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;save in edx</span><span class="sc0">
</span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">;load X coordinate</span><span class="sc0">
</span><span class="sc6">sar</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">                 </span><span class="sc1">;remove decimal part</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                    </span><span class="sc1">;save in ebx</span><span class="sc0">

</span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">;load color</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                  </span><span class="sc1">;color=0?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">point_pas_noir</span><span class="sc0">              </span><span class="sc1">;no: decrease color intensity</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">                  </span><span class="sc1">;yes: go to next pixel</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">fin_loop</span><span class="sc0">

</span><span class="sc5">point_pas_noir</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">;decrease Red component of color</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">R_pas_a_zero</span><span class="sc0">                </span><span class="sc1">;if positive, go to next component</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">;if negative, put 0</span><span class="sc0">
</span><span class="sc5">R_pas_a_zero</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">;decrease Green component of color</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">G_pas_a_zero</span><span class="sc0">                </span><span class="sc1">;if positive, go to next component</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">;if negative, put 0</span><span class="sc0">
</span><span class="sc5">G_pas_a_zero</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">;decrease Blue component of color</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">B_pas_a_zero</span><span class="sc0">                </span><span class="sc1">;if positive, go to next component</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">             </span><span class="sc1">;if negative, put 0</span><span class="sc0">
</span><span class="sc5">B_pas_a_zero</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">        </span><span class="sc1">;be careful, this API fucks esi, ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;colorref</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">        </span><span class="sc1">;y</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">        </span><span class="sc1">;x</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">theDC</span><span class="sc0">      </span><span class="sc1">;the Device Context</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetPixelV</span><span class="sc0">      </span><span class="sc1">;quand la fenetre est repeinte, on met le pixel à sa coordonnée</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc6">lodsd</span><span class="sc0">           </span><span class="sc1">;get the precedent Y coord from unused zone where we saved it</span><span class="sc0">
</span><span class="sc6">sar</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">     </span><span class="sc1">;remove decimal part</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;put in edx</span><span class="sc0">
</span><span class="sc6">lodsd</span><span class="sc0">           </span><span class="sc1">;get the precedent X coord from unused zone where we saved it</span><span class="sc0">
</span><span class="sc6">sar</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">     </span><span class="sc1">;remove decimal part</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">        </span><span class="sc1">;be careful, this API fucks esi, ecx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;black</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">theDC</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetPixelV</span><span class="sc0">      </span><span class="sc1">;remove pixel from precedent position</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">fin_loop</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">      </span><span class="sc1">;esi points to next pixel structure</span><span class="sc0">

</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">zozo2</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">theDC</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">handle_wd</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ReleaseDC</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc5">compteur</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">msg_loop</span><span class="sc0">

</span><span class="sc1">;----- pour voir si la fenetre est fermée</span><span class="sc0">

</span><span class="sc5">process_messages</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">msMESSAGE</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12h</span><span class="sc0">  </span><span class="sc1">;WM_QUIT equ 0012h</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">end_loop</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msg</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">TranslateMessage</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msg</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">DispatchMessageA</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">msg_loop</span><span class="sc0">

</span><span class="sc5">end_loop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">writebuffer</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">LocalFree</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">msWPARAM</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ExitProcess</span><span class="sc0">             </span><span class="sc1">;this terminates the program</span><span class="sc0">

</span><span class="sc1">;----- procédure de fenêtre vide pour accélérer</span><span class="sc0">

</span><span class="sc5">wndproc</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">adresse_retour</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">suite</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">PostQuitMessage</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">suite2</span><span class="sc0">

</span><span class="sc5">suite</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">DefWindowProcA</span><span class="sc0">

</span><span class="sc5">suite2</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">adresse_retour</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;----- procédure pour initialiser une explosion</span><span class="sc0">

</span><span class="sc5">ini_explosion</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nb_explosions</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nombre_explosion_maxi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">nb_explosions</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc0">             </span><span class="sc1">;chaque explosion se garde un buffer de 8192</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">writebuffer</span><span class="sc0">            </span><span class="sc1">;(256 pixels, 32 bits par pixel)</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">256</span><span class="sc0">                </span><span class="sc1">;on va calculer les 256 points</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">random</span><span class="sc0">
</span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">              </span><span class="sc1">;X: 0FFFFFFFFh/128 = 1FFFFFF</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">xx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;virgule fixe: 1FF,FFFF = 512</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">random</span><span class="sc0">
</span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">              </span><span class="sc1">;Y: 0FFFFFFFFh/256 = FFFFFF</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">yy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">             </span><span class="sc1">;virgule fixe: FF,FFFF = 256</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">random</span><span class="sc0">
</span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">              </span><span class="sc1">;COULEUR: codee sur 3 octets</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AF0F0Fh</span><span class="sc0">            </span><span class="sc1">;masque pour augmenter la luminosite</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">color</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">zozo</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">random</span><span class="sc0">
</span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc0">             </span><span class="sc1">;VITESSE: 0FFFFFFFFh/32768 = 1FFFF </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">              </span><span class="sc1">;virgule fixe: 1,FFFF = entre 1 et 2</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">            </span><span class="sc1">;ANGLE: en radians, ecx presque random</span><span class="sc0">

</span><span class="sc7">fild</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;charge l'angle dans le copro</span><span class="sc0">
</span><span class="sc7">fsin</span><span class="sc0">                    </span><span class="sc1">;sinus = composante en X</span><span class="sc0">
</span><span class="sc7">fimul</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;multiplie par la vitesse: resultat sur le stack</span><span class="sc0">
</span><span class="sc7">fild</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;charge l'angle par dessus</span><span class="sc0">
</span><span class="sc7">fcos</span><span class="sc0">                    </span><span class="sc1">;cosinus = composante en Y</span><span class="sc0">
</span><span class="sc7">fimul</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;multiplie par la vitesse: resultat sur le stack</span><span class="sc0">
</span><span class="sc7">fistp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;decharge la composante en Y</span><span class="sc0">
</span><span class="sc7">fistp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;decharge la composante en X</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
                    </span><span class="sc1">;structure d'un pixel:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">yy</span><span class="sc0">             </span><span class="sc1">;0  dd composante vitesse en Y </span><span class="sc0">
</span><span class="sc6">stosd</span><span class="sc0">                   </span><span class="sc1">;4  dd composante vitesse en X</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">xx</span><span class="sc0">             </span><span class="sc1">;8  dd coordonnee Y</span><span class="sc0">
</span><span class="sc6">stosd</span><span class="sc0">                   </span><span class="sc1">;12 dd coordonnee X</span><span class="sc0">
                    </span><span class="sc1">;16 dd couleur</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">color</span><span class="sc0">              </span><span class="sc1">;20 dd rien, used to save precedent Y coord </span><span class="sc0">
</span><span class="sc6">stosd</span><span class="sc0">                   </span><span class="sc1">;24 dd rien, used to save precedent X coord</span><span class="sc0">
                    </span><span class="sc1">;28 dd rien</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">             
</span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">zozo</span><span class="sc0">

</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc5">nb_explosions</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">la_suite</span><span class="sc0">

</span><span class="sc1">;----- random</span><span class="sc0">

</span><span class="sc5">random</span><span class="sc4">:</span><span class="sc0"> 

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">214013h</span><span class="sc0">
</span><span class="sc6">imul</span><span class="sc0"> </span><span class="sc5">seed</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                </span><span class="sc1">; Prevent divide overflow by caller</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2531011h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">seed</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

        </span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">HOST</span><span class="sc0">
        
</span><span class="sc1">;--------------------------- (c) Spanska 1999 ---------------------------------</span><span class="sc0">
</span></div></body>
</html>
