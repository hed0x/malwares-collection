<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc5">REG_AX</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; Регистры по порядку</span><span class="sc0">
</span><span class="sc5">REG_CX</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">REG_DX</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">REG_BX</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">REG_SP</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">REG_BP</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">REG_SI</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">
</span><span class="sc5">REG_DI</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">


</span><span class="sc5">Wbit</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000001B</span><span class="sc0">  </span><span class="sc1">;РАЗРЯДНОСТЬ ОПЕРАНДА В КОП</span><span class="sc0">
</span><span class="sc5">Dbit</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000010B</span><span class="sc0">  </span><span class="sc1">;НАПРАВЛЕНИЕ В КОП</span><span class="sc0">
</span><span class="sc5">Mode</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00001100B</span><span class="sc0">  </span><span class="sc1">;ТИП АДРЕСАЦИИ В КОП</span><span class="sc0">
</span><span class="sc5">JRQ</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00010000B</span><span class="sc0">  </span><span class="sc1">;ФЛАГ РАБОТЫ НАД JMP REL8</span><span class="sc0">
</span><span class="sc5">PRQ</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00100000B</span><span class="sc0">  </span><span class="sc1">;ФЛАГ РАБОТЫ НАД PUSH/POP</span><span class="sc0">
</span><span class="sc5">TRQ</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">01000000B</span><span class="sc0">  </span><span class="sc1">;МУСОР ВЛИЯЮЩИЙ НА Flags,AX</span><span class="sc0">
</span><span class="sc5">CRQ</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">10000000B</span><span class="sc0">  </span><span class="sc1">;ЗАПРОС НА CALL</span><span class="sc0">

</span><span class="sc1">;----------------- Управляющие данные ------------------------</span><span class="sc0">
                     </span><span class="sc1">; 7             0</span><span class="sc0">
</span><span class="sc5">REG_USED</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">00010000b</span><span class="sc0">    </span><span class="sc1">; DI SI BP SP BX DX CX AX</span><span class="sc0">

                     </span><span class="sc1">; 7           3  2     0</span><span class="sc0">
</span><span class="sc5">BT_FLAG</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">00000000B</span><span class="sc0">    </span><span class="sc1">; CRQ  TRQ  PRQ  JRQ  MODE  D  W</span><span class="sc0">


</span><span class="sc1">; МАСКИ КОМАНД ,КОТОРЫЕ МОГУТ АДРЕСОВАТЬ В ПАМЯТЬ ( CMP [BX],AL )</span><span class="sc0">

</span><span class="sc5">ARI_MASK</span><span class="sc0">    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">10000111B</span><span class="sc0">    </span><span class="sc1">; КОМАНДА CMP</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">11111111B</span><span class="sc0">    </span><span class="sc1">; КОНЕЦ МАСОК</span><span class="sc0">

</span><span class="sc1">; ТАБЛИЦА МУСОРА</span><span class="sc0">
</span><span class="sc1">; ФОРМАТ БАЙТА СТАТУСА:</span><span class="sc0">
</span><span class="sc1">;     7    6   5   4 3   2  1  0</span><span class="sc0">
</span><span class="sc1">;     TST  WPR 0   ROT   ADDBITS</span><span class="sc0">

</span><span class="sc5">TST</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">10000000B</span><span class="sc0">   </span><span class="sc1">; TEST REGISTER</span><span class="sc0">
</span><span class="sc5">WPR</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">01000000B</span><span class="sc0">   </span><span class="sc1">; Wbite PRESENT BIT</span><span class="sc0">
</span><span class="sc5">WPLACE</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00100000B</span><span class="sc0">   </span><span class="sc1">; Wbite PLACE</span><span class="sc0">
</span><span class="sc5">ROT</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00011000B</span><span class="sc0">   </span><span class="sc1">; ROTATE BY 0..3 BITES</span><span class="sc0">
</span><span class="sc5">ADDBITS</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000111B</span><span class="sc0">   </span><span class="sc1">; ADDING 0...7 BITES (REG/COP)</span><span class="sc0">

</span><span class="sc5">TRASH_TAB</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">10110000B</span><span class="sc4">,</span><span class="sc5">TST</span><span class="sc4">+</span><span class="sc5">WPR</span><span class="sc4">+</span><span class="sc5">WPLACE</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc0"> </span><span class="sc1">;MOV REG,IMM8/16</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">10010000B</span><span class="sc4">,</span><span class="sc5">TST</span><span class="sc4">+</span><span class="sc5">WPLACE</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc0">     </span><span class="sc1">;XCHG AX,REG</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">01000000B</span><span class="sc4">,</span><span class="sc5">TST</span><span class="sc4">+</span><span class="sc5">WPLACE</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc0">     </span><span class="sc1">;INC REG16</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">01001000B</span><span class="sc4">,</span><span class="sc5">TST</span><span class="sc4">+</span><span class="sc5">WPLACE</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc0">     </span><span class="sc1">;DEC REG16</span><span class="sc0">

        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">00000100B</span><span class="sc4">,</span><span class="sc2">01011111B</span><span class="sc0"> </span><span class="sc1">;WPR,ROT=3,ADDBITS=0...7</span><span class="sc0">
                        </span><span class="sc1">;ADD,OR,ADC,... AL/AX,IMM8/16</span><span class="sc0">

        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">00100111B</span><span class="sc4">,</span><span class="sc2">00011011B</span><span class="sc0"> </span><span class="sc1">;ROT=3,ADDBITS=0...3</span><span class="sc0">
                        </span><span class="sc1">;DAA,DAS,AAA,AAS</span><span class="sc0">

        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">11111000B</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">     </span><span class="sc1">;STI,CLI,STD,CLD,STC,CLC</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">10011000B</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;CBW</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">11010111B</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;XLAT</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">11001100B</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;INT 3</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">10011110B</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">     </span><span class="sc1">;SAHF,LAHF</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">11110101B</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">;CMC</span><span class="sc0">
</span><span class="sc5">TR_TAB_END</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc5">JMP_ADDR</span><span class="sc0">    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CALL_ADDR</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0FFFFH</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">RND</span><span class="sc0">     </span><span class="sc9">PROC</span><span class="sc0">        </span><span class="sc1">; DL = RND (0..DL)  Получить случайный байт</span><span class="sc0">

        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">            </span><span class="sc1">; RND(0..0)=0</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">EXRND</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">

        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc0">          </span><span class="sc1">; для 0FFh не надо +1</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">OKK</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc0">
</span><span class="sc5">OKK</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0100H</span><span class="sc0">        </span><span class="sc1">; размер единичного отрезка</span><span class="sc0">
        </span><span class="sc6">DIV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc0">

        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">

        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">55H</span><span class="sc0">
</span><span class="sc5">OLD_RND</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
        </span><span class="sc6">RCL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD_RND</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">

        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">     </span><span class="sc1">; Если RND больше, чем ЕдОтр*ВерхГран,</span><span class="sc0">
        </span><span class="sc6">JBE</span><span class="sc0"> </span><span class="sc5">OKK1</span><span class="sc0">      </span><span class="sc1">; то обрезаем до EдOтр*ВерхГран</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">
</span><span class="sc5">OKK1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">         </span><span class="sc1">; Делим полученный RND-байт на Единичн.Отрезок</span><span class="sc0">
        </span><span class="sc6">DIV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
</span><span class="sc5">EXRND</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">RETN</span><span class="sc0">
</span><span class="sc5">RND</span><span class="sc0">     </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">TABTRASH</span><span class="sc0">    </span><span class="sc9">PROC</span><span class="sc0">

        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">TRQ</span><span class="sc0">      </span><span class="sc1">;TRASH REQUEST IS MASKED ?</span><span class="sc0">
        </span><span class="sc6">STC</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">TR_EXIT</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,(</span><span class="sc5">TR_TAB_END</span><span class="sc4">-</span><span class="sc5">TRASH_TAB</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">MOVZX</span><span class="sc0">   </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">TRASH_TAB</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">        </span><span class="sc1">; AX , BX , ...</span><span class="sc0">

        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc5">WPR</span><span class="sc0">      </span><span class="sc1">; ПРИСУТСТВУЕТ БИТ W ?</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">ADDREG</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MAKE_W_BIT</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc8">DL</span><span class="sc0">    </span><span class="sc1">; УСТАНОВИМ</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">

        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc5">WPLACE</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">W_PLACE</span><span class="sc0">     </span><span class="sc1">; W В НУЛЕВОМ РАЗРЯДЕ</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">        </span><span class="sc1">; W В ТРЕТЬЕМ РАЗРЯДЕ</span><span class="sc0">
</span><span class="sc5">W_PLACE</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
</span><span class="sc5">ADDREG</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc5">ADDBITS</span><span class="sc0">    </span><span class="sc1">; + RND РЕГИСТР ИЛИ ЧАСТЬ КОМАНДЫ</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">

        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc5">TST</span><span class="sc0">      </span><span class="sc1">; ТЕСТИТЬ РЕГИСТР ?</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">NO_TST</span><span class="sc0">

        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">TEST_USED</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">ADDREG</span><span class="sc0">
</span><span class="sc5">NO_TST</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc5">ROT</span><span class="sc0">      </span><span class="sc1">; НА СКОЛЬКО ПОВЕРНУТЬ</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">

        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">         </span><span class="sc1">; ПОВЕРНЕМ</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">

        </span><span class="sc6">STOSB</span><span class="sc0">

        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc5">WPR</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">NO_ADD_IMM</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc8">DH</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">IMMED8</span><span class="sc0">
        </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">IMMED8</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">NO_ADD_IMM</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc5">Wbit</span><span class="sc0">     </span><span class="sc1">; СБРОСИМ W</span><span class="sc0">
        </span><span class="sc6">CLC</span><span class="sc0">
</span><span class="sc5">TR_EXIT</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">TABTRASH</span><span class="sc0">    </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">MAKE_SUB</span><span class="sc0">    </span><span class="sc9">PROC</span><span class="sc0">

        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">CRQ</span><span class="sc0">     </span><span class="sc1">;CALL REQUEST SET ?</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">ENDCALL</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0EBH</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">JMP_CALL</span><span class="sc4">],</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">

</span><span class="sc1">;        MOV     DL,3        ;TRASHLEN = RND (0...3)</span><span class="sc0">
</span><span class="sc1">;        CALL    TRASHCHAIN</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CALL_ADDR</span><span class="sc4">],</span><span class="sc8">DI</span><span class="sc0">

        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">CRQ</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">EXIT_CALL</span><span class="sc0">
</span><span class="sc5">ENDCALL</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">JRQ</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">SKIP_JMP</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">JMP_TRASH</span><span class="sc0">      </span><span class="sc1">;ЗАКРОЕМ JUMP</span><span class="sc0">
</span><span class="sc5">SKIP_JMP</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">PRQ</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">SKIP_STK</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">STACK_TRASH</span><span class="sc0">    </span><span class="sc1">;ЗАКРОЕМ PUSH/POP</span><span class="sc0">
</span><span class="sc5">SKIP_STK</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">TABTRASH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0C3H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0000H</span><span class="sc0">
</span><span class="sc5">JMP_CALL</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc5">CRQ</span><span class="sc0">
</span><span class="sc5">EXIT_CALL</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">CLC</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">MAKE_SUB</span><span class="sc0">    </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">MAKE_CALL</span><span class="sc0">   </span><span class="sc9">PROC</span><span class="sc0">

        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">CRQ</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">EXIT_CLL</span><span class="sc0">

        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CALL_ADDR</span><span class="sc4">],</span><span class="sc2">0FFFFH</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">EXIT_CLL</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0E8H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc5">CALL_ADDR</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">STOSW</span><span class="sc0">
</span><span class="sc5">EXIT_CLL</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">MAKE_CALL</span><span class="sc0">   </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">JMP_TRASH</span><span class="sc0">   </span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; Формат условного перехода :</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 0111xxxx  -  байт кода операции , второй байт - смещение Rel8</span><span class="sc0">
</span><span class="sc1">;     │</span><span class="sc0">
</span><span class="sc1">;     0 - jo   2 - jb   4 - je   6 - jbe  8 - js   A - jp   C - jl   E - jle</span><span class="sc0">
</span><span class="sc1">;     1 - jno  3 - jae  5 - jne  7 - ja   9 - jns  B - jnp  D - jge  F - jg</span><span class="sc0">


        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">JRQ</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">AddRel8</span><span class="sc0">      </span><span class="sc1">;Закончим Jump</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">01110000B</span><span class="sc0">     </span><span class="sc1">;Jxx Rel8</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">

        </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">   </span><span class="sc1">;Тип Jump'a готов</span><span class="sc0">

        </span><span class="sc6">stosb</span><span class="sc0">           </span><span class="sc1">;сохраняем в цепочке</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">JMP_ADDR</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">   </span><span class="sc1">;адрес Rel8</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">JRQ</span><span class="sc0">  </span><span class="sc1">;Установим Jump Request</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">AddRel8</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc5">JMP_ADDR</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc5">JRQ</span><span class="sc0"> </span><span class="sc1">;Сбросим запрос на завершение Jmp'a</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">JMP_TRASH</span><span class="sc0">   </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">STACK_TRASH</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">JRQ</span><span class="sc0">   </span><span class="sc1">; ЕСЛИ ЕСТЬ ФЛАГ JMP'a ,ТО</span><span class="sc0">
        </span><span class="sc6">STC</span><span class="sc0">         </span><span class="sc1">; ДЕЛАТЬ PUSH/POP НЕЛЬЗЯ</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">EXIT_STK</span><span class="sc0">

        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">CRQ</span><span class="sc0">   </span><span class="sc1">; ЕСЛИ ЕСТЬ ФЛАГ CALL'a ,ТО</span><span class="sc0">
        </span><span class="sc6">STC</span><span class="sc0">         </span><span class="sc1">; ДЕЛАТЬ PUSH/POP НЕЛЬЗЯ</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">EXIT_STK</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">01010000B</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">PRQ</span><span class="sc0">   </span><span class="sc1">; PUSH/POP REQUEST IS SET ?</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">INCSTACK</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">PRQ</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">INCSTACK</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">00001000B</span><span class="sc0">    </span><span class="sc1">; POP REG</span><span class="sc0">
</span><span class="sc5">NXT_REG</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">        </span><span class="sc1">; РЕГИСТР</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">TEST_USED</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">NXT_REG</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc5">PRQ</span><span class="sc0">    </span><span class="sc1">; СБРОСИМ ФЛАГ PUSH/POP</span><span class="sc0">
        </span><span class="sc6">CLC</span><span class="sc0">
</span><span class="sc5">EXIT_STK</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">STACK_TRASH</span><span class="sc0"> </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">SHIFT_TRASH</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">;ВОЗМОЖНО ГЕНЕРЕНИЕ КОМАНД SAL СО СДВИГОМ ЧЕРЕЗ CL</span><span class="sc0">

        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MAKE_W_BIT</span><span class="sc0">   </span><span class="sc1">; СГЕНЕРИМ РАЗРЯДНОСТЬ ОПЕРАНДА</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc8">DL</span><span class="sc0">

        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc5">Dbit</span><span class="sc0">   </span><span class="sc1">; СБРОСИМ БИТ НАПРАВЛЕНИЯ</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">11000000B</span><span class="sc0">     </span><span class="sc1">; КОП</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">

        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">  </span><span class="sc1">; СДВИГ ЧЕРЕЗ CL ИЛИ IMM8</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">

        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">SHIFT_CL</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">
</span><span class="sc5">SHIFT_CL</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">     </span><span class="sc1">; СДВИГ ЧЕРЕЗ IMM8 ИЛИ 1</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">

        </span><span class="sc6">STOSB</span><span class="sc0">

        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">Mode</span><span class="sc0">  </span><span class="sc1">;РАЗРЕШАЕМ ТОЛЬКО РЕГИСТРОВЫЕ СДВИГИ</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MAKE_MODE_RM</span><span class="sc0">
        </span><span class="sc6">POPF</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">EXIT_SHIFT</span><span class="sc0">
        </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">EXIT_SHIFT</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc2">11110000B</span><span class="sc0"> </span><span class="sc1">;СБРОСИМ W,D,MODE БИТЫ КОП'a</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">SHIFT_TRASH</span><span class="sc0"> </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">ARI_IMMED_TRASH</span><span class="sc0"> </span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">;АРИФМЕТИЧЕСКИЙ МУСОР С НЕПОСРЕДСТВЕННЫМ ОПЕРАНДОМ</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">10000000B</span><span class="sc0">     </span><span class="sc1">; КОП</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">  </span><span class="sc1">; БИТ S</span><span class="sc0">

        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">     </span><span class="sc1">; + БИТ S</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">        </span><span class="sc1">; ДЛЯ РАЗМЕРА ОПЕРАНДА</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">

        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MAKE_W_BIT</span><span class="sc0">   </span><span class="sc1">; СГЕНЕРИМ РАЗРЯДНОСТЬ ОПЕРАНДА</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">

        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc8">DL</span><span class="sc0">         </span><span class="sc1">; УСТАНОВИМ W БИТ</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc5">Dbit</span><span class="sc0">   </span><span class="sc1">; СБРОСИМ БИТ НАПРАВЛЕНИЯ</span><span class="sc0">

        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">

        </span><span class="sc6">STOSB</span><span class="sc0">

        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">Mode</span><span class="sc0">  </span><span class="sc1">; РЕГИСТРОВАЯ АДРЕСАЦИЯ</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MAKE_MODE_RM</span><span class="sc0">

        </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">     </span><span class="sc1">;БАЙТОВЫЙ ОПЕРАНД</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">

        </span><span class="sc6">POPF</span><span class="sc0">               </span><span class="sc1">;S=0 ?</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">EXIT_ARI</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">Wbit</span><span class="sc0">     </span><span class="sc1">;W=1 ?</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">EXIT_ARI</span><span class="sc0">

        </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">     </span><span class="sc1">;СЛОВНЫЙ ОПЕРАНД</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">EXIT_ARI</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc2">11110000B</span><span class="sc0"> </span><span class="sc1">;СБРОСИМ W,D,MODE БИТЫ КОП'a</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">ARI_IMMED_TRASH</span><span class="sc0"> </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">ARITHM_TRASH</span><span class="sc0">    </span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">;АРИФМЕТИЧЕСКИЙ МУСОР С КОСВЕННОЙ АДРЕСАЦИЕЙ</span><span class="sc0">

        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MAKE_W_BIT</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">    </span><span class="sc1">; СОХРАНИМ БИТ W</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">    </span><span class="sc1">; КОД ОПЕРАЦИИ</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ARI_MASK</span><span class="sc0">  </span><span class="sc1">;ПРОВЕРЯЕМ КОМАНДУ</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">TYPE_CMD</span><span class="sc0">        </span><span class="sc1">;НА ВОЗМОЖНОСТЬ ИСПОЛЬЗОВАНИЯ</span><span class="sc0">
                        </span><span class="sc1">;АДРЕСАЦИИ В ПАМЯТЬ</span><span class="sc0">
        </span><span class="sc6">PUSHF</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">;ГЕНЕРИМ БИТ D</span><span class="sc0">
        </span><span class="sc6">POPF</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">  </span><span class="sc5">OP_SIZE_REG</span><span class="sc0">

        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">  </span><span class="sc1">;ВОЗМОЖНО ИСПОЛЬЗОВАНИЕ REG/MEM - REG</span><span class="sc0">
</span><span class="sc5">OP_SIZE_REG</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">; БИТ D</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc8">DL</span><span class="sc0">     </span><span class="sc1">; ДОБАВЛЯЕМ В РЕГИСТР КОП'а</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">

        </span><span class="sc6">STOSB</span><span class="sc0">        </span><span class="sc1">;СОХРАНИМ КОП</span><span class="sc0">

        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">MAKE_MODE_RM</span><span class="sc0">

        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc2">11110000B</span><span class="sc0"> </span><span class="sc1">;СБРОСИМ W,D,MODE БИТЫ КОП'a</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">ARITHM_TRASH</span><span class="sc0">    </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">MAKE_W_BIT</span><span class="sc0">  </span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc1">;DL = Wbit</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc5">Wbit</span><span class="sc0">     </span><span class="sc1">; РАЗРЯДНОСТЬ</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc5">REG_USED</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; ЕСЛИ ВСЕ РЕГИСТРЫ ОБЩ.НАЗНАЧЕНИЯ</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DH</span><span class="sc0">       </span><span class="sc1">; ЗАНЯТЫ ,ТО W ДОЛЖЕН БЫТЬ = 1</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DH</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">OP_SIZE16</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">     </span><span class="sc1">; БИТ W=0 - AL , W=1 - AX</span><span class="sc0">
</span><span class="sc5">OP_SIZE16</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">MAKE_W_BIT</span><span class="sc0">  </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">MAKE_MODE_RM</span><span class="sc0">    </span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc1">;ФОРМИРУЕТ ВТОРОЙ БАЙТ КОМАНДЫ - MODE REG/MEM</span><span class="sc0">

        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">Dbit</span><span class="sc0">    </span><span class="sc1">; БИТ D=0 - АДРЕСУЕМ В ПАМЯТЬ</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">TEST_REG</span><span class="sc0">      </span><span class="sc1">; ЛИБО ЕГО НЕТ</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">           </span><span class="sc1">; НЕ БУДЕМ ТЕСТИРОВАТЬ РЕГИСТР</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">        </span><span class="sc1">; ЛИБО ДОПОЛНИТЕЛЬНЫЙ КОП</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">SECOND_BYTE</span><span class="sc0">
</span><span class="sc5">TEST_REG</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">        </span><span class="sc1">; НОМЕР РЕГИСТРА</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">TEST_USED</span><span class="sc0">      </span><span class="sc1">; ИСПОЛЬЗУЕТСЯ ЛИ РЕГИСТР - ?</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">TEST_REG</span><span class="sc0">
</span><span class="sc5">SECOND_BYTE</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">    </span><span class="sc1">; ГЕНЕРИМ БАЙТ</span><span class="sc0">

        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">     </span><span class="sc1">; ПОЛЕ REG/КОП</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">11000000B</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">Mode</span><span class="sc0">  </span><span class="sc1">;ПОЛЕ MODE УЖЕ ЗАДАЛИ ?</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">OPERAND_REG</span><span class="sc0"> </span><span class="sc1">;РЕГИСТРОВАЯ АДРЕСАЦИЯ</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">      </span><span class="sc1">; ПОЛЕ MODE</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">ROR</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">OPERAND_REG</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">      </span><span class="sc1">;ПОЛЕ REG/MEM</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">

        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">11000000B</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">MAKE_REGMEM</span><span class="sc0">
                     </span><span class="sc1">; РЕГИСТРОВАЯ АДРЕСАЦИЯ</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">BT_FLAG</span><span class="sc4">],</span><span class="sc5">Dbit</span><span class="sc0">   </span><span class="sc1">; БИТ D</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">MAKE_REGMEM</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc5">Wbit</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">DH</span><span class="sc4">,[</span><span class="sc5">BT_FLAG</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">NXT_TST_REGMEM</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">TEST_USED</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">MAKE_REGMEM</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">        </span><span class="sc1">;ПОДРАЗУМЕВАЕТСЯ ЧТО ОДИН ВСЕ-ТАКИ ЕСТЬ</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">RND</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">NXT_TST_REGMEM</span><span class="sc0">
</span><span class="sc5">MAKE_REGMEM</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">    </span><span class="sc1">; + REG/MEM</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">    </span><span class="sc1">; + MODE</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">

        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">00000000B</span><span class="sc0">     </span><span class="sc1">;ИНДЕКСНАЯ БЕЗ ДОП. ОПЕРАНДА</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NXT_MODE</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">00000110B</span><span class="sc0">     </span><span class="sc1">;НЕПОСРЕДСТВЕННЫЙ ОПЕРАНД MEM</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">INDEX16</span><span class="sc0">
</span><span class="sc5">NXT_MODE</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">01000000B</span><span class="sc0">     </span><span class="sc1">;ИНДЕКСНАЯ + IMM8</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">INDEX8</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">10000000B</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">ARI_OUT</span><span class="sc0">
</span><span class="sc5">INDEX16</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">;ИНДЕКСНАЯ + IMM16</span><span class="sc0">
        </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">INDEX8</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
        </span><span class="sc6">STOSB</span><span class="sc0">
</span><span class="sc5">ARI_OUT</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">MAKE_MODE_RM</span><span class="sc0">    </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">TEST_USED</span><span class="sc0">   </span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc1">; ZF=1 - РЕГИСТР НЕИСПОЛЬЗУЕТСЯ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; DL - НОМЕР РЕГИСТРА</span><span class="sc0">
</span><span class="sc1">; DH :</span><span class="sc0">
</span><span class="sc1">;      00 - ПОЛУРЕГИСТР</span><span class="sc0">
</span><span class="sc1">;      01 - РЕГИСТР</span><span class="sc0">

        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc8">DH</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">REG_SIZE8</span><span class="sc0">
</span><span class="sc5">REG_SIZE16</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">REG_USED</span><span class="sc4">],</span><span class="sc8">AH</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">OK1</span><span class="sc0">
</span><span class="sc5">REG_SIZE8</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,[</span><span class="sc5">REG_USED</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Маска используемых полурегистров</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">         </span><span class="sc1">; BhChBlCl</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">        </span><span class="sc1">; | | | |</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">          </span><span class="sc1">; 76543210</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">         </span><span class="sc1">;  | | | |</span><span class="sc0">
                      </span><span class="sc1">;  DhAhDlAl</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
</span><span class="sc5">OK1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">TEST_USED</span><span class="sc0">   </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc5">TYPE_CMD</span><span class="sc0">    </span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc1">;DL - КОД КОМАНДЫ (0...7)</span><span class="sc0">
</span><span class="sc1">;BX - ТАБЛИЦА МАСОК</span><span class="sc0">

</span><span class="sc1">;0xxx0xxxb - маска (xxx-код команды)</span><span class="sc0">
</span><span class="sc1">;11111111b - конец масок , или 7 бит взведен</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc5">NEXT_MASK</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc2">0FFH</span><span class="sc0">
        </span><span class="sc6">STC</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">EXIT_CMD_1</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">00000111B</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">EXIT_CMD_0</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NEXT_MASK</span><span class="sc0">
</span><span class="sc5">EXIT_CMD_0</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CLC</span><span class="sc0">
</span><span class="sc5">EXIT_CMD_1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">TYPE_CMD</span><span class="sc0">    </span><span class="sc9">ENDP</span><span class="sc0">

</span></div></body>
</html>
