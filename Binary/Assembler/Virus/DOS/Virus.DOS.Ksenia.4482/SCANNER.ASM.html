<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>SCANNER.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0"> </span><span class="sc5">firstdrv</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc12">'C'</span><span class="sc0">
 </span><span class="sc5">lastdrv</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc12">'E'</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
 </span><span class="sc5">v_id</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0b52dh</span><span class="sc0">

                        </span><span class="sc5">model</span><span class="sc0">   </span><span class="sc10">tiny</span><span class="sc0">
                         </span><span class="sc5">codeseg</span><span class="sc0">
                        </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">100h</span><span class="sc0">
                        </span><span class="sc2">.386</span><span class="sc0">
 </span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2524h</span><span class="sc0">
                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">int24</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">mon_init</span><span class="sc0">

 </span><span class="sc5">scan</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">masker</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">collect</span><span class="sc0">
                        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">nextdrv</span><span class="sc0">
                        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc5">file_cnt</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                        </span><span class="sc6">lodsb</span><span class="sc0">
                        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">'XE'</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">goodext</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">'YS'</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">goodext</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">'OC'</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">scan</span><span class="sc0">

 </span><span class="sc5">goodext</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc5">file_cnt</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">

                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">test_infected</span><span class="sc0">
                        </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">no_inf</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
                        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">
                        </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">allok</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">mon_init</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">rty</span><span class="sc0">
 </span><span class="sc5">allok</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
 </span><span class="sc5">rty</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc5">virused_cnt</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">scan</span><span class="sc0">

 </span><span class="sc5">no_inf</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
                        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">scan</span><span class="sc0">

 </span><span class="sc5">nextdrv</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc5">totfilc</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">masker</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">masker</span><span class="sc4">,</span><span class="sc5">lastdrv</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">scan</span><span class="sc0">

                        </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">totfilc</span><span class="sc0">
                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">file_number</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">count</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">virused_cnt</span><span class="sc0">
                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">vir_asciz</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">count</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">log</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4c00h</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

 </span><span class="sc5">test_infected</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d00h</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">clcret</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc0">
                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">buffer</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">buffer</span><span class="sc4">+</span><span class="sc2">12h</span><span class="sc4">,</span><span class="sc5">v_id</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">clcret</span><span class="sc0">

                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">cured</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">stcret</span><span class="sc0">

 </span><span class="sc5">clcret</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                        </span><span class="sc6">clc</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">

 </span><span class="sc5">stcret</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                        </span><span class="sc6">stc</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">

                        </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">count.inc</span><span class="sc0">
 </span><span class="sc1">; --- cut here ---</span><span class="sc0">
</span><span class="sc1">; подпрограмма "collect" для нахождения файлов по заданной маске</span><span class="sc0">
</span><span class="sc1">; copyright (c) 1998-99 Deadman</span><span class="sc0">
</span><span class="sc1">; на входе: cs:dx - маска</span><span class="sc0">
</span><span class="sc1">; на выходе cs:dx - найденный файл в формате ASCIZ+'$'</span><span class="sc0">
</span><span class="sc1">; если файлов больше нет, то cf=1 и dx = количество найденных до файлов</span><span class="sc0">
</span><span class="sc1">; при повторном вызове работает как "find next"</span><span class="sc0">
</span><span class="sc1">; при отсутствии файлов (cf=1) процедура сбрасывается в режим "find first"</span><span class="sc0">
</span><span class="sc1">; портит регистры: flags, dx</span><span class="sc0">
</span><span class="sc1">; замечание: подпрограмма должна быть расположена последней, т.к. ей</span><span class="sc0">
</span><span class="sc1">; требуется место для хранения DTA вложенных подкаталогов</span><span class="sc0">
 </span><span class="sc5">collect</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">  </span><span class="sc1">; сохранить регистры \dx</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc0">                   </span><span class="sc1">; получить в es:bx адрес</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                      </span><span class="sc1">; текущего dta</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">                    </span><span class="sc1">; сохранить его в стеке</span><span class="sc0">

          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">         </span><span class="sc1">; установить сегментные регистры</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">         </span><span class="sc1">; ds и es на сегмент кода</span><span class="sc0">

          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">fron</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; первый вызов (find first)?</span><span class="sc0">
          </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">find_next</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">in_dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">      </span><span class="sc1">; сохранить смещение маски поиска</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">file_cnt</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">; total files found: 0</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">              </span><span class="sc1">; засунуть в di адрес маски</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
 </span><span class="sc5">col_get_eol</span><span class="sc4">:</span><span class="sc0">                        </span><span class="sc1">; ищем зиро в маске</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">col_get_eol</span><span class="sc0">        </span><span class="sc1">; нашли?</span><span class="sc0">

          </span><span class="sc6">std</span><span class="sc0">                   </span><span class="sc1">; ищем начало голой маски (например, *.COM)</span><span class="sc0">
 </span><span class="sc5">get_mask</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">                 </span><span class="sc1">; считать в al символ</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">':'</span><span class="sc0">        </span><span class="sc1">; разделитель? (c:...)</span><span class="sc0">
          </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">have_got</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc13">'\'        ; \...?
</span><span class="sc0">          </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">have_got</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">         </span><span class="sc1">; если указана голая маска, т.е. без ":" и "\"</span><span class="sc0">
          </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">get_mask</span><span class="sc0">      </span><span class="sc1">; то взять за начало оной смещение из dx</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
 </span><span class="sc5">have_got</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">            </span><span class="sc1">; выравнивание на начало (ебаный std :-)</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">msk_pnt</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">    </span><span class="sc1">; сохранить смещение</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">         </span><span class="sc1">; вычислить количество байт от начала строки</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">         </span><span class="sc1">; до начала маски (т.е. путь)</span><span class="sc0">

          </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">result</span><span class="sc0">     </span><span class="sc1">; перекачать путь из юзеровского буфера в</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">         </span><span class="sc1">; буфер результатов</span><span class="sc0">
          </span><span class="sc6">cld</span><span class="sc0">
          </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">res_post</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">   </span><span class="sc1">; сохранить смещение конца ;-) пути</span><span class="sc0">
 </span><span class="sc5">find_first</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc0">        </span><span class="sc1">; ищем первый файл</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">           </span><span class="sc1">; чтоб не испахабили ah</span><span class="sc0">

 </span><span class="sc5">find_next</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">        </span><span class="sc1">; а тут ищем next</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">         </span><span class="sc1">; устанавливаем dta по адресу, указанному</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">        </span><span class="sc1">; в переменной "dta_pnt"</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">dta_pnt</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0ffefh</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc2">1000b</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">; ищем все ?*:%;( кроме каталогов</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
          </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">check_dir</span><span class="sc0">     </span><span class="sc1">; нету больше файлов -&gt; перейти в другую</span><span class="sc0">
                                </span><span class="sc1">; 'папку'</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">dta_pnt</span><span class="sc0">    </span><span class="sc1">; тута качаем имя и фамилию найденного файла</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc0">        </span><span class="sc1">; по адресу "res_post"</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">res_post</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
 </span><span class="sc5">clear</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc2">0ffh</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">cleared</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc2">20h</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">clear</span><span class="sc0">
 </span><span class="sc5">cleared</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0240dh</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">yes_more</span><span class="sc0">

 </span><span class="sc5">check_dir</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc0">                </span><span class="sc1">; ищем папки</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">res_post</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc12">'.*'</span><span class="sc0">    </span><span class="sc1">; (dir)\(*.*),0</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc12">'*'</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">result</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">             </span><span class="sc1">; это для того, чтобы всякие hidden'ы</span><span class="sc0">
 </span><span class="sc5">check_again</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">; не ускользнули от моего глаза</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
          </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">cd_dotdot</span><span class="sc0">             </span><span class="sc1">; тута ниче нету -&gt; делаем псевдо-CD</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">dta_pnt</span><span class="sc0">            </span><span class="sc1">; иначе тестим юнит, есть ли он</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">                </span><span class="sc1">; нормальная папка, или он</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">1eh</span><span class="sc4">],</span><span class="sc12">'.'</span><span class="sc0"> </span><span class="sc1">; файл или (.)(..), т.е. фильтруем</span><span class="sc0">
          </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">check_again</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">1eh</span><span class="sc4">],</span><span class="sc12">'YCER'</span><span class="sc0">
          </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">check_again</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">1eh</span><span class="sc4">],</span><span class="sc12">'IRIV'</span><span class="sc0">
          </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">check_again</span><span class="sc0">

 </span><span class="sc5">no_virii</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">15h</span><span class="sc4">],</span><span class="sc2">10000b</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">check_again</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">dta_pnt</span><span class="sc0">            </span><span class="sc1">; нашли папку -&gt; перекачать</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc0">                </span><span class="sc1">; название в 'result'</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">res_post</span><span class="sc0">

          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc13">'\'   ; конец пути
</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc5">res_post</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">dta_pnt</span><span class="sc0">            </span><span class="sc1">; сохранить указатель на конец пути</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">43</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">            </span><span class="sc1">; предыдущего уровня</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">msk_pnt</span><span class="sc0">     </span><span class="sc1">; перекачать маску для поиска в ЭТОЙ папке</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

          </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">result</span><span class="sc0">      </span><span class="sc1">; ищем следующие файлы, затем каталоги</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc5">dta_pnt</span><span class="sc4">,</span><span class="sc2">45</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc5">dir_cnt</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">find_first</span><span class="sc0">

 </span><span class="sc5">cd_dotdot</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">; тут надо сделать псевдо CD .. для поиска</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc5">dir_cnt</span><span class="sc0">        </span><span class="sc1">; оставшихся файлов и папок в предыдущей</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_more</span><span class="sc0">        </span><span class="sc1">; папке</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc5">dta_pnt</span><span class="sc4">,</span><span class="sc2">45</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">dta_pnt</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">43</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">res_post</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">check_again</span><span class="sc0">

 </span><span class="sc5">yes_more</span><span class="sc4">:</span><span class="sc0">                                  </span><span class="sc1">; выводим найденный файл</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">file_cnt</span><span class="sc0">        </span><span class="sc1">; количество найденных файлов</span><span class="sc0">
          </span><span class="sc6">clc</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">fron</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; следующий вызов - find next</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">result</span><span class="sc0">

 </span><span class="sc5">exit</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
          </span><span class="sc6">pushf</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
          </span><span class="sc6">popf</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">

          </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">

 </span><span class="sc5">no_more</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">fron</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                        </span><span class="sc1">; сбрасываем переменные</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">dta_pnt</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dtaz</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">dir_cnt</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">file_cnt</span><span class="sc0">                   </span><span class="sc1">; было найдено dx файлов</span><span class="sc0">
          </span><span class="sc6">stc</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">exit</span><span class="sc0">

 </span><span class="sc5">fron</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
 </span><span class="sc5">file_cnt</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
 </span><span class="sc5">dir_cnt</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">
 </span><span class="sc5">dta_pnt</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">dtaz</span><span class="sc0">
 </span><span class="sc5">msk_pnt</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">res_post</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">in_dx</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ah</span><span class="sc0">
 </span><span class="sc5">result</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">100h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">),</span><span class="sc2">0ffh</span><span class="sc0">

</span><span class="sc1">; --- cut here ---</span><span class="sc0">


 </span><span class="sc5">int24</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
                        </span><span class="sc6">iret</span><span class="sc0">

 </span><span class="sc5">mon_init</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc2">100000b</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">cop</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1856h</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3265h</span><span class="sc0">        </span><span class="sc1">; AX=3265 - значит, что копия вируса уже в</span><span class="sc0">

                        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">initret</span><span class="sc0">
                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">mem</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">16h</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
 </span><span class="sc5">initret</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">ret</span><span class="sc0">

 </span><span class="sc5">totfilc</span><span class="sc0">                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
 </span><span class="sc5">cop</span><span class="sc0">                    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"[KSENIA] Virus Finder"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc0">
 </span><span class="sc5">mem</span><span class="sc0">                    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"Virus found in memory"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc0">
 </span><span class="sc5">masker</span><span class="sc0">                 </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc5">firstdrv</span><span class="sc4">,</span><span class="sc3">":\*.*"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
 </span><span class="sc5">log</span><span class="sc0">                    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'------------------------------------'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Total files tested: '</span><span class="sc0">
 </span><span class="sc5">file_number</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">15</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc12">' '</span><span class="sc4">),</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Infected: '</span><span class="sc0">
 </span><span class="sc5">vir_asciz</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">15</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc12">' '</span><span class="sc4">),</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc0">
 </span><span class="sc5">cured</span><span class="sc0">                  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Infected - '</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc0">
 </span><span class="sc5">virused_cnt</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
 </span><span class="sc5">buffer</span><span class="sc0">                 </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">4096</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc5">dtaz</span><span class="sc0">                   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">4096</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

                        </span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">start</span><span class="sc0">
</span></div></body>
</html>
